---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-cs
title: Implementowanie optymistycznej współbieżności z SqlDataSource (C#) | Dokumentacja firmy Microsoft
author: rick-anderson
description: W tym samouczku możemy Przejrzyj podstawowe informacje o optymistyczne sterowanie współbieżnością, a następnie eksplorować implementowania za pomocą formantu SqlDataSource.
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2007
ms.topic: article
ms.assetid: df999966-ac48-460e-b82b-4877a57d6ab9
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-cs
msc.type: authoredcontent
ms.openlocfilehash: 246e8d0c2aee7358680fbca7229cc9b05ceca1cb
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2018
ms.locfileid: "30876166"
---
<a name="implementing-optimistic-concurrency-with-the-sqldatasource-c"></a><span data-ttu-id="ddc0d-103">Implementowanie optymistycznej współbieżności z SqlDataSource (C#)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-103">Implementing Optimistic Concurrency with the SqlDataSource (C#)</span></span>
====================
<span data-ttu-id="ddc0d-104">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ddc0d-105">[Pobierz przykładową aplikację](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_CS.exe) lub [pobierania plików PDF](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/datatutorial50cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_CS.exe) or [Download PDF](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/datatutorial50cs1.pdf)</span></span>

> <span data-ttu-id="ddc0d-106">W tym samouczku możemy Przejrzyj podstawowe informacje o optymistyczne sterowanie współbieżnością, a następnie eksplorować implementowania za pomocą formantu SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-106">In this tutorial we review the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource control.</span></span>


## <a name="introduction"></a><span data-ttu-id="ddc0d-107">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="ddc0d-107">Introduction</span></span>

<span data-ttu-id="ddc0d-108">W poprzednim samouczek możemy zbadać sposób dodawania Wstawianie, aktualizowanie i usuwanie funkcji w celu sterowania SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-108">In the preceding tutorial we examined how to add inserting, updating, and deleting capabilities to the SqlDataSource control.</span></span> <span data-ttu-id="ddc0d-109">Krótko mówiąc, aby zapewnić te funkcje musimy określ odpowiednie `INSERT`, `UPDATE`, lub `DELETE` instrukcji SQL w formancie s `InsertCommand`, `UpdateCommand`, lub `DeleteCommand` właściwości, oraz odpowiedni Parametry w `InsertParameters`, `UpdateParameters`, i `DeleteParameters` kolekcji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-109">In short, to provide these features we needed to specify the corresponding `INSERT`, `UPDATE`, or `DELETE` SQL statement in the control s `InsertCommand`, `UpdateCommand`, or `DeleteCommand` properties, along with the appropriate parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span> <span data-ttu-id="ddc0d-110">Podczas tych właściwości i kolekcji można określić ręcznie, skonfiguruj źródło danych Kreatora s przycisk Zaawansowane oferuje Generuj `INSERT`, `UPDATE`, i `DELETE` na podstawie wyboru instrukcje, która spowoduje automatyczne tworzenie tych instrukcji `SELECT` instrukcji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-110">While these properties and collections can be specified manually, the Configure Data Source wizard s Advanced button offers a Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox that will auto-create these statements based on the `SELECT` statement.</span></span>

<span data-ttu-id="ddc0d-111">Wraz z Generuj `INSERT`, `UPDATE`, i `DELETE` instrukcje wyboru, okno dialogowe Opcje zaawansowane generowania SQL obejmuje użycie opcji optymistycznej współbieżności (zobacz rysunek 1).</span><span class="sxs-lookup"><span data-stu-id="ddc0d-111">Along with the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, the Advanced SQL Generation Options dialog box includes a Use optimistic concurrency option (see Figure 1).</span></span> <span data-ttu-id="ddc0d-112">Po zaznaczeniu tej opcji, `WHERE` klauzule wygenerowana automatycznie `UPDATE` i `DELETE` instrukcje są modyfikowane do wykonywania tylko aktualizacji lub usuwania Jeśli podstawowej t nie zostały danych bazy danych został zmodyfikowany od czasu użytkownika ostatniego załadowania danych w siatce.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-112">When checked, the `WHERE` clauses in the autogenerated `UPDATE` and `DELETE` statements are modified to only perform the update or delete if the underlying database data hasn t been modified since the user last loaded the data into the grid.</span></span>


![Można dodać obsługę optymistycznej współbieżności z zaawansowanych generowanie kodu SQL, opcje — Okno dialogowe](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image1.gif)

<span data-ttu-id="ddc0d-114">**Rysunek 1**: z zaawansowanych można dodać obsługę optymistycznej współbieżności generowanie kodu SQL, opcje — Okno dialogowe</span><span class="sxs-lookup"><span data-stu-id="ddc0d-114">**Figure 1**: You Can Add Optimistic Concurrency Support from the Advanced SQL Generation Options Dialog Box</span></span>


<span data-ttu-id="ddc0d-115">W [implementacja optymistycznej współbieżności](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) samouczek możemy zbadać podstawy optymistyczne sterowanie współbieżnością i jak dodać go do elementu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-115">Back in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial we examined the fundamentals of optimistic concurrency control and how to add it to the ObjectDataSource.</span></span> <span data-ttu-id="ddc0d-116">W tym samouczku będziemy retuszowanie na podstawowe informacje o optymistyczne sterowanie współbieżnością i następnie eksplorować je przy użyciu SqlDataSource implementowania.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-116">In this tutorial we'll retouch on the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource.</span></span>

## <a name="a-recap-of-optimistic-concurrency"></a><span data-ttu-id="ddc0d-117">Drużyn optymistycznej współbieżności</span><span class="sxs-lookup"><span data-stu-id="ddc0d-117">A Recap of Optimistic Concurrency</span></span>

<span data-ttu-id="ddc0d-118">Dla aplikacji sieci web, które pozwalają wielu równoczesnych użytkowników, aby edytować lub usunąć tych samych danych, istnieje możliwość, że jeden użytkownik przypadkowo może zastąpić innego zmiany s.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-118">For web applications that allow multiple, simultaneous users to edit or delete the same data, there exists a possibility that one user may accidentally overwrite another s changes.</span></span> <span data-ttu-id="ddc0d-119">W [implementacja optymistycznej współbieżności](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) samouczka I podane w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-119">In the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial I provided the following example:</span></span>

<span data-ttu-id="ddc0d-120">Załóżmy, że dwóch użytkowników, Jisun i Sam, zostały zarówno odwiedzania strony w aplikacji, która dozwolone osoby odwiedzające aktualizować i usuwać produktów za pomocą kontrolki widoku siatki.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-120">Imagine that two users, Jisun and Sam, were both visiting a page in an application that allowed visitors to update and delete products through a GridView control.</span></span> <span data-ttu-id="ddc0d-121">Zarówno kliknij przycisk Edytuj dla Chai zbliżonym do czasu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-121">Both click the Edit button for Chai around the same time.</span></span> <span data-ttu-id="ddc0d-122">Jisun zmiany nazwy produktu Zepołowy Chai i klika przycisk Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-122">Jisun changes the product name to Chai Tea and clicks the Update button.</span></span> <span data-ttu-id="ddc0d-123">Wynikiem jest `UPDATE` instrukcji, która jest wysyłane do bazy danych, która ustawia *wszystkie* pól można aktualizować produktu s (nawet jeśli Jisun aktualizowana tylko jedno pole `ProductName`).</span><span class="sxs-lookup"><span data-stu-id="ddc0d-123">The net result is an `UPDATE` statement that is sent to the database, which sets *all* of the product s updateable fields (even though Jisun only updated one field, `ProductName`).</span></span> <span data-ttu-id="ddc0d-124">W tym momencie baza danych ma wartości Zepołowy Chai, kategoria Napoje cieczy egzotycznych dostawcy i tak dalej dla tego konkretnego produktu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-124">At this point in time, the database has the values Chai Tea, the category Beverages, the supplier Exotic Liquids, and so on for this particular product.</span></span> <span data-ttu-id="ddc0d-125">Jednak GridView na ekranie s Sam nadal zawiera nazwę produktu w można edytować wiersza elementu GridView jako Chai.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-125">However, the GridView on Sam s screen still shows the product name in the editable GridView row as Chai.</span></span> <span data-ttu-id="ddc0d-126">Kilka sekund po Jisun s zmiany zostały przekazane, Sam aktualizacje kategorii przyprawy i klika aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-126">A few seconds after Jisun s changes have been committed, Sam updates the category to Condiments and clicks Update.</span></span> <span data-ttu-id="ddc0d-127">Powoduje to `UPDATE` instrukcji wysyłane do bazy danych, która ustawia nazwę produktu Chai, `CategoryID` do odpowiednich przyprawy identyfikator kategorii i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-127">This results in an `UPDATE` statement sent to the database that sets the product name to Chai, the `CategoryID` to the corresponding Condiments category ID, and so on.</span></span> <span data-ttu-id="ddc0d-128">Zostały zastąpione Jisun s zmiany nazwy produktu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-128">Jisun s changes to the product name have been overwritten.</span></span>

<span data-ttu-id="ddc0d-129">Rysunek 2 przedstawia to interakcji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-129">Figure 2 illustrates this interaction.</span></span>


<span data-ttu-id="ddc0d-130">[![Gdy dwóch użytkowników jednocześnie zaktualizowania rekordu, potencjalnych s s jeden użytkownik zmienia się na zastąpienie innych s](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-130">[![When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image1.png)</span></span>

<span data-ttu-id="ddc0d-131">**Rysunek 2**: gdy dwóch użytkowników jednocześnie aktualizacja istnieje rekord s potencjalne dla jednego użytkownika s zmiany Zastąp innych s ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="ddc0d-131">**Figure 2**: When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.png))</span></span>


<span data-ttu-id="ddc0d-132">Aby zapobiec unfolding formularza w tym scenariuszu [sterowania współbieżnością](http://en.wikipedia.org/wiki/Concurrency_control) musi zostać wdrożone.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-132">To prevent this scenario from unfolding, a form of [concurrency control](http://en.wikipedia.org/wiki/Concurrency_control) must be implemented.</span></span> <span data-ttu-id="ddc0d-133">[Optymistycznej współbieżności](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) fokus w tym samouczku działa przy założeniu, że może być konfliktom współbieżności i, gdy przeważająca większość czasu takie konflikty won t wynikają.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-133">[Optimistic concurrency](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) the focus of this tutorial works on the assumption that while there may be concurrency conflicts every now and then, the vast majority of the time such conflicts won t arise.</span></span> <span data-ttu-id="ddc0d-134">W związku z tym, w przypadku konfliktu optymistyczne sterowanie współbieżnością po prostu informuje użytkownika zapisania ich zmiany mogą t, ponieważ inny użytkownik zmodyfikował tych samych danych.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-134">Therefore, if a conflict does arise, optimistic concurrency control simply informs the user that their changes can t be saved because another user has modified the same data.</span></span>

> [!NOTE]
> <span data-ttu-id="ddc0d-135">W przypadku aplikacji, w którym zakłada się, że będzie wiele konfliktom współbieżności lub jeśli takie konflikty nie są dopuszczalna następnie sterowania współbieżnością pesymistyczne można zamiast tego.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-135">For applications where it is assumed that there will be many concurrency conflicts or if such conflicts are not tolerable, then pessimistic concurrency control can be used instead.</span></span> <span data-ttu-id="ddc0d-136">Odwołaj się do [implementacja optymistycznej współbieżności](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) samouczka bardziej szczegółowe omówienie współbieżności pesymistyczne formantu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-136">Refer back to the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial for a more thorough discussion on pessimistic concurrency control.</span></span>


<span data-ttu-id="ddc0d-137">Optymistyczne sterowanie współbieżnością działania przez zapewnienie im rekordu są zaktualizowane lub usunięte ma takie same wartości, jak podczas aktualizowania lub usuwania procesu uruchamiania.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-137">Optimistic concurrency control works by ensuring that the record being updated or deleted has the same values as it did when the updating or deleting process started.</span></span> <span data-ttu-id="ddc0d-138">Na przykład po kliknięciu przycisku edycji w GridView edytowalny, wartości rekordu s są do odczytu z bazy danych i wyświetlane w pola tekstowe i inne formanty sieci Web.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-138">For example, when clicking the Edit button in an editable GridView, the record s values are read from the database and displayed in TextBoxes and other Web controls.</span></span> <span data-ttu-id="ddc0d-139">Te oryginalne wartości są zapisywane w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-139">These original values are saved by the GridView.</span></span> <span data-ttu-id="ddc0d-140">Następnie po użytkownik wprowadza swoje zmiany i kliknięciu przycisku Aktualizuj `UPDATE` instrukcją użytą w należy wziąć pod uwagę oryginalnych wartości oraz nowych wartości i aktualizować tylko podstawowy rekordów bazy danych w przypadku oryginalnej wartości, że użytkownik rozpoczął edycję są takie same jak wartości nadal w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-140">Later, after the user makes her changes and clicks the Update button, the `UPDATE` statement used must take into account the original values plus the new values and only update the underlying database record if the original values that the user started editing are identical to the values still in the database.</span></span> <span data-ttu-id="ddc0d-141">Rysunek 3 przedstawia następująca sekwencja zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-141">Figure 3 depicts this sequence of events.</span></span>


<span data-ttu-id="ddc0d-142">[![Dla aktualizacji lub usunięcia, które było poprawne oryginalnych wartości musi być równa wartości bieżącej bazy danych](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-142">[![For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.png)</span></span>

<span data-ttu-id="ddc0d-143">**Rysunek 3**: For Update lub Delete pomyślnie oryginalnej wartości musi być równa wartości bieżącej bazy danych ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="ddc0d-143">**Figure 3**: For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.png))</span></span>


<span data-ttu-id="ddc0d-144">Istnieją różne podejścia do wdrażania optymistycznej współbieżności (zobacz [Bromberg A. Peterowi](http://www.eggheadcafe.com/articles/pbrombergresume.asp) s [logikę aktualizowania współbieżności Optmistic](http://www.eggheadcafe.com/articles/20050719.asp) dla krótki opis wiele opcji).</span><span class="sxs-lookup"><span data-stu-id="ddc0d-144">There are various approaches to implementing optimistic concurrency (see [Peter A. Bromberg](http://www.eggheadcafe.com/articles/pbrombergresume.asp) s [Optmistic Concurrency Updating Logic](http://www.eggheadcafe.com/articles/20050719.asp) for a brief look at a number of options).</span></span> <span data-ttu-id="ddc0d-145">Wspomaga zastosowanych SqlDataSource (oraz ADO.NET wpisanych zestawów danych użytych w naszym Warstwa dostępu do danych) `WHERE` klauzulę porównanie wszystkich oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-145">The technique used by the SqlDataSource (as well as by the ADO.NET Typed DataSets used in our Data Access Layer) augments the `WHERE` clause to include a comparison of all of the original values.</span></span> <span data-ttu-id="ddc0d-146">Następujące `UPDATE` instrukcji, na przykład aktualizacje nazwy i cena produktu tylko wtedy, gdy bieżące wartości bazy danych są takie same wartości, które pierwotnie zostały pobrane podczas aktualizacji rekordu w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-146">The following `UPDATE` statement, for example, updates the name and price of a product only if the current database values are equal to the values that were originally retrieved when updating the record in the GridView.</span></span> <span data-ttu-id="ddc0d-147">`@ProductName` i `@UnitPrice` parametrów zawiera nowe wartości wprowadzonej przez użytkownika, podczas gdy `@original_ProductName` i `@original_UnitPrice` zawierają wartości, które pierwotnie zostały załadowane w widoku GridView, gdy kliknięto przycisk Edytuj:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-147">The `@ProductName` and `@UnitPrice` parameters contain the new values entered by the user, whereas `@original_ProductName` and `@original_UnitPrice` contain the values that were originally loaded into the GridView when the Edit button was clicked:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample1.sql)]

<span data-ttu-id="ddc0d-148">Jak zajmiemy się tym, w tym samouczku, włączanie optymistyczne sterowanie współbieżnością z SqlDataSource jest tak proste, jak sprawdzanie pola wyboru.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-148">As we'll see in this tutorial, enabling optimistic concurrency control with the SqlDataSource is as simple as checking a checkbox.</span></span>

## <a name="step-1-creating-a-sqldatasource-that-supports-optimistic-concurrency"></a><span data-ttu-id="ddc0d-149">Krok 1: Tworzenie SqlDataSource obsługującego optymistycznej współbieżności</span><span class="sxs-lookup"><span data-stu-id="ddc0d-149">Step 1: Creating a SqlDataSource that Supports Optimistic Concurrency</span></span>

<span data-ttu-id="ddc0d-150">Uruchamianie przez otwarcie `OptimisticConcurrency.aspx` strony z `SqlDataSource` folderu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-150">Start by opening the `OptimisticConcurrency.aspx` page from the `SqlDataSource` folder.</span></span> <span data-ttu-id="ddc0d-151">Przeciągnij z przybornika do projektanta, ustawienia kontroli SqlDataSource jego `ID` właściwości `ProductsDataSourceWithOptimisticConcurrency`.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-151">Drag a SqlDataSource control from the Toolbox onto the Designer, settings its `ID` property to `ProductsDataSourceWithOptimisticConcurrency`.</span></span> <span data-ttu-id="ddc0d-152">Następnie kliknij łącze Konfigurowanie źródła danych z tagów inteligentnych s formantu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-152">Next, click on the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="ddc0d-153">Na pierwszym ekranie kreatora wybierz do pracy z `NORTHWINDConnectionString` i kliknij przycisk Dalej.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-153">From the first screen in the wizard, choose to work with the `NORTHWINDConnectionString` and click Next.</span></span>


<span data-ttu-id="ddc0d-154">[![Wybierz do pracy z NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-154">[![Choose to Work with the NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.png)</span></span>

<span data-ttu-id="ddc0d-155">**Rysunek 4**: Wybierz pracować z `NORTHWINDConnectionString` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ddc0d-155">**Figure 4**: Choose to Work with the `NORTHWINDConnectionString` ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.png))</span></span>


<span data-ttu-id="ddc0d-156">W tym przykładzie, które będą dodawane GridView, która umożliwia użytkownikom edytowanie `Products` tabeli.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-156">For this example we'll be adding a GridView that enables users to edit the `Products` table.</span></span> <span data-ttu-id="ddc0d-157">W związku z tym z konfiguracji ekranu instrukcji Select wybierz `Products` tabeli z listy rozwijanej i wybierz `ProductID`, `ProductName`, `UnitPrice`, i `Discontinued` kolumny, jak pokazano na rysunku 5.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-157">Therefore, from the Configure the Select Statement screen, choose the `Products` table from the drop-down list and select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns, as shown in Figure 5.</span></span>


<span data-ttu-id="ddc0d-158">[![Z tabeli Produkty zwrócić ProductID, ProductName, UnitPrice i wycofane kolumn](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-158">[![From the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.png)</span></span>

<span data-ttu-id="ddc0d-159">**Rysunek 5**: Z `Products` tabeli, aby uzyskać `ProductID`, `ProductName`, `UnitPrice`, i `Discontinued` kolumn ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="ddc0d-159">**Figure 5**: From the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.png))</span></span>


<span data-ttu-id="ddc0d-160">Po pobraniu kolumny, kliknij przycisk Zaawansowane, aby wyświetlić okno dialogowe Opcje zaawansowane generowania SQL.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-160">After picking the columns, click the Advanced button to bring up the Advanced SQL Generation Options dialog box.</span></span> <span data-ttu-id="ddc0d-161">Sprawdź generowanie `INSERT`, `UPDATE`, i `DELETE` instrukcje i użyj pól wyboru optymistycznej współbieżności i kliknij przycisk OK (odwołują się do rysunku 1 dla zrzut ekranu).</span><span class="sxs-lookup"><span data-stu-id="ddc0d-161">Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements and Use optimistic concurrency checkboxes and click OK (refer back to Figure 1 for a screenshot).</span></span> <span data-ttu-id="ddc0d-162">Ukończ pracę kreatora, klikając przycisk Dalej, a następnie Zakończ.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-162">Complete the wizard by clicking Next, then Finish.</span></span>

<span data-ttu-id="ddc0d-163">Po zakończeniu pracy Kreatora konfigurowania źródła danych, Poświęć chwilę, aby zbadać powstałe w ten sposób `DeleteCommand` i `UpdateCommand` właściwości i `DeleteParameters` i `UpdateParameters` kolekcji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-163">After completing the Configure Data Source wizard, take a moment to examine the resulting `DeleteCommand` and `UpdateCommand` properties and the `DeleteParameters` and `UpdateParameters` collections.</span></span> <span data-ttu-id="ddc0d-164">W tym celu najłatwiej kliknij w lewym dolnym rogu, aby wyświetlić stronę składni deklaratywnej s na karcie Źródło.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-164">The easiest way to do this is to click on the Source tab in the lower left corner to see the page s declarative syntax.</span></span> <span data-ttu-id="ddc0d-165">Można znaleźć `UpdateCommand` wartość:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-165">There you will find an `UpdateCommand` value of:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample2.sql)]

<span data-ttu-id="ddc0d-166">Z parametrami siedmiu w `UpdateParameters` kolekcji:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-166">With seven parameters in the `UpdateParameters` collection:</span></span>


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample3.aspx)]

<span data-ttu-id="ddc0d-167">Podobnie `DeleteCommand` właściwości i `DeleteParameters` kolekcji powinna wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-167">Similarly, the `DeleteCommand` property and `DeleteParameters` collection should look like the following:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample4.sql)]


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample5.aspx)]

<span data-ttu-id="ddc0d-168">Oprócz rozbudować `WHERE` klauzul `UpdateCommand` i `DeleteCommand` właściwości (i dodanie dodatkowych parametrów do kolekcji odpowiednich parametrów), wybierając optymistycznej współbieżności opcja dostosowuje dwie inne użycia Właściwości:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-168">In addition to augmenting the `WHERE` clauses of the `UpdateCommand` and `DeleteCommand` properties (and adding the additional parameters to the respective parameter collections), selecting the Use optimistic concurrency option adjusts two other properties:</span></span>

- <span data-ttu-id="ddc0d-169">Zmiany [ `ConflictDetection` właściwości](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) z `OverwriteChanges` (ustawienie domyślne) do `CompareAllValues`</span><span class="sxs-lookup"><span data-stu-id="ddc0d-169">Changes the [`ConflictDetection` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) from `OverwriteChanges` (the default) to `CompareAllValues`</span></span>
- <span data-ttu-id="ddc0d-170">Zmiany [ `OldValuesParameterFormatString` właściwości](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) z {0} (ustawienie domyślne) z oryginalną\_{0}.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-170">Changes the [`OldValuesParameterFormatString` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) from {0} (the default) to original\_{0} .</span></span>

<span data-ttu-id="ddc0d-171">Gdy dane kontrolka sieci Web wywołuje SqlDataSource s `Update()` lub `Delete()` metody przekazaniem w oryginalnych wartości.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-171">When the data Web control invokes the SqlDataSource s `Update()` or `Delete()` method, it passes in the original values.</span></span> <span data-ttu-id="ddc0d-172">Jeśli SqlDataSource s `ConflictDetection` właściwość jest ustawiona na `CompareAllValues`, te oryginalne wartości są dodawane do polecenia.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-172">If the SqlDataSource s `ConflictDetection` property is set to `CompareAllValues`, these original values are added to the command.</span></span> <span data-ttu-id="ddc0d-173">`OldValuesParameterFormatString` Dostarcza wzorzec nazewnictwa używane dla oryginalnej wartości parametrów.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-173">The `OldValuesParameterFormatString` property provides the naming pattern used for these original value parameters.</span></span> <span data-ttu-id="ddc0d-174">Kreator konfigurowania źródła danych przy użyciu oryginalnego\_{0} oraz nazwy każdego parametru oryginalnego `UpdateCommand` i `DeleteCommand` właściwości i `UpdateParameters` i `DeleteParameters` kolekcji odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-174">The Configure Data Source wizard uses original\_{0} and names each original parameter in the `UpdateCommand` and `DeleteCommand` properties and `UpdateParameters` and `DeleteParameters` collections accordingly.</span></span>

> [!NOTE]
> <span data-ttu-id="ddc0d-175">Ponieważ firma Microsoft re nie używa s kontroli SqlDataSource Wstawianie możliwości, możesz usunąć `InsertCommand` właściwość i jej `InsertParameters` kolekcji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-175">Since we re not using the SqlDataSource control s inserting capabilities, feel free to remove the `InsertCommand` property and its `InsertParameters` collection.</span></span>


## <a name="correctly-handlingnullvalues"></a><span data-ttu-id="ddc0d-176">Obsługa poprawnie`NULL`wartości</span><span class="sxs-lookup"><span data-stu-id="ddc0d-176">Correctly Handling`NULL`Values</span></span>

<span data-ttu-id="ddc0d-177">Niestety, zwiększonej `UPDATE` i `DELETE` czy automatycznie instrukcje wygenerowana przez Kreatora konfigurowania źródła danych, używając optymistycznej współbieżności *nie* pracować z rekordów, które zawierają `NULL` wartości.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-177">Unfortunately, the augmented `UPDATE` and `DELETE` statements autogenerated by the Configure Data Source wizard when using optimistic concurrency do *not* work with records that contain `NULL` values.</span></span> <span data-ttu-id="ddc0d-178">Aby zobaczyć przyczynę, należy wziąć pod uwagę naszych s SqlDataSource `UpdateCommand`:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-178">To see why, consider our SqlDataSource s `UpdateCommand`:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample6.sql)]

<span data-ttu-id="ddc0d-179">`UnitPrice` Kolumny w `Products` tabela może mieć `NULL` wartości.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-179">The `UnitPrice` column in the `Products` table can have `NULL` values.</span></span> <span data-ttu-id="ddc0d-180">Jeśli został określony rekord `NULL` wartość `UnitPrice`, `WHERE` części klauzuli `[UnitPrice] = @original_UnitPrice` będzie *zawsze* obliczyć wartość false, ponieważ `NULL = NULL` zawsze zwraca wartość False.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-180">If a particular record has a `NULL` value for `UnitPrice`, the `WHERE` clause portion `[UnitPrice] = @original_UnitPrice` will *always* evaluate to False because `NULL = NULL` always returns False.</span></span> <span data-ttu-id="ddc0d-181">W związku z tym rekordy zawierających `NULL` wartości nie można edytować ani usunąć, jako `UPDATE` i `DELETE` instrukcje `WHERE` klauzule won powrotu t wszystkie wiersze, aby zaktualizować lub usunąć.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-181">Therefore, records that contain `NULL` values cannot be edited or deleted, as the `UPDATE` and `DELETE` statements `WHERE` clauses won t return any rows to update or delete.</span></span>

> [!NOTE]
> <span data-ttu-id="ddc0d-182">Ta usterka najpierw zostało zgłoszone do firmy Microsoft w czerwca 2004 w [SqlDataSource generuje niepoprawne instrukcji SQL](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) i powinno zostanie rozwiązany w następnej wersji platformy ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-182">This bug was first reported to Microsoft in June of 2004 in [SqlDataSource Generates Incorrect SQL Statements](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) and is reportedly scheduled to be fixed in the next version of ASP.NET.</span></span>


<span data-ttu-id="ddc0d-183">Aby rozwiązać ten problem, konieczne jest ręczne uaktualnienie `WHERE` klauzule zarówno `UpdateCommand` i `DeleteCommand` właściwości **wszystkie** kolumn, które mogą zostać `NULL` wartości.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-183">To fix this, we have to manually update the `WHERE` clauses in both the `UpdateCommand` and `DeleteCommand` properties for **all** columns that can have `NULL` values.</span></span> <span data-ttu-id="ddc0d-184">Ogólnie rzecz biorąc, zmień `[ColumnName] = @original_ColumnName` do:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-184">In general, change `[ColumnName] = @original_ColumnName` to:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample7.sql)]

<span data-ttu-id="ddc0d-185">Ta modyfikacja może się bezpośrednio za pomocą deklaratywne znaczników, za pomocą opcji UpdateQuery lub DeleteQuery z okna właściwości lub aktualizacji i usuwanie kart Określ niestandardową instrukcję SQL lub procedurę składowaną opcję Konfigurowanie danych Kreator źródła.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-185">This modification can be made directly through the declarative markup, via the UpdateQuery or DeleteQuery options from the Properties window, or through the UPDATE and DELETE tabs in the Specify a custom SQL statement or stored procedure option in the Configure Data Source wizard.</span></span> <span data-ttu-id="ddc0d-186">Ponownie, należy przewidzieć modyfikacji *co* kolumny w `UpdateCommand` i `DeleteCommand` s `WHERE` klauzuli, która może zawierać `NULL` wartości.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-186">Again, this modification must be made for *every* column in the `UpdateCommand` and `DeleteCommand` s `WHERE` clause that can contain `NULL` values.</span></span>

<span data-ttu-id="ddc0d-187">Powoduje to zastosowanie do naszym przykładzie zmodyfikować następujące `UpdateCommand` i `DeleteCommand` wartości:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-187">Applying this to our example results in the following modified `UpdateCommand` and `DeleteCommand` values:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample8.sql)]

## <a name="step-2-adding-a-gridview-with-edit-and-delete-options"></a><span data-ttu-id="ddc0d-188">Krok 2: Dodawanie Element GridView z właściwością edytowania i usuwania opcji</span><span class="sxs-lookup"><span data-stu-id="ddc0d-188">Step 2: Adding a GridView with Edit and Delete Options</span></span>

<span data-ttu-id="ddc0d-189">Z SqlDataSource skonfigurowany do obsługi optymistycznej współbieżności czy pozostaje jest dodanie danych formantu sieci Web do strony, która korzysta z tego formantu współbieżności.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-189">With the SqlDataSource configured to support optimistic concurrency, all that remains is to add a data Web control to the page that utilizes this concurrency control.</span></span> <span data-ttu-id="ddc0d-190">W tym samouczku umożliwiają s dodawania widoku GridView, zapewniająca zarówno edycji i usuwania funkcji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-190">For this tutorial, let s add a GridView that provides both edit and delete functionality.</span></span> <span data-ttu-id="ddc0d-191">Aby to zrobić, przeciągnij element GridView z przybornika do projektanta i zestaw jej `ID` do `Products`.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-191">To accomplish this, drag a GridView from the Toolbox onto the Designer and set its `ID` to `Products`.</span></span> <span data-ttu-id="ddc0d-192">Z tagów inteligentnych s GridView powiązać `ProductsDataSourceWithOptimisticConcurrency` kontroli SqlDataSource dodany w kroku 1.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-192">From the GridView s smart tag, bind it to the `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource control added in Step 1.</span></span> <span data-ttu-id="ddc0d-193">Ponadto sprawdź opcje Włącz edytowanie i usuwanie Włącz z tagów inteligentnych.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-193">Finally, check the Enable Editing and Enable Deleting options from the smart tag.</span></span>


<span data-ttu-id="ddc0d-194">[![Powiązać widoku GridView SqlDataSource i Włącz edytowanie i usuwanie](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-194">[![Bind the GridView to the SqlDataSource and Enable Editing and Deleting](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.png)</span></span>

<span data-ttu-id="ddc0d-195">**Rysunek 6**: powiązać widoku GridView SqlDataSource i Włącz edytowanie i usuwanie ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="ddc0d-195">**Figure 6**: Bind the GridView to the SqlDataSource and Enable Editing and Deleting ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image10.png))</span></span>


<span data-ttu-id="ddc0d-196">Po dodaniu widoku GridView, skonfiguruj jego wygląd przez usunięcie `ProductID` elementu BoundField, zmiana `ProductName` s elementu BoundField `HeaderText` właściwości produktu i aktualizowanie `UnitPrice` elementu BoundField, aby jego `HeaderText` jest właściwość po prostu cena.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-196">After adding the GridView, configure its appearance by removing the `ProductID` BoundField, changing the `ProductName` BoundField s `HeaderText` property to Product, and updating the `UnitPrice` BoundField so that its `HeaderText` property is simply Price.</span></span> <span data-ttu-id="ddc0d-197">W idealnym przypadku d zwiększania edycji interfejsu, który ma zawierać RequiredFieldValidator dla `ProductName` wartość i CompareValidator dla `UnitPrice` wartość (aby upewnić się, że jest poprawnie sformatowana wartość liczbowa s).</span><span class="sxs-lookup"><span data-stu-id="ddc0d-197">Ideally, we d enhance the editing interface to include a RequiredFieldValidator for the `ProductName` value and a CompareValidator for the `UnitPrice` value (to ensure it s a properly formatted numeric value).</span></span> <span data-ttu-id="ddc0d-198">Zapoznaj się [Dostosowywanie interfejs modyfikacji danych](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) samouczka na pełniejsze przyjrzeć się Dostosowywanie s GridView edycji interfejsu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-198">Refer to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial for a more in-depth look at customizing the GridView s editing interface.</span></span>

> [!NOTE]
> <span data-ttu-id="ddc0d-199">GridView, który musi być włączony stan widoku s, ponieważ oryginalne wartości przekazane z widoku GridView do SqlDataSource są przechowywane w widoku stanu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-199">The GridView s view state must be enabled since the original values passed from the GridView to the SqlDataSource are stored in view state.</span></span>


<span data-ttu-id="ddc0d-200">Po wprowadzeniu tych zmian do widoku GridView, znaczników deklaratywne GridView i SqlDataSource powinien wyglądać podobny do następującego:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-200">After making these modifications to the GridView, the GridView and SqlDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample9.aspx)]

<span data-ttu-id="ddc0d-201">Aby zobaczyć kontrolki optymistycznej współbieżności na akcję, Otwórz dwa okna przeglądarki i załadować `OptimisticConcurrency.aspx` strony w obu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-201">To see the optimistic concurrency control in action, open two browser windows and load the `OptimisticConcurrency.aspx` page in both.</span></span> <span data-ttu-id="ddc0d-202">Kliknij przyciski edycji dla pierwszego produktu w obu przeglądarkach.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-202">Click on the Edit buttons for the first product in both browsers.</span></span> <span data-ttu-id="ddc0d-203">W jednej przeglądarki Zmień nazwę produktu, a następnie kliknij przycisk Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-203">In one browser, change the product name and click Update.</span></span> <span data-ttu-id="ddc0d-204">Przeglądarka będzie ogłaszanie i widoku GridView powróci do trybu edycji wstępnie przedstawiający nową nazwę produktu dla rekordu właśnie edytowany.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-204">The browser will postback and the GridView will return to its pre-editing mode, showing the new product name for the record just edited.</span></span>

<span data-ttu-id="ddc0d-205">W oknie przeglądarki drugi zmiany ceny (ale pozostaw nazwę produktu jako wartości oryginalnej), a następnie kliknij przycisk Aktualizuj.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-205">In the second browser window, change the price (but leave the product name as its original value) and click Update.</span></span> <span data-ttu-id="ddc0d-206">Odświeżania strony siatki powróci do trybu edycji wstępnie, ale zmiany ceny nie została zarejestrowana.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-206">On postback, the grid returns to its pre-editing mode, but the change to the price is not recorded.</span></span> <span data-ttu-id="ddc0d-207">Drugi przeglądarki zawiera tę samą wartość jak pierwszy nazwę produktu z stara cena.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-207">The second browser shows the same value as the first one the new product name with the old price.</span></span> <span data-ttu-id="ddc0d-208">Zmiany wprowadzone w oknie przeglądarki drugi zostały utracone.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-208">The changes made in the second browser window were lost.</span></span> <span data-ttu-id="ddc0d-209">Ponadto zmiany zostały utracone raczej ciche, ponieważ nie było żadnych wyjątków lub komunikat wskazujący, czy naruszenie współbieżności właśnie wystąpił.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-209">Moreover, the changes were lost rather quietly, as there was no exception or message indicating that a concurrency violation just occurred.</span></span>


<span data-ttu-id="ddc0d-210">[![Zmiany w oknie przeglądarki drugi zostały utracone w trybie dyskretnym](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-210">[![The Changes in the Second Browser Window Were Silently Lost](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image11.png)</span></span>

<span data-ttu-id="ddc0d-211">**Rysunek 7**: zmiany w drugim przeglądarki okna zostały dyskretnie utraty ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ddc0d-211">**Figure 7**: The Changes in the Second Browser Window Were Silently Lost ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image12.png))</span></span>


<span data-ttu-id="ddc0d-212">Został przyczyny, dlaczego drugi zmiany przeglądarce s nie zostały zatwierdzone, ponieważ `UPDATE` instrukcja s `WHERE` klauzul odfiltrowane wszystkie rekordy i w związku z tym, nie wpływa na żadne wiersze.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-212">The reason why the second browser s changes were not committed was because the `UPDATE` statement s `WHERE` clause filtered out all records and therefore did not affect any rows.</span></span> <span data-ttu-id="ddc0d-213">Let s przyjrzeć się `UPDATE` ponownie instrukcji:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-213">Let s look at the `UPDATE` statement again:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample10.sql)]

<span data-ttu-id="ddc0d-214">Po drugie okno przeglądarki aktualizacji rekordu, oryginalną nazwę produktu określone w `WHERE` klauzuli są zgodne się z istniejącą nazwą produktu (ponieważ został zmieniony przez przeglądarkę pierwszy).</span><span class="sxs-lookup"><span data-stu-id="ddc0d-214">When the second browser window updates the record, the original product name specified in the `WHERE` clause doesn t match up with the existing product name (since it was changed by the first browser).</span></span> <span data-ttu-id="ddc0d-215">W związku z tym instrukcji `[ProductName] = @original_ProductName` zwraca wartość False, a `UPDATE` nie ma wpływu na rekordy.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-215">Therefore, the statement `[ProductName] = @original_ProductName` returns False, and the `UPDATE` does not affect any records.</span></span>

> [!NOTE]
> <span data-ttu-id="ddc0d-216">Usuń działa w taki sam sposób.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-216">Delete works in the same manner.</span></span> <span data-ttu-id="ddc0d-217">Dwa okna przeglądarki Otwórz rozpocząć edycji danego produktu z jednym, a następnie zapisz jego zmiany.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-217">With two browser windows open, start by editing a given product with one, and then saving its changes.</span></span> <span data-ttu-id="ddc0d-218">Po zapisaniu zmian w jednej przeglądarki, kliknij przycisk Usuń dla tego samego produktu w innym.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-218">After saving the changes in the one browser, click the Delete button for the same product in the other.</span></span> <span data-ttu-id="ddc0d-219">Ponieważ oryginalne ADAM wartości t są zgodne w `DELETE` instrukcja s `WHERE` klauzuli delete dyskretnie nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-219">Since the original values don t match up in the `DELETE` statement s `WHERE` clause, the delete silently fails.</span></span>


<span data-ttu-id="ddc0d-220">Z perspektywy użytkownika końcowego s w drugim oknie przeglądarki po kliknięciu przycisku Aktualizuj siatki powraca do trybu edycji wstępnie, ale ich zmiany zostały utracone.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-220">From the end user s perspective in the second browser window, after clicking the Update button the grid returns to the pre-editing mode, but their changes were lost.</span></span> <span data-ttu-id="ddc0d-221">Jednak tam s nie wizualny, który trzymaj t ich zmiany.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-221">However, there s no visual feedback that their changes didn t stick.</span></span> <span data-ttu-id="ddc0d-222">Najlepiej Jeśli zmiany użytkowników s zostaną utracone na naruszenie współbieżności, możemy d powiadamiać użytkowników i czasem zachować siatki w trybie edycji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-222">Ideally, if a user s changes are lost to a concurrency violation, we d notify them and, perhaps, keep the grid in edit mode.</span></span> <span data-ttu-id="ddc0d-223">Let s, zobacz, jak to zrobić.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-223">Let s look at how to accomplish this.</span></span>

## <a name="step-3-determining-when-a-concurrency-violation-has-occurred"></a><span data-ttu-id="ddc0d-224">Krok 3: Określanie wystąpienia Naruszenie współbieżności</span><span class="sxs-lookup"><span data-stu-id="ddc0d-224">Step 3: Determining When a Concurrency Violation Has Occurred</span></span>

<span data-ttu-id="ddc0d-225">Ponieważ Naruszenie współbieżności odrzuci jedną wprowadził zmiany, byłoby nieuprzywilejowany alertu użytkownika, jeśli nastąpiło naruszenie współbieżności.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-225">Since a concurrency violation rejects the changes one has made, it would be nice to alert the user when a concurrency violation has occurred.</span></span> <span data-ttu-id="ddc0d-226">Aby ostrzec użytkownika, umożliwiają s Dodawanie formantu etykiety w sieci Web do górnej części strony o nazwie `ConcurrencyViolationMessage` których `Text` właściwości wyświetli następujący komunikat: próbowano zaktualizować lub usunąć rekord, który jednocześnie został zaktualizowany przez innego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-226">To alert the user, let s add a Label Web control to the top of the page named `ConcurrencyViolationMessage` whose `Text` property displays the following message: You have attempted to update or delete a record that was simultaneously updated by another user.</span></span> <span data-ttu-id="ddc0d-227">Należy Przejrzyj zmiany wprowadzone przez użytkownika, a następnie wykonaj ponownie aktualizację lub Usuń.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-227">Please review the other user's changes and then redo your update or delete.</span></span> <span data-ttu-id="ddc0d-228">Ustawianie formantu etykiety s `CssClass` właściwości na ostrzeżenie, czyli klasę CSS zdefiniowanych w `Styles.css` wyświetlającym tekst w czcionki czerwony, kursywa bold i duże.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-228">Set the Label control s `CssClass` property to Warning, which is a CSS class defined in `Styles.css` that displays text in a red, italic, bold, and large font.</span></span> <span data-ttu-id="ddc0d-229">Wreszcie, ustaw etykiety s `Visible` i `EnableViewState` właściwości `false`.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-229">Finally, set the Label s `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="ddc0d-230">Spowoduje to ukrycie etykiety z wyjątkiem tylko ogłaszania, te zwrotnego którym możemy jawnie ustawić jej `Visible` właściwości `true`.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-230">This will hide the Label except for only those postbacks where we explicitly set its `Visible` property to `true`.</span></span>


<span data-ttu-id="ddc0d-231">[![Dodawanie formantu etykiety do strony, aby wyświetlić ostrzeżenia](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-231">[![Add a Label Control to the Page to Display the Warning](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image13.png)</span></span>

<span data-ttu-id="ddc0d-232">**Rysunek 8**: Dodawanie formantu etykiety do strony, aby wyświetlić ostrzeżenia ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="ddc0d-232">**Figure 8**: Add a Label Control to the Page to Display the Warning ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image14.png))</span></span>


<span data-ttu-id="ddc0d-233">Podczas przeprowadzania aktualizacji lub usuwania, GridView s `RowUpdated` i `RowDeleted` uruchomienie procedury obsługi zdarzeń po jego kontroli źródła danych wykonał żądanej update lub delete.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-233">When performing an update or delete, the GridView s `RowUpdated` and `RowDeleted` event handlers fire after its data source control has performed the requested update or delete.</span></span> <span data-ttu-id="ddc0d-234">Można określić liczbę wierszy objętych operacji te programy obsługi zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-234">We can determine how many rows were affected by the operation from these event handlers.</span></span> <span data-ttu-id="ddc0d-235">Jeśli zero wierszy została zmieniona, chcemy wyświetlić `ConcurrencyViolationMessage` etykiety.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-235">If zero rows were affected, we want to display the `ConcurrencyViolationMessage` Label.</span></span>

<span data-ttu-id="ddc0d-236">Tworzenie procedury obsługi zdarzeń dla obu `RowUpdated` i `RowDeleted` zdarzeń i Dodaj następujący kod:</span><span class="sxs-lookup"><span data-stu-id="ddc0d-236">Create an event handler for both the `RowUpdated` and `RowDeleted` events and add the following code:</span></span>


[!code-csharp[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample11.cs)]

<span data-ttu-id="ddc0d-237">W obu programów obsługi zdarzeń sprawdzamy `e.AffectedRows` właściwości i, jeśli ma on wartość równą 0, ustaw `ConcurrencyViolationMessage` etykiety s `Visible` właściwości `true`.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-237">In both event handlers we check the `e.AffectedRows` property and, if it equals 0, set the `ConcurrencyViolationMessage` Label s `Visible` property to `true`.</span></span> <span data-ttu-id="ddc0d-238">W `RowUpdated` program obsługi zdarzeń, możemy także poinstruować GridView pozostanie w trybie edycji przez ustawienie `KeepInEditMode` właściwości na wartość true.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-238">In the `RowUpdated` event handler, we also instruct the GridView to stay in edit mode by setting the `KeepInEditMode` property to true.</span></span> <span data-ttu-id="ddc0d-239">W ten sposób, musimy ponownie powiązać dane do siatki, dzięki czemu inne dane użytkownika s jest ładowany do edycji interfejsu.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-239">In doing so, we need to rebind the data to the grid so that the other user s data is loaded into the editing interface.</span></span> <span data-ttu-id="ddc0d-240">Jest to osiągane przez wywołanie GridView s `DataBind()` metody.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-240">This is accomplished by calling the GridView s `DataBind()` method.</span></span>

<span data-ttu-id="ddc0d-241">Jak pokazano na rysunku nr 9, z tych dwóch zdarzenia, zostanie wyświetlony komunikat bardzo istotne przy każdym wystąpieniu Naruszenie współbieżności.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-241">As Figure 9 shows, with these two event handlers, a very noticeable message is displayed whenever a concurrency violation occurs.</span></span>


<span data-ttu-id="ddc0d-242">[![Komunikat jest wyświetlany w wypadku Naruszenie współbieżności](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-242">[![A Message is Displayed in the Face of a Concurrency Violation](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image15.png)</span></span>

<span data-ttu-id="ddc0d-243">**Rysunek 9**: komunikat jest wyświetlany w wypadku Naruszenie współbieżności ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="ddc0d-243">**Figure 9**: A Message is Displayed in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image16.png))</span></span>


## <a name="summary"></a><span data-ttu-id="ddc0d-244">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="ddc0d-244">Summary</span></span>

<span data-ttu-id="ddc0d-245">Podczas tworzenia aplikacji sieci web gdzie wiele równoczesnych użytkowników może edytować tych samych danych, należy rozważyć opcje sterowania współbieżności.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-245">When creating a web application where multiple, concurrent users may be editing the same data, it is important to consider concurrency control options.</span></span> <span data-ttu-id="ddc0d-246">Domyślnie dane programu ASP.NET, które kontroluje sieci Web i kontrolki źródła danych nie stosować żadnego formantu współbieżności.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-246">By default, the ASP.NET data Web controls and data source controls do not employ any concurrency control.</span></span> <span data-ttu-id="ddc0d-247">Jak widzieliśmy w tym samouczku, implementacja optymistyczne sterowanie współbieżnością z SqlDataSource jest stosunkowo szybkie i łatwe.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-247">As we saw in this tutorial, implementing optimistic concurrency control with the SqlDataSource is relatively quick and easy.</span></span> <span data-ttu-id="ddc0d-248">SqlDataSource obsługuje większość legwork dla Twojego Dodawanie rozszerzony `WHERE` klauzule wygenerowana automatycznie `UPDATE` i `DELETE` instrukcji, ale są kilka precyzyjnie w obsłudze `NULL` wartości kolumn, zgodnie z opisem w Obsługa poprawnie `NULL` wartości sekcji.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-248">The SqlDataSource handles most of the legwork for your adding augmented `WHERE` clauses to the autogenerated `UPDATE` and `DELETE` statements but there are a few subtleties in handling `NULL` value columns, as discussed in the Correctly Handling `NULL` Values section.</span></span>

<span data-ttu-id="ddc0d-249">Ten samouczek zawiera naszych badania SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-249">This tutorial concludes our examination of the SqlDataSource.</span></span> <span data-ttu-id="ddc0d-250">Naszymi samouczkami, pozostałe powróci do pracy z danymi przy użyciu elementu ObjectDataSource i architektura warstwowego.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-250">Our remaining tutorials will return to working with data using the ObjectDataSource and tiered architecture.</span></span>

<span data-ttu-id="ddc0d-251">Programowanie przyjemność!</span><span class="sxs-lookup"><span data-stu-id="ddc0d-251">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ddc0d-252">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="ddc0d-252">About the Author</span></span>

<span data-ttu-id="ddc0d-253">[Scott Bento](http://www.4guysfromrolla.com/ScottMitchell.shtml), autora siedmiu książek ASP/ASP.NET i twórcę z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje z technologii Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ddc0d-254">Scott działa jako niezależnego konsultanta trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="ddc0d-254">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ddc0d-255">Jest jego najnowszej książki [ *Sams nauczyć się ASP.NET 2.0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="ddc0d-255">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ddc0d-256">Piotr można uzyskać pod adresem [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) lub za pośrednictwem jego blog, który znajduje się w temacie [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="ddc0d-256">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ddc0d-257">[Poprzednie](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)
> [dalej](querying-data-with-the-sqldatasource-control-vb.md)</span><span class="sxs-lookup"><span data-stu-id="ddc0d-257">[Previous](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)
[Next](querying-data-with-the-sqldatasource-control-vb.md)</span></span>
