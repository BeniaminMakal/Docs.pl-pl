---
uid: identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
title: Konta potwierdzenie i hasło odzyskiwania za pomocą tożsamości platformy ASP.NET (C#) | Dokumentacja firmy Microsoft
author: HaoK
description: Przed wykonaniem tego samouczka, które należy wykonać utworzyć bezpiecznego aplikacji sieci web platformy ASP.NET MVC 5 z dziennika w resetowania hasła i potwierdzania poczty e-mail. W tym samouczku...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/26/2015
ms.topic: article
ms.assetid: 8d54180d-f826-4df7-b503-7debf5ed9fb3
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 0167388cf6b488b72ca36f583a7794690dbf9900
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2018
---
<a name="account-confirmation-and-password-recovery-with-aspnet-identity-c"></a><span data-ttu-id="9930e-104">Potwierdzenie konta i hasło odzyskiwania za pomocą tożsamości platformy ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="9930e-104">Account Confirmation and Password Recovery with ASP.NET Identity (C#)</span></span>
====================
<span data-ttu-id="9930e-105">przez [Hao Kung](https://github.com/HaoK), [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="9930e-105">by [Hao Kung](https://github.com/HaoK), [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="9930e-106">Przed wykonaniem tego samouczka należy najpierw wykonać [utworzenia bezpiecznego aplikacji sieci web platformy ASP.NET MVC 5 z dziennika w resetowania hasła i potwierdzania poczty e-mail](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="9930e-106">Before doing this tutorial you should first complete [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span> <span data-ttu-id="9930e-107">Ten samouczek zawiera więcej szczegółowych informacji i opisano, jak skonfigurować konta e-mail o potwierdzenie konta lokalnego i umożliwiają użytkownikom zresetować zapomniane hasło w produkcie ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="9930e-107">This tutorial contains more details and will show you how to set up email for local account confirmation and allow users to reset their forgotten password in ASP.NET Identity.</span></span> <span data-ttu-id="9930e-108">Ten artykuł dotyczy autorstwa Ricka Andersona ([@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)), Pranav Rastogi ([@rustd](https://twitter.com/rustd)), Hao Kung i Suhas Joshi.</span><span class="sxs-lookup"><span data-stu-id="9930e-108">This article was written by Rick Anderson ([@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)), Pranav Rastogi ([@rustd](https://twitter.com/rustd)), Hao Kung, and Suhas Joshi.</span></span> <span data-ttu-id="9930e-109">Przykładowe NuGet zapisał głównie Hao Kung.</span><span class="sxs-lookup"><span data-stu-id="9930e-109">The NuGet sample was written primarily by Hao Kung.</span></span>


<span data-ttu-id="9930e-110">Konto użytkownika lokalnego wymaga od użytkownika utworzyć hasło dla konta i hasło jest przechowywane (bezpieczny) w aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="9930e-110">A local user account requires the user to create a password for the account, and that password is stored (securely) in the web app.</span></span> <span data-ttu-id="9930e-111">Tożsamość platformy ASP.NET obsługuje również społecznościowych konta, które nie wymagają od użytkownika utworzyć hasło aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9930e-111">ASP.NET Identity also supports social accounts, which don't require the user to create a password for the app.</span></span> <span data-ttu-id="9930e-112">[Kont społecznościowych](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) uwierzytelniania użytkowników za pomocą innych firm (takich jak Google, Twitter, Facebook i firmy Microsoft).</span><span class="sxs-lookup"><span data-stu-id="9930e-112">[Social accounts](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) use a third party (such as Google, Twitter, Facebook or Microsoft) to authenticate users.</span></span> <span data-ttu-id="9930e-113">W tym temacie omówiono następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="9930e-113">This topic covers the following:</span></span>

- <span data-ttu-id="9930e-114">[Tworzenie aplikacji platformy ASP.NET MVC](#createMvc) i Poznaj funkcje tożsamości ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9930e-114">[Create an ASP.NET MVC app](#createMvc) and explore ASP.NET Identity features.</span></span>
- [<span data-ttu-id="9930e-115">Tworzenie przykładowej tożsamości</span><span class="sxs-lookup"><span data-stu-id="9930e-115">Building the Identity sample</span></span>](#build)
- [<span data-ttu-id="9930e-116">Konfigurowanie wiadomości e-mail z potwierdzeniem</span><span class="sxs-lookup"><span data-stu-id="9930e-116">Set up email confirmation</span></span>](#email)

<span data-ttu-id="9930e-117">Nowi użytkownicy zarejestrować ich alias e-mail, który tworzy konto lokalne.</span><span class="sxs-lookup"><span data-stu-id="9930e-117">New users register their email alias, which creates a local account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image1.png)

<span data-ttu-id="9930e-118">Kliknięcie przycisku Zarejestruj wysyła wiadomość e-mail z potwierdzeniem zawierające token weryfikacji adresu e-mail.</span><span class="sxs-lookup"><span data-stu-id="9930e-118">Clicking the Register button sends a confirmation email containing a validation token to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image2.png)

<span data-ttu-id="9930e-119">Użytkownik jest wysyłana wiadomość e-mail z token potwierdzenia dla swojego konta.</span><span class="sxs-lookup"><span data-stu-id="9930e-119">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image3.png)

<span data-ttu-id="9930e-120">Kliknięcie łącza stanowi potwierdzenie konta.</span><span class="sxs-lookup"><span data-stu-id="9930e-120">Clicking the link confirms the account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image4.png)

<a id="passwordReset"></a>

## <a name="password-recoveryreset"></a><span data-ttu-id="9930e-121">Resetowanie odzyskiwania hasła</span><span class="sxs-lookup"><span data-stu-id="9930e-121">Password recovery/reset</span></span>

<span data-ttu-id="9930e-122">Lokalnych użytkowników, którzy zapomni swoje hasło może mieć tokenu zabezpieczającego wysyłane do swojego konta poczty e-mail, włączanie ich do zresetowania swojego hasła.</span><span class="sxs-lookup"><span data-stu-id="9930e-122">Local users who forget their password can have a security token sent to their email account, enabling them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image5.png)  
  
<span data-ttu-id="9930e-123">Użytkownik wkrótce otrzyma wiadomość e-mail z łączem, dzięki czemu można zresetować swoje hasło.</span><span class="sxs-lookup"><span data-stu-id="9930e-123">The user will soon get an email with a link allowing them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image6.png)  
<span data-ttu-id="9930e-124">Kliknięcie łącza powoduje wyświetlenie strony resetowania.</span><span class="sxs-lookup"><span data-stu-id="9930e-124">Clicking the link will take them to the Reset page.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image7.png)  
  
<span data-ttu-id="9930e-125">Kliknięcie przycisku **zresetować** przycisk będzie Potwierdź hasło zostało zresetowane.</span><span class="sxs-lookup"><span data-stu-id="9930e-125">Clicking the **Reset** button will confirm the password has been reset.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image8.png)

<a id="createMvc"></a>

## <a name="create-an-aspnet-web-app"></a><span data-ttu-id="9930e-126">Tworzenie aplikacji sieci Web ASP.NET</span><span class="sxs-lookup"><span data-stu-id="9930e-126">Create an ASP.NET Web app</span></span>

<span data-ttu-id="9930e-127">Rozpocznij od instalowania i uruchamiania [programu Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) lub [programu Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="9930e-127">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="9930e-128">Zainstaluj program Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) lub nowszej.</span><span class="sxs-lookup"><span data-stu-id="9930e-128">Install Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) or higher.</span></span>

> [!NOTE]
> <span data-ttu-id="9930e-129">Ostrzeżenie: Należy zainstalować program Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) do ukończenia tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="9930e-129">Warning: You must install Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) to complete this tutorial.</span></span>


1. <span data-ttu-id="9930e-130">Utwórz nowy projekt sieci Web ASP.NET i wybierz szablon MVC.</span><span class="sxs-lookup"><span data-stu-id="9930e-130">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="9930e-131">Formularze sieci Web obsługuje również tożsamości platformy ASP.NET, można wykonać podobne kroki w aplikacji formularzy sieci web.</span><span class="sxs-lookup"><span data-stu-id="9930e-131">Web Forms also supports ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>
2. <span data-ttu-id="9930e-132">Pozostaw domyślne uwierzytelnianie jako **indywidualnych kont użytkowników**.</span><span class="sxs-lookup"><span data-stu-id="9930e-132">Leave the default authentication as **Individual User Accounts**.</span></span>
3. <span data-ttu-id="9930e-133">Uruchom aplikację, kliknij przycisk **zarejestrować** i łącza do zarejestrowania użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9930e-133">Run the app, click the **Register** link and register a user.</span></span> <span data-ttu-id="9930e-134">W tym momencie jest tylko sprawdzanie poprawności w wiadomości e-mail z [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) atrybutu.</span><span class="sxs-lookup"><span data-stu-id="9930e-134">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
4. <span data-ttu-id="9930e-135">W Eksploratorze serwera, przejdź do **Connections\DefaultConnection\Tables\AspNetUsers danych**, kliknij prawym przyciskiem myszy i wybierz **Otwórz definicję tabeli**.</span><span class="sxs-lookup"><span data-stu-id="9930e-135">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span>

    <span data-ttu-id="9930e-136">Poniższy obraz przedstawia `AspNetUsers` schematu:</span><span class="sxs-lookup"><span data-stu-id="9930e-136">The following image shows the `AspNetUsers` schema:</span></span>

    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image9.png)
5. <span data-ttu-id="9930e-137">Kliknij prawym przyciskiem myszy **AspNetUsers** tabeli i wybierz **Pokaż dane tabeli**.</span><span class="sxs-lookup"><span data-stu-id="9930e-137">Right click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image10.png)  
  
   <span data-ttu-id="9930e-138">W tym momencie wiadomości e-mail nie został potwierdzony.</span><span class="sxs-lookup"><span data-stu-id="9930e-138">At this point the email has not been confirmed.</span></span>

<span data-ttu-id="9930e-139">Domyślny magazyn danych dla tożsamości ASP.NET jest Entity Framework, ale można skonfigurować go do używania innych magazynów danych i dodać więcej pól.</span><span class="sxs-lookup"><span data-stu-id="9930e-139">The default data store for ASP.NET Identity is Entity Framework, but you can configure it to use other data stores and to add additional fields.</span></span> <span data-ttu-id="9930e-140">Zobacz [dodatkowe zasoby](#addRes) sekcji na końcu tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="9930e-140">See [Additional Resources](#addRes) section at the end of this tutorial.</span></span>

<span data-ttu-id="9930e-141">[Klasy początkowej OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) jest wywoływane, gdy rozpoczyna się i wywołuje aplikacji `ConfigureAuth` metody w *aplikacji\_Start\Startup.Auth.cs*, które Konfiguruje potok OWIN i inicjuje tożsamości ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9930e-141">The [OWIN startup class](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) is called when the app starts and invokes the `ConfigureAuth` method in *App\_Start\Startup.Auth.cs*, which configures the OWIN pipeline and initializes ASP.NET Identity.</span></span> <span data-ttu-id="9930e-142">Sprawdź `ConfigureAuth` metody.</span><span class="sxs-lookup"><span data-stu-id="9930e-142">Examine the `ConfigureAuth` method.</span></span> <span data-ttu-id="9930e-143">Każdy `CreatePerOwinContext` wywołania rejestruje wywołanie zwrotne (zapisane w `OwinContext`) która będzie wywoływana raz na żądanie utworzenia wystąpienia określonego typu.</span><span class="sxs-lookup"><span data-stu-id="9930e-143">Each `CreatePerOwinContext` call registers a callback (saved in the `OwinContext`) that will be called once per request to create an instance of the specified type.</span></span> <span data-ttu-id="9930e-144">Można ustawić punktu przerwania w Konstruktorze i `Create` metody każdego typu (`ApplicationDbContext, ApplicationUserManager`) i sprawdź, są one nazywane na każdym żądaniu.</span><span class="sxs-lookup"><span data-stu-id="9930e-144">You can set a break point in the constructor and `Create` method of each type (`ApplicationDbContext, ApplicationUserManager`) and verify they are called on each request.</span></span> <span data-ttu-id="9930e-145">Wystąpienie elementu `ApplicationDbContext` i `ApplicationUserManager` jest przechowywana w kontekście OWIN, który jest dostępny w całej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9930e-145">A instance of `ApplicationDbContext` and `ApplicationUserManager` is stored in the OWIN context, which can be accessed throughout the application.</span></span> <span data-ttu-id="9930e-146">Przechwytuje tożsamości ASP.NET do potoku OWIN za pomocą oprogramowania pośredniczącego plików cookie.</span><span class="sxs-lookup"><span data-stu-id="9930e-146">ASP.NET Identity hooks into the OWIN pipeline through cookie middleware.</span></span> <span data-ttu-id="9930e-147">Aby uzyskać więcej informacji, zobacz [na żądanie Zarządzanie okresem istnienia klasy interfejs UserManager w produkcie ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="9930e-147">For more information, see [Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span>

<span data-ttu-id="9930e-148">Jeśli zmienisz profil zabezpieczeń nową sygnaturę bezpieczeństwa są generowane i przechowywane w `SecurityStamp` pole *AspNetUsers* tabeli.</span><span class="sxs-lookup"><span data-stu-id="9930e-148">When you change your security profile, a new security stamp is generated and stored in the `SecurityStamp` field of the *AspNetUsers* table.</span></span> <span data-ttu-id="9930e-149">Uwaga: `SecurityStamp` pola różni się od pliku cookie zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="9930e-149">Note, the `SecurityStamp` field is different from the security cookie.</span></span> <span data-ttu-id="9930e-150">Plik cookie zabezpieczeń nie są przechowywane w `AspNetUsers` tabeli (lub dowolnego miejsca w bazie danych tożsamości).</span><span class="sxs-lookup"><span data-stu-id="9930e-150">The security cookie is not stored in the `AspNetUsers` table (or anywhere else in the Identity DB).</span></span> <span data-ttu-id="9930e-151">Token pliku cookie zabezpieczeń jest podpisany przy użyciu [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) i zostanie utworzony z `UserId, SecurityStamp` i informacje dotyczące czasu wygaśnięcia.</span><span class="sxs-lookup"><span data-stu-id="9930e-151">The security cookie token is self-signed using [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) and is created with the `UserId, SecurityStamp` and expiration time information.</span></span>

<span data-ttu-id="9930e-152">Oprogramowanie pośredniczące plików cookie sprawdza, czy plik cookie na każde żądanie.</span><span class="sxs-lookup"><span data-stu-id="9930e-152">The cookie middleware checks the cookie on each request.</span></span> <span data-ttu-id="9930e-153">`SecurityStampValidator` Metody w `Startup` klasy trafienia bazę danych i okresowo sprawdza sygnaturę bezpieczeństwa z określonej `validateInterval`.</span><span class="sxs-lookup"><span data-stu-id="9930e-153">The `SecurityStampValidator` method in the `Startup` class hits the DB and checks security stamp periodically, as specified with the `validateInterval`.</span></span> <span data-ttu-id="9930e-154">Tylko dzieje co 30 minut (w naszym przykładzie), chyba że zostanie zmienione profil zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="9930e-154">This only happens every 30 minutes (in our sample) unless you change your security profile.</span></span> <span data-ttu-id="9930e-155">Aby zminimalizować rund do bazy danych wybrano 30 minut.</span><span class="sxs-lookup"><span data-stu-id="9930e-155">The 30 minute interval was chosen to minimize trips to the database.</span></span> <span data-ttu-id="9930e-156">Zobacz Moje [samouczek uwierzytelniania dwuskładnikowego](index.md) więcej szczegółów.</span><span class="sxs-lookup"><span data-stu-id="9930e-156">See my [two-factor authentication tutorial](index.md) for more details.</span></span>

<span data-ttu-id="9930e-157">Na komentarze w kodzie `UseCookieAuthentication` metoda obsługuje uwierzytelniania plików cookie.</span><span class="sxs-lookup"><span data-stu-id="9930e-157">Per the comments in the code, the `UseCookieAuthentication` method supports cookie authentication.</span></span> <span data-ttu-id="9930e-158">`SecurityStamp` Pola i skojarzony kod zapewnia dodatkową warstwę zabezpieczeń do aplikacji, gdy zmieniasz hasło, będziesz się logować bez przeglądarki podczas logowania.</span><span class="sxs-lookup"><span data-stu-id="9930e-158">The `SecurityStamp` field and associated code provides an extra layer of security to your app, when you change your password, you will be logged out of the browser you logged in with.</span></span> <span data-ttu-id="9930e-159">`SecurityStampValidator.OnValidateIdentity` Metody umożliwia aplikacji weryfikacji tokenu zabezpieczeń podczas logowania użytkownika, używana w przypadku zmiany hasła lub użyj logowania zewnętrznego.</span><span class="sxs-lookup"><span data-stu-id="9930e-159">The `SecurityStampValidator.OnValidateIdentity` method enables the app to validate the security token when the user logs in, which is used when you change a password or use the external login.</span></span> <span data-ttu-id="9930e-160">Jest to niezbędne do zapewnienia, że wszystkie tokeny (pliki cookie) generowany ze starym hasłem są unieważnione.</span><span class="sxs-lookup"><span data-stu-id="9930e-160">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="9930e-161">W przykładowy projekt, w przypadku zmiany hasła użytkowników następnie nowy token jest generowany dla użytkownika, wszystkie poprzednie tokeny są unieważniona i `SecurityStamp` pole jest aktualizowane.</span><span class="sxs-lookup"><span data-stu-id="9930e-161">In the sample project, if you change the users password then a new token is generated for the user, any previous tokens are invalidated and the `SecurityStamp` field is updated.</span></span>

<span data-ttu-id="9930e-162">Systemu tożsamości pozwalają skonfigurować aplikację tak po zmianie profil zabezpieczeń użytkowników (na przykład gdy użytkownik zmieni swoje hasło lub zmiany skojarzone logowania (przykład, Facebook, Google, konta Microsoft, itp.), użytkownik jest zalogowany spośród wszystkich wystąpienia przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="9930e-162">The Identity system allow you to configure your app so when the users security profile changes (for example, when the user changes their password or changes associated login (such as from Facebook, Google, Microsoft account, etc.), the user is logged out of all browser instances.</span></span> <span data-ttu-id="9930e-163">Na przykład obraz poniżej przedstawia [próbki pojedynczego wylogowanie](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) aplikacji, która umożliwia użytkownikowi Wyloguj wszystkie wystąpienia przeglądarki (w tym przypadku IE, Firefox i Chrome), klikając jeden z przycisków.</span><span class="sxs-lookup"><span data-stu-id="9930e-163">For example, the image below shows the [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app, which allows the user to sign out of all browser instances (in this case, IE, Firefox and Chrome) by clicking one button.</span></span> <span data-ttu-id="9930e-164">Alternatywnie próbki pozwala tylko wylogować się wystąpienia określonej przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="9930e-164">Alternatively, the sample allows you to only log out of a specific browser instance.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image11.png)

<span data-ttu-id="9930e-165">[Próbki pojedynczego wylogowanie](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) aplikacji pokazuje, jak ASP.NET Identity można ponownie wygenerować tokenu zabezpieczającego.</span><span class="sxs-lookup"><span data-stu-id="9930e-165">The [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app shows how ASP.NET Identity allows you to regenerate the security token.</span></span> <span data-ttu-id="9930e-166">Jest to niezbędne do zapewnienia, że wszystkie tokeny (pliki cookie) generowany ze starym hasłem są unieważnione.</span><span class="sxs-lookup"><span data-stu-id="9930e-166">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="9930e-167">Ta funkcja zapewnia dodatkową warstwę zabezpieczeń do tej aplikacji; Jeśli zmienisz hasło, będziesz się logować się, gdy użytkownik zalogował się do tej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9930e-167">This feature provides an extra layer of security to your application; when you change your password, you will be logged out where you have logged into this application.</span></span>

<span data-ttu-id="9930e-168">*Aplikacji\_Start\IdentityConfig.cs* plik zawiera `ApplicationUserManager`, `EmailService` i `SmsService` klasy.</span><span class="sxs-lookup"><span data-stu-id="9930e-168">The *App\_Start\IdentityConfig.cs* file contains the `ApplicationUserManager`, `EmailService` and `SmsService` classes.</span></span> <span data-ttu-id="9930e-169">`EmailService` i `SmsService` każdej implementacji klasy `IIdentityMessageService` interfejsu, dlatego należy typowe metody w każdej klasy, aby skonfigurować adres e-mail i SMS.</span><span class="sxs-lookup"><span data-stu-id="9930e-169">The `EmailService` and `SmsService` classes each implement the `IIdentityMessageService` interface, so you have common methods in each class to configure email and SMS.</span></span> <span data-ttu-id="9930e-170">Mimo że w tym samouczku tylko przedstawiono sposób dodawania powiadomienia pocztą e-mail za pomocą [SendGrid](http://sendgrid.com/), możesz wysłać wiadomości e-mail przy użyciu SMTP i innych mechanizmów.</span><span class="sxs-lookup"><span data-stu-id="9930e-170">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms.</span></span>

<span data-ttu-id="9930e-171">`Startup` Klasa zawiera także kocioł tablicy można dodać logowania społecznościowych (Facebook, Twitter, itp.), zobacz samouczek Mój [aplikacji MVC 5 za pomocą usługi Facebook, Twitter, LinkedIn i Google OAuth2 logowania jednokrotnego](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) Aby uzyskać więcej informacji.</span><span class="sxs-lookup"><span data-stu-id="9930e-171">The `Startup` class also contains boiler plate to add social logins (Facebook, Twitter, etc.), see my tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) for more info.</span></span>

<span data-ttu-id="9930e-172">Sprawdź `ApplicationUserManager` klasy, która zawiera informacje o tożsamości użytkowników i konfiguruje następujące funkcje:</span><span class="sxs-lookup"><span data-stu-id="9930e-172">Examine the `ApplicationUserManager` class, which contains the users identity information and configures the following features:</span></span>

- <span data-ttu-id="9930e-173">Wymagania dotyczące siły hasła.</span><span class="sxs-lookup"><span data-stu-id="9930e-173">Password strength requirements.</span></span>
- <span data-ttu-id="9930e-174">Blokowanie użytkownika (prób i czas).</span><span class="sxs-lookup"><span data-stu-id="9930e-174">User lock out (attempts and time).</span></span>
- <span data-ttu-id="9930e-175">Uwierzytelnianie dwuskładnikowe (2FA).</span><span class="sxs-lookup"><span data-stu-id="9930e-175">Two-factor authentication (2FA).</span></span> <span data-ttu-id="9930e-176">W samouczku innego będzie obejmować 2FA i programu SMS.</span><span class="sxs-lookup"><span data-stu-id="9930e-176">I'll cover 2FA and SMS in another tutorial.</span></span>
- <span data-ttu-id="9930e-177">Podłączanie poczty e-mail i usług programu SMS.</span><span class="sxs-lookup"><span data-stu-id="9930e-177">Hooking up the email and SMS services.</span></span> <span data-ttu-id="9930e-178">(I będzie obejmować programu SMS w samouczku innego).</span><span class="sxs-lookup"><span data-stu-id="9930e-178">(I'll cover SMS in another tutorial).</span></span>

<span data-ttu-id="9930e-179">`ApplicationUserManager` Klasa pochodzi od ogólnych `UserManager<ApplicationUser>` klasy.</span><span class="sxs-lookup"><span data-stu-id="9930e-179">The `ApplicationUserManager` class derives from the generic `UserManager<ApplicationUser>` class.</span></span> <span data-ttu-id="9930e-180">`ApplicationUser` pochodną [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="9930e-180">`ApplicationUser` derives from [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span></span> <span data-ttu-id="9930e-181">`IdentityUser` pochodzi z ogólnego `IdentityUser` klasy:</span><span class="sxs-lookup"><span data-stu-id="9930e-181">`IdentityUser` derives from the generic `IdentityUser` class:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample1.cs)]

<span data-ttu-id="9930e-182">Powyżej właściwości pokrywają się z właściwości w `AspNetUsers` tabeli pokazano powyżej.</span><span class="sxs-lookup"><span data-stu-id="9930e-182">The properties above coincide with the properties in the `AspNetUsers` table, shown above.</span></span>

<span data-ttu-id="9930e-183">Argumenty rodzajowe w `IUser` umożliwiającą klasy przy użyciu różnych typów dla klucza podstawowego.</span><span class="sxs-lookup"><span data-stu-id="9930e-183">Generic arguments on `IUser` enable you to derive a class using different types for the primary key.</span></span> <span data-ttu-id="9930e-184">Zobacz [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) próbki, która pokazuje, jak zmienić klucz podstawowy z ciągu na int lub identyfikatora GUID.</span><span class="sxs-lookup"><span data-stu-id="9930e-184">See the [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) sample which shows how to change the primary key from string to int or GUID.</span></span>

### <a name="applicationuser"></a><span data-ttu-id="9930e-185">ApplicationUser</span><span class="sxs-lookup"><span data-stu-id="9930e-185">ApplicationUser</span></span>

<span data-ttu-id="9930e-186">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) jest zdefiniowany w *Models\IdentityModels.cs* jako:</span><span class="sxs-lookup"><span data-stu-id="9930e-186">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) is defined in *Models\IdentityModels.cs* as:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample2.cs?highlight=8-9)]

<span data-ttu-id="9930e-187">Generuje wyróżniony kod powyżej [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span><span class="sxs-lookup"><span data-stu-id="9930e-187">The highlighted code above generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="9930e-188">ASP.NET Identity i uwierzytelniania plików Cookie OWIN są oparte na oświadczeniach, w związku z tym framework wymaga aplikacji do wygenerowania `ClaimsIdentity` dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9930e-188">ASP.NET Identity and OWIN Cookie Authentication are claims-based, therefore the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="9930e-189">`ClaimsIdentity` zawiera informacje o wszystkich oświadczenia dla użytkownika, takie jak nazwa użytkownika, wieku i jakie role użytkownika należy do.</span><span class="sxs-lookup"><span data-stu-id="9930e-189">`ClaimsIdentity` has information about all the claims for the user, such as the user's name, age and what roles the user belongs to.</span></span> <span data-ttu-id="9930e-190">Na tym etapie można również dodać więcej oświadczenia dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9930e-190">You can also add more claims for the user at this stage.</span></span>

<span data-ttu-id="9930e-191">OWIN `AuthenticationManager.SignIn` metoda przekazuje w `ClaimsIdentity` i loguje się użytkownik:</span><span class="sxs-lookup"><span data-stu-id="9930e-191">The OWIN `AuthenticationManager.SignIn` method passes in the `ClaimsIdentity` and signs in the user:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample3.cs?highlight=4-6)]

<span data-ttu-id="9930e-192">[Aplikacji MVC 5 za pomocą usługi Facebook, Twitter, LinkedIn i Google OAuth2 logowania jednokrotnego](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) przedstawiono sposób dodawania dodatkowych właściwości do `ApplicationUser` klasy.</span><span class="sxs-lookup"><span data-stu-id="9930e-192">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) shows how you can add additional properties to the `ApplicationUser` class.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="9930e-193">Wiadomości e-mail z potwierdzeniem</span><span class="sxs-lookup"><span data-stu-id="9930e-193">Email confirmation</span></span>

<span data-ttu-id="9930e-194">Jest dobrym pomysłem jest potwierdzenia adresu e-mail nowy użytkownik rejestruje, aby sprawdzić ich są nie personifikowanie innego użytkownika (czyli one nie został zarejestrowany przy do kogoś innego adresu e-mail).</span><span class="sxs-lookup"><span data-stu-id="9930e-194">It's a good idea to confirm the email a new user register with to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="9930e-195">Załóżmy, że masz forum dyskusyjne, czy chcesz zapobiec `"bob@example.com"` z rejestracją jako `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="9930e-195">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="9930e-196">Bez wiadomości e-mail z potwierdzeniem `"joe@contoso.com"` można pobrać niechcianych wiadomości e-mail z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9930e-196">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="9930e-197">Załóżmy, że Bob przypadkowo zarejestrowany jako `"bib@example.com"` i nie zauważyć, ADAM nie będą mogli używać hasła odzyskiwania, ponieważ aplikacja nie ma jego prawidłowy adres e-mail.</span><span class="sxs-lookup"><span data-stu-id="9930e-197">Suppose Bob accidently registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="9930e-198">Wiadomości e-mail z potwierdzeniem chroni tylko ograniczone z robotów i nie zapewnia ochrony z określone nadawcy wiadomości-śmieci, ponieważ mają one wiele aliasów e-mail pracy służące do rejestrowania. W poniższym przykładzie użytkownik będzie mógł zmienić swoje hasło, dopóki ich konto zostało potwierdzone (przez kliknięcie łącza potwierdzenie odebrane w zarejestrowani z konta e-mail.) Ten przepływ pracy można stosować do inne scenariusze, na przykład wysyłanie łącza potwierdzić i zresetować hasło na nowych kont utworzonych przez administratora, wysyłanie wiadomości e-mail użytkownika, gdy swój profil zostały zmienione i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="9930e-198">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.In the sample below, the user won't be able to change their password until their account has been confirmed (by them clicking on a confirmation link received on the email account they registered with.) You can apply this work flow to other scenarios, for example sending a link to confirm and reset the password on new accounts created by the administrator, sending the user an email when they have changed their profile and so on.</span></span> <span data-ttu-id="9930e-199">Ogólnie rzecz biorąc chcesz uniemożliwić przesyłanie danych do witryny sieci web, zanim zostały potwierdzone za pośrednictwem poczty e-mail, wiadomość SMS lub inny mechanizm nowych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="9930e-199">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a>

## <a name="building-a-more-complete-sample"></a><span data-ttu-id="9930e-200">Tworzenie bardziej szczegółowy próbki</span><span class="sxs-lookup"><span data-stu-id="9930e-200">Building a more complete sample</span></span>

<span data-ttu-id="9930e-201">W tej sekcji użyjesz NuGet można pobrać przykładowy bardziej szczegółowy zajmiemy się.</span><span class="sxs-lookup"><span data-stu-id="9930e-201">In this section, you'll use NuGet to download a more complete sample we will work with.</span></span>

1. <span data-ttu-id="9930e-202">Utwórz nową ***pusty*** projektu sieci Web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9930e-202">Create a new ***empty*** ASP.NET Web project.</span></span>
2. <span data-ttu-id="9930e-203">W konsoli Menedżera pakietów, wprowadź następujące polecenia:</span><span class="sxs-lookup"><span data-stu-id="9930e-203">In the Package Manager Console, enter the following the following commands:</span></span> 

    [!code-console[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample4.cmd)]

   <span data-ttu-id="9930e-204">W tym samouczku użyjemy [SendGrid](http://sendgrid.com/) do wysyłania wiadomości e-mail.</span><span class="sxs-lookup"><span data-stu-id="9930e-204">In this tutorial, we'll use [SendGrid](http://sendgrid.com/) to send email.</span></span> <span data-ttu-id="9930e-205">`Identity.Samples` Pakiet instaluje firma Microsoft będzie działać z kodu.</span><span class="sxs-lookup"><span data-stu-id="9930e-205">The `Identity.Samples` package installs the code we will be working with.</span></span>
3. <span data-ttu-id="9930e-206">Ustaw [projektu do używania protokołu SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="9930e-206">Set the [project to use SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="9930e-207">Przetestuj tworzenia konta lokalnego, uruchamiając aplikację, klikając **zarejestrować** link i przesyłanie formularza rejestracyjnego.</span><span class="sxs-lookup"><span data-stu-id="9930e-207">Test local account creation by running the app, clicking on the **Register** link, and posting the registration form.</span></span>
5. <span data-ttu-id="9930e-208">Kliknij łącze pokaz poczty e-mail, która symuluje wiadomości e-mail z potwierdzeniem.</span><span class="sxs-lookup"><span data-stu-id="9930e-208">Click the demo email link, which simulates email confirmation.</span></span>
6. <span data-ttu-id="9930e-209">Usuń kod potwierdzenia pokaz e-mail łączy z próbki ( `ViewBag.Link` kodu w kontrolerze konta.</span><span class="sxs-lookup"><span data-stu-id="9930e-209">Remove the demo email link confirmation code from the sample (The `ViewBag.Link` code in the account controller.</span></span> <span data-ttu-id="9930e-210">Zobacz `DisplayEmail` i `ForgotPasswordConfirmation` metody akcji i widokami razor).</span><span class="sxs-lookup"><span data-stu-id="9930e-210">See the `DisplayEmail` and `ForgotPasswordConfirmation` action methods and razor views ).</span></span>

> [!NOTE]
> <span data-ttu-id="9930e-211">Ostrzeżenie: Jeśli zmienisz jakiekolwiek ustawienia zabezpieczeń w tym przykładzie produkcji aplikacje będą wymagały zastosowane inspekcji zabezpieczeń jawnie wywołującą zmiany wprowadzone do.</span><span class="sxs-lookup"><span data-stu-id="9930e-211">Warning: If you change any of the security settings in this sample, productions apps will need to undergo a security audit that explicitly calls the changes made.</span></span>


## <a name="examine-the-code-in-appstartidentityconfigcs"></a><span data-ttu-id="9930e-212">Badanie kodu w aplikacji\_Start\IdentityConfig.cs</span><span class="sxs-lookup"><span data-stu-id="9930e-212">Examine the code in App\_Start\IdentityConfig.cs</span></span>

<span data-ttu-id="9930e-213">Przykład pokazuje, jak utworzyć konto i dodać go do *Admin* roli.</span><span class="sxs-lookup"><span data-stu-id="9930e-213">The sample shows how to create an account and add it to the *Admin* role.</span></span> <span data-ttu-id="9930e-214">Wiadomości e-mail w próbce należy zastąpić poczty e-mail, który będzie używany dla konta administratora.</span><span class="sxs-lookup"><span data-stu-id="9930e-214">You should replace the email in the sample with the email you will be using for the admin account.</span></span> <span data-ttu-id="9930e-215">Najprostszym sposobem od razu utworzyć konto administratora jest programowo w `Seed` metody.</span><span class="sxs-lookup"><span data-stu-id="9930e-215">The easiest way right now to create an administrator account is programmatically in the `Seed` method.</span></span> <span data-ttu-id="9930e-216">Mamy nadzieję w przyszłości narzędzia, które umożliwiają tworzenie i administrowanie użytkownikami i rolami.</span><span class="sxs-lookup"><span data-stu-id="9930e-216">We hope to have a tool in the future that will allow you to create and administer users and roles.</span></span> <span data-ttu-id="9930e-217">Przykładowy kod umożliwiają tworzenie i zarządzanie użytkownikami i rolami, ale najpierw musi mieć konto administratorów do uruchomienia stron administracyjnych na użytkowników i ról.</span><span class="sxs-lookup"><span data-stu-id="9930e-217">The sample code does let you create and manage users and roles, but you must first have an administrators account to run the roles and user admin pages.</span></span> <span data-ttu-id="9930e-218">W tym przykładzie konto administratora jest tworzony podczas bazy danych jest obsługiwany.</span><span class="sxs-lookup"><span data-stu-id="9930e-218">In this sample, the admin account is created when the DB is seeded.</span></span>

<span data-ttu-id="9930e-219">Zmiany hasła i Zmień nazwę konta, których chcesz otrzymywać powiadomienia e-mail.</span><span class="sxs-lookup"><span data-stu-id="9930e-219">Change the password and change the name to an account where you can receive email notifications.</span></span>

> [!WARNING]
> <span data-ttu-id="9930e-220">Zabezpieczenia — nigdy nie magazynu danych poufnych w kodzie źródłowym.</span><span class="sxs-lookup"><span data-stu-id="9930e-220">Security - Never store sensitive data in your source code.</span></span>

<span data-ttu-id="9930e-221">Jak wspomniano wcześniej, `app.CreatePerOwinContext` wywołanie w klasie uruchamiania dodaje wywołania zwrotne `Create` metoda aplikacji bazy danych zawartości, Menedżer i roli menedżera klas użytkowników.</span><span class="sxs-lookup"><span data-stu-id="9930e-221">As mentioned previously, the `app.CreatePerOwinContext` call in the startup class adds callbacks to the `Create` method of the app DB content, user manager and role manger classes.</span></span> <span data-ttu-id="9930e-222">Wywołania w potoku OWIN `Create` metody dla tych klas dla każdego żądania i przechowuje kontekst dla każdej klasy.</span><span class="sxs-lookup"><span data-stu-id="9930e-222">The OWIN pipeline calls the `Create` method on these classes for each request and stores the context for each class.</span></span> <span data-ttu-id="9930e-223">Konto kontrolera udostępnia Menedżera użytkowników z kontekstu HTTP (zawierający kontekst OWIN):</span><span class="sxs-lookup"><span data-stu-id="9930e-223">The account controller exposes the user manager from the HTTP context (which contains the OWIN context):</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample5.cs)]

<span data-ttu-id="9930e-224">Gdy użytkownik rejestruje konta lokalnego, `HTTP Post Register` metoda jest wywoływana:</span><span class="sxs-lookup"><span data-stu-id="9930e-224">When a user registers a local account, the `HTTP Post Register` method is called:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample6.cs)]

<span data-ttu-id="9930e-225">Powyższy kod używa danych modelu, aby utworzyć nowe konto użytkownika przy użyciu poczty e-mail i hasło.</span><span class="sxs-lookup"><span data-stu-id="9930e-225">The code above uses the model data to create a new user account using the email and password entered.</span></span> <span data-ttu-id="9930e-226">Jeśli alias e-mail znajduje się w magazynie danych, tworzenie konta usługi nie powiedzie się i ponownie wyświetlić formularza.</span><span class="sxs-lookup"><span data-stu-id="9930e-226">If the email alias is in the data store, account creation fails and the form is displayed again.</span></span> <span data-ttu-id="9930e-227">`GenerateEmailConfirmationTokenAsync` Metoda tworzy token potwierdzenia bezpiecznego i zapisuje je w magazynie danych tożsamości ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9930e-227">The `GenerateEmailConfirmationTokenAsync` method creates a secure confirmation token and stores it in the ASP.NET Identity data store.</span></span> <span data-ttu-id="9930e-228">[Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) metoda tworzy łącze zawierające `UserId` i tokenu potwierdzenia.</span><span class="sxs-lookup"><span data-stu-id="9930e-228">The [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) method creates a link containing the `UserId` and confirmation token.</span></span> <span data-ttu-id="9930e-229">Ten link jest następnie pocztą e-mail do użytkownika, użytkownik może kliknąć łącze w swoich aplikacji poczty e-mail, aby potwierdzić swoje konto.</span><span class="sxs-lookup"><span data-stu-id="9930e-229">This link is then emailed to the user, the user can click on the link in their email app to confirm their account.</span></span>

<a id="email"></a>

## <a name="set-up-email-confirmation"></a><span data-ttu-id="9930e-230">Konfigurowanie wiadomości e-mail z potwierdzeniem</span><span class="sxs-lookup"><span data-stu-id="9930e-230">Set up email confirmation</span></span>

<span data-ttu-id="9930e-231">Przejdź do [stronę Tworzenie konta Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) i zarejestrować bezpłatne konto.</span><span class="sxs-lookup"><span data-stu-id="9930e-231">Go to the [Azure SendGrid sign up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free account.</span></span> <span data-ttu-id="9930e-232">Dodaj kod podobne do następujących czynności, aby skonfigurować SendGrid:</span><span class="sxs-lookup"><span data-stu-id="9930e-232">Add code similar to the following to configure SendGrid:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample7.cs?highlight=5)]

> [!NOTE]
> <span data-ttu-id="9930e-233">Klienci poczty e-mail często akceptuje tylko wiadomości tekstowych (nie HTML).</span><span class="sxs-lookup"><span data-stu-id="9930e-233">Email clients frequently accept only text messages (no HTML).</span></span> <span data-ttu-id="9930e-234">Należy podać komunikat w tekst i HTML.</span><span class="sxs-lookup"><span data-stu-id="9930e-234">You should provide the message in text and HTML.</span></span> <span data-ttu-id="9930e-235">W powyższym przykładzie SendGrid jest to zrobić za pomocą `myMessage.Text` i `myMessage.Html` kodzie pokazanym powyżej.</span><span class="sxs-lookup"><span data-stu-id="9930e-235">In the SendGrid sample above, this is done with the `myMessage.Text` and `myMessage.Html` code shown above.</span></span>


<span data-ttu-id="9930e-236">Poniższy kod przedstawia sposób wysłania wiadomości e-mail przy użyciu [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) klasy where `message.Body` zwraca tylko łącze.</span><span class="sxs-lookup"><span data-stu-id="9930e-236">The following code shows how to send email using the [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) class where `message.Body` returns only the link.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample8.cs)]

> [!WARNING]
> <span data-ttu-id="9930e-237">Zabezpieczenia — nigdy nie magazynu danych poufnych w kodzie źródłowym.</span><span class="sxs-lookup"><span data-stu-id="9930e-237">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="9930e-238">Konto i poświadczenia są przechowywane w appSetting.</span><span class="sxs-lookup"><span data-stu-id="9930e-238">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="9930e-239">Na platformie Azure, można bezpiecznie przechowywać te wartości na **[Konfiguruj](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** kartę w portalu Azure.</span><span class="sxs-lookup"><span data-stu-id="9930e-239">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="9930e-240">Zobacz [najlepsze rozwiązania dotyczące wdrażania haseł i innych poufnych danych do platformy ASP.NET i usługi Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span><span class="sxs-lookup"><span data-stu-id="9930e-240">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>


<span data-ttu-id="9930e-241">Wprowadź swoje poświadczenia SendGrid, uruchom aplikację, rejestru z aliasem poczty e-mail można kliknij łącze Potwierdź w wiadomości e-mail.</span><span class="sxs-lookup"><span data-stu-id="9930e-241">Enter your SendGrid credentials, run the app, register with an email alias can click the confirm link in your email.</span></span> <span data-ttu-id="9930e-242">Aby sprawdzić, jak w tym z Twojej [Outlook.com](http://outlook.com) konto e-mail, zobacz Jan Atten [konfiguracji SMTP C# dla hosta SMTP Outlook.Com](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) i jego[ASP.NET 2.0 tożsamości: ustawienia weryfikacji konta i dwuskładnikowego autoryzacji](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) ogłoszeń.</span><span class="sxs-lookup"><span data-stu-id="9930e-242">To see how to do this with your [Outlook.com](http://outlook.com) email account, see John Atten's [C# SMTP Configuration for Outlook.Com SMTP Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) and his[ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) posts.</span></span>

<span data-ttu-id="9930e-243">Gdy użytkownik kliknie **zarejestrować** przycisk wiadomość e-mail z potwierdzeniem zawierające token weryfikacji są wysyłane na adres e-mail użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9930e-243">Once a user clicks the **Register** button a confirmation email containing a validation token is sent to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image12.png)

<span data-ttu-id="9930e-244">Użytkownik jest wysyłana wiadomość e-mail z token potwierdzenia dla swojego konta.</span><span class="sxs-lookup"><span data-stu-id="9930e-244">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image13.png)

## <a name="examine-the-code"></a><span data-ttu-id="9930e-245">Sprawdź kod</span><span class="sxs-lookup"><span data-stu-id="9930e-245">Examine the code</span></span>

<span data-ttu-id="9930e-246">Poniższy kod przedstawia `POST ForgotPassword` metody.</span><span class="sxs-lookup"><span data-stu-id="9930e-246">The following code shows the `POST ForgotPassword` method.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="9930e-247">Metoda kończy się niepowodzeniem dyskretnie, jeśli nie został potwierdzony adres e-mail użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9930e-247">The method fails silently if the user email has not been confirmed.</span></span> <span data-ttu-id="9930e-248">Jeśli błąd został opublikowany dla nieprawidłowego adresu e-mail, złośliwi użytkownicy, można użyć tych informacji można znaleźć prawidłowy identyfikator użytkownika (aliasów e-mail) na ataki.</span><span class="sxs-lookup"><span data-stu-id="9930e-248">If an error was posted for an invalid email address, malicious users could use that information to find valid userId (email aliases) to attack.</span></span>

<span data-ttu-id="9930e-249">Poniższy kod przedstawia `ConfirmEmail` metody w kontrolerze konta, które jest wywoływane, gdy użytkownik kliknie łącze potwierdzenia w wiadomości e-mail wysyłane do nich:</span><span class="sxs-lookup"><span data-stu-id="9930e-249">The following code shows the `ConfirmEmail` method in the account controller that is called when the user clicks the confirmation link in the email sent to them:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample10.cs)]

<span data-ttu-id="9930e-250">Gdy użyto token zapomniane hasło zostało unieważnione.</span><span class="sxs-lookup"><span data-stu-id="9930e-250">Once a forgotten password token has been used, it's invalidated.</span></span> <span data-ttu-id="9930e-251">Następujące zmiany kodu `Create` — metoda (w *aplikacji\_Start\IdentityConfig.cs* pliku) ustawia tokeny wygaśnie po upływie 3 godziny.</span><span class="sxs-lookup"><span data-stu-id="9930e-251">The following code change in the `Create` method (in the *App\_Start\IdentityConfig.cs* file) sets the tokens to expire in 3 hours.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample11.cs?highlight=6-8)]

<span data-ttu-id="9930e-252">Z powyższym kodzie zapomniane hasło i tokeny potwierdzenia e-mail wygasa 3 godziny.</span><span class="sxs-lookup"><span data-stu-id="9930e-252">With the code above, the forgotten password and the email confirmation tokens will expire in 3 hours.</span></span> <span data-ttu-id="9930e-253">Wartość domyślna `TokenLifespan` to jeden dzień.</span><span class="sxs-lookup"><span data-stu-id="9930e-253">The default `TokenLifespan` is one day.</span></span>

<span data-ttu-id="9930e-254">Poniższy kod przedstawia metody potwierdzenia poczty e-mail:</span><span class="sxs-lookup"><span data-stu-id="9930e-254">The following code shows the email confirmation method:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample12.cs)]

 <span data-ttu-id="9930e-255">Aby zapewnić bardziej bezpieczne aplikacji, ASP.NET Identity obsługuje uwierzytelnianie dwuskładnikowe (2FA).</span><span class="sxs-lookup"><span data-stu-id="9930e-255">To make your app more secure, ASP.NET Identity supports Two-Factor authentication (2FA).</span></span> <span data-ttu-id="9930e-256">Zobacz [tożsamości ASP.NET 2.0: Sprawdzanie poprawności konta i dwuskładnikowego autoryzacji](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) przez Atten Jan.</span><span class="sxs-lookup"><span data-stu-id="9930e-256">See [ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) by John Atten.</span></span> <span data-ttu-id="9930e-257">Mimo że można ustawić blokady konta na niepowodzenia próba hasło logowania, takiego podejścia sprawia, że logowanie podatne na [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) blokady.</span><span class="sxs-lookup"><span data-stu-id="9930e-257">Although you can set account lockout on login password attempt failures, that approach makes your login susceptible to [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) lockouts.</span></span> <span data-ttu-id="9930e-258">Firma Microsoft zaleca się, że używasz blokady konta tylko z 2FA.</span><span class="sxs-lookup"><span data-stu-id="9930e-258">We recommend you use account lockout only with 2FA.</span></span>  
<a id="addRes"></a>

## <a name="additional-resources"></a><span data-ttu-id="9930e-259">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="9930e-259">Additional Resources</span></span>

- [<span data-ttu-id="9930e-260">Omówienie niestandardowych dostawców magazynu dla produktu ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="9930e-260">Overview of Custom Storage Providers for ASP.NET Identity</span></span>](../extensibility/overview-of-custom-storage-providers-for-aspnet-identity.md)
- <span data-ttu-id="9930e-261">[Aplikacji MVC 5 za pomocą usługi Facebook, Twitter, LinkedIn i Google OAuth2 logowania jednokrotnego](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) także przedstawiono sposób dodawania informacji o profilu do tabeli użytkowników.</span><span class="sxs-lookup"><span data-stu-id="9930e-261">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) also shows how to add profile information to the users table.</span></span>
- <span data-ttu-id="9930e-262">[ASP.NET MVC i tożsamość 2.0: opis podstawowych funkcji](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) przez Atten Jan.</span><span class="sxs-lookup"><span data-stu-id="9930e-262">[ASP.NET MVC and Identity 2.0: Understanding the Basics](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) by John Atten.</span></span>
- [<span data-ttu-id="9930e-263">Wprowadzenie do produktu ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="9930e-263">Introduction to ASP.NET Identity</span></span>](../getting-started/introduction-to-aspnet-identity.md)
- <span data-ttu-id="9930e-264">[Anonsowanie RTM programu ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) przez Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="9930e-264">[Announcing RTM of ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) by Pranav Rastogi.</span></span>
