---
title: Host platformy ASP.NET Core w ramach farmy sieci web
author: guardrex
description: Dowiedz się, jak hostować wiele wystąpień aplikacji ASP.NET Core z udostępnionymi zasobami w środowisku farmy sieci web.
ms.author: riande
ms.custom: mvc
ms.date: 07/16/2018
uid: host-and-deploy/web-farm
ms.openlocfilehash: 2435c24bc205486331c828337ca81c43e6e60448
ms.sourcegitcommit: 3ca527f27c88cfc9d04688db5499e372fbc2c775
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/17/2018
ms.locfileid: "39096103"
---
# <a name="host-aspnet-core-in-a-web-farm"></a><span data-ttu-id="f6685-103">Host platformy ASP.NET Core w ramach farmy sieci web</span><span class="sxs-lookup"><span data-stu-id="f6685-103">Host ASP.NET Core in a web farm</span></span>

<span data-ttu-id="f6685-104">Przez [Luke Latham](https://github.com/guardrex) i [Chris Ross](https://github.com/Tratcher)</span><span class="sxs-lookup"><span data-stu-id="f6685-104">By [Luke Latham](https://github.com/guardrex) and [Chris Ross](https://github.com/Tratcher)</span></span>

<span data-ttu-id="f6685-105">A *kolektywu serwerów sieci web* jest grupą dwóch lub więcej serwerów sieci web (lub *węzłów*) które hostują wiele wystąpień aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f6685-105">A *web farm* is a group of two or more web servers (or *nodes*) that host multiple instances of an app.</span></span> <span data-ttu-id="f6685-106">W przypadku żądań od użytkowników dotrze do farmy sieci web *moduł równoważenia obciążenia* rozdziela żądania do węzłów kolektywu serwerów sieci web.</span><span class="sxs-lookup"><span data-stu-id="f6685-106">When requests from users arrive to a web farm, a *load balancer* distributes the requests to the web farm's nodes.</span></span> <span data-ttu-id="f6685-107">Poprawa farmy serwerów sieci Web:</span><span class="sxs-lookup"><span data-stu-id="f6685-107">Web farms improve:</span></span>

* <span data-ttu-id="f6685-108">**Niezawodność/dostępności** &ndash; przy co najmniej jeden węzeł ulegnie awarii, moduł równoważenia obciążenia może kierować żądania do innych węzłów działa, aby kontynuować przetwarzanie żądań.</span><span class="sxs-lookup"><span data-stu-id="f6685-108">**Reliability/availability** &ndash; When one or more nodes fail, the load balancer can route requests to other functioning nodes to continue processing requests.</span></span>
* <span data-ttu-id="f6685-109">**Pojemności i wydajności** &ndash; wielu węzłach może przetwarzać żądania więcej niż jednym serwerze.</span><span class="sxs-lookup"><span data-stu-id="f6685-109">**Capacity/performance** &ndash; Multiple nodes can process more requests than a single server.</span></span> <span data-ttu-id="f6685-110">Moduł równoważenia obciążenia równoważy obciążenie przez dystrybucję żądań do węzłów.</span><span class="sxs-lookup"><span data-stu-id="f6685-110">The load balancer balances the workload by distributing requests to the nodes.</span></span>
* <span data-ttu-id="f6685-111">**Skalowalność** &ndash; gdy wymagana jest więcej lub mniej pojemności, liczba aktywnych węzłów można zwiększyć lub zmniejszyć do dopasowania obciążenia.</span><span class="sxs-lookup"><span data-stu-id="f6685-111">**Scalability** &ndash; When more or less capacity is required, the number of active nodes can be increased or decreased to match the workload.</span></span> <span data-ttu-id="f6685-112">Sieci Web farmy technologie platformy, takie jak [usługi Azure App Service](https://azure.microsoft.com/services/app-service/), automatycznie dodawać lub usuwać węzły na żądanie przez administratora systemu lub automatycznie bez interwencji człowieka.</span><span class="sxs-lookup"><span data-stu-id="f6685-112">Web farm platform technologies, such as [Azure App Service](https://azure.microsoft.com/services/app-service/), can automatically add or remove nodes at the request of the system administrator or automatically without human intervention.</span></span>
* <span data-ttu-id="f6685-113">**Łatwość konserwacji** &ndash; węzły farmy sieci web może polegać na zbiór usług udostępnionych, co skutkuje łatwiejsze zarządzanie w systemie.</span><span class="sxs-lookup"><span data-stu-id="f6685-113">**Maintainability** &ndash; Nodes of a web farm can rely on a set of shared services, which results in easier system management.</span></span> <span data-ttu-id="f6685-114">Na przykład polegać węzły farmy sieci web od pojedynczego serwera bazy danych i wspólnej lokalizacji sieciowej dla zasobów statycznych, takich jak obrazy i pliki do pobrania.</span><span class="sxs-lookup"><span data-stu-id="f6685-114">For example, the nodes of a web farm can rely upon a single database server and a common network location for static resources, such as images and downloadable files.</span></span>

<span data-ttu-id="f6685-115">W tym temacie opisano, konfiguracji i zależności dla aplikacji ASP.NET core hostowana na farmie sieci web, które korzystają z zasobów udostępnionych.</span><span class="sxs-lookup"><span data-stu-id="f6685-115">This topic describes configuration and dependencies for ASP.NET core apps hosted in a web farm that rely upon shared resources.</span></span>

## <a name="general-configuration"></a><span data-ttu-id="f6685-116">Konfiguracja ogólna</span><span class="sxs-lookup"><span data-stu-id="f6685-116">General configuration</span></span>

<xref:host-and-deploy/index>  
<span data-ttu-id="f6685-117">Dowiedz się, jak skonfigurować środowiskach hostingu i wdrażanie aplikacji platformy ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="f6685-117">Learn how to set up hosting environments and deploy ASP.NET Core apps.</span></span> <span data-ttu-id="f6685-118">Skonfiguruj menedżera procesów w każdym węźle kolektywu serwerów sieci web do zautomatyzowania aplikacja uruchamia się i ponownego uruchomienia.</span><span class="sxs-lookup"><span data-stu-id="f6685-118">Configure a process manager on each node of the web farm to automate app starts and restarts.</span></span> <span data-ttu-id="f6685-119">Każdy węzeł wymaga środowiska uruchomieniowego platformy ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="f6685-119">Each node requires the ASP.NET Core runtime.</span></span> <span data-ttu-id="f6685-120">Aby uzyskać więcej informacji, zobacz Tematy w [hosta i wdrażanie](xref:host-and-deploy/index) obszaru dokumentacji.</span><span class="sxs-lookup"><span data-stu-id="f6685-120">For more information, see the topics in the [Host and deploy](xref:host-and-deploy/index) area of the documentation.</span></span>

<xref:host-and-deploy/proxy-load-balancer>  
<span data-ttu-id="f6685-121">Więcej informacji o konfiguracji dla aplikacji hostowanych za serwery proxy i moduły równoważenia obciążenia, które często zasłaniać żądanie ważnych informacji.</span><span class="sxs-lookup"><span data-stu-id="f6685-121">Learn about configuration for apps hosted behind proxy servers and load balancers, which often obscure important request information.</span></span>

<xref:host-and-deploy/azure-apps/index>  
<span data-ttu-id="f6685-122">[Usługa Azure App Service](https://azure.microsoft.com/services/app-service/) jest [chmury obliczeniowej platformy usługi firmy Microsoft](https://azure.microsoft.com/) do hostowania aplikacji sieci web, łącznie z platformą ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="f6685-122">[Azure App Service](https://azure.microsoft.com/services/app-service/) is a [Microsoft cloud computing platform service](https://azure.microsoft.com/) for hosting web apps, including ASP.NET Core.</span></span> <span data-ttu-id="f6685-123">App Service to w pełni zarządzana platforma, która umożliwia automatyczne skalowanie, równoważenie obciążenia sieciowego, poprawek i ciągłego wdrażania.</span><span class="sxs-lookup"><span data-stu-id="f6685-123">App Service is a fully managed platform that provides automatic scaling, load balancing, patching, and continuous deployment.</span></span>

## <a name="app-data"></a><span data-ttu-id="f6685-124">Dane aplikacji</span><span class="sxs-lookup"><span data-stu-id="f6685-124">App data</span></span>

<span data-ttu-id="f6685-125">Gdy aplikacja jest skalowana do wielu wystąpień, może to być stan aplikacji, który wymaga udostępnianie między węzłami.</span><span class="sxs-lookup"><span data-stu-id="f6685-125">When an app is scaled to multiple instances, there might be app state that requires sharing across nodes.</span></span> <span data-ttu-id="f6685-126">Jeśli stan jest przejściowe, rozważ udostępnienie [IDistributedCache](/dotnet/api/microsoft.extensions.caching.distributed.idistributedcache).</span><span class="sxs-lookup"><span data-stu-id="f6685-126">If the state is transient, consider sharing an [IDistributedCache](/dotnet/api/microsoft.extensions.caching.distributed.idistributedcache).</span></span> <span data-ttu-id="f6685-127">Jeśli udostępniony stan wymaga trwałości, należy wziąć pod uwagę przechowywania udostępnionego stanu w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f6685-127">If the shared state requires persistence, consider storing the shared state in a database.</span></span>

## <a name="required-configuration"></a><span data-ttu-id="f6685-128">Wymaganej konfiguracji</span><span class="sxs-lookup"><span data-stu-id="f6685-128">Required configuration</span></span>

<span data-ttu-id="f6685-129">Ochrona danych i pamięć podręczna wymagają konfiguracji dla aplikacji wdrożonych na farmie sieci web.</span><span class="sxs-lookup"><span data-stu-id="f6685-129">Data Protection and Caching require configuration for apps deployed to a web farm.</span></span>

### <a name="data-protection"></a><span data-ttu-id="f6685-130">Ochrona danych</span><span class="sxs-lookup"><span data-stu-id="f6685-130">Data Protection</span></span>

<span data-ttu-id="f6685-131">[System ochrony danych programu ASP.NET Core](xref:security/data-protection/introduction) jest używane przez aplikacje do ochrony danych.</span><span class="sxs-lookup"><span data-stu-id="f6685-131">The [ASP.NET Core Data Protection system](xref:security/data-protection/introduction) is used by apps to protect data.</span></span> <span data-ttu-id="f6685-132">Ochrona danych opiera się na zestaw klucze szyfrowania są przechowywane w *pierścienia klucz*.</span><span class="sxs-lookup"><span data-stu-id="f6685-132">Data Protection relies upon a set of cryptographic keys stored in a *key ring*.</span></span> <span data-ttu-id="f6685-133">Po zainicjowaniu system ochrony danych dotyczy [domyślne ustawienia](xref:security/data-protection/configuration/default-settings) , zapisać pierścienia klucz lokalnie.</span><span class="sxs-lookup"><span data-stu-id="f6685-133">When the Data Protection system is initialized, it applies [default settings](xref:security/data-protection/configuration/default-settings) that store the key ring locally.</span></span> <span data-ttu-id="f6685-134">W obszarze Konfiguracja domyślna pierścień Unikatowy klucz znajduje się w każdym węźle kolektywu serwerów sieci web.</span><span class="sxs-lookup"><span data-stu-id="f6685-134">Under the default configuration, a unique key ring is stored on each node of the web farm.</span></span> <span data-ttu-id="f6685-135">W związku z tym każdy węzeł farmy sieci web nie może odszyfrować danych, które są szyfrowane przez aplikację w innym węźle.</span><span class="sxs-lookup"><span data-stu-id="f6685-135">Consequently, each web farm node can't decrypt data that's encrypted by an app on any other node.</span></span> <span data-ttu-id="f6685-136">Domyślna konfiguracja nie jest zazwyczaj odpowiedni do hostowania aplikacji w ramach farmy sieci web.</span><span class="sxs-lookup"><span data-stu-id="f6685-136">The default configuration isn't generally appropriate for hosting apps in a web farm.</span></span> <span data-ttu-id="f6685-137">Alternatywa Implementowanie udostępnionego pierścień klucza jest zawsze Przekierowywanie żądań użytkowników do tego samego węzła.</span><span class="sxs-lookup"><span data-stu-id="f6685-137">An alternative to implementing a shared key ring is to always route user requests to the same node.</span></span> <span data-ttu-id="f6685-138">Aby uzyskać więcej informacji na temat konfiguracji systemu ochrony danych w przypadku wdrożeń kolektywu serwerów sieci web, zobacz <xref:security/data-protection/configuration/overview>.</span><span class="sxs-lookup"><span data-stu-id="f6685-138">For more information on Data Protection system configuration for web farm deployments, see <xref:security/data-protection/configuration/overview>.</span></span>

### <a name="caching"></a><span data-ttu-id="f6685-139">Pamięć podręczna</span><span class="sxs-lookup"><span data-stu-id="f6685-139">Caching</span></span>

<span data-ttu-id="f6685-140">W środowisku farmy sieci web mechanizm buforowania muszą współużytkować elementów pamięci podręcznej w węzłach kolektywu serwerów sieci web.</span><span class="sxs-lookup"><span data-stu-id="f6685-140">In a web farm environment, the caching mechanism must share cached items across the web farm's nodes.</span></span> <span data-ttu-id="f6685-141">Buforowanie musi albo korzystają z typowych pamięci podręcznej redis cache, udostępnionej bazy danych programu SQL Server lub niestandardowych implementacji buforowania, która udostępnia elementy pamięci podręcznej w całej farmie sieci web.</span><span class="sxs-lookup"><span data-stu-id="f6685-141">Caching must either rely upon a common Redis cache, a shared SQL Server database, or a custom caching implementation that shares cached items across the web farm.</span></span> <span data-ttu-id="f6685-142">Aby uzyskać więcej informacji, zobacz <xref:performance/caching/distributed>.</span><span class="sxs-lookup"><span data-stu-id="f6685-142">For more information, see <xref:performance/caching/distributed>.</span></span>

## <a name="dependent-components"></a><span data-ttu-id="f6685-143">Składniki zależne</span><span class="sxs-lookup"><span data-stu-id="f6685-143">Dependent components</span></span>

<span data-ttu-id="f6685-144">Następujące scenariusze nie wymaga dodatkowych czynności konfiguracyjnych, ale są one zależne od technologii, które wymagają konfiguracji dla farmy serwerów sieci web.</span><span class="sxs-lookup"><span data-stu-id="f6685-144">The following scenarios don't require additional configuration, but they depend on technologies that require configuration for web farms.</span></span>

| <span data-ttu-id="f6685-145">Scenariusz</span><span class="sxs-lookup"><span data-stu-id="f6685-145">Scenario</span></span> | <span data-ttu-id="f6685-146">Zależy od &hellip;</span><span class="sxs-lookup"><span data-stu-id="f6685-146">Depends on &hellip;</span></span> |
| -------- | ------------------- |
| <span data-ttu-id="f6685-147">Uwierzytelnianie</span><span class="sxs-lookup"><span data-stu-id="f6685-147">Authentication</span></span> | <span data-ttu-id="f6685-148">Ochrona danych (zobacz <xref:security/data-protection/configuration/overview>).</span><span class="sxs-lookup"><span data-stu-id="f6685-148">Data Protection (see <xref:security/data-protection/configuration/overview>).</span></span><br><br><span data-ttu-id="f6685-149">Aby uzyskać więcej informacji, zobacz <xref:security/authentication/cookie> i <xref:security/cookie-sharing>.</span><span class="sxs-lookup"><span data-stu-id="f6685-149">For more information, see <xref:security/authentication/cookie> and <xref:security/cookie-sharing>.</span></span> |
| <span data-ttu-id="f6685-150">Tożsamość</span><span class="sxs-lookup"><span data-stu-id="f6685-150">Identity</span></span> | <span data-ttu-id="f6685-151">Konfiguracja uwierzytelniania i bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f6685-151">Authentication and database configuration.</span></span><br><br><span data-ttu-id="f6685-152">Aby uzyskać więcej informacji, zobacz <xref:security/authentication/identity>.</span><span class="sxs-lookup"><span data-stu-id="f6685-152">For more information, see <xref:security/authentication/identity>.</span></span> |
| <span data-ttu-id="f6685-153">Sesja</span><span class="sxs-lookup"><span data-stu-id="f6685-153">Session</span></span> | <span data-ttu-id="f6685-154">Ochrona danych (zaszyfrowanych plików cookie) (zobacz <xref:security/data-protection/configuration/overview>) i pamięć podręczna (zobacz <xref:performance/caching/distributed>).</span><span class="sxs-lookup"><span data-stu-id="f6685-154">Data Protection (encrypted cookies) (see <xref:security/data-protection/configuration/overview>) and Caching (see <xref:performance/caching/distributed>).</span></span><br><br><span data-ttu-id="f6685-155">Aby uzyskać więcej informacji, zobacz [stan sesji i aplikacji: stan sesji](xref:fundamentals/app-state#session-state).</span><span class="sxs-lookup"><span data-stu-id="f6685-155">For more information, see [Session and app state: Session state](xref:fundamentals/app-state#session-state).</span></span> |
| <span data-ttu-id="f6685-156">TempData</span><span class="sxs-lookup"><span data-stu-id="f6685-156">TempData</span></span> | <span data-ttu-id="f6685-157">Ochrona danych (zaszyfrowanych plików cookie) (zobacz <xref:security/data-protection/configuration/overview>) lub sesji (zobacz [stan sesji i aplikacji: stan sesji](xref:fundamentals/app-state#session-state)).</span><span class="sxs-lookup"><span data-stu-id="f6685-157">Data Protection (encrypted cookies) (see <xref:security/data-protection/configuration/overview>) or Session (see [Session and app state: Session state](xref:fundamentals/app-state#session-state)).</span></span><br><br><span data-ttu-id="f6685-158">Aby uzyskać więcej informacji, zobacz [stan sesji i aplikacji: TempData](xref:fundamentals/app-state#tempdata).</span><span class="sxs-lookup"><span data-stu-id="f6685-158">For more information, see [Session and app state: TempData](xref:fundamentals/app-state#tempdata).</span></span> |
| <span data-ttu-id="f6685-159">Zabezpieczający przed sfałszowaniem</span><span class="sxs-lookup"><span data-stu-id="f6685-159">Anti-forgery</span></span> | <span data-ttu-id="f6685-160">Ochrona danych (zobacz <xref:security/data-protection/configuration/overview>).</span><span class="sxs-lookup"><span data-stu-id="f6685-160">Data Protection (see <xref:security/data-protection/configuration/overview>).</span></span><br><br><span data-ttu-id="f6685-161">Aby uzyskać więcej informacji, zobacz <xref:security/anti-request-forgery>.</span><span class="sxs-lookup"><span data-stu-id="f6685-161">For more information, see <xref:security/anti-request-forgery>.</span></span> |

## <a name="troubleshoot"></a><span data-ttu-id="f6685-162">Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="f6685-162">Troubleshoot</span></span>

<span data-ttu-id="f6685-163">Podczas ochrony danych lub pamięć podręczna nie jest skonfigurowany w środowisku kolektywu serwerów sieci web, sporadyczne błędy występują podczas przetwarzania żądania.</span><span class="sxs-lookup"><span data-stu-id="f6685-163">When Data Protection or Caching isn't configured for a web farm environment, intermittent errors occur when requests are processed.</span></span> <span data-ttu-id="f6685-164">Dzieje się tak, ponieważ węzły nie współużytkują te same zasoby, a żądania użytkowników nie są zawsze kierowane do tego samego węzła.</span><span class="sxs-lookup"><span data-stu-id="f6685-164">This occurs because nodes don't share the same resources and user requests aren't always routed back to the same node.</span></span>

<span data-ttu-id="f6685-165">Należy wziąć pod uwagę użytkownika, który zaloguje się do aplikacji przy użyciu uwierzytelniania plików cookie.</span><span class="sxs-lookup"><span data-stu-id="f6685-165">Consider a user who signs into the app using cookie authentication.</span></span> <span data-ttu-id="f6685-166">Zalogowaniu się użytkownika do aplikacji na węzeł farmy jedną witrynę sieci web.</span><span class="sxs-lookup"><span data-stu-id="f6685-166">The user signs into the app on one web farm node.</span></span> <span data-ttu-id="f6685-167">Jeśli ich kolejne żądanie zostanie odebrana na tym samym węźle, gdzie one podpisane, aplikacja jest w stanie odszyfrować pliku cookie uwierzytelniania i umożliwia dostęp do zasobów aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f6685-167">If their next request arrives at the same node where they signed in, the app is able to decrypt the authentication cookie and allows access to the app's resource.</span></span> <span data-ttu-id="f6685-168">Jeśli ich kolejne żądanie dociera do innego węzła, aplikacja nie można odszyfrować pliku cookie uwierzytelniania z poziomu węzła, gdzie użytkownik jest zalogowany i autoryzacji dla żądanego zasobu nie powiodło się.</span><span class="sxs-lookup"><span data-stu-id="f6685-168">If their next request arrives at a different node, the app can't decrypt the authentication cookie from the node where the user signed in, and authorization for the requested resource fails.</span></span>

<span data-ttu-id="f6685-169">Gdy wystąpienia któregokolwiek z następujących objawów **sporadycznie**, śledzona jest zazwyczaj problem do nieprawidłowej konfiguracji ochrony danych i pamięć podręczna w środowisku farmy sieci web:</span><span class="sxs-lookup"><span data-stu-id="f6685-169">When any of the following symptoms occur **intermittently**, the problem is usually traced to improper Data Protection or Caching configuration for a web farm environment:</span></span>

* <span data-ttu-id="f6685-170">Podziały uwierzytelniania &ndash; pliku cookie uwierzytelniania jest nieprawidłowo skonfigurowana lub nie można odszyfrować.</span><span class="sxs-lookup"><span data-stu-id="f6685-170">Authentication breaks &ndash; The authentication cookie is misconfigured or can't be decrypted.</span></span> <span data-ttu-id="f6685-171">OAuth (Facebook, Microsoft, Twitter) lub OpenIdConnect logowania się nie powieść z powodu błędu "Korelacji nie powiodło się."</span><span class="sxs-lookup"><span data-stu-id="f6685-171">OAuth (Facebook, Microsoft, Twitter) or OpenIdConnect logins fail with the error "Correlation failed."</span></span>
* <span data-ttu-id="f6685-172">Podziały autoryzacji &ndash; tożsamości zostaną utracone.</span><span class="sxs-lookup"><span data-stu-id="f6685-172">Authorization breaks &ndash; Identity is lost.</span></span>
* <span data-ttu-id="f6685-173">Stan sesji powoduje utratę danych.</span><span class="sxs-lookup"><span data-stu-id="f6685-173">Session state loses data.</span></span>
* <span data-ttu-id="f6685-174">Elementy pamięci podręcznej znikną.</span><span class="sxs-lookup"><span data-stu-id="f6685-174">Cached items disappear.</span></span>
* <span data-ttu-id="f6685-175">TempData kończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="f6685-175">TempData fails.</span></span>
* <span data-ttu-id="f6685-176">Publikuje niepowodzenie &ndash; sprawdzenie zabezpieczający przed sfałszowaniem nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="f6685-176">POSTs fail &ndash; The anti-forgery check fails.</span></span>

<span data-ttu-id="f6685-177">Aby uzyskać więcej informacji na temat konfigurowania ochrony danych dla wdrożeń kolektywu serwerów sieci web, zobacz <xref:security/data-protection/configuration/overview>.</span><span class="sxs-lookup"><span data-stu-id="f6685-177">For more information on Data Protection configuration for web farm deployments, see <xref:security/data-protection/configuration/overview>.</span></span> <span data-ttu-id="f6685-178">Aby uzyskać więcej informacji na temat konfiguracji pamięci podręcznej w przypadku wdrożeń kolektywu serwerów sieci web, zobacz <xref:performance/caching/distributed>.</span><span class="sxs-lookup"><span data-stu-id="f6685-178">For more information on Caching configuration for web farm deployments, see <xref:performance/caching/distributed>.</span></span>
