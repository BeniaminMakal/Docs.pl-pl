---
uid: mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
title: Używanie metod asynchronicznych na platformie ASP.NET MVC 4 | Dokumentacja firmy Microsoft
author: Rick-Anderson
description: W tym samouczku uczy podstawy tworzenia asynchroniczne aplikacji sieci Web programu ASP.NET MVC przy użyciu programu Visual Studio Express 2012 for Web, czyli wolnego kolejnych...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/06/2012
ms.topic: article
ms.assetid: a56572ba-81c3-47af-826d-941e9c4775ec
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: cee5fded4d8005df6054ab921f39882c3e5f21b8
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2018
---
<a name="using-asynchronous-methods-in-aspnet-mvc-4"></a><span data-ttu-id="518d9-103">Używanie metod asynchronicznych na platformie ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="518d9-103">Using Asynchronous Methods in ASP.NET MVC 4</span></span>
====================
<span data-ttu-id="518d9-104">przez [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="518d9-104">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="518d9-105">W tym samouczku udzieli Ci podstawy asynchroniczne sieci Web programu ASP.NET MVC aplikacji za pomocą [programu Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), który jest bezpłatną wersję programu Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="518d9-105">This tutorial will teach you the basics of building an asynchronous ASP.NET MVC Web application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="518d9-106">Można również użyć [programu Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="518d9-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span>
> 
> <span data-ttu-id="518d9-107">Kompletnego przykładu znajduje się w tym samouczku w witrynie github  [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span><span class="sxs-lookup"><span data-stu-id="518d9-107">A complete sample is provided for this tutorial on github  [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span></span>


<span data-ttu-id="518d9-108">ASP.NET MVC 4 [kontrolera](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) klasy w połączeniu [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) umożliwia pisanie metod asynchronicznych akcji, które zwracają obiekt typu [zadań&lt;ActionResult&gt; ](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="518d9-108">The ASP.NET MVC 4 [Controller](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) class in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to write asynchronous action methods that return an object of type [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span></span> <span data-ttu-id="518d9-109">.NET Framework 4 wprowadzono asynchroniczne koncepcji programowania nazywane [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) i obsługuje platformy ASP.NET MVC 4 [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="518d9-109">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET MVC 4 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="518d9-110">Zadania są reprezentowane przez **zadań** typu i powiązanych typów z [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="518d9-110">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="518d9-111">.NET Framework 4.5 opiera się na tym obsługa komunikacji asynchronicznej z [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych, które sprawiają, że praca z [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) znacznie mniej złożona niż poprzednie obiektów metody asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="518d9-111">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="518d9-112">[Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) — słowo kluczowe jest syntaktycznych skrócona forma wskazujący, który fragment kodu asynchronicznie ma oczekiwać na innych części kodu.</span><span class="sxs-lookup"><span data-stu-id="518d9-112">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="518d9-113">[Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) — słowo kluczowe reprezentuje wskazówkę, która służy do oznaczania metod jako opartego na zadaniach asynchronicznej metody.</span><span class="sxs-lookup"><span data-stu-id="518d9-113">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="518d9-114">Kombinacja **await**, **async**i **zadań** obiektu ułatwia do pisania kodu asynchronicznego w programie .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="518d9-114">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="518d9-115">Nowy model do metod asynchronicznych jest nazywany *wzorca asynchronicznego opartego na zadaniach* (**wybierz**).</span><span class="sxs-lookup"><span data-stu-id="518d9-115">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="518d9-116">Ten samouczek zakłada, masz pewną znajomość asynchronicznych za pomocą programing [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych i [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="518d9-116">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="518d9-117">Aby uzyskać więcej informacji na temat używania [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych i [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) przestrzeni nazw, zobacz następujące odwołania.</span><span class="sxs-lookup"><span data-stu-id="518d9-117">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="518d9-118">Oficjalny dokument: Asynchrony w .NET</span><span class="sxs-lookup"><span data-stu-id="518d9-118">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="518d9-119">Async/Await — często zadawane pytania</span><span class="sxs-lookup"><span data-stu-id="518d9-119">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="518d9-120">Programowanie asynchroniczne programu Visual Studio</span><span class="sxs-lookup"><span data-stu-id="518d9-120">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a>  <span data-ttu-id="518d9-121">Jak żądania są przetwarzane przez puli wątków</span><span class="sxs-lookup"><span data-stu-id="518d9-121">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="518d9-122">Na serwerze sieci web programu .NET Framework przechowuje pulę wątków, które są używane do obsługi żądań ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="518d9-122">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="518d9-123">Gdy żądanie dociera, wątków z puli jest wysyłane do przetwarzania tego żądania.</span><span class="sxs-lookup"><span data-stu-id="518d9-123">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="518d9-124">Jeśli żądanie jest przetwarzane synchronicznie, wątku, który przetwarza żądania jest zajęty podczas żądanie jest przetwarzane i że wątek nie może zrealizować innego żądania.</span><span class="sxs-lookup"><span data-stu-id="518d9-124">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="518d9-125">To może nie być problem, ponieważ pula wątków może się wystarczająco duże, aby pomieścić wiele wątków zajęty.</span><span class="sxs-lookup"><span data-stu-id="518d9-125">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="518d9-126">Jednak jest ograniczona liczba wątków w puli wątków (domyślna wartość maksymalna .NET 4.5 jest 5000).</span><span class="sxs-lookup"><span data-stu-id="518d9-126">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="518d9-127">W dużych aplikacji o wysokiej współbieżności długotrwałe żądania może być zajęta wszystkich dostępnych wątków.</span><span class="sxs-lookup"><span data-stu-id="518d9-127">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="518d9-128">Ten stan jest nazywany zablokowania wątku.</span><span class="sxs-lookup"><span data-stu-id="518d9-128">This condition is known as thread starvation.</span></span> <span data-ttu-id="518d9-129">Po osiągnięciu tego warunku, serwer sieci web kolejki żądań.</span><span class="sxs-lookup"><span data-stu-id="518d9-129">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="518d9-130">Jeśli zapełnienia kolejki żądań serwera sieci web odrzuca żądania z stan HTTP 503 (serwer jest zbyt zajęty).</span><span class="sxs-lookup"><span data-stu-id="518d9-130">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="518d9-131">Pula wątków CLR ma ograniczenia na nowe iniekcji wątku.</span><span class="sxs-lookup"><span data-stu-id="518d9-131">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="518d9-132">Jeśli seryjnym współbieżności (to znaczy witryny sieci web może nagle get dużą liczbę żądań) i wszystkie wątki żądanie dostępne są zajęte ze względu na wywołania zaplecza duże opóźnienie, szybkość iniekcji ograniczone wątku można zwiększyć bezpieczeństwo aplikacji odpowiadać bardzo źle.</span><span class="sxs-lookup"><span data-stu-id="518d9-132">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="518d9-133">Ponadto w każdym nowym wątku dodane do puli wątków ma obciążenie (na przykład 1 MB pamięci stosu).</span><span class="sxs-lookup"><span data-stu-id="518d9-133">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="518d9-134">Aplikacji sieci web przy użyciu metod synchronicznych wywołań duże opóźnienie usługi, którym puli wątków rozwoju domyślne .NET 4.5 maksymalnie 5 000 wątków będzie używać około 5 GB więcej pamięci niż aplikacja stanie takie same żądania obsługi przy użyciu metody asynchroniczne i wątków tylko 50.</span><span class="sxs-lookup"><span data-stu-id="518d9-134">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="518d9-135">Gdy podczas wykonywania zadanie asynchroniczne, nie zawsze korzystasz wątku.</span><span class="sxs-lookup"><span data-stu-id="518d9-135">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="518d9-136">Na przykład po wprowadzeniu żądanie usługi sieci web asynchroniczne, program ASP.NET nie będzie korzystać wszystkie wątki między **async** wywołanie metody i **await**.</span><span class="sxs-lookup"><span data-stu-id="518d9-136">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="518d9-137">Duże opóźnienie przy użyciu puli wątków do obsługi żądań może prowadzić do dużych pamięci i niską wykorzystanie sprzętu serwera.</span><span class="sxs-lookup"><span data-stu-id="518d9-137">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="518d9-138">Przetwarzanie żądań asynchronicznych</span><span class="sxs-lookup"><span data-stu-id="518d9-138">Processing Asynchronous Requests</span></span>

<span data-ttu-id="518d9-139">W aplikacji sieci web, które widzi dużej liczby równoczesnych żądań przy rozruchu lub ma seryjnym obciążenia (gdzie współbieżności zwiększa nagle) co asynchroniczne te wywołania usługi sieci web spowoduje zwiększenie czas odpowiedzi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="518d9-139">In web applications that sees a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making these web service calls asynchronous will increase the responsiveness of your application.</span></span> <span data-ttu-id="518d9-140">Asynchroniczne żądanie trwa tyle samo czasu na przetwarzanie jako żądań synchronicznych.</span><span class="sxs-lookup"><span data-stu-id="518d9-140">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="518d9-141">Na przykład jeśli żądanie sprawia, że usługi sieci web wywołaniu, które wymaga dwóch sekund, przyjmuje żądania dwie sekundy czy jest wykonywane synchronicznie lub asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="518d9-141">For example, if a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it is performed synchronously or asynchronously.</span></span> <span data-ttu-id="518d9-142">Jednak podczas wywołania asynchronicznego wątku nie blokuje odpowiedzi na inne żądania podczas oczekiwania na pierwsze żądanie do wykonania.</span><span class="sxs-lookup"><span data-stu-id="518d9-142">However, during an asynchronous call, a thread is not blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="518d9-143">W związku z tym żądań asynchronicznych uniknięcia wzrostu puli usługi kolejkowania wiadomości i wątku żądania, gdy istnieją dużą liczbą jednoczesnych żądań, które wywołują długotrwałej operacji.</span><span class="sxs-lookup"><span data-stu-id="518d9-143">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a>  <span data-ttu-id="518d9-144">Wybór metody akcji synchronicznego lub asynchronicznego</span><span class="sxs-lookup"><span data-stu-id="518d9-144">Choosing Synchronous or Asynchronous Action Methods</span></span>

<span data-ttu-id="518d9-145">Ta sekcja zawiera wskazówki dotyczące użycie metody akcji synchroniczna lub asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="518d9-145">This section lists guidelines for when to use synchronous or asynchronous action methods.</span></span> <span data-ttu-id="518d9-146">Są to po prostu wytycznych; zbadać każdą aplikację osobno w celu ustalenia, czy metod asynchronicznych pomocy z wydajnością.</span><span class="sxs-lookup"><span data-stu-id="518d9-146">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="518d9-147">Ogólnie rzecz biorąc Użyj metod synchronicznych następujące warunki:</span><span class="sxs-lookup"><span data-stu-id="518d9-147">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="518d9-148">Operacje są proste lub wykonywania short.</span><span class="sxs-lookup"><span data-stu-id="518d9-148">The operations are simple or short-running.</span></span>
- <span data-ttu-id="518d9-149">Prostota ma większe znaczenie niż wydajność.</span><span class="sxs-lookup"><span data-stu-id="518d9-149">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="518d9-150">Operacje są głównie operacje Procesora zamiast operacje, które wymagają szeroką gamę dysku lub obciążenie sieci.</span><span class="sxs-lookup"><span data-stu-id="518d9-150">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="518d9-151">Za pomocą metod asynchronicznych akcji na operacje procesora zapewnia nie korzyści i powoduje bardziej obciążenie.</span><span class="sxs-lookup"><span data-stu-id="518d9-151">Using asynchronous action methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

  <span data-ttu-id="518d9-152">Ogólnie rzecz biorąc można używać metod asynchronicznych następujące warunki:</span><span class="sxs-lookup"><span data-stu-id="518d9-152">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="518d9-153">W przypadku wywoływania usługi, które mogą być używane za pośrednictwem metod asynchronicznych i używasz .NET 4.5 lub wyższej.</span><span class="sxs-lookup"><span data-stu-id="518d9-153">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="518d9-154">Operacje są powiązane z siecią lub I/E-granicę zamiast procesora.</span><span class="sxs-lookup"><span data-stu-id="518d9-154">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="518d9-155">Równoległość ma większe znaczenie niż prostota kodu.</span><span class="sxs-lookup"><span data-stu-id="518d9-155">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="518d9-156">Chcesz udostępniają mechanizm umożliwiający użytkownikom anulować żądanie długotrwałe.</span><span class="sxs-lookup"><span data-stu-id="518d9-156">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="518d9-157">Gdy korzyści przełączania wątków limit przeprowadzi koszt przełączania kontekstu.</span><span class="sxs-lookup"><span data-stu-id="518d9-157">When the benefit of switching threads out weights the cost of the context switch.</span></span> <span data-ttu-id="518d9-158">Ogólnie rzecz biorąc należy metody asynchroniczne, jeśli metoda synchroniczna oczekuje na wątek żądania ASP.NET podczas wykonywania żadne czynności.</span><span class="sxs-lookup"><span data-stu-id="518d9-158">In general, you should make a method asynchronous if the synchronous method waits on the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="518d9-159">Za pomocą wywołania asynchronicznego, wątku żądania ASP.NET jest zainstalowany ten żadne czynności podczas oczekiwania na żądanie usługi sieci web zakończyć.</span><span class="sxs-lookup"><span data-stu-id="518d9-159">By making the call asynchronous, the ASP.NET request thread is not stalled doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="518d9-160">Testowanie pokazuje, czy operacji blokowania wąskich gardeł wydajności lokacji i usług IIS może obsłużyć więcej żądań przy użyciu metod asynchronicznych tymi połączeniami blokowania.</span><span class="sxs-lookup"><span data-stu-id="518d9-160">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

  <span data-ttu-id="518d9-161">Do pobrania przykładowych pokazano, jak skutecznie używać metod asynchronicznych akcji.</span><span class="sxs-lookup"><span data-stu-id="518d9-161">The downloadable sample shows how to use asynchronous action methods effectively.</span></span> <span data-ttu-id="518d9-162">Przykładu dostępnego zaprojektowano tak, aby zapewnić prosty pokaz programowania asynchronicznego w programie ASP.NET MVC 4 przy użyciu platformy .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="518d9-162">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET MVC 4 using .NET 4.5.</span></span> <span data-ttu-id="518d9-163">Przykład nie jest przeznaczona do architektury odwołania do programowania asynchronicznego w programie ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="518d9-163">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET MVC.</span></span> <span data-ttu-id="518d9-164">Wywołuje program przykładowy [ASP.NET Web API](../../../web-api/index.md) metod, które z kolei wymagają [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) do symulowania wywołania usługi sieci web długotrwałe.</span><span class="sxs-lookup"><span data-stu-id="518d9-164">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="518d9-165">Większość aplikacji produkcyjnych, nie będą widoczne takie oczywiste korzyści wynikające z używania metod asynchronicznych akcji.</span><span class="sxs-lookup"><span data-stu-id="518d9-165">Most production applications will not show such obvious benefits to using asynchronous action methods.</span></span>   
  
<span data-ttu-id="518d9-166">Kilka aplikacji wymaga wszystkich metod akcji była asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="518d9-166">Few applications require all action methods to be asynchronous.</span></span> <span data-ttu-id="518d9-167">Często konwertowanie kilka metod synchronicznych akcji do metod asynchronicznych zapewnia najlepsze zwiększenia efektywności ilości pracy wymagane.</span><span class="sxs-lookup"><span data-stu-id="518d9-167">Often, converting a few synchronous action methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a>  <span data-ttu-id="518d9-168">Przykładowa aplikacja</span><span class="sxs-lookup"><span data-stu-id="518d9-168">The Sample Application</span></span>

<span data-ttu-id="518d9-169">Możesz pobrać przykładową aplikację z [ https://github.com/RickAndMSFT/Async-ASP.NET/ ](https://github.com/RickAndMSFT/Async-ASP.NET) na [GitHub](https://github.com/) lokacji.</span><span class="sxs-lookup"><span data-stu-id="518d9-169">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="518d9-170">Repozytorium zawiera trzy projekty:</span><span class="sxs-lookup"><span data-stu-id="518d9-170">The repository consists of three projects:</span></span>

- <span data-ttu-id="518d9-171">*Mvc4Async*: projekt programu ASP.NET MVC 4, który zawiera kod używany w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="518d9-171">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in this tutorial.</span></span> <span data-ttu-id="518d9-172">Wykonywania wywołań interfejsu API sieci Web do **WebAPIpgw** usługi.</span><span class="sxs-lookup"><span data-stu-id="518d9-172">It makes Web API calls to the **WebAPIpgw** service.</span></span>
- <span data-ttu-id="518d9-173">*WebAPIpgw*: projekt programu ASP.NET MVC 4 interfejsu API sieci Web, który implementuje `Products, Gizmos and Widgets` kontrolerów.</span><span class="sxs-lookup"><span data-stu-id="518d9-173">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="518d9-174">Zapewnia dane dla *WebAppAsync* projektu i *Mvc4Async* projektu.</span><span class="sxs-lookup"><span data-stu-id="518d9-174">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="518d9-175">*WebAppAsync*: używanego w samouczku innego projektu formularzy sieci Web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="518d9-175">*WebAppAsync*: The ASP.NET Web Forms project used in another tutorial.</span></span>

## <a id="GizmosSynch"></a>  <span data-ttu-id="518d9-176">Metoda synchroniczna akcji Gizmos</span><span class="sxs-lookup"><span data-stu-id="518d9-176">The Gizmos Synchronous Action Method</span></span>

 <span data-ttu-id="518d9-177">Poniższy kod przedstawia `Gizmos` metody synchroniczne akcji, która jest używana do wyświetlania listy gizmos.</span><span class="sxs-lookup"><span data-stu-id="518d9-177">The following code shows the `Gizmos` synchronous action method that is used to display a list of gizmos.</span></span> <span data-ttu-id="518d9-178">(W tym artykule gizmo jest urządzenie mechaniczne fikcyjne).</span><span class="sxs-lookup"><span data-stu-id="518d9-178">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample1.cs)]

<span data-ttu-id="518d9-179">Poniższy kod przedstawia `GetGizmos` metody gizmo usługi.</span><span class="sxs-lookup"><span data-stu-id="518d9-179">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample2.cs)]

<span data-ttu-id="518d9-180">`GizmoService GetGizmos` Metoda przekazuje identyfikatora URI z usługą HTTP interfejsu API sieci Web programu ASP.NET, która zwraca listę gizmos danych.</span><span class="sxs-lookup"><span data-stu-id="518d9-180">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="518d9-181">*WebAPIpgw* projektu zawiera implementację interfejsu API sieci Web `gizmos, widget` i `product` kontrolerów.</span><span class="sxs-lookup"><span data-stu-id="518d9-181">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="518d9-182">Na poniższej ilustracji przedstawiono widok gizmos z przykładowy projekt.</span><span class="sxs-lookup"><span data-stu-id="518d9-182">The following image shows the gizmos view from the sample project.</span></span>

![Gizmos](using-asynchronous-methods-in-aspnet-mvc-4/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a>  <span data-ttu-id="518d9-184">Tworzenie Gizmos asynchronicznej metody akcji</span><span class="sxs-lookup"><span data-stu-id="518d9-184">Creating an Asynchronous Gizmos Action Method</span></span>

<span data-ttu-id="518d9-185">Przykład używa nowego [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) i [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) słowa kluczowe (dostępne w .NET 4.5 i programu Visual Studio 2012) pozwala kompilatora odpowiada za utrzymywanie złożone przekształcenia niezbędne do Programowanie asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="518d9-185">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="518d9-186">Kompilator umożliwia pisanie kodu za pomocą, który tworzy przepływ sterowania synchroniczne C# w i kompilator automatycznie stosuje przekształcenia trzeba użyć wywołania zwrotne w celu unikania blokowania wątków.</span><span class="sxs-lookup"><span data-stu-id="518d9-186">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="518d9-187">Poniższy kod przedstawia `Gizmos` metoda synchroniczna i `GizmosAsync` metody asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="518d9-187">The following code shows the `Gizmos` synchronous method and the `GizmosAsync` asynchronous method.</span></span> <span data-ttu-id="518d9-188">Jeśli przeglądarka obsługuje [HTML 5 `<mark>` elementu](http://www.w3.org/wiki/HTML/Elements/mark), zmiany w `GizmosAsync` w Wyróżnij żółty.</span><span class="sxs-lookup"><span data-stu-id="518d9-188">If your browser supports the [HTML 5 `<mark>` element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample3.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample4.cs?highlight=1,3,5)]

 <span data-ttu-id="518d9-189">Następujące zmiany zostały zastosowane, aby umożliwić `GizmosAsync` była asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="518d9-189">The following changes were applied to allow the `GizmosAsync` to be asynchronous.</span></span>

- <span data-ttu-id="518d9-190">Metoda jest oznaczona atrybutem [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) — słowo kluczowe, które informuje kompilator, aby wygenerować wywołań zwrotnych dla części treści i automatycznie utworzyć `Task<ActionResult>` który jest zwracany.</span><span class="sxs-lookup"><span data-stu-id="518d9-190">The method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task<ActionResult>` that is returned.</span></span>
- <span data-ttu-id="518d9-191">&quot;Asynchroniczne&quot; został dołączony do nazwy metody.</span><span class="sxs-lookup"><span data-stu-id="518d9-191">&quot;Async&quot; was appended to the method name.</span></span> <span data-ttu-id="518d9-192">Dołączanie "Async" nie jest wymagana, ale jest Konwencji podczas zapisywania metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="518d9-192">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="518d9-193">Zwracany typ został zmieniony z `ActionResult` do `Task<ActionResult>`.</span><span class="sxs-lookup"><span data-stu-id="518d9-193">The return type was changed from `ActionResult` to `Task<ActionResult>`.</span></span> <span data-ttu-id="518d9-194">Zwracany typ `Task<ActionResult>` reprezentuje pracy w toku i dostarcza wywołań metody z dojściem za pośrednictwem której czekać na zakończenie operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="518d9-194">The return type of `Task<ActionResult>` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span> <span data-ttu-id="518d9-195">W takim przypadku obiekt wywołujący jest usługą sieci web.</span><span class="sxs-lookup"><span data-stu-id="518d9-195">In this case, the caller is the web service.</span></span> <span data-ttu-id="518d9-196">`Task<ActionResult>` reprezentuje trwającej pracy z wyniku `ActionResult.`</span><span class="sxs-lookup"><span data-stu-id="518d9-196">`Task<ActionResult>` represents ongoing work with a result of `ActionResult.`</span></span>
- <span data-ttu-id="518d9-197">[Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) — słowo kluczowe została zastosowana do wywołania usługi sieci web.</span><span class="sxs-lookup"><span data-stu-id="518d9-197">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="518d9-198">Interfejs API usługi sieci web asynchroniczne została wywołana (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="518d9-198">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="518d9-199">Wewnątrz `GetGizmosAsync` innej metody asynchroniczne, treści metody `GetGizmosAsync` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="518d9-199">Inside of the `GetGizmosAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="518d9-200">`GetGizmosAsync` natychmiast zwraca `Task<List<Gizmo>>` który ostatecznie zostanie zakończony, gdy dane są dostępne.</span><span class="sxs-lookup"><span data-stu-id="518d9-200">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="518d9-201">Ponieważ nie chcesz wykonywanie dodatkowych czynności, aż do uzyskania danych gizmo kod oczekujące na zadanie (przy użyciu **await** — słowo kluczowe).</span><span class="sxs-lookup"><span data-stu-id="518d9-201">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="518d9-202">Można użyć **await** — słowo kluczowe tylko w metodach opatrzoną **async** — słowo kluczowe.</span><span class="sxs-lookup"><span data-stu-id="518d9-202">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="518d9-203">**Await** — słowo kluczowe nie blokuje wątek, do czasu ukończenia zadania.</span><span class="sxs-lookup"><span data-stu-id="518d9-203">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="518d9-204">Rejestruje się pozostałe metody jako wywołania zwrotnego dla zadania i natychmiast zwraca.</span><span class="sxs-lookup"><span data-stu-id="518d9-204">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="518d9-205">Po ukończeniu ostatecznie oczekiwano zadania, spowoduje wywołanie wywołanie zwrotne i w związku z tym wznowić wykonywanie prawa metody, w którym przerwał.</span><span class="sxs-lookup"><span data-stu-id="518d9-205">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="518d9-206">Aby uzyskać więcej informacji na temat używania [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych i [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) przestrzeni nazw, zobacz [odwołania async](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="518d9-206">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="518d9-207">Poniższy kod przedstawia `GetGizmos` i `GetGizmosAsync` metody.</span><span class="sxs-lookup"><span data-stu-id="518d9-207">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample5.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample6.cs?highlight=1,4-8)]

 <span data-ttu-id="518d9-208">Asynchroniczne zmiany są podobne do tych wprowadzone **GizmosAsync** powyżej.</span><span class="sxs-lookup"><span data-stu-id="518d9-208">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="518d9-209">Podpis metody został oznaczony za pomocą [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) — słowo kluczowe, zwracany typ został zmieniony na `Task<List<Gizmo>>`, i *Async* został dołączony do nazwy metody.</span><span class="sxs-lookup"><span data-stu-id="518d9-209">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="518d9-210">Asynchroniczną [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) klasa jest używana zamiast [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) klasy.</span><span class="sxs-lookup"><span data-stu-id="518d9-210">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="518d9-211">[Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) — słowo kluczowe została zastosowana do [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="518d9-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) asynchronous methods.</span></span>

<span data-ttu-id="518d9-212">Na poniższej ilustracji przedstawiono widok gizmo asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="518d9-212">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-mvc-4/_static/image2.png)

<span data-ttu-id="518d9-214">Przeglądarki prezentację danych gizmos jest identyczny z widoku utworzonego przez wywołanie synchroniczne.</span><span class="sxs-lookup"><span data-stu-id="518d9-214">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="518d9-215">Jedyną różnicą jest to wersja asynchroniczna może być więcej wydajności pod dużym obciążeniem.</span><span class="sxs-lookup"><span data-stu-id="518d9-215">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a id="Parallel"></a>  <span data-ttu-id="518d9-216">Wykonywanie operacji na wielu równolegle</span><span class="sxs-lookup"><span data-stu-id="518d9-216">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="518d9-217">Metod asynchronicznych akcji ma znaczących korzyści za pośrednictwem metod synchronicznych, gdy akcję, należy wykonać kilka operacji niezależnych.</span><span class="sxs-lookup"><span data-stu-id="518d9-217">Asynchronous action methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="518d9-218">W przykładowym pod warunkiem, metoda synchroniczna `PWG`(dla produktów, elementów widget i Gizmos) są wyświetlane wyniki trzy wywołania usługi sieci web w celu uzyskania listy produktów, elementów widget i gizmos.</span><span class="sxs-lookup"><span data-stu-id="518d9-218">In the sample provided, the synchronous method `PWG`(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="518d9-219">[ASP.NET Web API](../../../web-api/index.md) projektu, który zawiera te usługi używa [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) wywołuje w celu symulowania opóźnienia lub powolnej sieci.</span><span class="sxs-lookup"><span data-stu-id="518d9-219">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="518d9-220">Jeśli opóźnienie jest równa 500 milisekund asynchroniczną `PWGasync` metoda pobiera nieco ponad 500 MS, aby ukończyć podczas synchronicznego `PWG` wersji przejmuje 1500 MS.</span><span class="sxs-lookup"><span data-stu-id="518d9-220">When the delay is set to 500 milliseconds, the asynchronous `PWGasync` method takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="518d9-221">Synchroniczne `PWG` metody przedstawiono w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="518d9-221">The synchronous `PWG` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample7.cs)]

<span data-ttu-id="518d9-222">Asynchroniczną `PWGasync` metody przedstawiono w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="518d9-222">The asynchronous `PWGasync` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample8.cs?highlight=1,3,12)]

<span data-ttu-id="518d9-223">Na poniższej ilustracji przedstawiono widok zwrócony z **PWGasync** metody.</span><span class="sxs-lookup"><span data-stu-id="518d9-223">The following image shows the view returned from the **PWGasync** method.</span></span>

![pwgAsync](using-asynchronous-methods-in-aspnet-mvc-4/_static/image3.png)

## <a id="CancelToken"></a>  <span data-ttu-id="518d9-225">Przy użyciu Token anulowania</span><span class="sxs-lookup"><span data-stu-id="518d9-225">Using a Cancellation Token</span></span>

<span data-ttu-id="518d9-226">Metody akcji asynchronicznego zwracania `Task<ActionResult>`czy można anulować, będącą podejmują [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parametru, gdy zostało ono określone z [Wartość AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) atrybutu.</span><span class="sxs-lookup"><span data-stu-id="518d9-226">Asynchronous action methods returning `Task<ActionResult>`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) attribute.</span></span> <span data-ttu-id="518d9-227">Poniższy kod przedstawia `GizmosCancelAsync` metoda z limitem czasu w milisekundach czas oczekiwania 150.</span><span class="sxs-lookup"><span data-stu-id="518d9-227">The following code shows the `GizmosCancelAsync` method with a timeout of 150 milliseconds.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample9.cs?highlight=1-3,5,10)]

<span data-ttu-id="518d9-228">Poniższy kod przedstawia przeciążenia GetGizmosAsync, która przyjmuje [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parametru.</span><span class="sxs-lookup"><span data-stu-id="518d9-228">The following code shows the GetGizmosAsync overload, which takes a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample10.cs)]

<span data-ttu-id="518d9-229">W przykładowej aplikacji pod warunkiem, wybierając *pokaz Token anulowania* link wywołania `GizmosCancelAsync` — metoda i prezentuje anulowanie wywołania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="518d9-229">In the sample application provided, selecting the *Cancellation Token Demo* link calls the `GizmosCancelAsync` method and demonstrates the cancelation of the asynchronous call.</span></span>

## <a id="ServerConfig"></a>  <span data-ttu-id="518d9-230">Konfiguracja serwera dla wywołania usługi sieci Web opóźnienia wysokiej współbieżności/wysoki</span><span class="sxs-lookup"><span data-stu-id="518d9-230">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="518d9-231">Aby wykorzystać zalety aplikacji sieci web asynchroniczne, może być konieczne dokonanie pewnych zmian w domyślnej konfiguracji serwera.</span><span class="sxs-lookup"><span data-stu-id="518d9-231">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="518d9-232">Należy pamiętać o następujących w uwadze podczas konfigurowania i obciążeniowe testowania aplikacji sieci web asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="518d9-232">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="518d9-233">Windows 7, Windows Vista i wszystkie klienckie systemy operacyjne Windows mieć maksymalnie 10 równoczesnych żądań.</span><span class="sxs-lookup"><span data-stu-id="518d9-233">Windows 7, Windows Vista and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="518d9-234">Będziesz potrzebować systemu operacyjnego Windows Server, aby można było wykorzystać zalety metod asynchronicznych mocno obciążony.</span><span class="sxs-lookup"><span data-stu-id="518d9-234">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="518d9-235">Zarejestruj .NET 4.5 z usługami IIS w wierszu polecenia z podwyższonym poziomem uprawnień:</span><span class="sxs-lookup"><span data-stu-id="518d9-235">Register .NET 4.5 with IIS from an elevated command prompt:</span></span>  
  <span data-ttu-id="518d9-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis -i</span><span class="sxs-lookup"><span data-stu-id="518d9-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="518d9-237">Zobacz [narzędzie rejestracji programu ASP.NET usług IIS (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="518d9-237">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="518d9-238">Może być konieczne w celu zwiększenia [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) limitu kolejki z domyślnej wartości 1000 do 5000.</span><span class="sxs-lookup"><span data-stu-id="518d9-238">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="518d9-239">Jeśli ustawienie jest zbyt niska, mogą pojawić się [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) odrzucanie żądań o stan HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="518d9-239">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="518d9-240">Aby zmienić limit kolejki sterownik HTTP.sys:</span><span class="sxs-lookup"><span data-stu-id="518d9-240">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="518d9-241">Otwórz Menedżera usług IIS i przejdź do okienka pul aplikacji.</span><span class="sxs-lookup"><span data-stu-id="518d9-241">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="518d9-242">Kliknij prawym przyciskiem myszy docelową pulę aplikacji, a następnie wybierz **Zaawansowane ustawienia**.</span><span class="sxs-lookup"><span data-stu-id="518d9-242">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="518d9-243">![Zaawansowane](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="518d9-243">![advanced](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span></span>
    - <span data-ttu-id="518d9-244">W **Zaawansowane ustawienia** okno dialogowe, zmień *długość kolejki* z 1000 do 5000.</span><span class="sxs-lookup"><span data-stu-id="518d9-244">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="518d9-245">![Długość kolejki](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="518d9-245">![Queue length](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span></span>  
  
  <span data-ttu-id="518d9-246">Należy pamiętać, obrazy powyżej, .NET framework znajduje się w wersji 4.0, mimo że pula aplikacji jest przy użyciu platformy .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="518d9-246">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="518d9-247">Aby poznać tę rozbieżność, zobacz następujące tematy:</span><span class="sxs-lookup"><span data-stu-id="518d9-247">To understand this discrepancy, see the following:</span></span>

    - [<span data-ttu-id="518d9-248">Przechowywanie wersji platformy .NET i Wielowersyjności - .NET 4.5 jest uaktualnienie w miejscu do programu .NET 4.0</span><span class="sxs-lookup"><span data-stu-id="518d9-248">.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0</span></span>](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
    - [<span data-ttu-id="518d9-249">Jak ustawić aplikacji usług IIS lub puli aplikacji, aby używała ASP.NET 3.5, a nie 2.0</span><span class="sxs-lookup"><span data-stu-id="518d9-249">How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0</span></span>](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
    - <span data-ttu-id="518d9-250">[Wersje programu .NET framework i zależności](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="518d9-250">[.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span></span>
- <span data-ttu-id="518d9-251">Jeśli aplikacja korzysta z usług sieci web lub może być konieczne System.NET do komunikowania się z wewnętrznej bazy danych za pośrednictwem protokołu HTTP należy zwiększyć [connectionmanagement — / maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) elementu.</span><span class="sxs-lookup"><span data-stu-id="518d9-251">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="518d9-252">Dla aplikacji ASP.NET to jest ograniczona przez funkcję automatycznej konfiguracji do 12 razy liczba procesorów.</span><span class="sxs-lookup"><span data-stu-id="518d9-252">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="518d9-253">Oznacza to, że na quad-proc, użytkownik może mieć co najwyżej 12 \* 4 = 48 równoczesnych połączeń punkt końcowy IP.</span><span class="sxs-lookup"><span data-stu-id="518d9-253">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="518d9-254">Ponieważ to jest związany z [autokonfiguracji](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), najprostszym sposobem, aby zwiększyć `maxconnection` w programie ASP.NET jest skonfigurowanie aplikacji [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programowo w z `Application_Start` metody w *global.asax* pliku.</span><span class="sxs-lookup"><span data-stu-id="518d9-254">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="518d9-255">Zobacz przykład Pobierz przykład.</span><span class="sxs-lookup"><span data-stu-id="518d9-255">See the sample download for an example.</span></span>
- <span data-ttu-id="518d9-256">W programie .NET 4.5, domyślnie 5000 dla [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) powinna być poprawnie.</span><span class="sxs-lookup"><span data-stu-id="518d9-256">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>
