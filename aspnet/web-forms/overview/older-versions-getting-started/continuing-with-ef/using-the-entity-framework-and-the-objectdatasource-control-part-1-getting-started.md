---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: "Przy użyciu programu Entity Framework 4.0 i kontrolki ObjectDataSource, część 1: wprowadzenie | Dokumentacja firmy Microsoft"
author: tdykstra
description: "Ten samouczek serii kompilacje w aplikacji sieci web Contoso University utworzony przez wprowadzenie do samouczka serii Entity Framework. Jeśli yo..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/26/2011
ms.topic: article
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 6f93d6033b68773507d624125936f0a69777e2b7
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/10/2017
---
<a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="65e4b-104">Przy użyciu programu Entity Framework 4.0 i kontrolki ObjectDataSource, część 1: wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="65e4b-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>
====================
<span data-ttu-id="65e4b-105">przez [Dykstra niestandardowy](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="65e4b-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="65e4b-106">Ten samouczek serii opiera się na aplikację sieci web Contoso University jest tworzony przez [wprowadzenie do korzystania z programu Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) samouczka serii.</span><span class="sxs-lookup"><span data-stu-id="65e4b-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="65e4b-107">Jeśli nie została ukończona wcześniejszych samouczki, jako punkt początkowy dla tego samouczka możesz [pobrać aplikację](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) będzie utworzony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="65e4b-108">Możesz również [pobrać aplikację](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) tworzone przez zakończenie samouczka serii.</span><span class="sxs-lookup"><span data-stu-id="65e4b-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="65e4b-109">Przykładową aplikację sieci web firmy Contoso University przedstawia sposób tworzenia aplikacji formularzy sieci Web ASP.NET przy użyciu programu Entity Framework 4.0 i Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="65e4b-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="65e4b-110">Przykładowa aplikacja jest witryną internetową uniwersytetu fikcyjnej firmy Contoso.</span><span class="sxs-lookup"><span data-stu-id="65e4b-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="65e4b-111">Obejmuje funkcje, takie jak wprowadzenia studentów, tworzenie kursu i instruktora przypisania.</span><span class="sxs-lookup"><span data-stu-id="65e4b-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="65e4b-112">Samouczek zawiera przykłady w języku C#.</span><span class="sxs-lookup"><span data-stu-id="65e4b-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="65e4b-113">[Pobrania](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) zawiera kod w języku C# i Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="65e4b-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="65e4b-114">Najpierw bazy danych</span><span class="sxs-lookup"><span data-stu-id="65e4b-114">Database First</span></span>
> 
> <span data-ttu-id="65e4b-115">Istnieją trzy sposoby pracy z danymi programu Entity Framework: *Database First*, *Model First*, i *Code First*.</span><span class="sxs-lookup"><span data-stu-id="65e4b-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="65e4b-116">Ten samouczek jest przeznaczony dla pierwszej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-116">This tutorial is for Database First.</span></span> <span data-ttu-id="65e4b-117">Aby uzyskać informacji o różnicach między te przepływy pracy i wskazówki na temat wybierania najlepszy dla danego scenariusza, zobacz [przepływów pracy programu Entity Framework programowanie](https://msdn.microsoft.com/en-us/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="65e4b-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/en-us/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="65e4b-118">Formularze sieci Web</span><span class="sxs-lookup"><span data-stu-id="65e4b-118">Web Forms</span></span>
> 
> <span data-ttu-id="65e4b-119">Podobnie jak seria wprowadzenie tego samouczka serii korzysta z modelu formularzy sieci Web ASP.NET i przyjęto założenie, że wiesz, jak pracować z formularzy sieci Web ASP.NET w programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="65e4b-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="65e4b-120">Jeśli nie zobacz [wprowadzenie do formularzy sieci Web programu ASP.NET 4.5](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="65e4b-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="65e4b-121">Jeśli wolisz pracować z platformę ASP.NET MVC, zobacz [wprowadzenie do korzystania z programu Entity Framework za pomocą platformy ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="65e4b-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="65e4b-122">Wersje oprogramowania</span><span class="sxs-lookup"><span data-stu-id="65e4b-122">Software versions</span></span>
> 
> | <span data-ttu-id="65e4b-123">**Wyświetlany w samouczku**</span><span class="sxs-lookup"><span data-stu-id="65e4b-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="65e4b-124">**Współdziała również z**</span><span class="sxs-lookup"><span data-stu-id="65e4b-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="65e4b-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="65e4b-125">Windows 7</span></span> | <span data-ttu-id="65e4b-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="65e4b-126">Windows 8</span></span> |
> | <span data-ttu-id="65e4b-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="65e4b-127">Visual Studio 2010</span></span> | <span data-ttu-id="65e4b-128">Visual Studio Express 2010 for Web.</span><span class="sxs-lookup"><span data-stu-id="65e4b-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="65e4b-129">Samouczek nie był testowany z nowszej wersji programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="65e4b-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="65e4b-130">Różnią się wiele opcji menu, okna dialogowe i szablony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="65e4b-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="65e4b-131">.NET 4</span></span> | <span data-ttu-id="65e4b-132">.NET 4.5 jest zgodna z .NET 4, ale nie została przetestowana samouczek z .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="65e4b-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="65e4b-133">Entity Framework w wersji 4</span><span class="sxs-lookup"><span data-stu-id="65e4b-133">Entity Framework 4</span></span> | <span data-ttu-id="65e4b-134">Samouczek nie był testowany z nowszej wersji programu Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="65e4b-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="65e4b-135">Począwszy od programu Entity Framework 5, domyślnie używa EF `DbContext API` wprowadzono w systemie EF 4.1.</span><span class="sxs-lookup"><span data-stu-id="65e4b-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="65e4b-136">Formant EntityDataSource został zaprojektowany do użycia `ObjectContext` interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="65e4b-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="65e4b-137">Aby uzyskać informacje o sposobie używania obiektu EntityDataSource sterować za pomocą `DbContext` interfejsu API, zobacz [ten wpis w blogu](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="65e4b-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="65e4b-138">Pytania</span><span class="sxs-lookup"><span data-stu-id="65e4b-138">Questions</span></span>
> 
> <span data-ttu-id="65e4b-139">Jeśli masz pytania, które nie są bezpośrednio związane z tego samouczka możesz zamieścić je do [forum ASP.NET Entity Framework](https://forums.asp.net/1227.aspx), [Entity Framework i składnika LINQ to Entities forum](https://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/threads/), lub [ StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="65e4b-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>


<span data-ttu-id="65e4b-140">`EntityDataSource` Kontroli umożliwia szybkie tworzenie aplikacji, ale zwykle wymaga zachować dużą logika biznesowa i logika dostępu do danych w sieci *.aspx* stron.</span><span class="sxs-lookup"><span data-stu-id="65e4b-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="65e4b-141">Jeśli aplikacja zwiększa się złożoność i wymaganie rutynowej konserwacji, więcej czasu programowanie można zainwestować góry aby można było utworzyć *n warstwowa* lub *warstwie* struktury aplikacji to jest bardziej łatwy w obsłudze.</span><span class="sxs-lookup"><span data-stu-id="65e4b-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="65e4b-142">Do wdrożenia tej architektury, można oddzielić od warstwy logiki biznesowej (logiki warstwy Biznesowej) oraz warstwa dostępu do danych (DAL) warstwy prezentacji.</span><span class="sxs-lookup"><span data-stu-id="65e4b-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="65e4b-143">Jednym ze sposobów implementuje ta struktura jest użycie `ObjectDataSource` kontrolować zamiast `EntityDataSource` formantu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="65e4b-144">Jeśli używasz `ObjectDataSource` kontroli, wykonania kodu dostępu do danych, a następnie wywołaj w *.aspx* strony za pomocą formantu, który ma wiele takich samych funkcji innych formantów źródła danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="65e4b-145">Dzięki temu można łączyć zalety podejścia n warstwowa z zalet dotyczących dostępu do danych za pomocą kontrolki formularzy sieci Web.</span><span class="sxs-lookup"><span data-stu-id="65e4b-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="65e4b-146">`ObjectDataSource` Kontroli zapewnia większą elastyczność w inny sposób, jak również.</span><span class="sxs-lookup"><span data-stu-id="65e4b-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="65e4b-147">Ponieważ można napisać własny kod dostępu do danych, łatwiej jest więcej niż tylko do odczytu, wstawiania, aktualizowania lub usuwania określonego typu, które są zadania który `EntityDataSource` kontroli służy do wykonywania.</span><span class="sxs-lookup"><span data-stu-id="65e4b-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="65e4b-148">Na przykład można wykonać rejestrowania każdej aktualizacji jednostki, archiwizowanie danych zawsze po usunięciu jednostki lub automatycznie sprawdzanie i aktualizacji danych związanych z zgodnie z potrzebami podczas wstawiania wiersza o wartości klucza obcego.</span><span class="sxs-lookup"><span data-stu-id="65e4b-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="65e4b-149">Logika biznesowa i klasy repozytorium</span><span class="sxs-lookup"><span data-stu-id="65e4b-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="65e4b-150">`ObjectDataSource` Działania kontroli przez klasę, która tworzenia.</span><span class="sxs-lookup"><span data-stu-id="65e4b-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="65e4b-151">Klasa zawiera metody, które pobierania i aktualizowania danych, i podanie nazwy tych metod, które `ObjectDataSource` kontroli w znaczniku.</span><span class="sxs-lookup"><span data-stu-id="65e4b-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="65e4b-152">Podczas renderowania lub odświeżania strony przetwarzania `ObjectDataSource` wywołuje metody, które zostały określone.</span><span class="sxs-lookup"><span data-stu-id="65e4b-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="65e4b-153">Oprócz podstawowych operacji CRUD, tworzona za pomocą klasy `ObjectDataSource` formant może być konieczne wykonanie logiki biznesowej po `ObjectDataSource` odczytuje lub aktualizuje dane.</span><span class="sxs-lookup"><span data-stu-id="65e4b-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="65e4b-154">Na przykład po zaktualizowaniu działu, może być konieczne Sprawdź, czy nie inne działy mają tego samego konta administratora, ponieważ jedna osoba nie może być administratorem działu więcej niż jeden.</span><span class="sxs-lookup"><span data-stu-id="65e4b-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="65e4b-155">W niektórych `ObjectDataSource` dokumentacji, takich jak [Przegląd klasy ObjectDataSource](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.objectdatasource.aspx), kontrolka wywołuje klasy nazywane *obiektu biznesowego* zawierającą zarówno logika biznesowa i logika dostępu do danych .</span><span class="sxs-lookup"><span data-stu-id="65e4b-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="65e4b-156">W tym samouczku utworzysz osobnych klas logika biznesowa i logika dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="65e4b-157">Klasa, która hermetyzuje logika dostępu do danych jest nazywany *repozytorium*.</span><span class="sxs-lookup"><span data-stu-id="65e4b-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="65e4b-158">Klasa logika biznesowa zawiera metody logiki biznesowej i metod dostępu do danych, ale metody dostępu do danych mogą wywoływać repozytorium, aby wykonywać zadania dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="65e4b-159">Warstwa abstrakcji między logiki warstwy Biznesowej i warstwy DAL umożliwiającą automatyczne jednostki spowoduje również utworzenie testowania logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="65e4b-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="65e4b-160">Ta warstwa abstrakcji jest implementowany przez tworzenie interfejsu i przy użyciu interfejsu w przypadku wystąpienia repozytorium w klasie logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="65e4b-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="65e4b-161">Dzięki temu można podać klasy logiki biznesowej w odniesieniu do dowolnego obiektu, który implementuje interfejs repozytorium.</span><span class="sxs-lookup"><span data-stu-id="65e4b-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="65e4b-162">Do normalnego działania musisz podać obiektu repozytorium, który działa z programu Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="65e4b-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="65e4b-163">Do testowania, musisz podać obiekt repozytorium, który współpracuje z danych przechowywanych w taki sposób, który można łatwo manipulować, takich jak klasy zmienne zdefiniowane jako kolekcji.</span><span class="sxs-lookup"><span data-stu-id="65e4b-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="65e4b-164">Na poniższej ilustracji przedstawiono różnica między klasy logiki biznesowej, która zawiera logikę dostępu do danych bez repozytorium i korzystającą z repozytorium.</span><span class="sxs-lookup"><span data-stu-id="65e4b-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="65e4b-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="65e4b-166">Rozpocznie się przez utworzenie strony sieci web, w którym `ObjectDataSource` kontrolka jest powiązana bezpośrednio do repozytorium, ponieważ spełnia on tylko podstawowego dostępu do danych zadania.</span><span class="sxs-lookup"><span data-stu-id="65e4b-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="65e4b-167">W następnym samouczku utworzysz klasy logiki biznesowej z logikę weryfikacji i powiązać `ObjectDataSource` kontrolki do tej klasy, a nie klasę repozytorium.</span><span class="sxs-lookup"><span data-stu-id="65e4b-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="65e4b-168">Zostanie również tworzenia testów jednostkowych dla logiki sprawdzania poprawności.</span><span class="sxs-lookup"><span data-stu-id="65e4b-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="65e4b-169">W trzecim samouczku tej serii doda sortowania i filtrowania funkcje do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="65e4b-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="65e4b-170">Strony tworzenia w tym samouczku pracować z `Departments` zestawu jednostek w modelu danych, który został utworzony w [Wprowadzenie samouczek serii](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="65e4b-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="65e4b-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="65e4b-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="65e4b-173">Aktualizowanie bazy danych i modelu danych</span><span class="sxs-lookup"><span data-stu-id="65e4b-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="65e4b-174">W tym samouczku zostanie rozpoczęta, wprowadzając dwie zmiany w bazie danych, które wymaga odpowiednich zmian w modelu danych, który został utworzony w [wprowadzenie do korzystania z programu Entity Framework i formularzy sieci Web](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) samouczki.</span><span class="sxs-lookup"><span data-stu-id="65e4b-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="65e4b-175">W jednym z tych samouczkach zmiany zostały wprowadzone w Projektancie ręcznie, aby zsynchronizować modelu danych z bazy danych po zmianie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="65e4b-176">W tym samouczku użyjesz projektanta **zaktualizować z bazy danych modelu** narzędzie automatyczne aktualizowanie modelu danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="65e4b-177">Dodawanie relacji z bazą danych</span><span class="sxs-lookup"><span data-stu-id="65e4b-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="65e4b-178">W programie Visual Studio Otwórz utworzony w aplikacji sieci web Contoso University [wprowadzenie do korzystania z programu Entity Framework i formularzy sieci Web](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) samouczka serii, a następnie otwórz `SchoolDiagram` schemat bazy danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="65e4b-179">Jeśli przyjrzymy się `Department` tabeli w diagramie bazy danych, zobaczysz, że ma `Administrator` kolumny.</span><span class="sxs-lookup"><span data-stu-id="65e4b-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="65e4b-180">W tej kolumnie jest kluczem obcym do `Person` tabeli, ale nie relacji klucza obcego jest zdefiniowany w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="65e4b-181">Należy utworzyć relację, a Aktualizacja modelu danych, dzięki czemu programu Entity Framework automatycznie może obsłużyć tej relacji.</span><span class="sxs-lookup"><span data-stu-id="65e4b-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="65e4b-182">Na diagramie bazy danych, kliknij prawym przyciskiem myszy `Department` tabeli, a następnie wybierz **relacje**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="65e4b-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="65e4b-184">W **relacje klucza obcego** kliknij pozycję **Dodaj**, następnie kliknij przycisk wielokropka dla **Specyfikacja tabel i kolumn**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="65e4b-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="65e4b-186">W **tabel i kolumn** okno dialogowe pola, ustaw tabeli klucza podstawowego i pola do `Person` i `PersonID`, ustaw tabeli klucza obcego i pola do `Department` i `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="65e4b-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="65e4b-187">(Jeśli to zrobisz, Nazwa relacji ulegnie zmianie z `FK_Department_Department` do `FK_Department_Person`.)</span><span class="sxs-lookup"><span data-stu-id="65e4b-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="65e4b-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="65e4b-189">Kliknij przycisk **OK** w **tabel i kolumn** kliknij **Zamknij** w **relacje klucza obcego** i Zapisz zmiany.</span><span class="sxs-lookup"><span data-stu-id="65e4b-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="65e4b-190">Jeśli pojawi się monit, aby zapisać `Person` i `Department` tabele, kliknij przycisk **tak**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="65e4b-191">Jeśli została usunięta `Person` wiersze odpowiadające danych, który jest już w `Administrator` kolumny, nie będzie można zapisać tej zmiany.</span><span class="sxs-lookup"><span data-stu-id="65e4b-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="65e4b-192">W takim przypadku za pomocą edytora tabeli w **Eksploratora serwera** do upewnij się, że `Administrator` wartości w każdym `Department` wiersz zawiera identyfikator rekordu, który istnieje w `Person` tabeli.</span><span class="sxs-lookup"><span data-stu-id="65e4b-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="65e4b-193">Po zapisaniu zmian, nie będzie można usunąć wiersza z `Person` tabeli, jeśli osoba ma uprawnienia administratora działu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="65e4b-194">W aplikacji produkcyjnej czy Podaj komunikat o błędzie, usunięcie uniemożliwia ograniczenie bazy danych lub należy określić usuwania kaskadowego.</span><span class="sxs-lookup"><span data-stu-id="65e4b-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="65e4b-195">Na przykład sposobu określania usuwania kaskadowego zobacz [program Entity Framework i platformy ASP.NET — wprowadzenie Rozpoczęto część 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="65e4b-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>


### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="65e4b-196">Dodawanie widoku do bazy danych</span><span class="sxs-lookup"><span data-stu-id="65e4b-196">Adding a View to the Database</span></span>

<span data-ttu-id="65e4b-197">W nowym *Departments.aspx* strony, który zostanie utworzony, chcesz zapewnić nazwy w formacie "ostatni, najpierw" listy rozwijanej instruktorów, dzięki czemu użytkownicy mogą wybrać Administratorzy działów.</span><span class="sxs-lookup"><span data-stu-id="65e4b-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="65e4b-198">Aby ułatwić to zrobić, spowoduje utworzenie widoku w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="65e4b-199">Widok będzie zawierać tylko te dane, które są wymagane przez listy rozwijanej: Pełna nazwa (poprawnie sformatowana) i klucza rekordu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="65e4b-200">W **Eksploratora serwera**, rozwiń węzeł *School.mdf*, kliknij prawym przyciskiem myszy **widoków** folder, a następnie wybierz **Dodaj nowy widok**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="65e4b-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="65e4b-202">Kliknij przycisk **Zamknij** podczas **Dodaj tabelę** pojawi się okno dialogowe i wklej następującą instrukcję SQL w okienku SQL:</span><span class="sxs-lookup"><span data-stu-id="65e4b-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="65e4b-203">Zapisz widok jako `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="65e4b-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="65e4b-204">Aktualizacja modelu danych</span><span class="sxs-lookup"><span data-stu-id="65e4b-204">Updating the Data Model</span></span>

<span data-ttu-id="65e4b-205">W *DAL* folder, otwórz *SchoolModel.edmx* , kliknij prawym przyciskiem myszy powierzchnię projektu, a następnie wybierz **modelu aktualizacji z bazy danych**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="65e4b-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="65e4b-207">W **wybierz obiekty bazy danych użytkownika** okno dialogowe, wybierz opcję **Dodaj** i wybierz utworzony widok.</span><span class="sxs-lookup"><span data-stu-id="65e4b-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="65e4b-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="65e4b-209">Kliknij przycisk **Zakończ**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-209">Click **Finish**.</span></span>

<span data-ttu-id="65e4b-210">W projektancie, zobaczysz, że narzędzie utworzone `vInstructorName` jednostki i nowe skojarzenie między `Department` i `Person` jednostek.</span><span class="sxs-lookup"><span data-stu-id="65e4b-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="65e4b-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="65e4b-212">W **dane wyjściowe** i **listy błędów** systemu windows można napotkać komunikat ostrzegawczy informujący o tym, że narzędzie automatycznie utworzone podstawowego klucza dla nowego `vInstructorName` widoku.</span><span class="sxs-lookup"><span data-stu-id="65e4b-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="65e4b-213">Jest to oczekiwane zachowanie.</span><span class="sxs-lookup"><span data-stu-id="65e4b-213">This is expected behavior.</span></span>


<span data-ttu-id="65e4b-214">Odwołań do nowego `vInstructorName` jednostki w kodzie, nie chcesz użyć prefiksu małymi literami "v" do niego z Konwencją bazy danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="65e4b-215">W związku z tym spowoduje zmianę nazwy podmiotu i zestawu jednostek w modelu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="65e4b-216">Otwórz **modelu przeglądarki**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-216">Open the **Model Browser**.</span></span> <span data-ttu-id="65e4b-217">Zostanie wyświetlony `vInstructorName` wymieniony jako typu jednostki i widokiem.</span><span class="sxs-lookup"><span data-stu-id="65e4b-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="65e4b-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="65e4b-219">W obszarze **SchoolModel** (nie **SchoolModel.Store**), kliknij prawym przyciskiem myszy **vInstructorName** i wybierz **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="65e4b-220">W **właściwości** Zmień **nazwa** dla właściwości "InstructorName" i zmień **Nazwa zestawu jednostek** dla właściwości "InstructorNames".</span><span class="sxs-lookup"><span data-stu-id="65e4b-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="65e4b-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="65e4b-222">Zapisz i zamknij modelu danych, a następnie Odbuduj projekt.</span><span class="sxs-lookup"><span data-stu-id="65e4b-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="65e4b-223">Przy użyciu klasy repozytorium i kontrolki ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="65e4b-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="65e4b-224">Utwórz nowy plik klasy w *DAL* folderu, nadaj jej nazwę *SchoolRepository.cs*i Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="65e4b-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="65e4b-225">Ten kod zawiera jeden `GetDepartments` metodę zwracającą wszystkie jednostki w `Departments` zestawu jednostek.</span><span class="sxs-lookup"><span data-stu-id="65e4b-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="65e4b-226">Ponieważ wiadomo, że możesz będą uzyskiwać dostęp do `Person` właściwości nawigacji dla każdego wiersza zwrócone, możesz określić wczesny ładowania dla tej właściwości przy użyciu `Include` metody.</span><span class="sxs-lookup"><span data-stu-id="65e4b-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="65e4b-227">Klasa implementuje również `IDisposable` interfejs, aby upewnić się, że połączenie z bazą danych jest zwolnione, gdy obiekt jest usunięty.</span><span class="sxs-lookup"><span data-stu-id="65e4b-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="65e4b-228">Popularną praktyką jest utworzenie klasy repozytorium dla poszczególnych typów jednostek.</span><span class="sxs-lookup"><span data-stu-id="65e4b-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="65e4b-229">W tym samouczku jest używany jedną klasę repozytorium dla wielu typów jednostek.</span><span class="sxs-lookup"><span data-stu-id="65e4b-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="65e4b-230">Aby uzyskać więcej informacji na temat wzorca repozytorium, zobacz wpisów w [blog zespołu programu Entity Framework](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) i [blogu Julie Lerman](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="65e4b-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>


<span data-ttu-id="65e4b-231">`GetDepartments` Metoda zwraca `IEnumerable` obiektu zamiast `IQueryable` obiektu w celu zapewnienia użytecznego zwracana kolekcja nawet po usunięciu obiektu repozytorium.</span><span class="sxs-lookup"><span data-stu-id="65e4b-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="65e4b-232">`IQueryable` Obiektu może spowodować dostęp do bazy danych, gdy jest on dostępny, ale obiekt repozytorium może być usunięty w czasie próby renderowania danych formantu z danymi.</span><span class="sxs-lookup"><span data-stu-id="65e4b-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="65e4b-233">Może zwrócić inny typ kolekcji, takie jak `IList` obiekt zamiast `IEnumerable` obiektu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="65e4b-234">Jednak zwracanie `IEnumerable` obiektu gwarantuje, że można wykonywać zadania przetwarzania typowych listy tylko do odczytu takie jak `foreach` pętli i zapytań LINQ, ale nie można dodać do lub usuwanie elementów w kolekcji, co może oznacza, że będą takie zmiany utrwalone w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="65e4b-235">Utwórz *Departments.aspx* strona używa *Site.Master* strony wzorcowej i Dodaj następujący kod w `Content` formantu o nazwie `Content2`:</span><span class="sxs-lookup"><span data-stu-id="65e4b-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="65e4b-236">Tworzy tego znacznika `ObjectDataSource` formant, który używa klasy repozytorium nowo utworzone i `GridView` formantu, aby wyświetlić dane.</span><span class="sxs-lookup"><span data-stu-id="65e4b-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="65e4b-237">`GridView` Kontroli określa **Edytuj** i **usunąć** polecenia, ale nie dodano kod, aby jeszcze obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="65e4b-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="65e4b-238">Użyj kilka kolumn `DynamicField` steruje tak, aby można było korzystać z funkcji danych automatycznego formatowania i walidacji.</span><span class="sxs-lookup"><span data-stu-id="65e4b-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="65e4b-239">W tym do pracy, należy wywołać `EnableDynamicData` metoda `Page_Init` obsługi zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="65e4b-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="65e4b-240">(`DynamicControl` formanty nie są używane w `Administrator` pola, ponieważ one nie działać z właściwości nawigacji.)</span><span class="sxs-lookup"><span data-stu-id="65e4b-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="65e4b-241">`Vertical-Align="Top"` Atrybuty staną się ważne później podczas dodawania kolumny, która ma zagnieżdżoną `GridView` formant do siatki.</span><span class="sxs-lookup"><span data-stu-id="65e4b-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="65e4b-242">Otwórz *Departments.aspx.cs* pliku i dodaj następującą `using` instrukcji:</span><span class="sxs-lookup"><span data-stu-id="65e4b-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="65e4b-243">Następnie dodaj poniższe obsługę strony `Init` zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="65e4b-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="65e4b-244">W *DAL* folderu, Utwórz nowy plik klasy o nazwie *Department.cs* i Zastąp istniejący kod następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="65e4b-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="65e4b-245">Ten kod dodaje metadane do modelu danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="65e4b-246">Określa, że `Budget` właściwość `Department` jednostki faktycznie reprezentuje walutę, mimo że jego typu danych `Decimal`, i określa, że wartość musi wynosić od 0 do 1,000,000.00 $.</span><span class="sxs-lookup"><span data-stu-id="65e4b-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="65e4b-247">Określa również który `StartDate` właściwości powinien być sformatowany jako datę w formacie mm/dd/rrrr.</span><span class="sxs-lookup"><span data-stu-id="65e4b-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="65e4b-248">Uruchom *Departments.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="65e4b-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="65e4b-250">Zwróć uwagę, że mimo że nie określono ciągu formatu w *Departments.aspx* znaczników dla **budżetu** lub **Data rozpoczęcia** kolumn, domyślne waluty i daty Formatowanie stosowane na im przez `DynamicField` kontrolki, przy użyciu metadanych, który został dostarczony w *Department.cs* pliku.</span><span class="sxs-lookup"><span data-stu-id="65e4b-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="65e4b-251">Wstaw dodawania i usuwania funkcji</span><span class="sxs-lookup"><span data-stu-id="65e4b-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="65e4b-252">Otwórz *SchoolRepository.cs*, Dodaj następujący kod, aby można było utworzyć `Insert` — metoda i `Delete` metody.</span><span class="sxs-lookup"><span data-stu-id="65e4b-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="65e4b-253">Ten kod zawiera także metodę o nazwie `GenerateDepartmentID` obliczającej następnej wartości klucza rekordu dostępne do użycia przez `Insert` metody.</span><span class="sxs-lookup"><span data-stu-id="65e4b-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="65e4b-254">Jest to wymagane, ponieważ nie skonfigurowano bazę danych do obliczenia to automatycznie dla `Department` tabeli.</span><span class="sxs-lookup"><span data-stu-id="65e4b-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="65e4b-255">Attach — metoda</span><span class="sxs-lookup"><span data-stu-id="65e4b-255">The Attach Method</span></span>

<span data-ttu-id="65e4b-256">`DeleteDepartment` Wywołania metody `Attach` metody, aby ponownie ustanowić łącze, które są przechowywane w Menedżerze stanu obiektu kontekstu obiektów między jednostki w pamięci i bazę danych wiersz reprezentuje.</span><span class="sxs-lookup"><span data-stu-id="65e4b-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="65e4b-257">To musi być wcześniejsza niż wywołania metody `SaveChanges` metody.</span><span class="sxs-lookup"><span data-stu-id="65e4b-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="65e4b-258">Termin *kontekst* odwołuje się do klasy Entity Framework, która jest pochodną `ObjectContext` klasy, która umożliwia dostęp do zestawów jednostek i obiektów.</span><span class="sxs-lookup"><span data-stu-id="65e4b-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="65e4b-259">W kodzie dla tego projektu, nosi nazwę klasy `SchoolEntities`, i zawsze jest nazwane wystąpienie `context`.</span><span class="sxs-lookup"><span data-stu-id="65e4b-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="65e4b-260">Kontekst obiektu *Menedżer stanu obiektu* jest klasą pochodną `ObjectStateManager` klasy.</span><span class="sxs-lookup"><span data-stu-id="65e4b-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="65e4b-261">Skontaktuj się z obiektu używa obiektu Menedżer stanu do przechowywania obiektów jednostek i czy każdy z nich jest zsynchronizowana z jego odpowiedni wiersz tabeli lub wierszy w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="65e4b-262">Po przeczytaniu jednostki kontekst zapisuje go w obiekcie Menedżer stanu i śledzi czy reprezentacja tego obiektu jest zsynchronizowana z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="65e4b-263">Na przykład zmiana wartości właściwości, Flaga jest ustawiona na wskazują, że można zmienić właściwości nie jest już w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="65e4b-264">Następnie podczas wywoływania `SaveChanges` metody, kontekst wie, co należy zrobić w bazie danych, ponieważ Menedżer stanu obiektu zna dokładnie co różni się od bieżącego stanu jednostki i stan bazy danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="65e4b-265">Jednak ten proces zwykle nie działa w aplikacji sieci web, ponieważ wystąpienie obiektu kontekstu, odczytujący jednostki, wraz z wszystkich elementów w jego menedżera stanu obiektów zostanie usunięty po renderowania strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="65e4b-266">Wystąpienie obiektu kontekstu, które należy zastosować zmiany jest nowy, który zostanie uruchomiony do przetwarzania odświeżania strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="65e4b-267">W przypadku programu `DeleteDepartment` metody, `ObjectDataSource` kontroli ponownie tworzy oryginalnej wersji jednostki z wartości w widoku stanu, ale to utworzony ponownie `Department` jednostka nie istnieje w Menedżerze stanu obiektu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="65e4b-268">Jeśli zostanie wywołany `DeleteObject` metody w tej jednostce ponownego utworzenia, połączenie nie powiedzie się, ponieważ kontekst nie może określić, czy jednostka jest zsynchronizowana z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="65e4b-269">Jednak podczas wywoływania `Attach` metody ponownie nawiązuje tego samego śledzenia między ponownie utworzonej jednostki i wartościami w bazie danych, która pierwotnie została wykonana automatycznie, gdy jednostka została odczytana w starszych wystąpienia kontekstu obiektów.</span><span class="sxs-lookup"><span data-stu-id="65e4b-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="65e4b-270">Brak czasu nie mają kontekst śledzenia jednostki w obiekcie Menedżer stanu i można ustawić flagi, aby zapobiec operacją.</span><span class="sxs-lookup"><span data-stu-id="65e4b-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="65e4b-271">Przykładem tego są wyświetlane w kolejnych samouczkach z tej serii.</span><span class="sxs-lookup"><span data-stu-id="65e4b-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="65e4b-272">Metody SaveChanges</span><span class="sxs-lookup"><span data-stu-id="65e4b-272">The SaveChanges Method</span></span>

<span data-ttu-id="65e4b-273">Ta klasa prostego repozytorium przedstawiono podstawowe zasady sposób wykonywania operacji CRUD.</span><span class="sxs-lookup"><span data-stu-id="65e4b-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="65e4b-274">W tym przykładzie `SaveChanges` metoda jest wywoływana bezpośrednio po każdej aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="65e4b-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="65e4b-275">W aplikacji produkcyjnej warto wywołać `SaveChanges` metody z oddzielnych metodach, aby mieć lepszą kontrolę nad po zaktualizowaniu bazy danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="65e4b-276">(Na końcu następnym samouczku znajdziesz łącza do dokumentacji omówiono jednostki pracy wzorzec, który jest jednym z podejść koordynowanie odpowiednich aktualizacji.) Zwróć uwagę, że w tym przykładzie `DeleteDepartment` — metoda nie ma kodu do obsługi konfliktom współbieżności; zostanie dodany kod w tym w późniejszym samouczku z tej serii.</span><span class="sxs-lookup"><span data-stu-id="65e4b-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="65e4b-277">Podczas pobierania nazwy instruktora do wybrania przy wstawianiu</span><span class="sxs-lookup"><span data-stu-id="65e4b-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="65e4b-278">Użytkownicy musi mieć należy wybrać z listy instruktorów na liście rozwijanej administrator, podczas tworzenia nowych działów.</span><span class="sxs-lookup"><span data-stu-id="65e4b-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="65e4b-279">W związku z tym, Dodaj następujący kod do *SchoolRepository.cs* utworzyć metody, aby pobrać listę instruktorów przy użyciu widoku, który został utworzony wcześniej:</span><span class="sxs-lookup"><span data-stu-id="65e4b-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="65e4b-280">Tworzenie strony do wstawiania działów</span><span class="sxs-lookup"><span data-stu-id="65e4b-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="65e4b-281">Utwórz *DepartmentsAdd.aspx* strona używa *Site.Master* strony i Dodaj następujący kod w `Content` formantu o nazwie `Content2`:</span><span class="sxs-lookup"><span data-stu-id="65e4b-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="65e4b-282">Tego znacznika tworzy dwa `ObjectDataSource` kontroluje jedno wstawiania nowych `Department` jednostek i jeden do pobierania nazw instruktora `DropDownList` formant, który służy do wybierania Administratorzy działów.</span><span class="sxs-lookup"><span data-stu-id="65e4b-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="65e4b-283">Tworzy kod znaczników `DetailsView` kontrolować wprowadzanie nowych działów który określa obsługi dla formantu `ItemInserting` zdarzeń, dzięki czemu można ustawić `Administrator` wartości klucza obcego.</span><span class="sxs-lookup"><span data-stu-id="65e4b-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="65e4b-284">Na końcu jest `ValidationSummary` formantu, aby wyświetlić komunikaty o błędach.</span><span class="sxs-lookup"><span data-stu-id="65e4b-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="65e4b-285">Otwórz *DepartmentsAdd.aspx.cs* i dodaj następującą `using` instrukcji:</span><span class="sxs-lookup"><span data-stu-id="65e4b-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="65e4b-286">Dodaj następującą zmienną klasy i metody:</span><span class="sxs-lookup"><span data-stu-id="65e4b-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="65e4b-287">`Page_Init` Metody umożliwia korzystanie z funkcji danych dynamicznych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="65e4b-288">Program obsługi dla `DropDownList` formantu `Init` zdarzeń zapisuje odwołanie do formantu i obsługi dla `DetailsView` formantu `Inserting` zdarzeń używa tego odwołania, aby uzyskać `PersonID` wartość wybranym instruktorze i aktualizacji `Administrator` właściwości kluczy obcych z `Department` jednostki.</span><span class="sxs-lookup"><span data-stu-id="65e4b-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="65e4b-289">Uruchom strony, dodawania informacji działu nowe, a następnie kliknij **Wstaw** łącza.</span><span class="sxs-lookup"><span data-stu-id="65e4b-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="65e4b-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="65e4b-291">Wprowadź wartości dla innego działu nowe.</span><span class="sxs-lookup"><span data-stu-id="65e4b-291">Enter values for another new department.</span></span> <span data-ttu-id="65e4b-292">Wprowadź liczbę większą niż 1,000,000.00 w **budżetu** pola i tab do następnego pola.</span><span class="sxs-lookup"><span data-stu-id="65e4b-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="65e4b-293">W polu pojawi się znak gwiazdki, a jeśli kursora myszy nad nim, zobaczysz komunikat o błędzie, wprowadzone w metadanych dla tego pola.</span><span class="sxs-lookup"><span data-stu-id="65e4b-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="65e4b-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="65e4b-295">Kliknij przycisk **Wstaw**, i zostanie wyświetlony komunikat o błędzie wyświetlany przez `ValidationSummary` kontroli w dolnej części strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="65e4b-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="65e4b-297">Następnie zamknij przeglądarkę i Otwórz *Departments.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="65e4b-298">Dodaj możliwość usuwania *Departments.aspx* dodając `DeleteMethod` atrybutu `ObjectDataSource` kontroli, a `DataKeyNames` atrybutu `GridView` formantu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="65e4b-299">Znaczniki otwarcia tych kontrolek będzie teraz podobne do następujących:</span><span class="sxs-lookup"><span data-stu-id="65e4b-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="65e4b-300">Uruchom strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-300">Run the page.</span></span>

<span data-ttu-id="65e4b-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="65e4b-302">Usuń działu dodane po uruchomieniu *DepartmentsAdd.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="65e4b-303">Dodawanie funkcji aktualizacji</span><span class="sxs-lookup"><span data-stu-id="65e4b-303">Adding Update Functionality</span></span>

<span data-ttu-id="65e4b-304">Otwórz *SchoolRepository.cs* i dodaj następującą `Update` metody:</span><span class="sxs-lookup"><span data-stu-id="65e4b-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="65e4b-305">Po kliknięciu **aktualizacji** w *Departments.aspx* strony, `ObjectDataSource` kontroli tworzy dwa `Department` jednostek do przekazania do `UpdateDepartment` metody.</span><span class="sxs-lookup"><span data-stu-id="65e4b-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="65e4b-306">Jedno zawiera oryginalnych wartości, które były przechowywane w widoku stanu, a drugi zawiera nowe wartości, które zostały wprowadzone w `GridView` formantu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="65e4b-307">Kod w `UpdateDepartment` metoda przekazuje `Department` jednostki, która ma oryginalnych wartości do `Attach` metody w celu ustanowienia śledzenia między jednostki i o nowościach w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="65e4b-308">Następnie kod `Department` jednostki, która zawiera nowe wartości, aby `ApplyCurrentValues` metody.</span><span class="sxs-lookup"><span data-stu-id="65e4b-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="65e4b-309">Kontekst porównanie starych i nowych wartości.</span><span class="sxs-lookup"><span data-stu-id="65e4b-309">The object context compares the old and new values.</span></span> <span data-ttu-id="65e4b-310">Jeśli nowa wartość jest inna niż poprzednia wartość, kontekst zmieni się wartość właściwości.</span><span class="sxs-lookup"><span data-stu-id="65e4b-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="65e4b-311">`SaveChanges` Metody następnie aktualizuje tylko zmienione kolumny w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="65e4b-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="65e4b-312">(Jednak jeśli ta funkcja aktualizacji dla tej jednostki zostały zamapowane do procedury składowanej, cały wiersz będzie można zaktualizować niezależnie od tego, które zostały zmienione kolumn.)</span><span class="sxs-lookup"><span data-stu-id="65e4b-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="65e4b-313">Otwórz *Departments.aspx* i dodaj następujące atrybuty `DepartmentsObjectDataSource` sterowania:</span><span class="sxs-lookup"><span data-stu-id="65e4b-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="65e4b-314">Ta powoduje, że stary wartości były przechowywane w widoku stanu, dzięki czemu można porównać przy użyciu nowych wartości w `Update` metody.</span><span class="sxs-lookup"><span data-stu-id="65e4b-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="65e4b-315">Informuje formant, który jest nazwa oryginalnego parametru wartości `origDepartment` .</span><span class="sxs-lookup"><span data-stu-id="65e4b-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="65e4b-316">Kod znaczników dla tagu otwierającego `ObjectDataSource` kontroli teraz podobnego do następującego:</span><span class="sxs-lookup"><span data-stu-id="65e4b-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="65e4b-317">Dodaj `OnRowUpdating="DepartmentsGridView_RowUpdating"` atrybutu `GridView` formantu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="65e4b-318">Zostanie ona użyta do ustawienia `Administrator` wartość właściwości na podstawie wiersza użytkownik wybiera z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="65e4b-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="65e4b-319">`GridView` Tagu początkowego teraz podobnego do następującego:</span><span class="sxs-lookup"><span data-stu-id="65e4b-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="65e4b-320">Dodaj `EditItemTemplate` sterować dla `Administrator` kolumny `GridView` kontrolować, natychmiast po `ItemTemplate` kontroli dla tej kolumny:</span><span class="sxs-lookup"><span data-stu-id="65e4b-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="65e4b-321">To `EditItemTemplate` formant jest podobny do `InsertItemTemplate` kontroli w *DepartmentsAdd.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="65e4b-322">Różnica polega na wartość początkowa formantu jest ustawiona, przy użyciu `SelectedValue` atrybutu.</span><span class="sxs-lookup"><span data-stu-id="65e4b-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="65e4b-323">Przed `GridView` kontrolować, Dodaj `ValidationSummary` sterować tak samo jak *DepartmentsAdd.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="65e4b-324">Otwórz *Departments.aspx.cs* i bezpośrednio po deklaracji klasy częściowe, Dodaj następujący kod, aby utworzyć pole prywatne odwołanie do `DropDownList` sterowania:</span><span class="sxs-lookup"><span data-stu-id="65e4b-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="65e4b-325">Następnie dodaj obsługę `DropDownList` formantu `Init` zdarzeń i `GridView` formantu `RowUpdating` zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="65e4b-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="65e4b-326">Program obsługi dla `Init` odwołanie do zapisuje zdarzenia `DropDownList` kontrolki pola klasy.</span><span class="sxs-lookup"><span data-stu-id="65e4b-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="65e4b-327">Program obsługi dla `RowUpdating` zdarzeń używa odwołania można pobrać wartości wprowadzonych przez użytkownika i zastosować je do `Administrator` właściwość `Department` jednostki.</span><span class="sxs-lookup"><span data-stu-id="65e4b-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="65e4b-328">Użyj *DepartmentsAdd.aspx* strony, aby dodać nowy dział, a następnie uruchom *Departments.aspx* i kliknij przycisk **Edytuj** na wiersz, który został dodany.</span><span class="sxs-lookup"><span data-stu-id="65e4b-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="65e4b-329">Nie można edytować wierszy, które nie zostały dodane (oznacza to, że już zostały w bazie danych), ze względu na nieprawidłowe dane w bazie danych. Administratorzy dla wierszy, które zostały utworzone w bazie danych są studenta.</span><span class="sxs-lookup"><span data-stu-id="65e4b-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="65e4b-330">Jeśli próbujesz edytować jeden z nich, otrzyma strony błędu, który zgłasza błąd, takich jak`'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="65e4b-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>


<span data-ttu-id="65e4b-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="65e4b-332">Jeśli wprowadzisz nieprawidłowy **budżetu** ilość, a następnie kliknij przycisk **aktualizacji**, zapoznaj się z tego samego gwiazdki i komunikat o błędzie, który był wyświetlany w *Departments.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="65e4b-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="65e4b-333">Zmień wartość pola lub wybierz innego administratora i kliknij przycisk **aktualizacji**.</span><span class="sxs-lookup"><span data-stu-id="65e4b-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="65e4b-334">Zmiana jest wyświetlany.</span><span class="sxs-lookup"><span data-stu-id="65e4b-334">The change is displayed.</span></span>

<span data-ttu-id="65e4b-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="65e4b-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="65e4b-336">Na tym kończy się wprowadzenie do korzystania z `ObjectDataSource` kontrola basic CRUD (tworzenia, odczytu, aktualizowanie i usuwanie) operacje przy użyciu programu Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="65e4b-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="65e4b-337">Powstanie prostej aplikacji warstwowych, ale warstwy logiki biznesowej jest nadal ściśle powiązane do warstwy dostępu do danych, co stwarza automatyczne testy jednostkowe.</span><span class="sxs-lookup"><span data-stu-id="65e4b-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="65e4b-338">W samouczku następujące zobaczysz sposobu implementacji wzorca repozytorium w celu ułatwienia testowania jednostki.</span><span class="sxs-lookup"><span data-stu-id="65e4b-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="65e4b-339">Dalej</span><span class="sxs-lookup"><span data-stu-id="65e4b-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
