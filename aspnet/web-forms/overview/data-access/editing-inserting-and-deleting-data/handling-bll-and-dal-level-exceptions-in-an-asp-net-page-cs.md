---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
title: Obsługa wyjątków logiki warstwy Biznesowej i warstwy DAL poziom strony ASP.NET (C#) | Dokumentacja firmy Microsoft
author: rick-anderson
description: W tym samouczku przedstawiono sposób wyświetlania komunikat o błędzie przyjaznych, informacyjny powinna wystąpić Wystąpił wyjątek podczas wstawiania, aktualizacji lub operacji usuwania programu...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: 49d8a66c-3ea8-4087-839f-179d1d94512a
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
msc.type: authoredcontent
ms.openlocfilehash: e7589584f3b0773a739b785c433ec45eeac3607e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2018
ms.locfileid: "30888240"
---
<a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-c"></a><span data-ttu-id="d9a33-103">Obsługa wyjątków logiki warstwy Biznesowej i warstwy DAL poziom strony ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="d9a33-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (C#)</span></span>
====================
<span data-ttu-id="d9a33-104">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d9a33-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d9a33-105">[Pobierz przykładową aplikację](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) lub [pobierania plików PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="d9a33-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span></span>

> <span data-ttu-id="d9a33-106">W tym samouczku przedstawiono sposób wyświetlania komunikat o błędzie przyjaznych, informacyjny powinien wystąpić wyjątek podczas wstawiania, aktualizacji lub operacja usuwania danych ASP.NET kontrolka sieci Web.</span><span class="sxs-lookup"><span data-stu-id="d9a33-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>


## <a name="introduction"></a><span data-ttu-id="d9a33-107">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="d9a33-107">Introduction</span></span>

<span data-ttu-id="d9a33-108">Pracę z danymi z aplikacji sieci web ASP.NET przy użyciu architektury aplikacji warstwowych obejmuje trzy następujące ogólne czynności:</span><span class="sxs-lookup"><span data-stu-id="d9a33-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="d9a33-109">Określ metodę, warstwy logiki biznesowej musi być wywoływane i wartości jakie parametr przekazywany.</span><span class="sxs-lookup"><span data-stu-id="d9a33-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="d9a33-110">Wartości parametrów, które mogą być zakodowany, programowo przypisane lub danych wejściowych wprowadzony przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d9a33-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="d9a33-111">Wywołanie metody.</span><span class="sxs-lookup"><span data-stu-id="d9a33-111">Invoke the method.</span></span>
3. <span data-ttu-id="d9a33-112">Przetworzyć wyników.</span><span class="sxs-lookup"><span data-stu-id="d9a33-112">Process the results.</span></span> <span data-ttu-id="d9a33-113">Podczas wywoływania metody logiki warstwy Biznesowej, która zwraca dane, może to obejmować powiązanie danych z danych formantu sieci Web.</span><span class="sxs-lookup"><span data-stu-id="d9a33-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="d9a33-114">Dla metod logiki warstwy Biznesowej, które modyfikują dane może to obejmować wykonywanie niektórych akcji na podstawie wartości zwracane lub bezpiecznie obsługi wszelkie wyjątki, które powstały w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="d9a33-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="d9a33-115">Jak widzieliśmy w [poprzedniego samouczek](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), zarówno w elemencie ObjectDataSource, jak i dane formantów sieci Web podanie punkty rozszerzeń kroki 1 i 3.</span><span class="sxs-lookup"><span data-stu-id="d9a33-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="d9a33-116">Widoku GridView, na przykład generowane jego `RowUpdating` zdarzeń przed przypisanie jej wartości pól do jego ObjectDataSource `UpdateParameters` kolekcji; jego `RowUpdated` zdarzenie jest wywoływane po elemencie ObjectDataSource ukończył operację.</span><span class="sxs-lookup"><span data-stu-id="d9a33-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="d9a33-117">Firma Microsoft już zostały zbadane zdarzeń, które wyzwalać w kroku 1 i jak już wspomniano jak one używane do dostosowywania parametrów wejściowych, lub Anuluj operację.</span><span class="sxs-lookup"><span data-stu-id="d9a33-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="d9a33-118">W tym samouczku firma Microsoft będzie Włącz naszych uwagę na zdarzenia, które wyzwalać po ukończeniu tej operacji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="d9a33-119">Z te programy obsługi zdarzeń po poziom, którego możemy, między innymi określić, czy wystąpił wyjątek podczas operacji i go bezpiecznie obsłużyć, wyświetlanie komunikat o błędzie przyjaznych, informacyjny na ekranie, a nie przyjęty standardowe ASP.NET Strona wyjątku.</span><span class="sxs-lookup"><span data-stu-id="d9a33-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="d9a33-120">Aby zilustrować pracy z tych zdarzeń po poziomu, Utwórzmy strona, która zawiera listę produktów w można edytować widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="d9a33-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="d9a33-121">Podczas aktualizowania produktu, jeśli wyjątek jest wywoływane naszych ASP.NET będą wyświetlane krótką wiadomość powyżej widoku GridView wyjaśniający, że wystąpił problem.</span><span class="sxs-lookup"><span data-stu-id="d9a33-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="d9a33-122">Dzieła!</span><span class="sxs-lookup"><span data-stu-id="d9a33-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="d9a33-123">Krok 1: Tworzenie można edytować GridView produktów</span><span class="sxs-lookup"><span data-stu-id="d9a33-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="d9a33-124">W poprzednich instrukcji utworzyliśmy edytowalny Element GridView z dwóch pól `ProductName` i `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="d9a33-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="d9a33-125">To wymagane dodatkowe przeciążenia dla tworzenia `ProductsBLL` klasy `UpdateProduct` metoda, która akceptowany tylko trzy parametry wejściowe (produktu nazwa cenie jednostkowej i identyfikator) nazwą parametru dla każdego pola produktu.</span><span class="sxs-lookup"><span data-stu-id="d9a33-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="d9a33-126">W tym samouczku umożliwia rozwiązaniem, ta technika, tworzenie można edytować widoku GridView, wyświetlana nazwa produktu, ilość na jednostkę, cenie jednostkowej oraz jednostki w magazynie, ale zezwala tylko nazwę, cenie jednostkowej i jednostki w magazynie do edycji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="d9a33-127">Aby zmieścił się w tym scenariuszu poprosimy Cię o innego przeciążenia metody `UpdateProduct` metoda, która przyjmuje cztery parametry: Nazwa produktu, cenie jednostkowej, jednostki w magazynie i identyfikator.</span><span class="sxs-lookup"><span data-stu-id="d9a33-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="d9a33-128">Dodaj następującą metodę do `ProductsBLL` klasy:</span><span class="sxs-lookup"><span data-stu-id="d9a33-128">Add the following method to the `ProductsBLL` class:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample1.cs)]

<span data-ttu-id="d9a33-129">Ta metoda pełną jest gotowy do utworzenia strony ASP.NET, która służy do edytowania czterech pól danego produktu.</span><span class="sxs-lookup"><span data-stu-id="d9a33-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="d9a33-130">Otwórz `ErrorHandling.aspx` strony `EditInsertDelete` folderu i Dodaj element GridView do strony przy użyciu projektanta.</span><span class="sxs-lookup"><span data-stu-id="d9a33-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="d9a33-131">Powiązać widoku GridView nowy element ObjectDataSource, mapowanie `Select()` metodę `ProductsBLL` klasy `GetProducts()` — metoda i `Update()` metodę `UpdateProduct` przeciążenia właśnie utworzony.</span><span class="sxs-lookup"><span data-stu-id="d9a33-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>


<span data-ttu-id="d9a33-132">[![Użyj przeciążenia metody UpdateProduct, które przyjmuje cztery parametry wejściowe](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span></span>

<span data-ttu-id="d9a33-133">**Rysunek 1**: Użyj `UpdateProduct` metoda przeciążenia czy przyjmuje cztery parametry wejściowe ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span></span>


<span data-ttu-id="d9a33-134">Spowoduje to utworzenie elementu ObjectDataSource z `UpdateParameters` kolekcji z cztery parametry i GridView z polem dla każdego pola produktu.</span><span class="sxs-lookup"><span data-stu-id="d9a33-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="d9a33-135">Przypisuje znaczników deklaracyjne element ObjectDataSource `OldValuesParameterFormatString` właściwości wartość `original_{0}`, który spowoduje, że wyjątek od klasy Nasze logiki warstwy Biznesowej oczekują, że parametr wejściowy o nazwie `original_productID` , należy przesłać.</span><span class="sxs-lookup"><span data-stu-id="d9a33-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="d9a33-136">Nie zapomnij Usuń ustawienie to całkowicie z składni deklaratywnej (lub ustaw ją na wartość domyślną `{0}`).</span><span class="sxs-lookup"><span data-stu-id="d9a33-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="d9a33-137">Następnie nawiasu dół widoku GridView, aby uwzględnić tylko `ProductName`, `QuantityPerUnit`, `UnitPrice`, i `UnitsInStock` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="d9a33-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="d9a33-138">Również możesz zastosować na poziomie pola formatowania danych konieczne (np. zmiana `HeaderText` właściwości).</span><span class="sxs-lookup"><span data-stu-id="d9a33-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="d9a33-139">W poprzednich instrukcji Analizujemy sposób formatowania `UnitPrice` elementu BoundField jako walutę zarówno w trybie tylko do odczytu i w trybie edycji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="d9a33-140">Poznajmy tej samej lokalizacji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-140">Let's do the same here.</span></span> <span data-ttu-id="d9a33-141">Odwołaj to wymagane ustawienie elementu BoundField `DataFormatString` właściwości `{0:c}`, jego `HtmlEncode` właściwości `false`, a jego `ApplyFormatInEditMode` do `true`, jak pokazano na rysunku 2.</span><span class="sxs-lookup"><span data-stu-id="d9a33-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>


<span data-ttu-id="d9a33-142">[![Konfigurowanie elementu UnitPrice BoundField do wyświetlania jako walutę](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span></span>

<span data-ttu-id="d9a33-143">**Rysunek 2**: Konfigurowanie `UnitPrice` elementu BoundField do wyświetlania jako walutę ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span></span>


<span data-ttu-id="d9a33-144">Formatowanie `UnitPrice` jako walutę w interfejsie edycji wymaga tworzenie obsługi zdarzeń dla w widoku GridView `RowUpdating` zdarzeń, która analizuje ciąg w formacie waluty w `decimal` wartość.</span><span class="sxs-lookup"><span data-stu-id="d9a33-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="d9a33-145">Odwołania, który `RowUpdating` obsługi zdarzeń od ostatniego samouczek również sprawdzane pod kątem upewnij się, że podane przez użytkownika `UnitPrice` wartość.</span><span class="sxs-lookup"><span data-stu-id="d9a33-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="d9a33-146">Jednak w tym samouczku umożliwia Zezwalaj użytkownikowi na pominięcie cenę.</span><span class="sxs-lookup"><span data-stu-id="d9a33-146">However, for this tutorial let's allow the user to omit the price.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample2.cs)]

<span data-ttu-id="d9a33-147">Nasze GridView obejmuje `QuantityPerUnit` elementu BoundField, ale tego elementu BoundField powinny być tylko do wyświetlania i nie może być edytowany przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d9a33-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="d9a33-148">W tym wystarczy ustawić BoundFields `ReadOnly` właściwości `true`.</span><span class="sxs-lookup"><span data-stu-id="d9a33-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>


<span data-ttu-id="d9a33-149">[![Nadawanie elementu QuantityPerUnit BoundField tylko do odczytu](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span></span>

<span data-ttu-id="d9a33-150">**Rysunek 3**: należy `QuantityPerUnit` elementu BoundField tylko do odczytu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span></span>


<span data-ttu-id="d9a33-151">Na koniec pole wyboru Włącz edytowanie z tagów inteligentnych w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="d9a33-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="d9a33-152">Po wykonaniu tych czynności `ErrorHandling.aspx` strony projektanta powinien wyglądać podobnie do rysunek 4.</span><span class="sxs-lookup"><span data-stu-id="d9a33-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>


<span data-ttu-id="d9a33-153">[![Usuń wszystkie oprócz wymagane BoundFields i zaznacz pole wyboru Włącz edytowanie wyboru](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span></span>

<span data-ttu-id="d9a33-154">**Rysunek 4**: Usuń wszystkie elementy oprócz potrzebne BoundFields i zaznacz pole wyboru Włącz edytowanie pola wyboru ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span></span>


<span data-ttu-id="d9a33-155">W tym momencie mamy listę wszystkich produktów `ProductName`, `QuantityPerUnit`, `UnitPrice`, i `UnitsInStock` pola; jednak tylko `ProductName`, `UnitPrice`, i `UnitsInStock` pola można edytowane.</span><span class="sxs-lookup"><span data-stu-id="d9a33-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>


<span data-ttu-id="d9a33-156">[![Użytkownicy teraz można łatwo edytować, nazwy produktów, ceny i jednostki w standardowych pól](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span></span>

<span data-ttu-id="d9a33-157">**Rysunek 5**: nazwy użytkowników mogą teraz łatwo edytować produktów, ceny i pól jednostki w magazynie ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span></span>


## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="d9a33-158">Krok 2: Bezpiecznie obsługi wyjątków na poziomie warstwy DAL</span><span class="sxs-lookup"><span data-stu-id="d9a33-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="d9a33-159">Gdy naszych można edytować widoku GridView działa bajeczną podczas wprowadzania wartości nazwy produktu edytowany, ceny i jednostki w magazynie, wprowadzanie wartości niedozwolony powoduje wygenerowanie wyjątku.</span><span class="sxs-lookup"><span data-stu-id="d9a33-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="d9a33-160">Na przykład, pomijając `ProductName` wartość przyczyny [nonullallowedexception —](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) zostanie wygenerowany od `ProductName` właściwości w `ProdcutsRow` klasa ma jego `AllowDBNull` ustawioną właściwość `false`; Jeśli Baza danych nie działa, `SqlException` zgłoszony przez TableAdapter podczas próby nawiązania połączenia z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="d9a33-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProdcutsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="d9a33-161">Bez podejmowania żadnych działań, te wyjątki bąbelkowy się z warstwy dostępu do danych do warstwy logiki biznesowej, a następnie do strony ASP.NET i w końcu do środowiska wykonawczego programu ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d9a33-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="d9a33-162">W zależności od konfiguracji aplikacji sieci web i czy odwiedzasz aplikacji z `localhost`, nieobsługiwany wyjątek może spowodować strony ogólny błąd serwera, raport szczegóły błędu lub strony sieci web przyjaznych dla użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d9a33-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="d9a33-163">Zobacz [sieci Web obsługi błędu aplikacji, w programie ASP.NET](http://www.15seconds.com/issue/030102.htm) i [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) uzyskać więcej informacji na temat sposobu środowiska uruchomieniowego ASP.NET odpowiada nieprzechwycony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="d9a33-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="d9a33-164">Rysunek 6 przedstawia ekranu napotkanych podczas próby zaktualizowania produktu bez określania `ProductName` wartość.</span><span class="sxs-lookup"><span data-stu-id="d9a33-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="d9a33-165">Jest to domyślny raport szczegółowe informacje o błędzie wyświetlany po wznowieniu za pośrednictwem `localhost`.</span><span class="sxs-lookup"><span data-stu-id="d9a33-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>


<span data-ttu-id="d9a33-166">[![Pominięcie szczegóły wyjątku będzie wyświetlana nazwa produktu](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span></span>

<span data-ttu-id="d9a33-167">**Rysunek 6**: pominięcie szczegóły wyjątku wyświetlana będzie nazwa produktu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span></span>


<span data-ttu-id="d9a33-168">Takie szczegóły wyjątku są przydatne podczas testowania aplikacji, prezentacja użytkownik końcowy ekran w wypadku wyjątków jest mniejsza niż idealne.</span><span class="sxs-lookup"><span data-stu-id="d9a33-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="d9a33-169">Prawdopodobnie użytkownik końcowy nie może ustalić, jakie `NoNullAllowedException` jest i dlaczego został spowodowany.</span><span class="sxs-lookup"><span data-stu-id="d9a33-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="d9a33-170">Lepszym rozwiązaniem jest do zaoferowania użytkownikowi bardziej przyjazny komunikat wyjaśniający, że wystąpiły problemy podczas próby aktualizacji produktu.</span><span class="sxs-lookup"><span data-stu-id="d9a33-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="d9a33-171">Jeśli wystąpi wyjątek podczas wykonywania operacji, po poziomu zdarzeń w elemencie ObjectDataSource i kontroli danych w sieci Web pozwalają wykryć i anulować wyjątku z propagacji do środowiska wykonawczego programu ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d9a33-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="d9a33-172">W naszym przykładzie załóżmy tworzenie obsługi zdarzeń dla w widoku GridView `RowUpdated` zdarzenie, które określa, jeśli wyjątek jest uruchamiany i jeśli tak, Wyświetla szczegóły wyjątku w formancie etykiety w sieci Web.</span><span class="sxs-lookup"><span data-stu-id="d9a33-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="d9a33-173">Rozpocznij od dodania etykietę do strony ASP.NET, ustawienie jej `ID` właściwości `ExceptionDetails` i wyczyszczenie jego `Text` właściwości.</span><span class="sxs-lookup"><span data-stu-id="d9a33-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="d9a33-174">Aby narysować oka użytkownika do tej wiadomości, ustaw jej `CssClass` właściwości `Warning`, który jest dodana do klasy CSS `Styles.css` plików w poprzednich instrukcji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="d9a33-175">Odwołaj się, że ta klasa CSS powoduje, że tekst etykiety będzie wyświetlana w czcionce czerwony, pogrubienie, kursywa bardzo duża.</span><span class="sxs-lookup"><span data-stu-id="d9a33-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>


<span data-ttu-id="d9a33-176">[![Na stronie Dodaj formant etykiety sieci Web](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span></span>

<span data-ttu-id="d9a33-177">**Rysunek 7**: Dodawanie formantu etykiety sieci Web do strony ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span></span>


<span data-ttu-id="d9a33-178">Ponieważ chcemy ten formant etykiety w sieci Web, aby były widoczne tylko natychmiast po Wystąpił wyjątek, ustaw jej `Visible` właściwości na wartość false w `Page_Load` obsługi zdarzeń:</span><span class="sxs-lookup"><span data-stu-id="d9a33-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample3.cs)]

<span data-ttu-id="d9a33-179">Z tego kodu, w pierwszej wizyty strony i kolejne ogłaszania zwrotnego `ExceptionDetails` kontrolka będzie miała jego `Visible` ustawioną właściwość `false`.</span><span class="sxs-lookup"><span data-stu-id="d9a33-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="d9a33-180">W wypadku wyjątek poziomie DAL lub logiki warstwy Biznesowej, które firma Microsoft może wykryć, że w widoku GridView `RowUpdated` program obsługi zdarzeń, możemy ustawi `ExceptionDetails` formantu `Visible` właściwości na wartość true.</span><span class="sxs-lookup"><span data-stu-id="d9a33-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="d9a33-181">Ponieważ programy obsługi zdarzeń formantu sieci Web wystąpić po `Page_Load` program obsługi zdarzeń w cyklu życia strony, będzie można wyświetlić etykiety.</span><span class="sxs-lookup"><span data-stu-id="d9a33-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="d9a33-182">Jednak na następny ogłaszania zwrotnego `Page_Load` obsługi zdarzeń zostaną przywrócone `Visible` właściwości z powrotem do `false`, ukrywając go ponownie z widoku.</span><span class="sxs-lookup"><span data-stu-id="d9a33-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="d9a33-183">Alternatywnie można usunąć konieczność ustawienie `ExceptionDetails` formantu `Visible` właściwości w `Page_Load` przez przypisanie jej `Visible` właściwości `false` w składni deklaratywnej i wyłączanie swój stan widoku (ustawienie jej `EnableViewState` właściwości `false`).</span><span class="sxs-lookup"><span data-stu-id="d9a33-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="d9a33-184">Użyjemy tego podejścia alternatywnego w przyszłości samouczka.</span><span class="sxs-lookup"><span data-stu-id="d9a33-184">We'll use this alternative approach in a future tutorial.</span></span>


<span data-ttu-id="d9a33-185">Za pomocą formantu etykiety dodane, naszych następnym krokiem jest tworzenie obsługi zdarzeń dla w widoku GridView `RowUpdated` zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="d9a33-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="d9a33-186">Wybierz widoku GridView w projektancie, przejdź do okna właściwości i kliknij ikonę bolt, wyświetlanie zdarzeń w widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="d9a33-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="d9a33-187">Powinna już istnieć wpis istnieje w widoku GridView `RowUpdating` zdarzenie, ponieważ utworzono we wcześniejszej części tego samouczka program obsługi zdarzeń dla tego zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="d9a33-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="d9a33-188">Tworzenie procedury obsługi zdarzeń dla `RowUpdated` również zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="d9a33-188">Create an event handler for the `RowUpdated` event as well.</span></span>


![Tworzenie procedury obsługi zdarzeń dla zdarzenia RowUpdated w widoku GridView](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image22.png)

<span data-ttu-id="d9a33-190">**Rysunek 8**: Tworzenie procedury obsługi zdarzeń dla w widoku GridView `RowUpdated` zdarzeń</span><span class="sxs-lookup"><span data-stu-id="d9a33-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>


> [!NOTE]
> <span data-ttu-id="d9a33-191">Można również utworzyć programu obsługi zdarzeń za pomocą listy rozwijanej w górnej części pliku klasy związane z kodem.</span><span class="sxs-lookup"><span data-stu-id="d9a33-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="d9a33-192">Wybierz z listy rozwijanej w lewym widoku GridView i `RowUpdated` zdarzenia z elementem po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="d9a33-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>


<span data-ttu-id="d9a33-193">Tworzenie ten program obsługi zdarzeń Dodaj następujący kod do klasy związane z kodem strony ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="d9a33-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample4.cs)]

<span data-ttu-id="d9a33-194">Drugi parametr wejściowy tej obsługi zdarzeń jest obiektem typu [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), która zawiera trzy właściwości istotnych dla obsługi wyjątków:</span><span class="sxs-lookup"><span data-stu-id="d9a33-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="d9a33-195">`Exception` Odwołanie do zgłoszenia wyjątku; Jeśli żaden wyjątek nie były zgłaszane, ta właściwość będzie mieć wartość `null`</span><span class="sxs-lookup"><span data-stu-id="d9a33-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="d9a33-196">`ExceptionHandled` wartość logiczna, która wskazuje, czy wyjątek został obsłużony w `RowUpdated` obsługi zdarzeń; Jeśli `false` (ustawienie domyślne), wyjątek jest zgłoszony ponownie wypływająca do środowiska wykonawczego programu ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d9a33-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="d9a33-197">`KeepInEditMode` Jeśli ustawiono `true` edytowanych wiersza elementu GridView pozostaje w trybie edycji; Jeśli `false` (domyślna), wiersza elementu GridView powróci do trybu tylko do odczytu</span><span class="sxs-lookup"><span data-stu-id="d9a33-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="d9a33-198">Naszego kodu, następnie należy sprawdzić, czy `Exception` nie jest `null`, co oznacza, że wystąpił wyjątek podczas wykonywania operacji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="d9a33-199">Jeśli tak jest, chcemy się:</span><span class="sxs-lookup"><span data-stu-id="d9a33-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="d9a33-200">Wyświetla przyjazną dla użytkownika komunikat w `ExceptionDetails` etykiety</span><span class="sxs-lookup"><span data-stu-id="d9a33-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="d9a33-201">Wskazuje, czy wyjątek został obsłużony.</span><span class="sxs-lookup"><span data-stu-id="d9a33-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="d9a33-202">Zachowaj wiersza elementu GridView w trybie edycji</span><span class="sxs-lookup"><span data-stu-id="d9a33-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="d9a33-203">Ten kod w następujących wykonuje następujące cele:</span><span class="sxs-lookup"><span data-stu-id="d9a33-203">This following code accomplishes these objectives:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample5.cs)]

<span data-ttu-id="d9a33-204">Ten program obsługi zdarzeń rozpoczyna się od sprawdzenia, czy `e.Exception` jest `null`.</span><span class="sxs-lookup"><span data-stu-id="d9a33-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="d9a33-205">Jeśli nie, `ExceptionDetails` etykiety `Visible` właściwość jest ustawiona na `true` i jego `Text` dla właściwości "Wystąpił problem podczas aktualizowania produktu."</span><span class="sxs-lookup"><span data-stu-id="d9a33-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="d9a33-206">Szczegóły faktyczny wyjątek, który został zgłoszony znajdują się w `e.Exception` obiektu `InnerException` właściwości.</span><span class="sxs-lookup"><span data-stu-id="d9a33-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="d9a33-207">Ten wyjątek wewnętrzny się zbadana i, jeśli jest określonego typu, komunikat dodatkowe, pomocne jest dołączany do `ExceptionDetails` etykiety `Text` właściwości.</span><span class="sxs-lookup"><span data-stu-id="d9a33-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="d9a33-208">Ponadto `ExceptionHandled` i `KeepInEditMode` właściwości są ustawione na `true`.</span><span class="sxs-lookup"><span data-stu-id="d9a33-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="d9a33-209">Na rysunku nr 9 przedstawiono zrzut ekranu strony podczas pomijania nazwa produktu; Rysunek nr 10 przedstawia wyniki, wprowadzając niedozwolony `UnitPrice` wartość (-50).</span><span class="sxs-lookup"><span data-stu-id="d9a33-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>


<span data-ttu-id="d9a33-210">[![Pole ProductName BoundField musi zawierać wartość](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span></span>

<span data-ttu-id="d9a33-211">**Rysunek 9**: `ProductName` elementu BoundField musi zawierać wartość ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span></span>


<span data-ttu-id="d9a33-212">[![Wartości ujemne UnitPrice są niedozwolone](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span></span>

<span data-ttu-id="d9a33-213">**Na rysunku nr 10**: ujemna `UnitPrice` wartości są niedozwolone ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span></span>


<span data-ttu-id="d9a33-214">Przez ustawienie `e.ExceptionHandled` właściwości `true`, `RowUpdated` program obsługi zdarzeń wskazuje, że obsłużyła wyjątek.</span><span class="sxs-lookup"><span data-stu-id="d9a33-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="d9a33-215">W związku z tym wyjątku nie są propagowane do środowiska wykonawczego programu ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d9a33-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="d9a33-216">Rysunki 9 i 10 Pokaż łagodne sposób obsługi wyjątków zgłoszonych z powodu nieprawidłowego użytkownika w danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="d9a33-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="d9a33-217">Najlepiej, jeśli jednak takie nieprawidłowe dane wejściowe nigdy nie będzie reach warstwy logiki biznesowej w pierwszej kolejności, jak strony ASP.NET należy upewnij się, czy dane wejściowe użytkownika są prawidłowe przed wywołaniem `ProductsBLL` klasy `UpdateProduct` metody.</span><span class="sxs-lookup"><span data-stu-id="d9a33-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="d9a33-218">W naszym samouczku dalej zajmiemy się tym, jak dodać formanty walidacji do edycji i wstawianie interfejsów upewnij się, że dane przesłane do warstwy logiki biznesowej jest zgodna z reguły biznesowe.</span><span class="sxs-lookup"><span data-stu-id="d9a33-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="d9a33-219">Formanty walidacji nie tylko zapobiec wywołanie `UpdateProduct` metody do momentu dane dostarczone przez użytkownika jest prawidłowy, ale również zapewnia większą przyjazność pracę użytkownika identyfikowanie problemów zapisu danych.</span><span class="sxs-lookup"><span data-stu-id="d9a33-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>


## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="d9a33-220">Krok 3: Bezpiecznie obsługi wyjątków na poziomie logiki warstwy Biznesowej</span><span class="sxs-lookup"><span data-stu-id="d9a33-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="d9a33-221">Podczas wstawiania, aktualizowania lub usuwania danych, Warstwa dostępu do danych może zgłosić wyjątek w wypadku błędów związanych z danymi.</span><span class="sxs-lookup"><span data-stu-id="d9a33-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="d9a33-222">Baza danych może być w trybie offline, kolumnie tabeli wymaganej bazy danych nie mógł zawierać określoną wartość lub ograniczenie poziomu tabeli zostały naruszone.</span><span class="sxs-lookup"><span data-stu-id="d9a33-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="d9a33-223">Oprócz wyjątków ściśle związanych z danymi warstwy logiki biznesowej umożliwia wyjątki sygnalizującego, kiedy reguły biznesowe zostały naruszone.</span><span class="sxs-lookup"><span data-stu-id="d9a33-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="d9a33-224">W [Tworzenie warstwy logiki biznesowej](../introduction/creating-a-business-logic-layer-cs.md) samouczek, na przykład dodaliśmy wyboru reguła biznesowa oryginalnej `UpdateProduct` przeciążenia.</span><span class="sxs-lookup"><span data-stu-id="d9a33-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="d9a33-225">W szczególności jeśli użytkownik został oznaczenie produktu, jak zaprzestać, wprowadziliśmy czy produktu można nie tylko jeden dostarczone przez dostawcę.</span><span class="sxs-lookup"><span data-stu-id="d9a33-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="d9a33-226">Jeśli ten stan zostało naruszone, `ApplicationException` został zgłoszony.</span><span class="sxs-lookup"><span data-stu-id="d9a33-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="d9a33-227">Dla `UpdateProduct` przeciążenia utworzonej w tym samouczku, możemy dodać regułę biznesową, która uniemożliwia `UnitPrice` pola na nową wartość, która jest więcej niż dwa razy oryginalnej `UnitPrice` wartość.</span><span class="sxs-lookup"><span data-stu-id="d9a33-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="d9a33-228">Aby to zrobić, należy dostosować `UpdateProduct` przeciążenia, który wykonuje sprawdzanie i zgłasza `ApplicationException` Jeśli naruszenia reguły.</span><span class="sxs-lookup"><span data-stu-id="d9a33-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="d9a33-229">Zaktualizowana metoda następująco:</span><span class="sxs-lookup"><span data-stu-id="d9a33-229">The updated method follows:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample6.cs)]

<span data-ttu-id="d9a33-230">Dzięki tej zmianie spowoduje, że każda Aktualizacja cen, która jest więcej niż dwa razy istniejących cen `ApplicationException` zostanie wygenerowany.</span><span class="sxs-lookup"><span data-stu-id="d9a33-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="d9a33-231">Podobnie jak wyjątek zgłoszony z warstwy DAL, w tym wywoływane logiki warstwy Biznesowej `ApplicationException` wykrywane i obsługiwane w widoku GridView `RowUpdated` obsługi zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="d9a33-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="d9a33-232">W rzeczywistości `RowUpdated` kod obsługi zdarzeń, jak podano, poprawnie wykryje tego wyjątku i wyświetli `ApplicationException`w `Message` wartości właściwości.</span><span class="sxs-lookup"><span data-stu-id="d9a33-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="d9a33-233">Rysunek 11 zawiera zrzut, gdy użytkownik próbuje zaktualizować ceny Chai 50,00 USD, czyli więcej niż double jego bieżąca cena cenie od 19,95 USD ekranu.</span><span class="sxs-lookup"><span data-stu-id="d9a33-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>


<span data-ttu-id="d9a33-234">[![Reguły biznesowe nie zezwalaj na wzrostów, które więcej niż dwukrotnie cena produktu](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="d9a33-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span></span>

<span data-ttu-id="d9a33-235">**Rysunek 11**: nie zezwalaj wzrostów, które więcej niż dwukrotnie cena produktu reguły biznesowe ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="d9a33-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span></span>


> [!NOTE]
> <span data-ttu-id="d9a33-236">W idealnym przypadku naszej reguł logiki biznesowej czy refaktoryzowane poza `UpdateProduct` przeciążenia metody i do wspólnej metody.</span><span class="sxs-lookup"><span data-stu-id="d9a33-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="d9a33-237">To pole pozostanie jako wykonywania dla czytnika.</span><span class="sxs-lookup"><span data-stu-id="d9a33-237">This is left as an exercise for the reader.</span></span>


## <a name="summary"></a><span data-ttu-id="d9a33-238">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="d9a33-238">Summary</span></span>

<span data-ttu-id="d9a33-239">Podczas wstawiania, aktualizowania i usuwania działań formantu danych sieci Web i ObjectDataSource związane wyzwalać zdarzeń przed i po poziomu tego zakładkę bieżącej operacji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="d9a33-240">Jak widzieliśmy w tym samouczku i mieszanego, podczas pracy z GridView można edytować w widoku GridView `RowUpdating` generowane zdarzenie, a następnie przez element ObjectDataSource `Updating` zdarzeń w takim przypadku polecenie aktualizacji jest wprowadzone w elemencie ObjectDataSource obiekt źródłowy.</span><span class="sxs-lookup"><span data-stu-id="d9a33-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="d9a33-241">Po ukończeniu tej operacji, ObjectDataSource `Updated` generowane zdarzenie, a następnie w widoku GridView `RowUpdated` zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="d9a33-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="d9a33-242">Można utworzyć procedury obsługi zdarzeń dla zdarzenia wstępnie poziomu, aby dostosować parametry wejściowe lub po poziomu zdarzeń, aby sprawdzić i reagowanie na wyniki operacji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="d9a33-243">Programy obsługi zdarzeń po poziomu są najczęściej używane do wykrywania, czy wystąpił wyjątek podczas operacji.</span><span class="sxs-lookup"><span data-stu-id="d9a33-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="d9a33-244">Wystąpił wyjątek w wypadku te programy obsługi zdarzeń po poziom opcjonalnie może obsłużyć wyjątek samodzielnie.</span><span class="sxs-lookup"><span data-stu-id="d9a33-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="d9a33-245">W tym samouczku widzieliśmy sposób obsługi takiego wyjątku, wyświetlając przyjazne komunikaty o błędach.</span><span class="sxs-lookup"><span data-stu-id="d9a33-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="d9a33-246">W następnym samouczku zajmiemy się tym, jak zmniejszyć prawdopodobieństwo wyjątki wynikające z danych formatowania problemów (takich jak wprowadzenie ujemny `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="d9a33-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="d9a33-247">W szczególności wyjaśniono, jak dodać formanty walidacji do edycji i wstawianie interfejsów.</span><span class="sxs-lookup"><span data-stu-id="d9a33-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="d9a33-248">Programowanie przyjemność!</span><span class="sxs-lookup"><span data-stu-id="d9a33-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="d9a33-249">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="d9a33-249">About the Author</span></span>

<span data-ttu-id="d9a33-250">[Scott Bento](http://www.4guysfromrolla.com/ScottMitchell.shtml), autora siedmiu książek ASP/ASP.NET i twórcę z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje z technologii Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="d9a33-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d9a33-251">Scott działa jako niezależnego konsultanta trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="d9a33-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d9a33-252">Jest jego najnowszej książki [ *Sams nauczyć się ASP.NET 2.0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="d9a33-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="d9a33-253">Piotr można uzyskać pod adresem [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) lub za pośrednictwem jego blog, który znajduje się w temacie [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="d9a33-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="d9a33-254">Specjalne podziękowania dla</span><span class="sxs-lookup"><span data-stu-id="d9a33-254">Special Thanks To</span></span>

<span data-ttu-id="d9a33-255">Ten samouczek serii zostało sprawdzone przez wiele recenzentów przydatne.</span><span class="sxs-lookup"><span data-stu-id="d9a33-255">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d9a33-256">Recenzenta realizacji w tym samouczku został Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="d9a33-256">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="d9a33-257">Zainteresowani recenzowania Moje nadchodzących artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="d9a33-257">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d9a33-258">Jeśli tak, Porzuć mnie linii w [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d9a33-258">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d9a33-259">[Poprzednie](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
> [dalej](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span><span class="sxs-lookup"><span data-stu-id="d9a33-259">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span></span>
