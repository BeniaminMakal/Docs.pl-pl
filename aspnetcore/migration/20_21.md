---
title: Migracja z platformy ASP.NET Core 2.0 lub 2.1
author: rick-anderson
description: W tym artykule opisano podstawy migrowanie aplikacji programu ASP.NET 2.0 Core 2.1.
ms.author: riande
ms.date: 05/30/2018
uid: migration/20_21
ms.openlocfilehash: 8d27d916b04c12c17c0054de8392408f751b6990
ms.sourcegitcommit: 1faf2525902236428dae6a59e375519bafd5d6d7
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/28/2018
ms.locfileid: "37089896"
---
# <a name="migrate-from-aspnet-core-20-to-21"></a>Migracja z platformy ASP.NET Core 2.0 lub 2.1

Przez [Rick Anderson](https://twitter.com/RickAndMSFT)

Zobacz [What's new in ASP.NET Core 2.1](xref:aspnetcore-2.1) omówienie nowych funkcji programu ASP.NET Core 2.1.

W tym artykule:

* Omówiono podstawowe informacje o migracji aplikacji programu ASP.NET 2.0 Core 2.1.
* Zawiera omówienie zmian w szablonach aplikacji sieci web platformy ASP.NET Core.

Szybkie omówienie zmian w 2.1 jest:

* Tworzenie aplikacji sieci web platformy ASP.NET Core 2.0, o nazwie WebApp1.
* Zatwierdź WebApp1 w systemie kontroli źródła.
* Usuń WebApp1 i tworzenie aplikacji sieci web platformy ASP.NET Core 2.1 o nazwie WebApp1 w tym samym miejscu.
* Przegląd zmian dokonanych w wersji 2.1.

Ten artykuł zawiera omówienie migracji do platformy ASP.NET Core 2.1. Nie zawiera pełną listę wszystkich zmian konieczne jest migracja do wersji 2.1. Niektóre projekty mogą wymagać większej liczby kroków w zależności od opcji wybranej podczas tworzenia projektu i zmiany do projektu.

## <a name="update-the-project-file-to-use-21-versions"></a>Zaktualizuj plik projektu do użycia wersji 2.1

Aktualizacja *.csproj* pliku projektu:

* Zmień `<TargetFramework>netcoreapp2.0</TargetFramework>` do wersji 2.1, który jest `<TargetFramework>netcoreapp2.1</TargetFramework>`.
* Zamień wersji określonego odwołania do pakietu "Microsoft.AspNetCore.All" z odwołaniem do pakietu versionless "Microsoft.AspNetCore.App". Może być konieczne dodanie zależności, które zostały usunięte z "Microsoft.AspNetCore.All". Zobacz [migrowania Microsoft.AspNetCore.All do Microsoft.AspNetCore.App](xref:fundamentals/metapackage#migrate) i [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). Jeśli jesteś dotyczących programu .NET Framework:

  * Dodaj odwołania do poszczególnych pakietów zamiast odwołania pakietu meta.
  * Zaktualizuj każde odwołanie pakietu 2.1.
* Usuń wszystkie odniesienia do `<DotNetCliToolReference>` elementy pakietów "Microsoft.AspNetCore", "Microsoft.VisualStudio" i "Microsoft.EntityFrameworkCore". Narzędzia te zostały zastąpione przez narzędzia globalnego.

Następujący kod przedstawia szablon wygenerowany 2.0 *.csproj* pliku projektu:

[!code-xml[Main](20_21/sample/WebApp20.csproj)]

Następujący kod przedstawia szablon wygenerowany 2.1 *.csproj* pliku projektu:

[!code-xml[Main](20_21/sample/WebApp21.csproj)]

## <a name="rules-for-projects-targeting-the-shared-runtime"></a>Reguły dla projektów przeznaczonych dla udostępnionych środowiska wykonawczego

Platformy ASP.NET Core obejmuje następujące udostępnionego środowisk uruchomieniowych:

* [Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app)
* [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)

Zasady dla projektów przeznaczonych dla udostępnionych środowiska uruchomieniowego:

* Projekty odwołujące się do `Microsoft.AspNetCore.All` lub `Microsoft.AspNetCore.App` pakietów musi ustawioną SDK projektu `Microsoft.NET.Sdk.Web` w górnej części pliku projektu (`<Project Sdk="Microsoft.NET.Sdk.Web">`).
* Projekty odwołujące się do pakietów lub projektów odwołujących się przechodnie `Microsoft.AspNetCore.All` lub `Microsoft.AspNetCore.App`:
  * Należy ustawić SDK projektu `Microsoft.NET.Sdk.Web` w górnej części pliku projektu (`<Project Sdk="Microsoft.NET.Sdk.Web">`).
  * Musi odwoływać się tego samego pakietu udostępnionego środowiska wykonawczego. Jeśli odwołuje się LibraryA `Microsoft.AspNetCore.App`, wszystkie projekty odwołujące się do LibraryA również musi odwoływać się `Microsoft.AspNetCore.App`.
* Projekty pliku wykonywalnego (projekty zawierające aplikacje, które będą uruchamiane z `dotnet run` lub aplikacji, których uruchamianie i testowanie projektów dla aplikacji) nie mogą określać wersji dla `Microsoft.AspNetCore.App`. Zestaw SDK Określa wersję niejawnie za pośrednictwem `<PackageReference Include="Microsoft.AspNetCore.App" />`.
* Odwołanie do projektów (projekty, do których nie ma punktu wejścia, a odwołania do projektu `Microsoft.AspNetCore.All` lub `Microsoft.AspNetCore.App`) musi określać wersję pakietu.

## <a name="changes-to-take-advantage-of-the-new-code-based-idioms-that-are-recommended-in-aspnet-core-21"></a>Zmiany, aby móc korzystać z nowych idioms opartej na kodzie, które są zalecane w ASP.NET Core 2.1

### <a name="changes-to-main"></a>Zmiany dla metody Main

Na poniższych ilustracjach przedstawiono zmiany wprowadzone do szablonu wygenerowany *Program.cs* pliku.

![stary różnice wersji](20_21/_static/main20.png)

Na poprzedniej ilustracji przedstawiono w wersji 2.0 z operacji usuwania na czerwono.

Poniższa ilustracja przedstawia przykładowy kod 2.1. Kod na zielono zastąpiony w wersji 2.0:

![różnice w nowej wersji](20_21/_static/main21.png)

Poniższy kod przedstawia wersji 2.1 *Program.cs*:

[!code-csharp[Main](20_21/sample/Program.cs?name=snippet)]

Nowy `Main` zastępuje wywołanie `BuildWebHost` z [CreateWebHostBuilder](/dotnet/api/microsoft.aspnetcore.mvc.testing.webapplicationfactory-1.createwebhostbuilder). [IWebHostBuilder](/dotnet/api/microsoft.aspnetcore.hosting.iwebhostbuilder) został dodany do obsługi nowej [infrastruktury testowego integracji](xref:test/integration-tests).

### <a name="changes-to-startup"></a>Zmiany do uruchomienia

Poniższy kod przedstawia zmiany szablonu 2.1 wygenerowanego kodu. Wszystkie zmiany są nowo dodanych kodu, z wyjątkiem `UseBrowserLink` został usunięty:

[!code-csharp[Main](20_21/sample/Startup.cs?highlight=3,4,21-26,30,42,45,47)]

Poprzednie zmiany kodu są szczegółowo opisane:

* [Obsługa GDPR w ASP.NET Core](xref:security/gdpr) dla `CookiePolicyOptions` i `UseCookiePolicy`.
* [Protokół zabezpieczeń Strict transportu HTTP (HSTS)](xref:security/enforcing-ssl#http-strict-transport-security-protocol-hsts) dla `UseHsts`.
* [Wymagać protokołu HTTPS](xref:security/enforcing-ssl#require-https) dla `UseHttpsRedirection`.
* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion) dla `SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`.

## <a name="changes-to-authentication-code"></a>Zmiany kodu uwierzytelniania

Platformy ASP.NET Core 2.1 udostępnia [ASP.NET Core Identity](xref:security/authentication/identity) jako [biblioteki klas Razor](xref:razor-pages/ui-class) (RCL).

Wartość domyślna 2.1 interfejsu tożsamości użytkownika nie obecnie zapewnia wprowadzono nowe ważne funkcje w wersji 2.0. Zastępowanie tożsamości z pakietem RCL jest opcjonalne. Zalety zastąpienia szablonu generowany tożsamości kodu z wersją RCL obejmują:

* Wiele plików są przenoszone poza swoje drzewo źródła.
* Znajdują się wszystkie poprawki i nowe funkcje do tożsamości w [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app). Automatycznie Pobierz zaktualizowany tożsamości podczas `Microsoft.AspNetCore.App` jest aktualizowany.

Jeśli wprowadzono nieuproszczony zmian wprowadzonych w szablonie generowany kod tożsamości:

* Poprzedniego zalety nie mogą uzasadniać konwersji do wersji RCL.
* Możesz zachować swój kod platformy ASP.NET Core 2.0 tożsamości, jest w pełni obsługiwane.

Tożsamość 2.1 udostępnia punkty końcowe z `Identity` obszaru. Na przykład poniższa tabela zawiera przykłady tożsamości punktów końcowych, które zmieniają się z 2.0 2.1:

| 2.0 ADRES URL         | 2.1 ADRES URL |
| --------------- | ------------ |
| / / Logowanie się na koncie  | / / Konta/Logowanie tożsamości |
| / Konta/wylogowania | / Tożsamości/konta/wylogowania |
| Lub konto/zarządzać | / Tożsamości/konta/zarządzania |

Ma interfejsu użytkownika tożsamości 2.1 potrzebujących biblioteki tożsamości uwzględnienie tożsamości adresy URL aplikacji, które mają kod przy użyciu tożsamości i Zastąp 2.0 `/Identity` segement dołączany na identyfikatory URI początku. Aby obsłużyć nowy punkty końcowe tożsamości jest skonfigurowanie przekierowania, na przykład z `/Account/Login` do `/Identity/Account/Login`.

### <a name="update-identity-to-version-21"></a>Tożsamość aktualizacji do wersji 2.1

Następujące opcje są dostępne, można zaktualizować tożsamości 2.1.

* Użyj kodu 2.0 interfejsu użytkownika tożsamości bez zmian. Przy użyciu kodu 2.0 interfejsu użytkownika tożsamości jest w pełni obsługiwany. Jest to dobre rozwiązanie, gdy wprowadzono zmiany znaczący wygenerowanego kodu tożsamości.
* Usuń istniejący kod 2.0 tożsamości i [tożsamości szkieletu](xref:security/authentication/scaffold-identity) do projektu. Projekt będzie używać [ASP.NET Core Identity](xref:security/authentication/identity) [biblioteki klas Razor](xref:razor-pages/ui-class). Można wygenerować kodu i interfejsu użytkownika dla żadnego kodu interfejsu tożsamości użytkownika, które zostały zmodyfikowane. Zastosuj zmiany kodu do nowo utworzonego szkieletu kodu interfejsu użytkownika.
* Usuń istniejący kod 2.0 tożsamości i [tożsamości szkieletu](xref:security/authentication/scaffold-identity) do projektu z opcją **Zastąp wszystkie pliki**.

### <a name="replace-identity-20-ui-with-the-identity-21-razor-class-library"></a>Zastąpienia tożsamości 2.0 interfejsu użytkownika z biblioteki klas Razor tożsamości 2.1

W tej sekcji opisano kroki, aby zmienić kod platformy ASP.NET Core 2.0 szablonu wygenerowanego tożsamości z [ASP.NET Core Identity](xref:security/authentication/identity) [biblioteki klas Razor](xref:razor-pages/ui-class). Poniższe kroki to etapy dla stron Razor projektu, ale podejście do projektu MVC jest podobne.

* Sprawdź [plik projektu został zaktualizowany do wersji 2.1](#update-the-project-file-to-use-21-versions)
* Usuń następujące foldery i wszystkie pliki w nich:
  * *Kontrolery*
  * *Strony/konta /*
  * *Rozszerzenia*
* Skompiluj projekt.
* [Tworzenie szkieletu tożsamości](xref:security/authentication/scaffold-identity) do projektu:
  * Wybierz projekty, kończenie *_Layout.cshtml* pliku.
  * Wybierz **+** ikonę w prawej części **klasa kontekstu danych**. Zaakceptuj nazwę domyślną.
  * Wybierz **Dodaj** do utworzenia nowej klasy kontekstu danych. Tworzenie nowy kontekst danych jest wymagane dla, aby utworzyć szkielet. Nowy kontekst danych należy usunąć w następnej sekcji.

### <a name="update-after-scaffolding-identity"></a>Zaktualizowane po tworzenia szkieletu tożsamości

* Usuń tworzenia szkieletu tożsamości wygenerowany `IdentityDbContext` klasy dgml w *danych-obszarów/tożsamości/* folderu.
* Usuń *Areas/Identity/IdentityHostingStartup.cs*
* Aktualizacja *_LoginPartial.cshtml* pliku:
  * Przenieś *Pages/_LoginPartial.cshtml* do *Pages/Shared/_LoginPartial.cshtml*
  * Dodaj `asp-area="Identity"` do formularza i kotwicy łącza.
  * Aktualizacja `<form />` elementu `    <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" id="logoutForm" class="navbar-right">`

  Poniższy kod przedstawia zaktualizowanego *_LoginPartial.cshtml* pliku:

  [!code-cshtml[Main](20_21/sample/_LoginPartial.cshtml?highlight=8,11,22,23)]

Aktualizacja `ConfigureServices` następującym kodem:

[!code-csharp[Main](20_21/sample/Startup2.cs?name=snippet)]

## <a name="changes-to-razor-pages-projects-razor-files"></a>Zmiany stron Razor projektów plików Razor

### <a name="the-layout-file"></a>Plik układu

* Przenieś *Pages/_Layout.cshtml* do *Pages/Shared/_Layout.cshtml*
* *Layout.cshtml* plik ma następujące zmiany:

  * `<partial name="_CookieConsentPartial" />` zostanie dodany. Aby uzyskać więcej informacji, zobacz [GDPR obsługuje w ASP.NET Core](xref:security/gdpr).
  * zmiany jQuery z 2.2.0 3.3.1

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

* *Pages/_ValidationScriptsPartial.cshtml* przenosi *Pages/Shared/_ValidationScriptsPartial.cshtml*
* *jquery.Validate/1.14.0* zmienia się na *jquery.validate/1.17.0*

### <a name="new-files"></a>Nowe pliki

Dodano następujące pliki:

* *Privacy.cshtml*
* *Privacy.cshtml.CS*

Zobacz [GDPR obsługuje w ASP.NET Core](xref:security/gdpr) informacji o plikach poprzedni.

## <a name="changes-to-mvc-projects-razor-files"></a>Zmiany w plikach Razor projektów MVC

### <a name="the-layout-file"></a>Plik układu

*Layout.cshtml* plik ma następujące zmiany:

* `<partial name="_CookieConsentPartial" />` zostanie dodany.
* zmiany jQuery z 2.2.0 3.3.1

### <a name="validationscriptspartialcshtml"></a>_ValidationScriptsPartial.cshtml

*jquery.Validate/1.14.0* zmienia się na *jquery.validate/1.17.0*

### <a name="new-files-and-action-methods"></a>Nowe pliki i metod akcji

Dodaje się:

* *Views/Home/Privacy.cshtml*
* `Privacy` Metody akcji jest dodawany do kontrolera głównej.

Zobacz [GDPR obsługuje w ASP.NET Core](xref:security/gdpr) informacji o plikach poprzedni.

## <a name="additional-changes"></a>Dodatkowe zmiany

* [SetCompatibilityVersion](xref:fundamentals/startup#setcompatibilityversion)
* [Konfiguracja transportu](xref:fundamentals/servers/kestrel#transport-configuration)
