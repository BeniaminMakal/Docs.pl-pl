---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: "Tworzenie modelu sprawdzaniem poprawności reguły biznesowej | Dokumentacja firmy Microsoft"
author: microsoft
description: "Krok 3 przedstawiono sposób tworzenia modelu, że firma Microsoft umożliwia zarówno zapytania i aktualizowania bazy danych dla aplikacji NerdDinner."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: dbe6370979f218988c168df3e80314ef9b338fbd
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/10/2017
---
<a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="08cb2-103">Tworzenie modelu sprawdzaniem poprawności reguły biznesowej</span><span class="sxs-lookup"><span data-stu-id="08cb2-103">Build a Model with Business Rule Validations</span></span>
====================
<span data-ttu-id="08cb2-104">przez [firmy Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="08cb2-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="08cb2-105">Pobierz plik PDF</span><span class="sxs-lookup"><span data-stu-id="08cb2-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="08cb2-106">Jest to krok 3 bezpłatnych ["NerdDinner" samouczek aplikacji](introducing-the-nerddinner-tutorial.md) który przeszukiwań przez proces kompilacji mały, ale ukończyć, aplikacji sieci web przy użyciu platformy ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="08cb2-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="08cb2-107">Krok 3 przedstawiono sposób tworzenia modelu, że firma Microsoft umożliwia zarówno zapytania i aktualizowania bazy danych dla aplikacji NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="08cb2-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="08cb2-108">Jeśli używasz programu ASP.NET MVC 3, zaleca się wykonanie [pobierania uruchomiona z MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) lub [magazynu utworów muzycznych MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) samouczki.</span><span class="sxs-lookup"><span data-stu-id="08cb2-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="08cb2-109">NerdDinner krok 3: Budowanie modelu</span><span class="sxs-lookup"><span data-stu-id="08cb2-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="08cb2-110">W ramach model-view-controller termin "modelu" odnosi się do obiektów, które zawierają dane aplikacji, jak również odpowiedniego logika domeny, która integruje się sprawdzanie poprawności i reguły biznesowe z nim.</span><span class="sxs-lookup"><span data-stu-id="08cb2-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="08cb2-111">Model jest na wiele sposobów "pulsu" aplikacji opartych na strukturze MVC i jak zajmiemy się tym później zasadniczo dysków z zachowaniem.</span><span class="sxs-lookup"><span data-stu-id="08cb2-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="08cb2-112">Platforma ASP.NET MVC obsługuje za pomocą innych technologii dostępu do danych i możliwość wyboru z wielu zaawansowanych opcji danych .NET do zaimplementowania ich modeli, w tym: LINQ do jednostek, składnika LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM lub po prostu raw ADO. NET DataReaders ani zestawów danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="08cb2-113">Dla aplikacji NerdDinner zamierzamy LINQ do SQL umożliwia utworzenie prostego modelu, który odpowiada dość ściśle naszych projekt bazy danych i dodaje niektóre niestandardowe reguły sprawdzania poprawności logiki i business.</span><span class="sxs-lookup"><span data-stu-id="08cb2-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="08cb2-114">Następnie wprowadzimy klasę repozytorium, która pomaga abstrakcyjny optymalizacji implementacja trwałości danych od pozostałej części aplikacji i umożliwia firmie Microsoft w celu łatwego jednostki przetestować go.</span><span class="sxs-lookup"><span data-stu-id="08cb2-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="08cb2-115">LINQ do SQL</span><span class="sxs-lookup"><span data-stu-id="08cb2-115">LINQ to SQL</span></span>

<span data-ttu-id="08cb2-116">LINQ do SQL jest ORM (obiektów relacyjnych mapowania) jest dostarczany jako część .NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="08cb2-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="08cb2-117">LINQ do SQL zapewnia prosty sposób mapowania klasy .NET, które firma Microsoft może kodu przed tabel bazy danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="08cb2-118">Dla aplikacji NerdDinner użyjemy go do mapowania tabeli kolacji i RSVP w naszej bazie danych obiad oraz RSVP klasy.</span><span class="sxs-lookup"><span data-stu-id="08cb2-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="08cb2-119">Kolumny tabeli kolacji i RSVP odpowiada właściwości klasy obiad i RSVP.</span><span class="sxs-lookup"><span data-stu-id="08cb2-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="08cb2-120">Każdy obiekt obiad i RSVP będzie reprezentować oddzielnym wierszu w kolacji lub RSVP tabel w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="08cb2-121">LINQ do SQL pozwala uniknąć konieczności ręcznego utworzenia instrukcje SQL w celu pobierania i aktualizowania obiad i RSVP obiektów z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="08cb2-122">Zamiast tego zdefiniujemy obiad i RSVP klas, w jaki sposób są one wykonywane na/bazy danych i relacje między nimi.</span><span class="sxs-lookup"><span data-stu-id="08cb2-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="08cb2-123">LINQ do SQL bierze opieki generowania odpowiednich logiki wykonywania SQL do użycia w czasie wykonywania, gdy firma Microsoft i korzystać z nich.</span><span class="sxs-lookup"><span data-stu-id="08cb2-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="08cb2-124">Możemy użyć LINQ obsługę języka VB i C# do pisania obszerne zapytań, które pobierają obiad i RSVP obiektów z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="08cb2-125">Pozwala to zmniejszyć ilość kodu danych należy zapisać, i umożliwia tworzenie aplikacji naprawdę czyste.</span><span class="sxs-lookup"><span data-stu-id="08cb2-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="08cb2-126">Dodawanie klasy LINQ do SQL do naszej projektu</span><span class="sxs-lookup"><span data-stu-id="08cb2-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="08cb2-127">Firma Microsoft będzie rozpocząć, klikając prawym przyciskiem myszy w folderze "Modele" w ramach naszych projektu i wybierz **Add -&gt;nowy element** polecenie:</span><span class="sxs-lookup"><span data-stu-id="08cb2-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="08cb2-128">Zostanie wyświetlone okno dialogowe "Dodaj nowy element".</span><span class="sxs-lookup"><span data-stu-id="08cb2-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="08cb2-129">Firma Microsoft będzie filtrować według kategorii "Dane" i wybierz szablon "LINQ do SQL klasy" w niej:</span><span class="sxs-lookup"><span data-stu-id="08cb2-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="08cb2-130">Firma Microsoft będzie nazwy elementu "NerdDinner" i kliknij przycisk "Dodaj".</span><span class="sxs-lookup"><span data-stu-id="08cb2-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="08cb2-131">Visual Studio będzie dodanie pliku NerdDinner.dbml w naszym katalogu \Models, a następnie otwórz składnika LINQ to SQL Projektant obiektów relacyjnych:</span><span class="sxs-lookup"><span data-stu-id="08cb2-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="08cb2-132">Tworzenie klasy modelu danych za pomocą LINQ do SQL</span><span class="sxs-lookup"><span data-stu-id="08cb2-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="08cb2-133">LINQ do SQL pozwala szybko utworzyć klasy modelu danych z istniejącego schematu bazy danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="08cb2-134">Zadania do wykonania to firma Microsoft będzie otworzyć NerdDinner bazy danych w Eksploratorze serwera i wybierz tabele chcemy modelu w tym:</span><span class="sxs-lookup"><span data-stu-id="08cb2-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="08cb2-135">Firma Microsoft następnie przeciągnij tabel na LINQ do powierzchni projektanta SQL.</span><span class="sxs-lookup"><span data-stu-id="08cb2-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="08cb2-136">Gdy przejdziemy LINQ to SQL zostanie automatycznie utworzony obiad i klasy RSVP przy użyciu schematu tabeli (z właściwości klasy, które mapują kolumny tabeli bazy danych):</span><span class="sxs-lookup"><span data-stu-id="08cb2-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="08cb2-137">Domyślnie LINQ do SQL projektanta automatycznie "generuje końcówki liczbie mnogiej" nazwy tabel i kolumn podczas tworzenia klasy na podstawie schematu bazy danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="08cb2-138">Na przykład: w tabeli "Kolacji" w naszym przykładzie powyżej spowodowała klasy "Obiad".</span><span class="sxs-lookup"><span data-stu-id="08cb2-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="08cb2-139">Ta klasa nazewnictwa ułatwia naszych modeli zgodnie z konwencją nazewnictwa .NET i zwykle znaleźć ten, którego poprawkę projektanta to zapasowej wygodny (szczególnie podczas dodawania wiele tabel).</span><span class="sxs-lookup"><span data-stu-id="08cb2-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="08cb2-140">Jeśli nie chcesz, aby nazwa klasy lub właściwości, które generuje projektanta, ale zawsze możesz zmienić i zmień ją na dowolną nazwę, która ma.</span><span class="sxs-lookup"><span data-stu-id="08cb2-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="08cb2-141">Można to zrobić, edytując właściwości/jednostki nazwy w wierszu projektanta lub modyfikując przy użyciu siatki właściwości.</span><span class="sxs-lookup"><span data-stu-id="08cb2-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="08cb2-142">Domyślnie LINQ do SQL projektanta również przeprowadzający podstawowy klucz/relacje klucza obcego tabel, a oparte na nich automatycznie tworzy domyślną "skojarzenia relacji" między klasami inny model, który tworzy.</span><span class="sxs-lookup"><span data-stu-id="08cb2-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="08cb2-143">Na przykład gdy firma Microsoft przeciągnięto kolacji i RSVP tabel na LINQ do SQL projektanta skojarzenie relacji jeden do wielu między tymi dwoma wywnioskowano opiera się na fakt, że tabela RSVP miał kluczy obcych do tabeli kolacji (jest to określane przez strzałkę w Projektant):</span><span class="sxs-lookup"><span data-stu-id="08cb2-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="08cb2-144">Powyżej skojarzenia spowoduje, że LINQ do SQL, aby dodać właściwość "Obiad" silnie typizowaną do klasy RSVP, której deweloperzy mogą używać obiad skojarzone z danym RSVP dostępu do.</span><span class="sxs-lookup"><span data-stu-id="08cb2-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="08cb2-145">Spowoduje także klasy obiad mieć "RSVPs" właściwość kolekcji, który umożliwia deweloperom pobierania i aktualizowania RSVP obiekty skojarzone z określonym obiad.</span><span class="sxs-lookup"><span data-stu-id="08cb2-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="08cb2-146">Poniżej widać przykład intellisense w programie Visual Studio po możemy utworzyć nowego obiektu RSVP i dodaj go do kolekcji zbędne obiad.</span><span class="sxs-lookup"><span data-stu-id="08cb2-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="08cb2-147">Zwróć uwagę, jak LINQ do SQL automatycznie dodawane kolekcji "Zbędne" w obiekcie obiad:</span><span class="sxs-lookup"><span data-stu-id="08cb2-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="08cb2-148">Dodawanie obiektu RSVP do kolekcji zbędne obiad możemy informuje LINQ do SQL do skojarzenia klucza obcego relacji między obiad i wiersz RSVP w naszej bazie danych:</span><span class="sxs-lookup"><span data-stu-id="08cb2-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="08cb2-149">Jeśli nie lubisz jak projektanta został uformowany lub o nazwie skojarzenia tabeli, które można zmienić.</span><span class="sxs-lookup"><span data-stu-id="08cb2-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="08cb2-150">Po prostu kliknij strzałkę skojarzenia w Projektancie i uzyskać dostęp do jego właściwości za pośrednictwem siatki właściwości, aby zmienić nazwę, usuń lub zmodyfikuj go.</span><span class="sxs-lookup"><span data-stu-id="08cb2-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="08cb2-151">Dla naszej aplikacji NerdDinner, domyślne reguły kojarzenia pracy dla klasy modelu danych, które możemy budowania i możemy użyć domyślnego zachowania.</span><span class="sxs-lookup"><span data-stu-id="08cb2-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="08cb2-152">Klasa NerdDinnerDataContext</span><span class="sxs-lookup"><span data-stu-id="08cb2-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="08cb2-153">Visual Studio automatycznie utworzy klasy .NET, które reprezentują modeli i bazy danych relacje zdefiniowane przy użyciu składnika LINQ to SQL projektanta.</span><span class="sxs-lookup"><span data-stu-id="08cb2-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="08cb2-154">LINQ do klasy SQL DataContext zostanie również wygenerowany dla każdego składnika LINQ to SQL pliku projektanta dodany do rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="08cb2-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="08cb2-155">Ponieważ firma Microsoft o nazwie naszych LINQ do SQL klasy elementu "NerdDinner" klasy DataContext utworzone zostanie wywołana "NerdDinnerDataContext".</span><span class="sxs-lookup"><span data-stu-id="08cb2-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="08cb2-156">Ta klasa NerdDinnerDataContext jest podstawowy sposób firma Microsoft będzie współpracować z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="08cb2-157">Klasy Nasze NerdDinnerDataContext udostępnia dwie właściwości — "Kolacji" i "RSVPs" - reprezentujących dwóch tabel, które możemy modelowane w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="08cb2-158">Możemy użyć C# do zapisu zapytań LINQ te właściwości zapytania i pobrać obiad i RSVP obiektów z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="08cb2-159">Poniższy kod przedstawia sposób tworzenia wystąpienia obiektu NerdDinnerDataContext i wykonywać zapytania LINQ, aby uzyskać sekwencję kolacji, które występują w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="08cb2-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="08cb2-160">Program Visual Studio udostępnia pełną intellisense podczas pisania zapytań LINQ i obiektów zwróconych z niego są silnie typizowane i obsługiwać intellisense:</span><span class="sxs-lookup"><span data-stu-id="08cb2-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="08cb2-161">Oprócz umożliwienia zapytań dotyczących obiektów obiad i RSVP, NerdDinnerDataContext automatycznie śledzi zmiany możemy następnie obiad i RSVP obiekty, które możemy pobierać za jego pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="08cb2-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="08cb2-162">Tej funkcji można używać łatwo zapisanie zmian w bazie danych — bez konieczności pisania kodu jawne aktualizacji SQL.</span><span class="sxs-lookup"><span data-stu-id="08cb2-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="08cb2-163">Na przykład poniższy kod pokazuje, jak używać zapytania LINQ pobierania pojedynczy obiekt obiad z bazy danych, zaktualizuj dwóch właściwości obiad i następnie zapisać zmiany w bazie danych:</span><span class="sxs-lookup"><span data-stu-id="08cb2-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="08cb2-164">Obiekt NerdDinnerDataContext w kodzie powyżej automatycznie śledzone zmiany właściwości do obiektu obiad, do którego możemy pobrać z niego.</span><span class="sxs-lookup"><span data-stu-id="08cb2-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="08cb2-165">Wywołanego metody "SubmitChanges()", wykona odpowiednie "AKTUALIZUJ" instrukcji SQL do bazy danych, aby utrwalić wstecz zaktualizowane wartości.</span><span class="sxs-lookup"><span data-stu-id="08cb2-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="08cb2-166">Tworzenie klasy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="08cb2-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="08cb2-167">Małych aplikacjach czasami jest wyrażenie zgody na kontrolery pracować bezpośrednio przed składnika LINQ to SQL DataContext klasy, a następnie osadź zapytań LINQ w ramach kontrolerów.</span><span class="sxs-lookup"><span data-stu-id="08cb2-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="08cb2-168">Jako dłuższego aplikacji, to rozwiązanie staje się skomplikowane do utrzymywania i testowania.</span><span class="sxs-lookup"><span data-stu-id="08cb2-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="08cb2-169">Również może prowadzić do nas duplikowania tego samego zapytania LINQ w kilku miejscach.</span><span class="sxs-lookup"><span data-stu-id="08cb2-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="08cb2-170">Użyj wzorca "repository" jest jeden podejście, które mogą ułatwić aplikacje do obsługi i testowania.</span><span class="sxs-lookup"><span data-stu-id="08cb2-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="08cb2-171">Klasa repozytorium pomaga Hermetyzowanie danych zapytań i logikę trwałości i optymalizacji streszczenia szczegóły implementacji trwałości danych z aplikacji.</span><span class="sxs-lookup"><span data-stu-id="08cb2-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="08cb2-172">Oprócz tworzenia czyszczący kodu aplikacji, za pomocą wzorca repozytorium może ułatwić w przyszłości zmienić implementacji magazynu danych, a może pomóc ułatwienia testowania aplikacji bez konieczności rzeczywistych bazy danych jednostki.</span><span class="sxs-lookup"><span data-stu-id="08cb2-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="08cb2-173">Dla aplikacji NerdDinner zdefiniujemy klasy DinnerRepository z poniżej podpisu:</span><span class="sxs-lookup"><span data-stu-id="08cb2-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="08cb2-174">*Uwaga: Dalej w tym rozdziale firma Microsoft będzie wyodrębniania interfejsu IDinnerRepository z tej klasy i Włącz iniekcji zależności z nim naszych kontrolerów. Najpierw jednak zamierzamy uruchomić proste i po prostu pracować bezpośrednio z klasy DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="08cb2-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="08cb2-175">Do implementowania tej klasy, firma Microsoft będzie kliknij prawym przyciskiem myszy na naszych folderu "Modeli" i wybierz polecenie **Add -&gt;nowy element** polecenia menu.</span><span class="sxs-lookup"><span data-stu-id="08cb2-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="08cb2-176">W oknie dialogowym "Dodaj nowy element" możemy wybierz szablon "Class" i "DinnerRepository.cs" do pliku o nazwie:</span><span class="sxs-lookup"><span data-stu-id="08cb2-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="08cb2-177">Następnie możemy wdrożyć klasy Nasze DinnerRespository przy użyciu kodu poniżej:</span><span class="sxs-lookup"><span data-stu-id="08cb2-177">We can then implement our DinnerRespository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="08cb2-178">Pobieranie, aktualizowania, wstawiania i usuwanie za pomocą klasy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="08cb2-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="08cb2-179">Teraz, utworzyliśmy klasy Nasze DinnerRepository Oto kilka przykładów kodu, które wykazują typowych zadań, które firma Microsoft może z nim zrobić:</span><span class="sxs-lookup"><span data-stu-id="08cb2-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="08cb2-180">Przykłady zapytań</span><span class="sxs-lookup"><span data-stu-id="08cb2-180">Querying Examples</span></span>

<span data-ttu-id="08cb2-181">Poniższy kod pobiera jeden obiad, przy użyciu wartości DinnerID:</span><span class="sxs-lookup"><span data-stu-id="08cb2-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>


[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="08cb2-182">Poniższy kod pobiera wszystkie nadchodzących kolacji i pętle nad nimi:</span><span class="sxs-lookup"><span data-stu-id="08cb2-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="08cb2-183">INSERT i Update przykłady</span><span class="sxs-lookup"><span data-stu-id="08cb2-183">Insert and Update Examples</span></span>

<span data-ttu-id="08cb2-184">Poniższy kod pokazuje, dodawanie dwóch nowych kolacji.</span><span class="sxs-lookup"><span data-stu-id="08cb2-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="08cb2-185">Dodatki/zmiany do repozytorium nie są zapisane w bazie danych, dopóki wywołania metody "Zapisz()" na nim.</span><span class="sxs-lookup"><span data-stu-id="08cb2-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="08cb2-186">LINQ do SQL jest automatycznie zawijany, wszystkie zmiany w transakcji bazy danych — tak się zdarzyć, wszystkie zmiany albo żadna z nich podczas zapisywania w naszym repozytorium:</span><span class="sxs-lookup"><span data-stu-id="08cb2-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="08cb2-187">Poniższy kod pobiera istniejący obiekt obiad i modyfikuje dwie właściwości na nim.</span><span class="sxs-lookup"><span data-stu-id="08cb2-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="08cb2-188">Zmiany zostały zastosowane w bazie danych, gdy wywoływana jest metoda "Zapisz()" naszym repozytorium:</span><span class="sxs-lookup"><span data-stu-id="08cb2-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="08cb2-189">Poniższy kod pobiera obiad, a następnie dodaje zaproszenie do niego.</span><span class="sxs-lookup"><span data-stu-id="08cb2-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="08cb2-190">Jest to przy użyciu kolekcji zbędne na obiad utworzony obiekt LINQ do SQL firmie Microsoft (ponieważ istnieje relacja podstawowy klucz/klucz obcy między dwoma w bazie danych).</span><span class="sxs-lookup"><span data-stu-id="08cb2-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="08cb2-191">Ta zmiana jest zachowywane w bazie danych jako nowy wiersz tabeli RSVP po wywołaniu metody "Zapisz()" repozytorium:</span><span class="sxs-lookup"><span data-stu-id="08cb2-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="08cb2-192">Usuń przykładowe</span><span class="sxs-lookup"><span data-stu-id="08cb2-192">Delete Example</span></span>

<span data-ttu-id="08cb2-193">Poniższy kod pobiera istniejący obiekt obiad i dołącza go do usunięcia.</span><span class="sxs-lookup"><span data-stu-id="08cb2-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="08cb2-194">Po wywołaniu metody "Zapisz()" repozytorium go zobowiązuje delete w bazie danych:</span><span class="sxs-lookup"><span data-stu-id="08cb2-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="08cb2-195">Integrowanie sprawdzania poprawności i logiki reguły biznesowej z klasami modelu</span><span class="sxs-lookup"><span data-stu-id="08cb2-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="08cb2-196">Integrowanie sprawdzania poprawności i reguły biznesowej jest kluczowym elementem dowolnej aplikacji, która współdziała z danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="08cb2-197">Sprawdzanie poprawności schematu</span><span class="sxs-lookup"><span data-stu-id="08cb2-197">Schema Validation</span></span>

<span data-ttu-id="08cb2-198">Po zdefiniowaniu klasy modelu przy użyciu składnika LINQ to SQL projektanta typy danych właściwości w modelu danych klasy odpowiadają typów danych w tabeli bazy danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="08cb2-199">Na przykład: Jeśli kolumna "EventDate" w tabeli kolacji jest typu "datetime", klasy modelu danych, które są tworzone w składniku LINQ to SQL jest typu "DateTime" (która jest wbudowane datatype .NET).</span><span class="sxs-lookup"><span data-stu-id="08cb2-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="08cb2-200">Oznacza to, że otrzymasz błędy kompilacji, jeśli próby przypisania liczbą całkowitą lub wartość logiczną do niego z kodu i jego zgłosi błąd automatycznie przy próbie niejawnie przekonwertować typu ciąg nie jest ważna do niego w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="08cb2-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="08cb2-201">LINQ do SQL zostanie automatycznie obsługuje ucieczki wartości SQL dla Ciebie, podczas używania ciągów — co pomaga chronić przed ataki podczas korzystania z niego.</span><span class="sxs-lookup"><span data-stu-id="08cb2-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="08cb2-202">Sprawdzanie poprawności i logiki reguły biznesowej</span><span class="sxs-lookup"><span data-stu-id="08cb2-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="08cb2-203">Sprawdzanie poprawności schematu jest przydatne w pierwszej kolejności, ale jest rzadko wystarczające.</span><span class="sxs-lookup"><span data-stu-id="08cb2-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="08cb2-204">Większość przypadków ze świata rzeczywistego muszą mieć możliwość określenia bardziej zaawansowane funkcje logiki sprawdzania poprawności, które obejmują wiele właściwości, wykonanie kodu i często mają pogłębianie wiedzy na temat stanu modelu (na przykład: jej tworzenia/aktualizacji/usunięte, lub jest w stanie specyficznego dla domeny tak samo, jak "archiwizowane").</span><span class="sxs-lookup"><span data-stu-id="08cb2-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="08cb2-205">Istnieje szereg różnych wzorców i platform, które mogą służyć do definiowania i stosowania reguł sprawdzania poprawności do klasy modeli, a istnieje kilka .NET na podstawie platform tam używane ułatwiające to.</span><span class="sxs-lookup"><span data-stu-id="08cb2-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="08cb2-206">Można użyć niemal żadnej z nich w aplikacji ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="08cb2-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="08cb2-207">Na potrzeby aplikacji NerdDinner użyjemy wzorzec stosunkowo proste i bezpośrednie gdzie uwidaczniamy IsValid właściwości i metody GetRuleViolations() naszych obiad obiektu modelu.</span><span class="sxs-lookup"><span data-stu-id="08cb2-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="08cb2-208">Właściwość IsValid zwraca wartość PRAWDA lub FAŁSZ w zależności od tego, czy wszystkie ważne są reguły sprawdzania poprawności i biznesowych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="08cb2-209">Metoda GetRuleViolations() zwróci listę wszystkich błędów reguły.</span><span class="sxs-lookup"><span data-stu-id="08cb2-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="08cb2-210">Firma Microsoft będzie implementują IsValid i GetRuleViolations() dla modelu obiad przez dodanie "klasy częściowej" do naszej projektu.</span><span class="sxs-lookup"><span data-stu-id="08cb2-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="08cb2-211">Klasy częściowe może służyć do dodawania metod/właściwości/zdarzenia do klasy obsługiwany przez projektanta VS (np. klasa obiad generowane przez składnik LINQ to SQL projektanta) i uniknąć narzędzie z messing z naszego kodu.</span><span class="sxs-lookup"><span data-stu-id="08cb2-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="08cb2-212">Możemy dodać nową klasę częściowe do naszej projektu przez kliknięcie prawym przyciskiem myszy \Models folder, a następnie wybierz polecenie "Dodaj nowy element".</span><span class="sxs-lookup"><span data-stu-id="08cb2-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="08cb2-213">Firma Microsoft następnie wybierz szablon "Class" w oknie dialogowym "Dodaj nowy element" i nadaj mu nazwę Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="08cb2-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="08cb2-214">Kliknięcie przycisku "Dodaj" spowoduje dodanie pliku Dinner.cs do naszej projektu i otwórz go w środowisku IDE.</span><span class="sxs-lookup"><span data-stu-id="08cb2-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="08cb2-215">Firma Microsoft można następnie wdrożyć to rozwiązanie podstawowe reguły/sprawdzanie poprawności wymuszania framework przy użyciu poniższego kodu:</span><span class="sxs-lookup"><span data-stu-id="08cb2-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="08cb2-216">Kilka uwagi dotyczące kodu powyżej:</span><span class="sxs-lookup"><span data-stu-id="08cb2-216">A few notes about the above code:</span></span>

- <span data-ttu-id="08cb2-217">Klasa obiad jest poprzedzona słowem kluczowym "częściowej" — co oznacza kod źródłowy znajdujący się w niej będą połączone z klasy generowane utrzymywane w składniku LINQ to SQL projektanta i skompilowany w jednej klasy.</span><span class="sxs-lookup"><span data-stu-id="08cb2-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="08cb2-218">Klasa RuleViolation jest klasa pomocy, który zostanie dodany do projektu, który pozwala zawierają więcej szczegółowych informacji o naruszenie reguły.</span><span class="sxs-lookup"><span data-stu-id="08cb2-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="08cb2-219">Metoda Dinner.GetRuleViolations() powoduje, że nasze zasady sprawdzania poprawności i business ma zostać obliczone (Firma Microsoft będzie ich wdrażania wkrótce).</span><span class="sxs-lookup"><span data-stu-id="08cb2-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="08cb2-220">Następnie zwraca ponownie sekwencję RuleViolation obiektów, które zawierają więcej szczegółowych informacji o błędach reguły.</span><span class="sxs-lookup"><span data-stu-id="08cb2-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="08cb2-221">Właściwość Dinner.IsValid umożliwia wygodne pomocnika właściwość, która wskazuje, czy obiekt obiad ma żadnych aktywnych RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="08cb2-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="08cb2-222">On aktywne można sprawdzić przez dewelopera przy użyciu obiektu obiad w dowolnym momencie (i nie zgłaszał wyjątku).</span><span class="sxs-lookup"><span data-stu-id="08cb2-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="08cb2-223">Metoda częściowa Dinner.OnValidate() jest haku udostępniający LINQ do SQL umożliwiający powiadamianych w dowolnym momencie obiad obiekt ma zostać utrwalony w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="08cb2-224">Nasze implementacji OnValidate() powyżej zapewnia obiad ma nie RuleViolations, dopóki zostanie zapisane.</span><span class="sxs-lookup"><span data-stu-id="08cb2-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="08cb2-225">Jeśli jest w nieprawidłowym stanie zgłasza wyjątek, który spowoduje, że LINQ do SQL, aby przerwać transakcji.</span><span class="sxs-lookup"><span data-stu-id="08cb2-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="08cb2-226">Metoda ta umożliwia proste platforma, która zostanie zintegrowana, weryfikacji i reguł biznesowych do.</span><span class="sxs-lookup"><span data-stu-id="08cb2-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="08cb2-227">Teraz Dodajmy poniżej reguł do naszej metody GetRuleViolations():</span><span class="sxs-lookup"><span data-stu-id="08cb2-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="08cb2-228">Użyto funkcji "yield return" języka C# do zwrócenia sekwencji żadnych RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="08cb2-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="08cb2-229">Najpierw sprawdza reguły sześciu powyżej wymusić po prostu, że właściwości ciągu na naszych obiad nie może być zerowa lub pusta.</span><span class="sxs-lookup"><span data-stu-id="08cb2-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="08cb2-230">Ostatnia reguła jest nieco bardziej interesujące i wywołania metody pomocniczej PhoneValidator.IsValidNumber(), że można dodać do naszej projektu, aby sprawdzić, czy ContactPhone number format dopasowań obiad w kraju.</span><span class="sxs-lookup"><span data-stu-id="08cb2-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="08cb2-231">Możemy użyć. Obsługa wyrażenia regularnego przez sieć do implementacji sprawdzania poprawności telefoniczna pomoc techniczna.</span><span class="sxs-lookup"><span data-stu-id="08cb2-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="08cb2-232">Poniżej przedstawiono prosty implementacji PhoneValidator, które można dodać do naszych projektu, który pozwala na dodawanie kontroli wzorzec wyrażenia regularnego określonego kraju:</span><span class="sxs-lookup"><span data-stu-id="08cb2-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="08cb2-233">Obsługa weryfikacji i naruszeń logika biznesowa</span><span class="sxs-lookup"><span data-stu-id="08cb2-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="08cb2-234">Teraz, po dodaniu powyżej sprawdzania poprawności i business kodu reguły, spróbujemy można utworzyć lub zaktualizować obiad za każdym razem, nasze zasady logikę weryfikacji będą oceniane, a wymuszane.</span><span class="sxs-lookup"><span data-stu-id="08cb2-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="08cb2-235">Programiści mogą pisać kod jak poniżej, aby aktywnie ustalić, czy obiekt obiad jest prawidłowy i pobrać listy wszystkich naruszeń w nim bez podnoszenia wszelkie wyjątki:</span><span class="sxs-lookup"><span data-stu-id="08cb2-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="08cb2-236">Firma Microsoft podejmie próbę zapisania obiad w nieprawidłowym stanie, gdy firma Microsoft wywołać metody Zapisz() DinnerRepository zostanie zgłoszony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="08cb2-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="08cb2-237">Dzieje się tak, ponieważ przed zapisaniem zmian obiad i dodano kod do Dinner.OnValidate(), aby zgłosić wyjątek, jeśli istnieje wszelkie naruszenia reguły w obiad LINQ do SQL automatycznie wywołuje metody częściowej naszych Dinner.OnValidate().</span><span class="sxs-lookup"><span data-stu-id="08cb2-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="08cb2-238">Firma Microsoft przechwycić tego wyjątku i reagować i odbierać listę naruszeń ustalenie:</span><span class="sxs-lookup"><span data-stu-id="08cb2-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="08cb2-239">Ponieważ naszych reguł sprawdzania poprawności i business zostaną zaimplementowane w naszym warstwy modelu, a nie w ramach warstwy interfejsu użytkownika, będzie można zastosować i używane we wszystkich scenariuszach w naszej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="08cb2-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="08cb2-240">Firma Microsoft później zmienić lub dodać reguły biznesowe i wszystkie kod działa z naszych obiektów obiad uwzględnić je.</span><span class="sxs-lookup"><span data-stu-id="08cb2-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="08cb2-241">Mając możliwość zmiany reguły biznesowe w jednym miejscu, bez konieczności zmiany ripple w całej aplikacji i logika interfejsu użytkownika jest znak dobrze napisanych aplikacji i korzyści, które platforma MVC pomaga zachęca.</span><span class="sxs-lookup"><span data-stu-id="08cb2-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="08cb2-242">Następny krok</span><span class="sxs-lookup"><span data-stu-id="08cb2-242">Next Step</span></span>

<span data-ttu-id="08cb2-243">Mamy teraz modelu, który możemy użyć zarówno zapytania i zaktualizować naszej bazie danych.</span><span class="sxs-lookup"><span data-stu-id="08cb2-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="08cb2-244">Teraz Dodajmy niektóre kontrolery i widoki do projektu, który firma Microsoft może wykorzystać do tworzenia obsługi interfejsu użytkownika HTML wokół niego.</span><span class="sxs-lookup"><span data-stu-id="08cb2-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="08cb2-245">[Poprzednie](create-a-database.md)
[dalej](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="08cb2-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
