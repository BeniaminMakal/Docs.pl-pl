---
uid: signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
title: 'Samouczek: Serwer emisji z SignalR 2 | Dokumentacja firmy Microsoft'
author: tdykstra
description: "W tym samouczku przedstawiono sposób tworzenia aplikacji sieci web, który używa 2 SignalR platformy ASP.NET w celu zapewnienia funkcji emisji serwera. Emisja serwera oznacza, że commun..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/13/2014
ms.topic: article
ms.assetid: 1568247f-60b5-4eca-96e0-e661fbb2b273
ms.technology: dotnet-signalr
ms.prod: .net-framework
msc.legacyurl: /signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 98a7ce4991d58181177cf56976888e9fd1526987
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/24/2018
---
<a name="tutorial-server-broadcast-with-signalr-2"></a><span data-ttu-id="d509f-104">Samouczek: Serwer emisji z SignalR 2</span><span class="sxs-lookup"><span data-stu-id="d509f-104">Tutorial: Server Broadcast with SignalR 2</span></span>
====================
<span data-ttu-id="d509f-105">przez [Dykstra Tomasz](https://github.com/tdykstra), [FitzMacken niestandardowy](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="d509f-105">by [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="d509f-106">W tym samouczku przedstawiono sposób tworzenia aplikacji sieci web, który używa 2 SignalR platformy ASP.NET w celu zapewnienia funkcji emisji serwera.</span><span class="sxs-lookup"><span data-stu-id="d509f-106">This tutorial shows how to create a web application that uses ASP.NET SignalR 2 to provide server broadcast functionality.</span></span> <span data-ttu-id="d509f-107">Emisja serwera oznacza, że komunikacji klientów są inicjowane przez serwer.</span><span class="sxs-lookup"><span data-stu-id="d509f-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="d509f-108">Ten scenariusz wymaga różne podejścia programowania niż peer-to-peer scenariuszy, takich jak aplikacje rozmów, w których komunikacji klientów są inicjowane przez jedną lub więcej klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="d509f-109">Aplikacji, które zostaną utworzone w tym samouczku symuluje giełdowych typowy scenariusz emisji funkcje serwera.</span><span class="sxs-lookup"><span data-stu-id="d509f-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="d509f-110">W tym temacie pierwotnie zapisał Patrick Fletcher.</span><span class="sxs-lookup"><span data-stu-id="d509f-110">This topic was originally written by Patrick Fletcher.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="d509f-111">Używane w samouczku wersje oprogramowania</span><span class="sxs-lookup"><span data-stu-id="d509f-111">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="d509f-112">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="d509f-112">Visual Studio 2013</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - <span data-ttu-id="d509f-113">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="d509f-113">.NET 4.5</span></span>
> - <span data-ttu-id="d509f-114">SignalR w wersji 2</span><span class="sxs-lookup"><span data-stu-id="d509f-114">SignalR version 2</span></span>
>   
> 
> 
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a><span data-ttu-id="d509f-115">Z tego samouczka przy użyciu programu Visual Studio 2012</span><span class="sxs-lookup"><span data-stu-id="d509f-115">Using Visual Studio 2012 with this tutorial</span></span>
> 
> 
> <span data-ttu-id="d509f-116">Aby używać programu Visual Studio 2012 z tego samouczka, wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="d509f-116">To use Visual Studio 2012 with this tutorial, do the following:</span></span>
> 
> - <span data-ttu-id="d509f-117">Aktualizacja Twojego [Menedżera pakietów](http://docs.nuget.org/docs/start-here/installing-nuget) do najnowszej wersji.</span><span class="sxs-lookup"><span data-stu-id="d509f-117">Update your [Package Manager](http://docs.nuget.org/docs/start-here/installing-nuget) to the latest version.</span></span>
> - <span data-ttu-id="d509f-118">Zainstaluj [sieci Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span><span class="sxs-lookup"><span data-stu-id="d509f-118">Install the [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span></span>
> - <span data-ttu-id="d509f-119">Instalator platformy sieci Web, wyszukiwanie i instalowanie **ASP.NET i 2013.1 narzędzia sieci Web dla programu Visual Studio 2012**.</span><span class="sxs-lookup"><span data-stu-id="d509f-119">In the Web Platform Installer, search for and install **ASP.NET and Web Tools 2013.1 for Visual Studio 2012**.</span></span> <span data-ttu-id="d509f-120">Spowoduje to zainstalowanie szablony programu Visual Studio dla biblioteki SignalR klas takich jak **Centrum**.</span><span class="sxs-lookup"><span data-stu-id="d509f-120">This will install Visual Studio templates for SignalR classes such as **Hub**.</span></span>
> - <span data-ttu-id="d509f-121">Niektóre szablony (takich jak **klasy początkowej OWIN**) nie są dostępne; w tym przypadku powinien użyć pliku klasy.</span><span class="sxs-lookup"><span data-stu-id="d509f-121">Some templates (such as **OWIN Startup Class**) will not be available; for these, use a Class file instead.</span></span>
> 
> 
> ## <a name="tutorial-versions"></a><span data-ttu-id="d509f-122">Samouczek wersji</span><span class="sxs-lookup"><span data-stu-id="d509f-122">Tutorial Versions</span></span>
> 
> <span data-ttu-id="d509f-123">Aby uzyskać informacje dotyczące starszych wersji biblioteki signalr, zobacz [starsze wersje biblioteki SignalR](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="d509f-123">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
> 
> ## <a name="questions-and-comments"></a><span data-ttu-id="d509f-124">Pytania i komentarze</span><span class="sxs-lookup"><span data-stu-id="d509f-124">Questions and comments</span></span>
> 
> <span data-ttu-id="d509f-125">Wystaw opinię na jak zbędne tego samouczka i jakie firma Microsoft może poprawić w komentarze u dołu strony.</span><span class="sxs-lookup"><span data-stu-id="d509f-125">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="d509f-126">Jeśli masz pytania, które nie są bezpośrednio związane z tego samouczka możesz zamieścić je do [forum ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) lub [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="d509f-126">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>


## <a name="overview"></a><span data-ttu-id="d509f-127">Omówienie</span><span class="sxs-lookup"><span data-stu-id="d509f-127">Overview</span></span>

<span data-ttu-id="d509f-128">W tym samouczku będzie utworzyć aplikację giełdowych reprezentatywne aplikacji w czasie rzeczywistym, w których chcesz okresowo "push", lub emisji, aby wszyscy połączeni klienci powiadomienia z serwera.</span><span class="sxs-lookup"><span data-stu-id="d509f-128">In this tutorial, you'll create a stock ticker application that is representative of real-time applications in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span> <span data-ttu-id="d509f-129">W pierwszej części tego samouczka utworzysz uproszczonej wersji tej aplikacji od początku.</span><span class="sxs-lookup"><span data-stu-id="d509f-129">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="d509f-130">W pozostałej części tego samouczka zostanie instalowanie pakietu NuGet, który zawiera dodatkowe funkcje oraz przejrzeć kod dla tych funkcji.</span><span class="sxs-lookup"><span data-stu-id="d509f-130">In the remainder of the tutorial, you'll install a NuGet package that contains additional features, and review the code for those features.</span></span>

<span data-ttu-id="d509f-131">Aplikacja, która będzie kompilacji w pierwszej części tego samouczka Wyświetla siatkę z danych podstawowych.</span><span class="sxs-lookup"><span data-stu-id="d509f-131">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Wersja początkowa StockTicker](tutorial-server-broadcast-with-signalr/_static/image1.png)

<span data-ttu-id="d509f-133">Okresowo serwer losowo aktualizuje giełdowych i wypychanie aktualizacji do wszystkich połączonych klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-133">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="d509f-134">W przeglądarce liczby lub symbole w **zmienić** i  **%**  kolumn dynamicznej zmiany w odpowiedzi na powiadomienia z serwera.</span><span class="sxs-lookup"><span data-stu-id="d509f-134">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="d509f-135">Po otwarciu przeglądarki dodatkowych dla tego samego adresu URL, wszystkie one Pokaż tych samych danych i zmian w danych jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="d509f-135">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="d509f-136">Ten samouczek zawiera następujące sekcje:</span><span class="sxs-lookup"><span data-stu-id="d509f-136">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="d509f-137">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="d509f-137">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="d509f-138">Tworzenie projektu</span><span class="sxs-lookup"><span data-stu-id="d509f-138">Create the project</span></span>](#createproject)
- [<span data-ttu-id="d509f-139">Ustaw kod serwera</span><span class="sxs-lookup"><span data-stu-id="d509f-139">Set up the server code</span></span>](#server)
- [<span data-ttu-id="d509f-140">Ustaw kod klienta</span><span class="sxs-lookup"><span data-stu-id="d509f-140">Set up the client code</span></span>](#client)
- [<span data-ttu-id="d509f-141">Testowanie aplikacji</span><span class="sxs-lookup"><span data-stu-id="d509f-141">Test the application</span></span>](#test)
- [<span data-ttu-id="d509f-142">Włączanie rejestrowania</span><span class="sxs-lookup"><span data-stu-id="d509f-142">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="d509f-143">Instalowanie i przejrzeć pełny przykład StockTicker</span><span class="sxs-lookup"><span data-stu-id="d509f-143">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="d509f-144">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="d509f-144">Next steps</span></span>](#nextsteps)

<span data-ttu-id="d509f-145">[Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) pakiet NuGet instaluje przykładowej symulowane aplikacji giełdowych w projektu programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d509f-145">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span>

> [!NOTE]
> <span data-ttu-id="d509f-146">Jeśli nie chcesz kroków tworzenia aplikacji, można zainstalować pakiet SignalR.Sample w nowym projekcie pusta aplikacja sieci Web platformy ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d509f-146">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new Empty ASP.NET Web Application project.</span></span> <span data-ttu-id="d509f-147">Jeśli zainstalowano pakiet NuGet bez wykonywania czynności w tym samouczku **musi postępuj zgodnie z instrukcjami plik readme.txt**.</span><span class="sxs-lookup"><span data-stu-id="d509f-147">If you install the NuGet package without performing the steps in this tutorial, **you must follow the instructions in the readme.txt file**.</span></span> <span data-ttu-id="d509f-148">Aby uruchomić pakiet, należy dodać klasę początkową OWIN, który wywołuje metodę ConfigureSignalR w zainstalowanym pakietem.</span><span class="sxs-lookup"><span data-stu-id="d509f-148">To run the package you need to add an OWIN startup class which calls the ConfigureSignalR method in the installed package.</span></span> <span data-ttu-id="d509f-149">Zostanie wyświetlony błąd, jeśli nie dodasz klasy początkowej OWIN.</span><span class="sxs-lookup"><span data-stu-id="d509f-149">You will receive an error if you do not add the OWIN startup class.</span></span>


<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="d509f-150">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="d509f-150">Prerequisites</span></span>

<span data-ttu-id="d509f-151">Przed rozpoczęciem upewnij się, że masz program Visual Studio 2013 zainstalowany na tym komputerze.</span><span class="sxs-lookup"><span data-stu-id="d509f-151">Before you start, make sure that you have Visual Studio 2013 installed on your computer.</span></span> <span data-ttu-id="d509f-152">Jeśli nie masz programu Visual Studio, zobacz [pobiera ASP.NET](https://www.asp.net/downloads) uzyskać bezpłatne Visual Studio 2013 Express.</span><span class="sxs-lookup"><span data-stu-id="d509f-152">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2013 Express.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="d509f-153">Utwórz projekt</span><span class="sxs-lookup"><span data-stu-id="d509f-153">Create the project</span></span>

1. <span data-ttu-id="d509f-154">Z **pliku** menu, kliknij przycisk **nowy projekt**.</span><span class="sxs-lookup"><span data-stu-id="d509f-154">From the **File** menu, click **New Project**.</span></span>
2. <span data-ttu-id="d509f-155">W **nowy projekt** okna dialogowego rozwiń **C#** w obszarze **szablony** i wybierz **Web**.</span><span class="sxs-lookup"><span data-stu-id="d509f-155">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="d509f-156">Wybierz **pusta aplikacja sieci Web ASP.NET** szablonu, nazwy projektu *SignalR.StockTicker*i kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="d509f-156">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Okno dialogowe Nowy projekt](tutorial-server-broadcast-with-signalr/_static/image2.png)
4. <span data-ttu-id="d509f-158">W **ASP.NET nowe** okno projektu, pozostaw **pusty** zaznaczone, a następnie kliknij przycisk **tworzenia projektu**.</span><span class="sxs-lookup"><span data-stu-id="d509f-158">In the **New ASP.NET** Project window, leave **Empty** selected and click **Create Project**.</span></span>

    ![Okno dialogowe Nowy projekt ASP](tutorial-server-broadcast-with-signalr/_static/image3.png)

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="d509f-160">Ustaw kod serwera</span><span class="sxs-lookup"><span data-stu-id="d509f-160">Set up the server code</span></span>

<span data-ttu-id="d509f-161">W tej sekcji służy do konfigurowania kodu, który jest uruchamiany na serwerze.</span><span class="sxs-lookup"><span data-stu-id="d509f-161">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="d509f-162">Tworzenie klasy zasobów</span><span class="sxs-lookup"><span data-stu-id="d509f-162">Create the Stock class</span></span>

<span data-ttu-id="d509f-163">Rozpocznij poprzez utworzenie klasy modelu zasobu, który ma być używany do przechowywania i transmitowania informacji na temat zasobu.</span><span class="sxs-lookup"><span data-stu-id="d509f-163">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="d509f-164">Utwórz nowy plik klasy w folderze projektu, nadaj jej nazwę *Stock.cs*, a następnie Zastąp kod szablonu z następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="d509f-164">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample1.cs)]

    <span data-ttu-id="d509f-165">Dwie właściwości, które zostaną ustawione podczas tworzenia zasobów są symbolu (na przykład MSFT dla firmy Microsoft) i cenę.</span><span class="sxs-lookup"><span data-stu-id="d509f-165">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="d509f-166">Inne właściwości zależą od tego, jak i kiedy ustawić cenę.</span><span class="sxs-lookup"><span data-stu-id="d509f-166">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="d509f-167">Ustaw cen, po raz pierwszy wartość pobiera propagowane do DayOpen.</span><span class="sxs-lookup"><span data-stu-id="d509f-167">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="d509f-168">Kolejne czasu ustawić cen, zmiany i wartości właściwości PercentChange są obliczane w oparciu różnica między ceny i DayOpen.</span><span class="sxs-lookup"><span data-stu-id="d509f-168">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="d509f-169">Tworzenie klasy StockTicker i StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="d509f-169">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="d509f-170">Za pomocą interfejsu API koncentratora SignalR będzie obsługiwać interakcji z serwera do klienta.</span><span class="sxs-lookup"><span data-stu-id="d509f-170">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="d509f-171">Klasa StockTickerHub, która jest pochodną klasy koncentratora SignalR będzie obsługiwać odbieranie połączeń i wywołania metody od klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-171">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="d509f-172">Należy również Obsługa danych giełdowych i uruchom obiekt czasomierza okresowo wyzwalanie aktualizacji cen, niezależnie od połączeń klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-172">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="d509f-173">Nie można umieścić te funkcje w klasie Centrum, ponieważ przejściowej wystąpień koncentratorów.</span><span class="sxs-lookup"><span data-stu-id="d509f-173">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="d509f-174">Wystąpienie klasy koncentratora jest tworzona dla każdej operacji koncentratora, takie jak połączenia i połączeń z klienta do serwera.</span><span class="sxs-lookup"><span data-stu-id="d509f-174">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="d509f-175">Dlatego mechanizm, który przechowuje dane zapasów, aktualizacji ceny i emituje aktualizacji cen musi działać w oddzielnych klasy, która będzie nazwa StockTicker.</span><span class="sxs-lookup"><span data-stu-id="d509f-175">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Emisja z StockTicker](tutorial-server-broadcast-with-signalr/_static/image5.png)

<span data-ttu-id="d509f-177">Mają tylko jedno wystąpienie klasy StockTicker, aby uruchomić na serwerze, więc musisz skonfigurować odwołanie z każdego wystąpienia StockTickerHub na pojedyncze wystąpienie StockTicker.</span><span class="sxs-lookup"><span data-stu-id="d509f-177">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="d509f-178">Klasa StockTicker ma mieć możliwość emisji do klientów, ponieważ ma standardowych danych i wyzwala aktualizacje, ale StockTicker nie jest klasą koncentratora.</span><span class="sxs-lookup"><span data-stu-id="d509f-178">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="d509f-179">W związku z tym klasy StockTicker musi pobrać odwołanie do obiektu kontekstu połączenia koncentratora SignalR.</span><span class="sxs-lookup"><span data-stu-id="d509f-179">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="d509f-180">Następnie można użyć obiektu context połączenia SignalR do emisji do klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-180">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="d509f-181">W **Eksploratora rozwiązań**, kliknij prawym przyciskiem myszy projekt i kliknij przycisk **Dodaj | Klasy koncentratora SignalR (v2)**.</span><span class="sxs-lookup"><span data-stu-id="d509f-181">In **Solution Explorer**, right-click the project and click **Add | SignalR Hub Class (v2)**.</span></span>
2. <span data-ttu-id="d509f-182">Nazwa nowego centrum *StockTickerHub.cs*, a następnie kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="d509f-182">Name the new hub *StockTickerHub.cs*, and then click **Add**.</span></span> <span data-ttu-id="d509f-183">Pakiety SignalR NuGet zostaną dodane do projektu.</span><span class="sxs-lookup"><span data-stu-id="d509f-183">SignalR NuGet packages will be added to your project.</span></span>
3. <span data-ttu-id="d509f-184">Zastąp kod szablonu z następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="d509f-184">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample2.cs)]

    <span data-ttu-id="d509f-185">[Centrum](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) klasa jest używana do definiowania metod klientów można wywołać na serwerze.</span><span class="sxs-lookup"><span data-stu-id="d509f-185">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="d509f-186">Definiujesz jednej metody: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="d509f-186">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="d509f-187">Gdy klient początkowo łączy się z serwerem, wywoła tę metodę, aby uzyskać listę wszystkich zasobów z ich bieżącej ceny.</span><span class="sxs-lookup"><span data-stu-id="d509f-187">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="d509f-188">Metody można synchronicznie wykonać i zwracać `IEnumerable<Stock>` ponieważ zwraca dane z pamięci.</span><span class="sxs-lookup"><span data-stu-id="d509f-188">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="d509f-189">Jeśli metoda musiały uzyskać danych przy wykonywaniu czegoś, co wymagałoby oczekiwania, takich jak wyszukiwania w bazie danych lub wywołania usługi sieci web, należy określić `Task<IEnumerable<Stock>>` jako wartości zwracane, aby włączyć przetwarzanie asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="d509f-189">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="d509f-190">Aby uzyskać więcej informacji, zobacz [ASP.NET SignalR koncentratory interfejsu API przewodnik - Server - kiedy asynchroniczne](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span><span class="sxs-lookup"><span data-stu-id="d509f-190">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span></span>

    <span data-ttu-id="d509f-191">Atrybut HubName Określa, jak koncentratora zostanie dodane odwołanie w kodzie JavaScript na kliencie.</span><span class="sxs-lookup"><span data-stu-id="d509f-191">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="d509f-192">Domyślna nazwa na kliencie, jeśli nie możesz użyć tego atrybutu to wersja formatu — z uwzględnieniem wielkości liter nazwy klasy, która w tym przypadku będzie stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="d509f-192">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="d509f-193">Jak można zauważyć później podczas tworzenia klasy StockTicker, pojedyncze wystąpienie tej klasy jest tworzony w jego właściwości statycznej wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="d509f-193">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="d509f-194">Pojedyncze wystąpienie StockTicker pozostaje w pamięci bez względu na liczbę klientów Połącz lub Rozłącz, czy to wystąpienie jest metoda GetAllStocks używa do zwracania bieżącej standardowych informacji.</span><span class="sxs-lookup"><span data-stu-id="d509f-194">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
4. <span data-ttu-id="d509f-195">Utwórz nowy plik klasy w folderze projektu, nadaj jej nazwę *StockTicker.cs*, a następnie Zastąp kod szablonu z następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="d509f-195">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample3.cs)]

    <span data-ttu-id="d509f-196">Ponieważ wiele wątków będzie działać to samo wystąpienie elementu StockTicker kodu, klasa StockTicker musi być threadsafe.</span><span class="sxs-lookup"><span data-stu-id="d509f-196">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="d509f-197">Przechowywanie pojedyncze wystąpienie w polu statycznym</span><span class="sxs-lookup"><span data-stu-id="d509f-197">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="d509f-198">Kod inicjuje statycznych \_pole wystąpienia, aby utworzyć kopię zapasową właściwości wystąpienia przy użyciu wystąpienia klasy, a to jest tylko wystąpienia klasy, które można utworzyć, ponieważ Konstruktor jest oznaczony jako prywatny.</span><span class="sxs-lookup"><span data-stu-id="d509f-198">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="d509f-199">[Inicjalizacja z opóźnieniem](https://msdn.microsoft.com/library/dd997286.aspx) służy do \_pola wystąpienia nie ze względu na wydajność, ale aby upewnić się, że tworzenie wystąpienia jest threadsafe.</span><span class="sxs-lookup"><span data-stu-id="d509f-199">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample4.cs)]

    <span data-ttu-id="d509f-200">Zawsze, gdy klient nawiąże połączenie z serwerem, nowe wystąpienie klasy StockTickerHub działa w oddzielnym wątku pobiera pojedyncze wystąpienie StockTicker z StockTicker.Instance właściwości statycznej, jak przedstawiono wcześniej w klasie StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="d509f-200">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="d509f-201">Przechowywanie danych giełdowych w obiekt ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="d509f-201">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="d509f-202">Konstruktor inicjuje \_kolekcji zasobów z niektórymi przykładowych danych podstawowych i GetAllStocks zwraca zasobów.</span><span class="sxs-lookup"><span data-stu-id="d509f-202">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="d509f-203">Jak przedstawiono wcześniej, to kolekcja zasobów z kolei jest zwracany przez StockTickerHub.GetAllStocks, która to metoda serwera w klasie koncentratora, której klienci mogą wywoływać.</span><span class="sxs-lookup"><span data-stu-id="d509f-203">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample5.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample6.cs)]

    <span data-ttu-id="d509f-204">Kolekcja zasobów została zdefiniowana jako [obiekt ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) typu dla bezpieczeństwa wątków.</span><span class="sxs-lookup"><span data-stu-id="d509f-204">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="d509f-205">Alternatywnie, można użyć [słownika](https://msdn.microsoft.com/library/xfhwa508.aspx) obiektu i jawnie zablokować słownik po wprowadzeniu zmian do niego.</span><span class="sxs-lookup"><span data-stu-id="d509f-205">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="d509f-206">Ta przykładowa aplikacja jest OK do przechowywania danych aplikacji w pamięci i utratę danych, jeśli wystąpienie StockTicker zostanie usunięty.</span><span class="sxs-lookup"><span data-stu-id="d509f-206">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="d509f-207">W rzeczywistej aplikacji będzie działać z magazynem danych wewnętrznych, takich jak bazy danych.</span><span class="sxs-lookup"><span data-stu-id="d509f-207">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="d509f-208">Okresowo aktualizacji cen akcji</span><span class="sxs-lookup"><span data-stu-id="d509f-208">Periodically updating stock prices</span></span>

    <span data-ttu-id="d509f-209">Obiekt czasomierza, który okresowo wywołuje metody, które aktualizują giełdowych wyrywkowo uruchamiania konstruktora.</span><span class="sxs-lookup"><span data-stu-id="d509f-209">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample7.cs)]

    <span data-ttu-id="d509f-210">UpdateStockPrices jest wywoływana przez czasomierz, który przekazuje wartość null w parametrze state.</span><span class="sxs-lookup"><span data-stu-id="d509f-210">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="d509f-211">Przed zaktualizowaniem ceny, blokada jest pobierany podczas \_updateStockPricesLock obiektu.</span><span class="sxs-lookup"><span data-stu-id="d509f-211">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="d509f-212">Kod sprawdza, czy inny wątek już aktualizuje ceny, a następnie wywołuje TryUpdateStockPrice dla każdej akcji na liście.</span><span class="sxs-lookup"><span data-stu-id="d509f-212">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="d509f-213">Metoda TryUpdateStockPrice decyduje o tym, czy chcesz zmienić giełdowy i ile je zmienić.</span><span class="sxs-lookup"><span data-stu-id="d509f-213">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="d509f-214">Zmiana giełdowy BroadcastStockPrice jest wywoływana emisji zmiany giełdowy wszyscy połączeni klienci.</span><span class="sxs-lookup"><span data-stu-id="d509f-214">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="d509f-215">\_UpdatingStockPrices flaga jest oznaczony jako [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) w celu zapewnienia threadsafe do niego dostęp.</span><span class="sxs-lookup"><span data-stu-id="d509f-215">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample8.cs)]

    <span data-ttu-id="d509f-216">W rzeczywistej aplikacji metoda TryUpdateStockPrice spowodowałoby wywołanie usługi sieci web w celu wyszukania ceny; w tym kodzie użyto do zmiany losowo generator liczb losowych.</span><span class="sxs-lookup"><span data-stu-id="d509f-216">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="d509f-217">Uzyskanie kontekstu SignalR, dzięki czemu klasy StockTicker można emisji do klientów</span><span class="sxs-lookup"><span data-stu-id="d509f-217">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="d509f-218">Ponieważ zmiany ceny tutaj pochodzą z obiektu StockTicker, to obiekt, który musi wywołać metodę updateStockPrice na wszystkich podłączonych klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-218">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="d509f-219">W klasie Centrum masz interfejs API do wywoływania metody klienta, ale StockTicker nie pochodzi od klasy koncentratora i nie ma odwołania do dowolnego obiektu koncentratora.</span><span class="sxs-lookup"><span data-stu-id="d509f-219">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="d509f-220">W związku z tym w celu emisji do połączonych klientów, klasa StockTicker musi pobrać wystąpienia kontekstu SignalR dla klasy StockTickerHub i używać go do wywołania metody na klientach.</span><span class="sxs-lookup"><span data-stu-id="d509f-220">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="d509f-221">Ten kod pobiera odwołanie do kontekstu SignalR, podczas tworzenia pojedyncze wystąpienie klasy przebiegi, które odwołują się do konstruktora, i konstruktora umieszczenie go we właściwości klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-221">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="d509f-222">Istnieją dwie przyczyny, dlaczego chcesz pobrać kontekstu tylko raz: uzyskanie kontekstu jest kosztowna operacja, i pobierania ich raz zapewnia zachowywanie zamierzonej kolejności komunikatów wysyłanych do klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-222">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample9.cs)]

    <span data-ttu-id="d509f-223">Pobieranie właściwości klientów kontekstu i umieść go we właściwości StockTickerClient umożliwia pisanie kodu do wywołania metody klienta, który wygląda tak samo jak w klasie koncentratora.</span><span class="sxs-lookup"><span data-stu-id="d509f-223">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="d509f-224">Na przykład aby emisji do wszystkich klientów należy napisać Clients.All.updateStockPrice(stock).</span><span class="sxs-lookup"><span data-stu-id="d509f-224">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="d509f-225">Metoda updateStockPrice wywołujesz BroadcastStockPrice nie istnieje jeszcze; można będzie dodać później podczas pisania kodu, który działa na kliencie.</span><span class="sxs-lookup"><span data-stu-id="d509f-225">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="d509f-226">Ponieważ Clients.All jest dynamiczny, co oznacza, że wyrażenie, które zostanie obliczone w czasie wykonywania mogą odwoływać się do updateStockPrice tutaj.</span><span class="sxs-lookup"><span data-stu-id="d509f-226">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="d509f-227">Gdy wykonuje wywołanie tej metody, SignalR wysyła nazwę metody i wartość parametru do klienta, a jeśli klient ma metodę o nazwie updateStockPrice, zostanie wywołana metoda i wartość parametru zostaną przekazane do niej.</span><span class="sxs-lookup"><span data-stu-id="d509f-227">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="d509f-228">Clients.All oznacza wysłać do wszystkich klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-228">Clients.All means send to all clients.</span></span> <span data-ttu-id="d509f-229">SignalR udostępnia inne opcje, aby określić klientów lub grupy klientów do wysyłania do.</span><span class="sxs-lookup"><span data-stu-id="d509f-229">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="d509f-230">Aby uzyskać więcej informacji, zobacz [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="d509f-230">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="d509f-231">Zarejestruj trasy SignalR</span><span class="sxs-lookup"><span data-stu-id="d509f-231">Register the SignalR route</span></span>

<span data-ttu-id="d509f-232">Serwer musi znać adres URL, który można przechwytywać i bezpośrednio do SignalR.</span><span class="sxs-lookup"><span data-stu-id="d509f-232">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="d509f-233">Czy, który zostanie dodany i klasy początkowej OWIN.</span><span class="sxs-lookup"><span data-stu-id="d509f-233">To do that you'll add and OWIN startup class.</span></span>

1. <span data-ttu-id="d509f-234">W **Eksploratora rozwiązań**, kliknij prawym przyciskiem myszy projekt, a następnie kliknij przycisk **Dodaj | Klasy początkowej OWIN**.</span><span class="sxs-lookup"><span data-stu-id="d509f-234">In **Solution Explorer**, right-click the project, and then click **Add | OWIN Startup Class**.</span></span> <span data-ttu-id="d509f-235">Nazwa klasy **Startup.cs**.</span><span class="sxs-lookup"><span data-stu-id="d509f-235">Name the class **Startup.cs**.</span></span>
2. <span data-ttu-id="d509f-236">Zastąp kod w **Startup.cs** następującym kodem.</span><span class="sxs-lookup"><span data-stu-id="d509f-236">Replace the code in **Startup.cs** with the following.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample10.cs)]

<span data-ttu-id="d509f-237">Ukończono konfigurowanie kod serwera.</span><span class="sxs-lookup"><span data-stu-id="d509f-237">You have now completed setting up the server code.</span></span> <span data-ttu-id="d509f-238">W następnej sekcji należy skonfigurować klienta.</span><span class="sxs-lookup"><span data-stu-id="d509f-238">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="d509f-239">Ustaw kod klienta</span><span class="sxs-lookup"><span data-stu-id="d509f-239">Set up the client code</span></span>

1. <span data-ttu-id="d509f-240">Utwórz nowy plik HTML w folderze projektu i nadaj mu nazwę *StockTicker.html*.</span><span class="sxs-lookup"><span data-stu-id="d509f-240">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="d509f-241">Zastąp kod szablonu z następującym kodem.</span><span class="sxs-lookup"><span data-stu-id="d509f-241">Replace the template code with the following code.</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample11.html)]

    <span data-ttu-id="d509f-242">Kod HTML tworzy tabelę z kolumnami 5, wiersz nagłówka i wierszem danych z jednej komórce, które obejmuje wszystkie kolumny 5.</span><span class="sxs-lookup"><span data-stu-id="d509f-242">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="d509f-243">Wiersz danych wyświetla "Trwa ładowanie..." i będą wyświetlane tylko na chwilę podczas uruchamiania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d509f-243">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="d509f-244">Kod JavaScript spowoduje usunięcie tego wiersza i Dodaj w jego miejscu wierszy z podstawowe dane pobrane z serwera.</span><span class="sxs-lookup"><span data-stu-id="d509f-244">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="d509f-245">Tagi skryptu Określ plik skryptu jQuery, plik skryptu SignalR core pliku skryptu proxy SignalR i StockTicker plik skryptu, który zostanie utworzony później.</span><span class="sxs-lookup"><span data-stu-id="d509f-245">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="d509f-246">SignalR pliku skryptu proxy, który określa adres URL "/ signalr/hubs", jest generowane dynamicznie i określa metody serwera proxy dla metod w klasie koncentratora, w tym przypadku StockTickerHub.GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="d509f-246">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="d509f-247">Jeśli wolisz, możesz wygenerować plik JavaScript ręcznie przy użyciu [narzędzia SignalR](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) i Wyłącz tworzenie dynamicznych plików w wywołaniu metody MapHubs.</span><span class="sxs-lookup"><span data-stu-id="d509f-247">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
 > <span data-ttu-id="d509f-248">Upewnij się, że plik JavaScript odwołania w *StockTicker.html* są poprawne.</span><span class="sxs-lookup"><span data-stu-id="d509f-248">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="d509f-249">Oznacza to, upewnij się, że wersja jQuery w Twojej tagu skryptu (1.10.2 w przykładzie) jest taka sama jak wersja jQuery do projektu *skryptów* folderu i upewnij się, że wersja SignalR w Twojej tag skryptu jest taka sama jak SignalR Wersja do projektu *skryptów* folderu.</span><span class="sxs-lookup"><span data-stu-id="d509f-249">That is, make sure that the jQuery version in your script tag (1.10.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="d509f-250">Zmiana nazw plików w tagach skryptów, jeśli to konieczne.</span><span class="sxs-lookup"><span data-stu-id="d509f-250">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="d509f-251">W **Eksploratora rozwiązań**, kliknij prawym przyciskiem myszy *StockTicker.html*, a następnie kliknij przycisk **Ustaw jako stronę startową**.</span><span class="sxs-lookup"><span data-stu-id="d509f-251">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="d509f-252">Utwórz nowy plik JavaScript w folderze projektu i nadaj mu nazwę *StockTicker.js*...</span><span class="sxs-lookup"><span data-stu-id="d509f-252">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="d509f-253">Zastąp kod szablonu z następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="d509f-253">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample12.js)]

    <span data-ttu-id="d509f-254">$.connection odwołuje się do serwerów proxy SignalR.</span><span class="sxs-lookup"><span data-stu-id="d509f-254">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="d509f-255">Ten kod pobiera odwołanie do serwera proxy dla klasy StockTickerHub i umieszczenie go w zmiennej znacznika.</span><span class="sxs-lookup"><span data-stu-id="d509f-255">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="d509f-256">Nazwa serwera proxy jest nazwę, która została ustawiona przez atrybut [HubName]:</span><span class="sxs-lookup"><span data-stu-id="d509f-256">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample13.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample14.cs)]

    <span data-ttu-id="d509f-257">Po zdefiniowaniu zmiennych i funkcji ostatniego wiersza kodu w pliku inicjuje połączenia SignalR przez wywołanie funkcji start SignalR.</span><span class="sxs-lookup"><span data-stu-id="d509f-257">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="d509f-258">Funkcja start wykonuje asynchronicznie i zwraca [jQuery opóźnieniem obiektu](http://api.jquery.com/category/deferred-object/), co oznacza można wywołać funkcję gotowe, aby określić funkcji do wywołania po ukończeniu operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="d509f-258">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample15.js)]

    <span data-ttu-id="d509f-259">Funkcja inicjowania wywołuje funkcję getAllStocks na serwerze i wykorzystuje serwer zwraca można zaktualizować tabeli podstawowe informacje.</span><span class="sxs-lookup"><span data-stu-id="d509f-259">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="d509f-260">Należy zauważyć, że domyślnie, należy użyć camel wielkość liter na kliencie, mimo że nazwa metody jest pascal — z uwzględnieniem wielkości liter na serwerze.</span><span class="sxs-lookup"><span data-stu-id="d509f-260">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="d509f-261">Reguła wielkości liter formatu ma zastosowanie tylko do metod, a nie obiekty.</span><span class="sxs-lookup"><span data-stu-id="d509f-261">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="d509f-262">Na przykład można odwoływać się do zasobu. Symbol i zapasów. Cena, nie stock.symbol lub stock.price.</span><span class="sxs-lookup"><span data-stu-id="d509f-262">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample16.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample17.cs)]

    <span data-ttu-id="d509f-263">Jeśli chcesz używać pascal wielkości liter na kliencie lub jeśli chcesz użyć nazwy innej metody, możesz można dekoracji metody koncentratora z atrybutem HubMethodName tak samo dekorowane się klasy koncentratora z atrybutem HubName.</span><span class="sxs-lookup"><span data-stu-id="d509f-263">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="d509f-264">W przypadku metody init HTML dla wiersza tabeli jest tworzony dla każdego obiektu podstawowego otrzymany z serwera przez formatStock wywołanie do właściwości formatu standardowych obiektu i ograniczyć przez wywołanie (która jest zdefiniowana w górnej części *StockTicker.js*) należy zastąpić symbole zastępcze w zmiennej rowTemplate wartości właściwości standardowych obiektów.</span><span class="sxs-lookup"><span data-stu-id="d509f-264">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="d509f-265">Wynikowa HTML następnie jest dołączany do podstawowego tabeli.</span><span class="sxs-lookup"><span data-stu-id="d509f-265">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="d509f-266">Należy wywołać init, przekazując go jako funkcji wywołania zwrotnego, która jest wykonywana po zakończeniu działania funkcji rozpoczęcia asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="d509f-266">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="d509f-267">Jeśli wywołujesz init jako oddzielną instrukcję języka JavaScript po wywołaniu metody uruchamiania funkcji nie powiedzie się, ponieważ będzie wykonaj natychmiast bez oczekiwania na funkcję start na zakończenie nawiązywania połączenia.</span><span class="sxs-lookup"><span data-stu-id="d509f-267">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="d509f-268">W takim przypadku funkcja init może spróbować wywołanie funkcji getAllStocks, zanim zostanie nawiązane połączenie z serwerem.</span><span class="sxs-lookup"><span data-stu-id="d509f-268">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="d509f-269">Zmiany cen danego zasobu, serwer wywołuje updateStockPrice na podłączonych klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-269">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="d509f-270">Funkcja jest dodawany do właściwości klienta serwera proxy stockTicker Aby udostępnić go do wywołania z serwera.</span><span class="sxs-lookup"><span data-stu-id="d509f-270">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample18.js)]

    <span data-ttu-id="d509f-271">Funkcja updateStockPrice formatuje obiektem magazynowym otrzymany z serwera do wiersza tabeli tak samo jak funkcja init.</span><span class="sxs-lookup"><span data-stu-id="d509f-271">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="d509f-272">Jednak dodanie wiersza do tabeli, a nie wyszukuje giełdowych bieżącego wiersza w tabeli i tego wiersza są zastępowane nową.</span><span class="sxs-lookup"><span data-stu-id="d509f-272">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="d509f-273">Testowanie aplikacji</span><span class="sxs-lookup"><span data-stu-id="d509f-273">Test the application</span></span>

1. <span data-ttu-id="d509f-274">Naciśnij klawisz F5, aby uruchomić aplikację w trybie debugowania.</span><span class="sxs-lookup"><span data-stu-id="d509f-274">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="d509f-275">Tabela standardowych początkowo wyświetlane "Trwa ładowanie..." wiersza, następnie z niewielkim opóźnieniem wyświetlania standardowych danych początkowych, a następnie uruchom cen akcji można zmienić.</span><span class="sxs-lookup"><span data-stu-id="d509f-275">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Podczas ładowania](tutorial-server-broadcast-with-signalr/_static/image6.png)

    ![Początkowa tabeli standardowych](tutorial-server-broadcast-with-signalr/_static/image7.png)

    ![Tabela standardowych odbieranie zmian z serwera](tutorial-server-broadcast-with-signalr/_static/image8.png)
2. <span data-ttu-id="d509f-279">Skopiuj adres URL z pola adresu przeglądarki i wklej go do co najmniej jednego nowego okna przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="d509f-279">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="d509f-280">Początkowa wyświetlania standardowych jest taka sama jak pierwszy przeglądarki, a jednocześnie wprowadzenia zmiany.</span><span class="sxs-lookup"><span data-stu-id="d509f-280">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="d509f-281">Zamknij wszystkie przeglądarki i Otwórz w przeglądarce nowe, a następnie przejdź do tego samego adresu URL.</span><span class="sxs-lookup"><span data-stu-id="d509f-281">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="d509f-282">Uruchom na serwerze, aby standardowych tabeli pokazuje, że nadal można zmienić zasobów nadal StockTicker pojedynczego obiektu.</span><span class="sxs-lookup"><span data-stu-id="d509f-282">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="d509f-283">(Nie widzisz początkowej tabeli o wartości zero, zmień wartości).</span><span class="sxs-lookup"><span data-stu-id="d509f-283">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="d509f-284">Zamknij przeglądarkę.</span><span class="sxs-lookup"><span data-stu-id="d509f-284">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="d509f-285">Włączanie rejestrowania</span><span class="sxs-lookup"><span data-stu-id="d509f-285">Enable logging</span></span>

<span data-ttu-id="d509f-286">SignalR ma funkcję wbudowanych rejestrowanie można włączyć na kliencie do pomocy w rozwiązywaniu problemów.</span><span class="sxs-lookup"><span data-stu-id="d509f-286">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="d509f-287">W tej sekcji możesz włączyć rejestrowanie i przykłady, które pokazują, jak dzienniki informujące, które z następujących metod transportu SignalR używa:</span><span class="sxs-lookup"><span data-stu-id="d509f-287">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="d509f-288">[Protokół WebSockets](http://en.wikipedia.org/wiki/WebSocket), obsługiwanych przez usługi IIS 8 i bieżącej przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="d509f-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="d509f-289">[Serwer wysłał zdarzenia](http://en.wikipedia.org/wiki/Server-sent_events)obsługiwany przez przeglądarki innego niż program Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="d509f-289">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="d509f-290">[Nieskończona ramki](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), obsługiwanych przez program Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="d509f-290">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="d509f-291">[Długie sondowania AJAX](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling)obsługiwany przez wszystkie przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="d509f-291">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="d509f-292">Dla danego połączenia SignalR wybiera najlepszą metodę transportu, który obsługuje zarówno na serwerze, jak i klienta.</span><span class="sxs-lookup"><span data-stu-id="d509f-292">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="d509f-293">Otwórz *StockTicker.js* i Dodaj wiersz kodu, aby włączyć rejestrowanie bezpośrednio przed kod, który inicjuje połączenie z końcem pliku:</span><span class="sxs-lookup"><span data-stu-id="d509f-293">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample19.js)]
2. <span data-ttu-id="d509f-294">Naciśnij klawisz F5, aby uruchomić projekt.</span><span class="sxs-lookup"><span data-stu-id="d509f-294">Press F5 to run the project.</span></span>
3. <span data-ttu-id="d509f-295">Otwórz okno narzędzia deweloperów w przeglądarce, a następnie wybierz konsoli można znaleźć w dziennikach.</span><span class="sxs-lookup"><span data-stu-id="d509f-295">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="d509f-296">Może być konieczne Odśwież stronę, aby wyświetlić dzienniki negocjowania Metoda transportu dla nowego połączenia Signalr.</span><span class="sxs-lookup"><span data-stu-id="d509f-296">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="d509f-297">Jeśli korzystasz z programu Internet Explorer 10 w systemie Windows 8 (IIS 8), Metoda transportu jest Websocket.</span><span class="sxs-lookup"><span data-stu-id="d509f-297">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![IE 10 IIS 8 Console](tutorial-server-broadcast-with-signalr/_static/image9.png)

    <span data-ttu-id="d509f-299">Jeśli korzystasz z programu Internet Explorer 10 w systemie Windows 7 (usług IIS 7.5), Metoda transportu jest iframe.</span><span class="sxs-lookup"><span data-stu-id="d509f-299">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![IE 10 Console, IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image10.png)

    <span data-ttu-id="d509f-301">W programie Firefox Zainstaluj dodatek Firebug można pobrać okna konsoli.</span><span class="sxs-lookup"><span data-stu-id="d509f-301">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="d509f-302">Jeśli używasz przeglądarki Firefox 19 w systemie Windows 8 (IIS 8), Metoda transportu jest Websocket.</span><span class="sxs-lookup"><span data-stu-id="d509f-302">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8 Websockets](tutorial-server-broadcast-with-signalr/_static/image11.png)

    <span data-ttu-id="d509f-304">Jeśli używasz przeglądarki Firefox 19 w systemie Windows 7 (usług IIS 7.5), Metoda transportu jest zdarzenia wysłanego przez serwer.</span><span class="sxs-lookup"><span data-stu-id="d509f-304">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Konsoli usług IIS 7.5 Firefox 19](tutorial-server-broadcast-with-signalr/_static/image12.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="d509f-306">Instalowanie i przejrzeć pełny przykład StockTicker</span><span class="sxs-lookup"><span data-stu-id="d509f-306">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="d509f-307">Aplikacji StockTicker, który jest instalowany przez [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) pakietu NuGet zawiera więcej funkcji niż uproszczonej wersji, nowo utworzoną od podstaw.</span><span class="sxs-lookup"><span data-stu-id="d509f-307">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="d509f-308">W tej części samouczka zainstaluj pakiet NuGet i Przejrzyj nowe funkcje i kod, który implementuje je.</span><span class="sxs-lookup"><span data-stu-id="d509f-308">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span> <span data-ttu-id="d509f-309">Po zainstalowaniu pakietu bez wykonywania wcześniejszych krokach tego samouczka, należy dodać klasę początkową OWIN do projektu.</span><span class="sxs-lookup"><span data-stu-id="d509f-309">If you install the package without performing the earlier steps of this tutorial, you must add an OWIN startup class to your project.</span></span> <span data-ttu-id="d509f-310">Ten krok jest szczegółowo opisane w pliku pakietu NuGet.</span><span class="sxs-lookup"><span data-stu-id="d509f-310">This step is explained in the readme.txt file for the NuGet package.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="d509f-311">Zainstaluj pakiet SignalR.Sample NuGet</span><span class="sxs-lookup"><span data-stu-id="d509f-311">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="d509f-312">W **Eksploratora rozwiązań**, kliknij prawym przyciskiem myszy projekt i kliknij przycisk **Zarządzaj pakietami NuGet**.</span><span class="sxs-lookup"><span data-stu-id="d509f-312">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="d509f-313">W **Zarządzaj pakietami NuGet** okno dialogowe, kliknij przycisk **Online**, wprowadź *SignalR.Sample* w **wyszukiwania Online** , a następnie kliknij przycisk  **Zainstaluj** w **SignalR.Sample** pakietu.</span><span class="sxs-lookup"><span data-stu-id="d509f-313">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Zainstaluj pakiet SignalR.Sample](tutorial-server-broadcast-with-signalr/_static/image13.png)
3. <span data-ttu-id="d509f-315">W **Eksploratora rozwiązań**, rozwiń węzeł *SignalR.Sample* folderu, który został utworzony przez zainstalowanie pakietu SignalR.Sample.</span><span class="sxs-lookup"><span data-stu-id="d509f-315">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
4. <span data-ttu-id="d509f-316">W *SignalR.Sample* folderu, kliknij prawym przyciskiem myszy *StockTicker.html*, a następnie kliknij przycisk **Ustaw jako stronę startową**.</span><span class="sxs-lookup"><span data-stu-id="d509f-316">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d509f-317">Instalowania SignalR.Sample NuGet pakietu może zmienić wersję jQuery, który ma w Twojej *skryptów* folderu.</span><span class="sxs-lookup"><span data-stu-id="d509f-317">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="d509f-318">Nowy *StockTicker.html* pliku, który instaluje pakiet w *SignalR.Sample* folderu zostaną zsynchronizowane z wersją jQuery, która instaluje pakiet, ale jeśli chcesz uruchomić oryginalny *StockTicker.html* ponownie, należy najpierw zaktualizować odwołania jQuery w tagu skryptu.</span><span class="sxs-lookup"><span data-stu-id="d509f-318">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="d509f-319">Uruchamianie aplikacji</span><span class="sxs-lookup"><span data-stu-id="d509f-319">Run the application</span></span>

1. <span data-ttu-id="d509f-320">Naciśnij klawisz F5, aby uruchomić aplikację.</span><span class="sxs-lookup"><span data-stu-id="d509f-320">Press F5 to run the application.</span></span>

    <span data-ttu-id="d509f-321">Oprócz siatki, który był wyświetlany poprzednio aplikacji pełnej giełdowych wyświetlane okno przewijania w poziomie z wyświetla te same dane zapasów.</span><span class="sxs-lookup"><span data-stu-id="d509f-321">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="d509f-322">Po uruchomieniu aplikacji po raz pierwszy "rynku" jest "zamknięte" i statyczne siatki i okno znacznika, w którym nie jest przewijania.</span><span class="sxs-lookup"><span data-stu-id="d509f-322">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![StockTicker ekranu start](tutorial-server-broadcast-with-signalr/_static/image14.png)

    <span data-ttu-id="d509f-324">Po kliknięciu **otwartego rynku**, **Live znacznika giełdowych** pole zaczyna być przewijane w poziomie, a serwer jest uruchamiany okresowo emisji giełdowy zmiany na podstawie losowej.</span><span class="sxs-lookup"><span data-stu-id="d509f-324">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="d509f-325">Po każdej aktualizacji cen standardowych zmiany zarówno **Live tabeli giełdowych** siatki i **Live znacznika giełdowych** pola są aktualizowane.</span><span class="sxs-lookup"><span data-stu-id="d509f-325">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="d509f-326">Podczas zmiany ceny danego zasobu jest dodatnia, zasobów jest wyświetlana z zielonym tłem, i po zmianie ma wartość ujemną, zasobów jest wyświetlany czerwony tła.</span><span class="sxs-lookup"><span data-stu-id="d509f-326">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Otwarcie rynku aplikacji StockTicker](tutorial-server-broadcast-with-signalr/_static/image15.png)

    <span data-ttu-id="d509f-328">**Zamknij rynku** przycisk zatrzymuje zmiany i zatrzymuje znacznika przewijanie i **zresetować** przycisku powoduje przywrócenie wszystkich standardowych danych stanu początkowego przed uruchomieniem zmiany ceny.</span><span class="sxs-lookup"><span data-stu-id="d509f-328">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="d509f-329">Jeśli więcej okien przeglądarki i przejść do tego samego adresu URL, można zobaczyć te same dane, aktualizowana dynamicznie w tym samym czasie w każdej przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="d509f-329">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="d509f-330">Po kliknięciu jednego z przycisków wszystkie przeglądarki odpowiedź tak samo w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="d509f-330">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="d509f-331">Wyświetlanie znacznika zasobu na żywo</span><span class="sxs-lookup"><span data-stu-id="d509f-331">Live Stock Ticker display</span></span>

<span data-ttu-id="d509f-332">**Live znacznika giełdowych** wyświetlana jest Lista nieuporządkowana w element div, który jest sformatowany w jednym wierszu za style CSS.</span><span class="sxs-lookup"><span data-stu-id="d509f-332">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="d509f-333">Znacznika zostanie zainicjowana i zaktualizować ten sam sposób jak tabeli:, zastępując symbole zastępcze w &lt;li&gt; ciąg szablonu i dynamiczne dodawanie &lt;li&gt; elementy &lt;ul&gt; element.</span><span class="sxs-lookup"><span data-stu-id="d509f-333">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="d509f-334">Przewijanie odbywa się za pomocą funkcji Animacja jQuery różnicującej lewej margines nieuporządkowaną listę w div.</span><span class="sxs-lookup"><span data-stu-id="d509f-334">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="d509f-335">Giełdowych HTML:</span><span class="sxs-lookup"><span data-stu-id="d509f-335">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample20.html)]

<span data-ttu-id="d509f-336">Giełdowych CSS:</span><span class="sxs-lookup"><span data-stu-id="d509f-336">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample21.html)]

<span data-ttu-id="d509f-337">Kod jQuery, który umożliwia przewijanie:</span><span class="sxs-lookup"><span data-stu-id="d509f-337">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample22.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="d509f-338">Dodatkowe metody na serwerze, który można wywołać klienta</span><span class="sxs-lookup"><span data-stu-id="d509f-338">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="d509f-339">Klasa StockTickerHub definiuje cztery dodatkowe metody, które klient może wywoływać:</span><span class="sxs-lookup"><span data-stu-id="d509f-339">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample23.cs)]

<span data-ttu-id="d509f-340">OpenMarket, CloseMarket i resetowania są wywoływane w odpowiedzi do przycisków w górnej części strony.</span><span class="sxs-lookup"><span data-stu-id="d509f-340">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="d509f-341">Pokazują one wzorzec jednego klienta, które wyzwalają zmianę stanu, który jest natychmiast propagowane do wszystkich klientów.</span><span class="sxs-lookup"><span data-stu-id="d509f-341">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="d509f-342">Każda z tych metod wywołuje metodę w klasie StockTicker tego efekty stanu rynku zmienić i następnie emituje nowy stan.</span><span class="sxs-lookup"><span data-stu-id="d509f-342">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="d509f-343">W klasie StockTicker stan rynku jest obsługiwana przez właściwości MarketState, która zwraca wartość wyliczenia MarketState:</span><span class="sxs-lookup"><span data-stu-id="d509f-343">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample24.cs)]

<span data-ttu-id="d509f-344">Każdej z metod, które spowodują zmianę stanu rynku zrobić wewnątrz bloku blokady, ponieważ klasa StockTicker musi być threadsafe:</span><span class="sxs-lookup"><span data-stu-id="d509f-344">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample25.cs)]

<span data-ttu-id="d509f-345">Aby upewnić się, że ten kod jest threadsafe, \_marketState pola, aby utworzyć kopię zapasową właściwości MarketState jest oznaczony jako trwałe,</span><span class="sxs-lookup"><span data-stu-id="d509f-345">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample26.cs)]

<span data-ttu-id="d509f-346">Metody BroadcastMarketStateChange i BroadcastMarketReset są podobne do już wyświetlane, metoda BroadcastStockPrice, z wyjątkiem wywołują różnych metod zdefiniowany po stronie klienta:</span><span class="sxs-lookup"><span data-stu-id="d509f-346">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample27.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="d509f-347">Dodatkowe funkcje na kliencie, który można wywołać serwera</span><span class="sxs-lookup"><span data-stu-id="d509f-347">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="d509f-348">Funkcja updateStockPrice teraz obsługuje zarówno siatki i wyświetlanie znacznika i stosuje jQuery.Color flash czerwony i zielony kolorów.</span><span class="sxs-lookup"><span data-stu-id="d509f-348">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="d509f-349">Nowe funkcje w *SignalR.StockTicker.js* Włączanie i wyłączanie przycisków oparte na rynku stanu i zatrzymać lub uruchomić znacznika okna przewijanie w poziomie.</span><span class="sxs-lookup"><span data-stu-id="d509f-349">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="d509f-350">Ponieważ wiele funkcji są dodawane do ticker.client, [jQuery rozszerzanie funkcji](http://api.jquery.com/jQuery.extend/) służy do dodawania ich.</span><span class="sxs-lookup"><span data-stu-id="d509f-350">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample28.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="d509f-351">Instalacja klienta dodatkowe po ustanowieniu połączenia</span><span class="sxs-lookup"><span data-stu-id="d509f-351">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="d509f-352">Po nawiązaniu przez klienta połączenie, ma wykonania dodatkowych czynności, aby zrobić: Sprawdzanie rynku open lub closed, aby wywołać odpowiednie marketOpened lub funkcja marketClosed i Dołącz wywołania metody serwera do przycisków.</span><span class="sxs-lookup"><span data-stu-id="d509f-352">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample29.js)]

<span data-ttu-id="d509f-353">Metody serwera nie przewodowe do przycisków dopiero po nawiązaniu połączenia, dzięki czemu kod nie może próbować wywołać metody serwera, zanim staną się dostępne.</span><span class="sxs-lookup"><span data-stu-id="d509f-353">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="d509f-354">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="d509f-354">Next steps</span></span>

<span data-ttu-id="d509f-355">W tym samouczku znasz jak do programowania aplikacji SignalR, który wysyła wiadomości z serwera do wszystkich połączonych klientów, zarówno w regularnych odstępach czasu, jak i w odpowiedzi na powiadomienia za pomocą dowolnego klienta.</span><span class="sxs-lookup"><span data-stu-id="d509f-355">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="d509f-356">Wzorzec do zarządzania stanem serwera za pomocą wielowątkowych pojedyncze wystąpienie można również również w scenariuszach gry online przeznaczonych dla wielu graczy.</span><span class="sxs-lookup"><span data-stu-id="d509f-356">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="d509f-357">Na przykład zobacz [gry ShootR, która jest oparta na SignalR](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="d509f-357">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="d509f-358">Samouczki zawierających scenariusze komunikacji peer-to-peer, zobacz [wprowadzenie SignalR](introduction-to-signalr.md) i [aktualizacji w czasie rzeczywistym z SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="d509f-358">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](introduction-to-signalr.md) and [Real-Time Updating with SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span></span>

<span data-ttu-id="d509f-359">Aby uzyskać bardziej zaawansowane pojęcia dotyczące programowania SignalR, odwiedź następującą witrynę dla SignalR kod źródłowy i zasoby:</span><span class="sxs-lookup"><span data-stu-id="d509f-359">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="d509f-360">Biblioteka SignalR platformy ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d509f-360">ASP.NET SignalR</span></span>](../../index.md)
- [<span data-ttu-id="d509f-361">Projekt SignalR</span><span class="sxs-lookup"><span data-stu-id="d509f-361">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="d509f-362">SignalR Github i przykłady</span><span class="sxs-lookup"><span data-stu-id="d509f-362">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="d509f-363">Witryna typu Wiki biblioteki SignalR</span><span class="sxs-lookup"><span data-stu-id="d509f-363">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)

<span data-ttu-id="d509f-364">Aby uzyskać wskazówki dotyczące sposobu wdrażania aplikacji SignalR na platformie Azure, zobacz [SignalR korzystanie z aplikacji sieci Web w usłudze Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span><span class="sxs-lookup"><span data-stu-id="d509f-364">For a walkthrough on how to deploy a SignalR application to Azure, see [Using SignalR with Web Apps in Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span></span> <span data-ttu-id="d509f-365">Aby uzyskać szczegółowe informacje o sposobie wdrażania projektu sieci web programu Visual Studio do witryny sieci Web systemu Windows Azure, zobacz [tworzenie aplikacji sieci web platformy ASP.NET w usłudze Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span><span class="sxs-lookup"><span data-stu-id="d509f-365">For detailed information about how to deploy a Visual Studio web project to a Windows Azure Web Site, see [Create an ASP.NET web app in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span></span>
