---
title: "Testowanie logiką kontrolera w ASP.NET Core"
author: ardalis
description: "Dowiedz się, jak logikę kontrolera testu w ASP.NET Core z Moq i xUnit."
keywords: Platformy ASP.NET Core kontrolera testu, testowania, testu jednostkowego, testy jednostkowe, testu integracji, testowanie integracji, xUnit
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: dd4135ec-2b15-410c-b3fb-3d12eed4a1ac
ms.technology: aspnet
ms.prod: asp.net-core
uid: mvc/controllers/testing
ms.openlocfilehash: aa60912e06946bd0df4936d33c88d3bf7b69984c
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/10/2017
---
# <a name="testing-controller-logic-in-aspnet-core"></a><span data-ttu-id="76124-104">Testowanie logiką kontrolera w ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="76124-104">Testing controller logic in ASP.NET Core</span></span>

<span data-ttu-id="76124-105">Przez [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="76124-105">By [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="76124-106">Kontrolery w aplikacjach ASP.NET MVC powinna być mała i skupiają się na problemy z interfejsem użytkownika.</span><span class="sxs-lookup"><span data-stu-id="76124-106">Controllers in ASP.NET MVC apps should be small and focused on user-interface concerns.</span></span> <span data-ttu-id="76124-107">Dużych kontrolerów, które zajmują się problemów bez interfejsu użytkownika są trudne do testowania i obsługi.</span><span class="sxs-lookup"><span data-stu-id="76124-107">Large controllers that deal with non-UI concerns are more difficult to test and maintain.</span></span>

[<span data-ttu-id="76124-108">Przykładowy widok lub pobrania z witryny GitHub</span><span class="sxs-lookup"><span data-stu-id="76124-108">View or download sample from GitHub</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample)

## <a name="testing-controllers"></a><span data-ttu-id="76124-109">Kontrolery testów</span><span class="sxs-lookup"><span data-stu-id="76124-109">Testing controllers</span></span>

<span data-ttu-id="76124-110">Kontrolery są centralnej częścią żadnej aplikacji ASP.NET Core MVC.</span><span class="sxs-lookup"><span data-stu-id="76124-110">Controllers are a central part of any ASP.NET Core MVC application.</span></span> <span data-ttu-id="76124-111">Tak powinien mieć pewność, które działają zgodnie z przeznaczeniem dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="76124-111">As such, you should have confidence they behave as intended for your app.</span></span> <span data-ttu-id="76124-112">Testy automatyczne może udostępnić tym zaufania i może szybko wykrywać błędy przed dotarciem produkcji.</span><span class="sxs-lookup"><span data-stu-id="76124-112">Automated tests can provide you with this confidence and can detect errors before they reach production.</span></span> <span data-ttu-id="76124-113">Należy unikać umieszczania niepotrzebnych obowiązki w kontrolerach i upewnij się, zespół testy tylko na obowiązki kontrolera.</span><span class="sxs-lookup"><span data-stu-id="76124-113">It's important to avoid placing unnecessary responsibilities within your controllers and ensure your tests focus only on controller responsibilities.</span></span>

<span data-ttu-id="76124-114">Logika kontroler powinien być minimalny i nie ukierunkowanych na logiki lub infrastruktury problemy biznesowe (na przykład dostęp do danych).</span><span class="sxs-lookup"><span data-stu-id="76124-114">Controller logic should be minimal and not be focused on business logic or infrastructure concerns (for example, data access).</span></span> <span data-ttu-id="76124-115">Przetestuj logiką kontrolera, nie framework.</span><span class="sxs-lookup"><span data-stu-id="76124-115">Test controller logic, not the framework.</span></span> <span data-ttu-id="76124-116">Test jak kontroler *zachowuje się* oparte na prawidłowe lub nieprawidłowe dane wejściowe.</span><span class="sxs-lookup"><span data-stu-id="76124-116">Test how the controller *behaves* based on valid or invalid inputs.</span></span> <span data-ttu-id="76124-117">Test na podstawie wyniku prowadzonej działalności, którą wykonuje odpowiedzi kontrolera.</span><span class="sxs-lookup"><span data-stu-id="76124-117">Test controller responses based on the result of the business operation it performs.</span></span>

<span data-ttu-id="76124-118">Typowy kontroler obowiązki:</span><span class="sxs-lookup"><span data-stu-id="76124-118">Typical controller responsibilities:</span></span>

* <span data-ttu-id="76124-119">Sprawdź `ModelState.IsValid`.</span><span class="sxs-lookup"><span data-stu-id="76124-119">Verify `ModelState.IsValid`.</span></span>
* <span data-ttu-id="76124-120">Zwraca odpowiedź o błędzie, jeśli `ModelState` jest nieprawidłowy.</span><span class="sxs-lookup"><span data-stu-id="76124-120">Return an error response if `ModelState` is invalid.</span></span>
* <span data-ttu-id="76124-121">Jednostek biznesowych należy pobrać z magazynu trwałego.</span><span class="sxs-lookup"><span data-stu-id="76124-121">Retrieve a business entity from persistence.</span></span>
* <span data-ttu-id="76124-122">Wykonaj akcję w jednostce biznesowej.</span><span class="sxs-lookup"><span data-stu-id="76124-122">Perform an action on the business entity.</span></span>
* <span data-ttu-id="76124-123">Zapisz jednostki biznesowe trwałości.</span><span class="sxs-lookup"><span data-stu-id="76124-123">Save the business entity to persistence.</span></span>
* <span data-ttu-id="76124-124">Zwraca preferowany `IActionResult`.</span><span class="sxs-lookup"><span data-stu-id="76124-124">Return an appropriate `IActionResult`.</span></span>

## <a name="unit-testing"></a><span data-ttu-id="76124-125">Testy jednostkowe</span><span class="sxs-lookup"><span data-stu-id="76124-125">Unit testing</span></span>

<span data-ttu-id="76124-126">[Testy jednostkowe](https://docs.microsoft.com/dotnet/articles/core/testing/unit-testing-with-dotnet-test) obejmuje testowania części aplikacji w izolacji od jego infrastruktury i zależności.</span><span class="sxs-lookup"><span data-stu-id="76124-126">[Unit testing](https://docs.microsoft.com/dotnet/articles/core/testing/unit-testing-with-dotnet-test) involves testing a part of an app in isolation from its infrastructure and dependencies.</span></span> <span data-ttu-id="76124-127">Podczas testowania logiką kontrolera, zawartości jednej akcji jednostek jest testowany, nie zachowanie z jego zależności lub struktury sam.</span><span class="sxs-lookup"><span data-stu-id="76124-127">When unit testing controller logic, only the contents of a single action is tested, not the behavior of its dependencies or of the framework itself.</span></span> <span data-ttu-id="76124-128">Jako jednostki można przetestować akcji kontrolera, upewnij się, że można skupić się tylko na jego zachowania.</span><span class="sxs-lookup"><span data-stu-id="76124-128">As you unit test your controller actions, make sure you focus only on its behavior.</span></span> <span data-ttu-id="76124-129">Kontroler testu jednostkowego pozwala uniknąć elementów, jak [filtry](filters.md), [routingu](../../fundamentals/routing.md), lub [modelu powiązania](../models/model-binding.md).</span><span class="sxs-lookup"><span data-stu-id="76124-129">A controller unit test avoids things like [filters](filters.md), [routing](../../fundamentals/routing.md), or [model binding](../models/model-binding.md).</span></span> <span data-ttu-id="76124-130">Istotą testowania tylko jeden element, testy jednostkowe są zwykle proste do zapisu i szybkie uruchamianie.</span><span class="sxs-lookup"><span data-stu-id="76124-130">By focusing on testing just one thing, unit tests are generally simple to write and quick to run.</span></span> <span data-ttu-id="76124-131">Dobrze napisane zbiór testy jednostkowe mogą być uruchamiane często bez znacznie obciążenie.</span><span class="sxs-lookup"><span data-stu-id="76124-131">A well-written set of unit tests can be run frequently without much overhead.</span></span> <span data-ttu-id="76124-132">Jednak testów jednostkowych nie wykrywaj problemy w interakcji między składnikami, który jest celem [testów integracji](xref:mvc/controllers/testing#integration-testing).</span><span class="sxs-lookup"><span data-stu-id="76124-132">However, unit tests do not detect issues in the interaction between components, which is the purpose of [integration testing](xref:mvc/controllers/testing#integration-testing).</span></span>

<span data-ttu-id="76124-133">Jeśli piszesz filtry niestandardowe, tras, itp., należy testu jednostkowego ich, ale nie jako część testy na akcję określony kontroler.</span><span class="sxs-lookup"><span data-stu-id="76124-133">If you're writing custom filters, routes, etc, you should unit test them, but not as part of your tests on a particular controller action.</span></span> <span data-ttu-id="76124-134">Powinny one być testowane w izolacji.</span><span class="sxs-lookup"><span data-stu-id="76124-134">They should be tested in isolation.</span></span>

> [!TIP]
> <span data-ttu-id="76124-135">[Tworzenie i Uruchamianie testów jednostkowych z programem Visual Studio](https://docs.microsoft.com/visualstudio/test/unit-test-your-code).</span><span class="sxs-lookup"><span data-stu-id="76124-135">[Create and run unit tests with Visual Studio](https://docs.microsoft.com/visualstudio/test/unit-test-your-code).</span></span>

<span data-ttu-id="76124-136">Aby zademonstrować testy jednostkowe, przejrzyj następujący kontroler.</span><span class="sxs-lookup"><span data-stu-id="76124-136">To demonstrate unit testing, review the following controller.</span></span> <span data-ttu-id="76124-137">Wyświetla listę Burza sesji, a zezwala na nowe Burza sesji ma zostać utworzony wpis:</span><span class="sxs-lookup"><span data-stu-id="76124-137">It displays a list of brainstorming sessions and allows new brainstorming sessions to be created with a POST:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/src/TestingControllersSample/Controllers/HomeController.cs?highlight=12,16,21,42,43)]

<span data-ttu-id="76124-138">Oto kontrolera [zasady jawne zależności](http://deviq.com/explicit-dependencies-principle/), oczekiwano iniekcji zależności do tego celu z wystąpieniem `IBrainstormSessionRepository`.</span><span class="sxs-lookup"><span data-stu-id="76124-138">The controller is following the [explicit dependencies principle](http://deviq.com/explicit-dependencies-principle/), expecting dependency injection to provide it with an instance of `IBrainstormSessionRepository`.</span></span> <span data-ttu-id="76124-139">Ułatwia to dość łatwe do testowania przy użyciu platformy zasymulować obiektu, takie jak [Moq](https://www.nuget.org/packages/Moq/).</span><span class="sxs-lookup"><span data-stu-id="76124-139">This makes it fairly easy to test using a mock object framework, like [Moq](https://www.nuget.org/packages/Moq/).</span></span> <span data-ttu-id="76124-140">`HTTP GET Index` — Metoda nie ma pętli lub gałęzi i tylko wywołania jednej metody.</span><span class="sxs-lookup"><span data-stu-id="76124-140">The `HTTP GET Index` method has no looping or branching and only calls one method.</span></span> <span data-ttu-id="76124-141">Aby to sprawdzić `Index` metody, należy sprawdzić, czy `ViewResult` jest zwracany, z `ViewModel` w repozytorium `List` metody.</span><span class="sxs-lookup"><span data-stu-id="76124-141">To test this `Index` method, we need to verify that a `ViewResult` is returned, with a `ViewModel` from the repository's `List` method.</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/HomeControllerTests.cs?highlight=17-18&range=1-33,76-95)]

<span data-ttu-id="76124-142">`HomeController` `HTTP POST Index` Sprawdzić — metoda (pokazanym powyżej):</span><span class="sxs-lookup"><span data-stu-id="76124-142">The `HomeController` `HTTP POST Index` method (shown above) should verify:</span></span>

* <span data-ttu-id="76124-143">Metoda akcji zwraca nieprawidłowe żądanie `ViewResult` odpowiednimi danymi podczas `ModelState.IsValid` jest`false`</span><span class="sxs-lookup"><span data-stu-id="76124-143">The action method returns a Bad Request `ViewResult` with the appropriate data when `ModelState.IsValid` is `false`</span></span>

* <span data-ttu-id="76124-144">`Add` Wywoływana jest metoda repozytorium i `RedirectToActionResult` jest zwracany za poprawne argumenty podczas `ModelState.IsValid` ma wartość true.</span><span class="sxs-lookup"><span data-stu-id="76124-144">The `Add` method on the repository is called and a `RedirectToActionResult` is returned with the correct arguments when `ModelState.IsValid` is true.</span></span>

<span data-ttu-id="76124-145">Nieprawidłowy stan modelu można sprawdzić przez dodanie błędów za pomocą `AddModelError` jak pokazano poniżej pierwszego testu.</span><span class="sxs-lookup"><span data-stu-id="76124-145">Invalid model state can be tested by adding errors using `AddModelError` as shown in the first test below.</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/HomeControllerTests.cs?highlight=8,15-16,37-39&range=35-75)]

<span data-ttu-id="76124-146">Potwierdza pierwszego testu, gdy `ModelState` nie jest prawidłowa, taka sama `ViewResult` jest zwracane jako `GET` żądania.</span><span class="sxs-lookup"><span data-stu-id="76124-146">The first test confirms when `ModelState` is not valid, the same `ViewResult` is returned as for a `GET` request.</span></span> <span data-ttu-id="76124-147">Należy pamiętać, że test nie próba przekazania w nieprawidłowy model.</span><span class="sxs-lookup"><span data-stu-id="76124-147">Note that the test doesn't attempt to pass in an invalid model.</span></span> <span data-ttu-id="76124-148">To zadziała nie mimo to ponieważ wiązania modelu nie jest uruchomiony (chociaż [testu integracji](xref:mvc/controllers/testing#integration-testing) użyje wiązania modelu wykonywania).</span><span class="sxs-lookup"><span data-stu-id="76124-148">That wouldn't work anyway since model binding isn't running (though an [integration test](xref:mvc/controllers/testing#integration-testing) would use exercise model binding).</span></span> <span data-ttu-id="76124-149">W takim przypadku wiązania modelu nie jest poddawana testom.</span><span class="sxs-lookup"><span data-stu-id="76124-149">In this case, model binding is not being tested.</span></span> <span data-ttu-id="76124-150">Te testy jednostkowe tylko testowania jest kod w metodzie akcji.</span><span class="sxs-lookup"><span data-stu-id="76124-150">These unit tests are only testing what the code in the action method does.</span></span>

<span data-ttu-id="76124-151">Drugi test sprawdza, że w przypadku `ModelState` jest prawidłowy, nowy `BrainstormSession` jest dodawana (repozytorium), a metoda zwraca `RedirectToActionResult` z oczekiwanym właściwości.</span><span class="sxs-lookup"><span data-stu-id="76124-151">The second test verifies that when `ModelState` is valid, a new `BrainstormSession` is added (via the repository), and the method returns a `RedirectToActionResult` with the expected properties.</span></span> <span data-ttu-id="76124-152">Mocked wywołania, które nie są nazywane są zwykle została zignorowana, ale wywołanie `Verifiable` na końcu instalacji wywołania umożliwi można sprawdzić w teście.</span><span class="sxs-lookup"><span data-stu-id="76124-152">Mocked calls that aren't called are normally ignored, but calling `Verifiable` at the end of the setup call allows it to be verified in the test.</span></span> <span data-ttu-id="76124-153">Jest to zrobić za pomocą wywołania `mockRepo.Verify`, który zakończy się niepowodzeniem testu, jeśli nie wywołano metody oczekiwanej.</span><span class="sxs-lookup"><span data-stu-id="76124-153">This is done with the call to `mockRepo.Verify`, which will fail the test if the expected method was not called.</span></span>

> [!NOTE]
> <span data-ttu-id="76124-154">Biblioteka Moq używane w tym przykładzie ułatwia mieszać mocks weryfikowalny lub "strict" z-weryfikowalny mocks (zwaną również "utracić" mocks lub klas zastępczych).</span><span class="sxs-lookup"><span data-stu-id="76124-154">The Moq library used in this sample makes it easy to mix verifiable, or "strict", mocks with non-verifiable mocks (also called "loose" mocks or stubs).</span></span> <span data-ttu-id="76124-155">Dowiedz się więcej o [Dostosowywanie zachowania makiety z Moq](https://github.com/Moq/moq4/wiki/Quickstart#customizing-mock-behavior).</span><span class="sxs-lookup"><span data-stu-id="76124-155">Learn more about [customizing Mock behavior with Moq](https://github.com/Moq/moq4/wiki/Quickstart#customizing-mock-behavior).</span></span>

<span data-ttu-id="76124-156">Inny kontroler w aplikacji Wyświetla informacje związane z sesją określonego Diagram burzy.</span><span class="sxs-lookup"><span data-stu-id="76124-156">Another controller in the app displays information related to a particular brainstorming session.</span></span> <span data-ttu-id="76124-157">Zawiera logikę radzenia sobie z wartości nieprawidłowy identyfikator:</span><span class="sxs-lookup"><span data-stu-id="76124-157">It includes some logic to deal with invalid id values:</span></span>

[!code-csharp[Main](./testing/sample/TestingControllersSample/src/TestingControllersSample/Controllers/SessionController.cs?highlight=19,20,21,22,25,26,27,28)]

<span data-ttu-id="76124-158">Akcja kontrolera ma trzech przypadkach do testowania, po jednej dla każdego `return` instrukcji:</span><span class="sxs-lookup"><span data-stu-id="76124-158">The controller action has three cases to test, one for each `return` statement:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/SessionControllerTests.cs?highlight=27,28,29,46,47,64,65,66,67,68)]

<span data-ttu-id="76124-159">Aplikacja udostępnia funkcje jako składnika web API (Lista koncepcji związanych z sesji Diagram burzy i metody do dodawania nowych pomysłów do sesji):</span><span class="sxs-lookup"><span data-stu-id="76124-159">The app exposes functionality as a web API (a list of ideas associated with a brainstorming session and a method for adding new ideas to a session):</span></span>

<a name="ideas-controller"></a>

[!code-csharp[Main](testing/sample/TestingControllersSample/src/TestingControllersSample/Api/IdeasController.cs?highlight=21,22,27,30,31,32,33,34,35,36,41,42,46,52,65)]

<span data-ttu-id="76124-160">`ForSession` Metoda zwraca listę `IdeaDTO` typów.</span><span class="sxs-lookup"><span data-stu-id="76124-160">The `ForSession` method returns a list of `IdeaDTO` types.</span></span> <span data-ttu-id="76124-161">Należy unikać zwracania jednostek biznesowych domeny bezpośrednio za pomocą interfejsu API, ponieważ często zawierają więcej danych niż wymaga klienta interfejsu API, a ich połączenie niepotrzebnie modelu domeny wewnętrznej aplikacji przy użyciu interfejsu API można ujawnić zewnętrznie.</span><span class="sxs-lookup"><span data-stu-id="76124-161">Avoid returning your business domain entities directly via API calls, since frequently they include more data than the API client requires, and they unnecessarily couple your app's internal domain model with the API you expose externally.</span></span> <span data-ttu-id="76124-162">Mapowanie między domeny jednostek i typy zwróci się przez sieć można przeprowadzić ręcznie (za pomocą LINQ `Select` w sposób pokazany poniżej) lub za pomocą biblioteki, takich jak [AutoMapper](https://github.com/AutoMapper/AutoMapper)</span><span class="sxs-lookup"><span data-stu-id="76124-162">Mapping between domain entities and the types you will return over the wire can be done manually (using a LINQ `Select` as shown here) or using a library like [AutoMapper](https://github.com/AutoMapper/AutoMapper)</span></span>

<span data-ttu-id="76124-163">Testów jednostkowych dla `Create` i `ForSession` metody interfejsu API:</span><span class="sxs-lookup"><span data-stu-id="76124-163">The unit tests for the `Create` and `ForSession` API methods:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/ApiIdeasControllerTests.cs?highlight=18,23,29,33,38-39,43,50,58-59,68-70,76-78&range=1-83,121-135)]

<span data-ttu-id="76124-164">Jak wspomniano wcześniej, aby przetestować działanie metody podczas `ModelState` jest nieprawidłowy, Dodaj błąd modelu do kontrolera jako część testu.</span><span class="sxs-lookup"><span data-stu-id="76124-164">As stated previously, to test the behavior of the method when `ModelState` is invalid, add a model error to the controller as part of the test.</span></span> <span data-ttu-id="76124-165">Nie należy próbować testów sprawdzania poprawności lub modelu wiązania modelu w testy jednostkowe — po prostu przetestować zachowania metodzie akcji, gdy do czynienia z określonego `ModelState` wartość.</span><span class="sxs-lookup"><span data-stu-id="76124-165">Don't try to test model validation or model binding in your unit tests - just test your action method's behavior when confronted with a particular `ModelState` value.</span></span>

<span data-ttu-id="76124-166">Drugi test zależy od repozytorium zwracanie wartości null, aby zasymulować repozytorium jest skonfigurowany do zwrócenia wartości null.</span><span class="sxs-lookup"><span data-stu-id="76124-166">The second test depends on the repository returning null, so the mock repository is configured to return null.</span></span> <span data-ttu-id="76124-167">Nie istnieje potrzeba można utworzyć testowej bazy danych (w pamięci lub w inny sposób) i utworzyć kwerendę, która zwraca wynik — mogą to robić w jednej instrukcji jak pokazano.</span><span class="sxs-lookup"><span data-stu-id="76124-167">There's no need to create a test database (in memory or otherwise) and construct a query that will return this result - it can be done in a single statement as shown.</span></span>

<span data-ttu-id="76124-168">Ostatni test sprawdza, czy z repozytorium `Update` metoda jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="76124-168">The last test verifies that the repository's `Update` method is called.</span></span> <span data-ttu-id="76124-169">Jak opisano wcześniej, makiety jest wywoływana z `Verifiable` , a następnie mocked z repozytorium `Verify` metoda jest wywoływana, aby upewnić się, możliwe do zweryfikowania metody zostało wykonane.</span><span class="sxs-lookup"><span data-stu-id="76124-169">As we did previously, the mock is called with `Verifiable` and then the mocked repository's `Verify` method is called to confirm the verifiable method was executed.</span></span> <span data-ttu-id="76124-170">Nie jest odpowiedzialność testów jednostkowych upewnij się, że `Update` metody zapisane dane; który można zrobić za pomocą testu integracji.</span><span class="sxs-lookup"><span data-stu-id="76124-170">It's not a unit test responsibility to ensure that the `Update` method saved the data; that can be done with an integration test.</span></span>

## <a name="integration-testing"></a><span data-ttu-id="76124-171">Testowanie integracji</span><span class="sxs-lookup"><span data-stu-id="76124-171">Integration testing</span></span>

<span data-ttu-id="76124-172">[Testowanie integracji](../../testing/integration-testing.md) poprawnie ze sobą zapewnia oddzielnych modułów w pracy aplikacji.</span><span class="sxs-lookup"><span data-stu-id="76124-172">[Integration testing](../../testing/integration-testing.md) is done to ensure separate modules within your app work correctly together.</span></span> <span data-ttu-id="76124-173">Ogólnie rzecz biorąc coś, co można przetestować z testu jednostkowego, można również sprawdzić z testem integracji, ale odwrotnej nie jest spełniony.</span><span class="sxs-lookup"><span data-stu-id="76124-173">Generally, anything you can test with a unit test, you can also test with an integration test, but the reverse isn't true.</span></span> <span data-ttu-id="76124-174">Jednak testy integracji zazwyczaj można znacznie mniejsza niż testy jednostkowe.</span><span class="sxs-lookup"><span data-stu-id="76124-174">However, integration tests tend to be much slower than unit tests.</span></span> <span data-ttu-id="76124-175">W związku z tym najlepiej do testowania, niezależnie od można przy użyciu testów jednostkowych i użyć testów integracji dla scenariuszy obejmujących wiele współpracowników.</span><span class="sxs-lookup"><span data-stu-id="76124-175">Thus, it's best to test whatever you can with unit tests, and use integration tests for scenarios that involve multiple collaborators.</span></span>

<span data-ttu-id="76124-176">Mimo że nadal mogą być użyteczne, zasymulować obiekty są rzadko używane w testach integracji.</span><span class="sxs-lookup"><span data-stu-id="76124-176">Although they may still be useful, mock objects are rarely used in integration tests.</span></span> <span data-ttu-id="76124-177">W przypadku przeprowadzania testów jednostkowych zasymulować obiekty są efektywny sposób kontrolować sposób zachowania przypadku współpracownicy poza jednostki testowane na potrzeby testu.</span><span class="sxs-lookup"><span data-stu-id="76124-177">In unit testing, mock objects are an effective way to control how collaborators outside of the unit being tested should behave for the purposes of the test.</span></span> <span data-ttu-id="76124-178">W teście integracji rzeczywistych współpracownicy są używane do upewnij się, że podsystem całego razem działa prawidłowo.</span><span class="sxs-lookup"><span data-stu-id="76124-178">In an integration test, real collaborators are used to confirm the whole subsystem works together correctly.</span></span>

### <a name="application-state"></a><span data-ttu-id="76124-179">Stan aplikacji</span><span class="sxs-lookup"><span data-stu-id="76124-179">Application state</span></span>

<span data-ttu-id="76124-180">Ważnym zagadnieniem podczas przeprowadzania testów integracji jest sposób ustawiania stanu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="76124-180">One important consideration when performing integration testing is how to set your app's state.</span></span> <span data-ttu-id="76124-181">Testy muszą działać od siebie niezależne, a więc każdy test powinien zaczynać się od aplikacji w znanego stanu.</span><span class="sxs-lookup"><span data-stu-id="76124-181">Tests need to run independent of one another, and so each test should start with the app in a known state.</span></span> <span data-ttu-id="76124-182">Jeśli dana aplikacja nie korzystania z bazy danych lub mieć żadnych trwałości, nie można tego problemu.</span><span class="sxs-lookup"><span data-stu-id="76124-182">If your app doesn't use a database or have any persistence, this may not be an issue.</span></span> <span data-ttu-id="76124-183">Jednak większość aplikacji rzeczywistych utrwalić stanu do określonego rodzaju magazynu danych, więc wszelkie zmiany dokonane przez jeden test może mieć wpływ na innego testu, chyba że zostanie zresetowana do magazynu danych.</span><span class="sxs-lookup"><span data-stu-id="76124-183">However, most real-world apps persist their state to some kind of data store, so any modifications made by one test could impact another test unless the data store is reset.</span></span> <span data-ttu-id="76124-184">Za pomocą wbudowanych `TestServer`, jest bardzo prosta do aplikacji platformy ASP.NET Core hosta w ramach naszych testów integracji, ale który nie musi udzielić dostępu do danych, zostanie użyty.</span><span class="sxs-lookup"><span data-stu-id="76124-184">Using the built-in `TestServer`, it's very straightforward to host ASP.NET Core apps within our integration tests, but that doesn't necessarily grant access to the data it will use.</span></span> <span data-ttu-id="76124-185">Jeśli używasz istniejącej bazy danych, jednym z podejść jest aplikacjami nawiązać połączenia z bazą danych testów, które testy mogą uzyskać dostęp i upewnij się, zostanie zresetowana do znanego stanu przed wykonaniem każdego z testów.</span><span class="sxs-lookup"><span data-stu-id="76124-185">If you're using an actual database, one approach is to have the app connect to a test database, which your tests can access and ensure is reset to a known state before each test executes.</span></span>

<span data-ttu-id="76124-186">W tej przykładowej aplikacji używam programu Entity Framework Core InMemoryDatabase pomocy technicznej, tak właśnie nie mogę połączyć do niej w projekcie testowym.</span><span class="sxs-lookup"><span data-stu-id="76124-186">In this sample application, I'm using Entity Framework Core's InMemoryDatabase support, so I can't just connect to it from my test project.</span></span> <span data-ttu-id="76124-187">Zamiast tego należy udostępnić `InitializeDatabase` metody z poziomu aplikacji `Startup` klasy, które można wywołać podczas uruchamiania aplikacji, jeśli jest w `Development` środowiska.</span><span class="sxs-lookup"><span data-stu-id="76124-187">Instead, I expose an `InitializeDatabase` method from the app's `Startup` class, which I call when the app starts up if it's in the `Development` environment.</span></span> <span data-ttu-id="76124-188">Moje testy integracji automatycznie korzystać z to tak długo, jak będą one ustawienia środowiska na `Development`.</span><span class="sxs-lookup"><span data-stu-id="76124-188">My integration tests automatically benefit from this as long as they set the environment to `Development`.</span></span> <span data-ttu-id="76124-189">Nie mam martwić się o zresetowanie bazy danych, ponieważ InMemoryDatabase jest resetowany każdym ponownym uruchomieniu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="76124-189">I don't have to worry about resetting the database, since the InMemoryDatabase is reset each time the app restarts.</span></span>

<span data-ttu-id="76124-190">`Startup` Klasy:</span><span class="sxs-lookup"><span data-stu-id="76124-190">The `Startup` class:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/src/TestingControllersSample/Startup.cs?highlight=19,20,34,35,43,52)]

<span data-ttu-id="76124-191">Zobaczysz `GetTestSession` metody często używane w testach integracji poniżej.</span><span class="sxs-lookup"><span data-stu-id="76124-191">You'll see the `GetTestSession` method used frequently in the integration tests below.</span></span>

### <a name="accessing-views"></a><span data-ttu-id="76124-192">Uzyskiwanie dostępu do widoków</span><span class="sxs-lookup"><span data-stu-id="76124-192">Accessing views</span></span>

<span data-ttu-id="76124-193">Umożliwia skonfigurowanie każdej klasy testowej integracji `TestServer` który uruchomi aplikacji platformy ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="76124-193">Each integration test class configures the `TestServer` that will run the ASP.NET Core app.</span></span> <span data-ttu-id="76124-194">Domyślnie `TestServer` hostem aplikacji sieci web w folderze, w którym jest uruchomiona — w takim przypadku folderu projektu testowego.</span><span class="sxs-lookup"><span data-stu-id="76124-194">By default, `TestServer` hosts the web app in the folder where it's running - in this case, the test project folder.</span></span> <span data-ttu-id="76124-195">W związku z tym podczas próby test akcji kontrolera, które zwracają `ViewResult`, może zostać wyświetlony ten błąd:</span><span class="sxs-lookup"><span data-stu-id="76124-195">Thus, when you attempt to test controller actions that return `ViewResult`, you may see this error:</span></span>

```
The view 'Index' was not found. The following locations were searched:
(list of locations)
```

<span data-ttu-id="76124-196">Aby rozwiązać ten problem, należy skonfigurować serwer zawartości głównego, aby mogły zlokalizować widoki dla projektu testowane.</span><span class="sxs-lookup"><span data-stu-id="76124-196">To correct this issue, you need to configure the server's content root, so it can locate the views for the project being tested.</span></span> <span data-ttu-id="76124-197">Jest to realizowane przez wywołanie `UseContentRoot` w `TestFixture` klasy, pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="76124-197">This is done by a call to `UseContentRoot` in the `TestFixture` class, shown below:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/TestFixture.cs?highlight=30,33)]

<span data-ttu-id="76124-198">`TestFixture` Klasy jest odpowiedzialny za konfigurowanie i tworzenie `TestServer`, ustawieniu `HttpClient` do komunikowania się z `TestServer`.</span><span class="sxs-lookup"><span data-stu-id="76124-198">The `TestFixture` class is responsible for configuring and creating the `TestServer`, setting up an `HttpClient` to communicate with the `TestServer`.</span></span> <span data-ttu-id="76124-199">Każdy integrację testów używa `Client` właściwość, aby połączyć się z serwerem testu i wysłać żądanie.</span><span class="sxs-lookup"><span data-stu-id="76124-199">Each of the integration tests uses the `Client` property to connect to the test server and make a request.</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/HomeControllerTests.cs?highlight=20,26,29,30,31,35,38,39,40,41,44,47,48)]

<span data-ttu-id="76124-200">W pierwszym badaniu powyżej `responseString` przechowuje rzeczywiste renderowania kodu HTML z widoku, który można przeprowadzić inspekcji, aby potwierdzić zawiera oczekiwanych rezultatów.</span><span class="sxs-lookup"><span data-stu-id="76124-200">In the first test above, the `responseString` holds the actual rendered HTML from the View, which can be inspected to confirm it contains expected results.</span></span>

<span data-ttu-id="76124-201">Drugi test tworzy POST formularza z nazwą sesji unikatowy i zapisuje go w aplikacji, a następnie sprawdza, czy oczekiwanego przekierowania jest zwracany.</span><span class="sxs-lookup"><span data-stu-id="76124-201">The second test constructs a form POST with a unique session name and POSTs it to the app, then verifies that the expected redirect is returned.</span></span>

### <a name="api-methods"></a><span data-ttu-id="76124-202">Metody interfejsu API</span><span class="sxs-lookup"><span data-stu-id="76124-202">API methods</span></span>

<span data-ttu-id="76124-203">Jeśli aplikacja udostępnia web API, jego warto mieć testów automatycznych upewnij się, są one wykonywane zgodnie z oczekiwaniami.</span><span class="sxs-lookup"><span data-stu-id="76124-203">If your app exposes web APIs, it's a good idea to have automated tests confirm they execute as expected.</span></span> <span data-ttu-id="76124-204">Wbudowane `TestServer` ułatwia testowanie interfejsów API sieci web.</span><span class="sxs-lookup"><span data-stu-id="76124-204">The built-in `TestServer` makes it easy to test web APIs.</span></span> <span data-ttu-id="76124-205">Jeśli Twoje metody interfejsu API z wiązania modelu, należy zawsze sprawdzić `ModelState.IsValid`, oraz testy integracji są odpowiednim miejscu, aby potwierdzić z weryfikacją modelu działa prawidłowo.</span><span class="sxs-lookup"><span data-stu-id="76124-205">If your API methods are using model binding, you should always check `ModelState.IsValid`, and integration tests are the right place to confirm that your model validation is working properly.</span></span>

<span data-ttu-id="76124-206">Następujący zestaw docelowy testy `Create` metody w [IdeasController](xref:mvc/controllers/testing#ideas-controller) klasy pokazanym powyżej:</span><span class="sxs-lookup"><span data-stu-id="76124-206">The following set of tests target the `Create` method in the [IdeasController](xref:mvc/controllers/testing#ideas-controller) class shown above:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/ApiIdeasControllerTests.cs)]

<span data-ttu-id="76124-207">W przeciwieństwie do integracji testy akcji, które zwraca widoków HTML metody interfejsu API sieci web, które zwracają wyniki zwykle można zdeserializowany jako silnie typizowanych obiektów, jak pokazano powyżej ostatniego testu.</span><span class="sxs-lookup"><span data-stu-id="76124-207">Unlike integration tests of actions that returns HTML views, web API methods that return results can usually be deserialized as strongly typed objects, as the last test above shows.</span></span> <span data-ttu-id="76124-208">W takim przypadku testu deserializuje wynik, który ma `BrainstormSession` wystąpienia i potwierdza, że pomysł poprawnie została dodana do jego kolekcja pomysłów.</span><span class="sxs-lookup"><span data-stu-id="76124-208">In this case, the test deserializes the result to a `BrainstormSession` instance, and confirms that the idea was correctly added to its collection of ideas.</span></span>

<span data-ttu-id="76124-209">W tym artykule znajdziesz więcej przykładów testów integracji [przykładowy projekt](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample).</span><span class="sxs-lookup"><span data-stu-id="76124-209">You'll find additional examples of integration tests in this article's [sample project](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample).</span></span>
