---
title: "Iniekcji zależności w platformy ASP.NET Core"
author: ardalis
description: "Dowiedz się, jak platformy ASP.NET Core implementuje iniekcji zależności i jak z niego korzystać."
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.technology: aspnet
ms.prod: asp.net-core
uid: fundamentals/dependency-injection
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 7a5a0991694b2c7caa79dbc09f6471d614f67dac
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/24/2018
---
# <a name="introduction-to-dependency-injection-in-aspnet-core"></a><span data-ttu-id="14f40-103">Wprowadzenie do iniekcji zależności w platformy ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="14f40-103">Introduction to Dependency Injection in ASP.NET Core</span></span>

<a name="fundamentals-dependency-injection"></a>

<span data-ttu-id="14f40-104">Przez [Steve Smith](https://ardalis.com/) i [Scott Addie](https://scottaddie.com)</span><span class="sxs-lookup"><span data-stu-id="14f40-104">By [Steve Smith](https://ardalis.com/) and [Scott Addie](https://scottaddie.com)</span></span>

<span data-ttu-id="14f40-105">Platformy ASP.NET Core zaprojektowano od podstaw w górę do obsługi i korzystać z iniekcji zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-105">ASP.NET Core is designed from the ground up to support and leverage dependency injection.</span></span> <span data-ttu-id="14f40-106">Platformy ASP.NET Core aplikacje mogą korzystać z usług wbudowana struktura, konfigurując je do metod w klasie uruchamiania, a także iniekcji można skonfigurować usługi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="14f40-106">ASP.NET Core applications can leverage built-in framework services by having them injected into methods in the Startup class, and application services can be configured for injection as well.</span></span> <span data-ttu-id="14f40-107">Domyślny kontener usługi udostępniane przez platformy ASP.NET Core zawiera minimalnego funkcji ustawiony i nie jest przeznaczony do zastąpić inne kontenery.</span><span class="sxs-lookup"><span data-stu-id="14f40-107">The default services container provided by ASP.NET Core provides a minimal feature set and isn't intended to replace other containers.</span></span>

<span data-ttu-id="14f40-108">[Wyświetlić lub pobrać przykładowy kod](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/dependency-injection/sample) ([sposobu pobierania](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="14f40-108">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/dependency-injection/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-is-dependency-injection"></a><span data-ttu-id="14f40-109">Co to jest iniekcji zależności?</span><span class="sxs-lookup"><span data-stu-id="14f40-109">What is Dependency Injection?</span></span>

<span data-ttu-id="14f40-110">Iniekcji zależności (Podpisane) to technika służące osiągnięciu luźne powiązanie między obiektów i ich współpracownicy lub zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-110">Dependency injection (DI) is a technique for achieving loose coupling between objects and their collaborators, or dependencies.</span></span> <span data-ttu-id="14f40-111">Zamiast bezpośrednio uruchamianiu współpracownicy lub przy użyciu statycznych odwołań obiektów klasy wymaga, aby jego akcje są przekazywane do klasy, w dowolny sposób.</span><span class="sxs-lookup"><span data-stu-id="14f40-111">Rather than directly instantiating collaborators, or using static references, the objects a class needs in order to perform its actions are provided to the class in some fashion.</span></span> <span data-ttu-id="14f40-112">W większości przypadków deklaracją klasy ich zależności za pomocą ich konstruktora, dzięki czemu mogą wykonać [jawne zależności zasady](http://deviq.com/explicit-dependencies-principle/).</span><span class="sxs-lookup"><span data-stu-id="14f40-112">Most often, classes will declare their dependencies via their constructor, allowing them to follow the [Explicit Dependencies Principle](http://deviq.com/explicit-dependencies-principle/).</span></span> <span data-ttu-id="14f40-113">Takie podejście jest określany jako "iniekcji konstruktora".</span><span class="sxs-lookup"><span data-stu-id="14f40-113">This approach is known as "constructor injection".</span></span>

<span data-ttu-id="14f40-114">Gdy klasy zostały zaprojektowane z Podpisane pamiętać, są one więcej luźno powiązane ponieważ nie mają bezpośredniego, ustalony zależności w swoich współpracowników.</span><span class="sxs-lookup"><span data-stu-id="14f40-114">When classes are designed with DI in mind, they're more loosely coupled because they don't have direct, hard-coded dependencies on their collaborators.</span></span> <span data-ttu-id="14f40-115">Wynika to [zasady odwracanie zależności](http://deviq.com/dependency-inversion-principle/), które stwierdza, że *"wysokiego poziomu moduły nie są zależne od niskiego poziomu modułów; powinien zależą od obiektów abstrakcyjnych".*</span><span class="sxs-lookup"><span data-stu-id="14f40-115">This follows the [Dependency Inversion Principle](http://deviq.com/dependency-inversion-principle/), which states that *"high level modules shouldn't depend on low level modules; both should depend on abstractions."*</span></span> <span data-ttu-id="14f40-116">Zamiast odwołania do określonej implementacji, klas żądania obiektów abstrakcyjnych (zazwyczaj `interfaces`) które są dostarczane do nich, gdy jest utworzony w klasie.</span><span class="sxs-lookup"><span data-stu-id="14f40-116">Instead of referencing specific implementations, classes request abstractions (typically `interfaces`) which are provided to them when the class is constructed.</span></span> <span data-ttu-id="14f40-117">Wyodrębnianie zależności do interfejsów i zapewnianie implementacje te interfejsy jako parametry jest również przykład [wzorzec projektowania strategii](http://deviq.com/strategy-design-pattern/).</span><span class="sxs-lookup"><span data-stu-id="14f40-117">Extracting dependencies into interfaces and providing implementations of these interfaces as parameters is also an example of the [Strategy design pattern](http://deviq.com/strategy-design-pattern/).</span></span>

<span data-ttu-id="14f40-118">Gdy system jest przeznaczony do użycia Podpisane, z wielu klas żąda ich zależności za pośrednictwem ich konstruktora (lub właściwości), warto mieć klasy dedykowane do tworzenia tych klas z ich skojarzone zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-118">When a system is designed to use DI, with many classes requesting their dependencies via their constructor (or properties), it's helpful to have a class dedicated to creating these classes with their associated dependencies.</span></span> <span data-ttu-id="14f40-119">Tych klas są określane jako *kontenery*, lub w szczególności [Inwersja kontroli (IoC)](http://deviq.com/inversion-of-control/) kontenery lub zależności Iniekcja kontenerów.</span><span class="sxs-lookup"><span data-stu-id="14f40-119">These classes are referred to as *containers*, or more specifically, [Inversion of Control (IoC)](http://deviq.com/inversion-of-control/) containers or Dependency Injection (DI) containers.</span></span> <span data-ttu-id="14f40-120">Kontener jest zasadniczo fabrykę, który jest odpowiedzialny za zapewnienie wystąpienia typów, których wymagane są od niego.</span><span class="sxs-lookup"><span data-stu-id="14f40-120">A container is essentially a factory that's responsible for providing instances of types that are requested from it.</span></span> <span data-ttu-id="14f40-121">Podany typ został zadeklarowany, zawiera on zależności, czy kontener został skonfigurowany, aby zapewnić typów zależności, utworzy zależności w ramach tworzenia żądanego wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="14f40-121">If a given type has declared that it has dependencies, and the container has been configured to provide the dependency types, it will create the dependencies as part of creating the requested instance.</span></span> <span data-ttu-id="14f40-122">W ten sposób można podać wykresy złożonych zależności do klasy bez konieczności stosowania żadnych konstrukcji obiektów ustalony.</span><span class="sxs-lookup"><span data-stu-id="14f40-122">In this way, complex dependency graphs can be provided to classes without the need for any hard-coded object construction.</span></span> <span data-ttu-id="14f40-123">Oprócz tworzenia obiektów z ich zależności, kontenery Zarządzanie zwykle okresy istnienia obiektu w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="14f40-123">In addition to creating objects with their dependencies, containers typically manage object lifetimes within the application.</span></span>

<span data-ttu-id="14f40-124">Platformy ASP.NET Core zawiera proste kontenera wbudowanych (reprezentowane przez `IServiceProvider` interfejsu) obsługującej iniekcji konstruktora domyślnie i program ASP.NET udostępnia pewnych usług za pośrednictwem Podpisane.</span><span class="sxs-lookup"><span data-stu-id="14f40-124">ASP.NET Core includes a simple built-in container (represented by the `IServiceProvider` interface) that supports constructor injection by default, and ASP.NET makes certain services available through DI.</span></span> <span data-ttu-id="14f40-125">ŚRODOWISKO ASP. Kontener dla NET odwołuje się do typów zarządza jako *usług*.</span><span class="sxs-lookup"><span data-stu-id="14f40-125">ASP.NET's container refers to the types it manages as *services*.</span></span> <span data-ttu-id="14f40-126">W dalszej części tego artykułu *usług* odnoszą się do typów, które są zarządzane przez program ASP.NET Core Inwersja kontroli kontenera.</span><span class="sxs-lookup"><span data-stu-id="14f40-126">Throughout the rest of this article, *services* will refer to types that are managed by ASP.NET Core's IoC container.</span></span> <span data-ttu-id="14f40-127">Konfigurowanie usługi kontenera wbudowanych w `ConfigureServices` metody w aplikacji `Startup` klasy.</span><span class="sxs-lookup"><span data-stu-id="14f40-127">You configure the built-in container's services in the `ConfigureServices` method in your application's `Startup` class.</span></span>

> [!NOTE]
> <span data-ttu-id="14f40-128">Pole Fowler został zapisany szeroką gamę artykułu na [Inwersja kontroli kontenerów i wzorzec iniekcji zależności](https://www.martinfowler.com/articles/injection.html).</span><span class="sxs-lookup"><span data-stu-id="14f40-128">Martin Fowler has written an extensive article on [Inversion of Control Containers and the Dependency Injection Pattern](https://www.martinfowler.com/articles/injection.html).</span></span> <span data-ttu-id="14f40-129">Microsoft Patterns and Practices ma również opis dużą [iniekcji zależności](https://msdn.microsoft.com/library/hh323705.aspx).</span><span class="sxs-lookup"><span data-stu-id="14f40-129">Microsoft Patterns and Practices also has a great description of [Dependency Injection](https://msdn.microsoft.com/library/hh323705.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="14f40-130">W tym artykule omówiono iniekcji zależności mają zastosowanie do wszystkich aplikacji ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="14f40-130">This article covers Dependency Injection as it applies to all ASP.NET applications.</span></span> <span data-ttu-id="14f40-131">Iniekcji zależności w ramach kontrolerów MVC jest objęte [iniekcji zależności i kontrolery](../mvc/controllers/dependency-injection.md).</span><span class="sxs-lookup"><span data-stu-id="14f40-131">Dependency Injection within MVC controllers is covered in [Dependency Injection and Controllers](../mvc/controllers/dependency-injection.md).</span></span>

### <a name="constructor-injection-behavior"></a><span data-ttu-id="14f40-132">Zachowanie iniekcji — Konstruktor</span><span class="sxs-lookup"><span data-stu-id="14f40-132">Constructor Injection Behavior</span></span>

<span data-ttu-id="14f40-133">Konstruktor iniekcji wymaga, aby w Konstruktorze *publicznego*.</span><span class="sxs-lookup"><span data-stu-id="14f40-133">Constructor injection requires that the constructor in question be *public*.</span></span> <span data-ttu-id="14f40-134">W przeciwnym razie zgłosi aplikacji `InvalidOperationException`:</span><span class="sxs-lookup"><span data-stu-id="14f40-134">Otherwise, your app will throw an `InvalidOperationException`:</span></span>

> <span data-ttu-id="14f40-135">Nie można odnaleźć odpowiedniego konstruktora dla typu "YourType".</span><span class="sxs-lookup"><span data-stu-id="14f40-135">A suitable constructor for type 'YourType' couldn't be located.</span></span> <span data-ttu-id="14f40-136">Upewnij się, typ jest konkretnych i usług są zarejestrowane dla wszystkich parametrów konstruktora publicznego.</span><span class="sxs-lookup"><span data-stu-id="14f40-136">Ensure the type is concrete and services are registered for all parameters of a public constructor.</span></span>


<span data-ttu-id="14f40-137">Konstruktor iniekcji wymaga tego tylko jeden konstruktor dotyczy istnieje.</span><span class="sxs-lookup"><span data-stu-id="14f40-137">Constructor injection requires that only one applicable constructor exist.</span></span> <span data-ttu-id="14f40-138">Przeciążenia konstruktora są obsługiwane, ale tylko jedno przeciążenie może istnieć, którego argumenty mogą wszystkie spełniać iniekcji zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-138">Constructor overloads are supported, but only one overload can exist whose arguments can all be fulfilled by dependency injection.</span></span> <span data-ttu-id="14f40-139">Jeśli istnieje więcej niż jeden, aplikacja będzie zgłaszać wyjątek `InvalidOperationException`:</span><span class="sxs-lookup"><span data-stu-id="14f40-139">If more than one exists, your app will throw an `InvalidOperationException`:</span></span>

> <span data-ttu-id="14f40-140">Znaleziono wiele konstruktorów akceptuje wszystkie typy podany argument typu "YourType".</span><span class="sxs-lookup"><span data-stu-id="14f40-140">Multiple constructors accepting all given argument types have been found in type 'YourType'.</span></span> <span data-ttu-id="14f40-141">Powinien istnieć tylko jeden konstruktor zastosowania.</span><span class="sxs-lookup"><span data-stu-id="14f40-141">There should only be one applicable constructor.</span></span>

<span data-ttu-id="14f40-142">Konstruktory mogą akceptować argumenty, które nie są dostarczane przez iniekcji zależności, ale muszą one obsługuje przekazywania wartości domyślnych.</span><span class="sxs-lookup"><span data-stu-id="14f40-142">Constructors can accept arguments that are not provided by dependency injection, but these must support default values.</span></span> <span data-ttu-id="14f40-143">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="14f40-143">For example:</span></span>

```csharp
// throws InvalidOperationException: Unable to resolve service for type 'System.String'...
public CharactersController(ICharacterRepository characterRepository, string title)
{
    _characterRepository = characterRepository;
    _title = title;
}

// runs without error
public CharactersController(ICharacterRepository characterRepository, string title = "Characters")
{
    _characterRepository = characterRepository;
    _title = title;
}
```

## <a name="using-framework-provided-services"></a><span data-ttu-id="14f40-144">Za pomocą usług dostarczonych Framework</span><span class="sxs-lookup"><span data-stu-id="14f40-144">Using Framework-Provided Services</span></span>

<span data-ttu-id="14f40-145">`ConfigureServices` Metoda `Startup` klasy jest odpowiedzialny za definiowanie usługi aplikacja będzie korzystać, w tym funkcji platformy Entity Framework Core i ASP.NET Core MVC.</span><span class="sxs-lookup"><span data-stu-id="14f40-145">The `ConfigureServices` method in the `Startup` class is responsible for defining the services the application will use, including platform features like Entity Framework Core and ASP.NET Core MVC.</span></span> <span data-ttu-id="14f40-146">Początkowo `IServiceCollection` do `ConfigureServices` ma następujące usługi zdefiniowane (w zależności od [konfiguracji hosta](xref:fundamentals/hosting)):</span><span class="sxs-lookup"><span data-stu-id="14f40-146">Initially, the `IServiceCollection` provided to `ConfigureServices` has the following services defined (depending on [how the host was configured](xref:fundamentals/hosting)):</span></span>

| <span data-ttu-id="14f40-147">Typ usługi</span><span class="sxs-lookup"><span data-stu-id="14f40-147">Service Type</span></span> | <span data-ttu-id="14f40-148">Okres istnienia</span><span class="sxs-lookup"><span data-stu-id="14f40-148">Lifetime</span></span> |
| ----- | ------- |
| [<span data-ttu-id="14f40-149">Microsoft.AspNetCore.Hosting.IHostingEnvironment</span><span class="sxs-lookup"><span data-stu-id="14f40-149">Microsoft.AspNetCore.Hosting.IHostingEnvironment</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.ihostingenvironment) | <span data-ttu-id="14f40-150">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-150">Singleton</span></span> |
| [<span data-ttu-id="14f40-151">Microsoft.Extensions.Logging.ILoggerFactory</span><span class="sxs-lookup"><span data-stu-id="14f40-151">Microsoft.Extensions.Logging.ILoggerFactory</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.logging.iloggerfactory) | <span data-ttu-id="14f40-152">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-152">Singleton</span></span> |
| [<span data-ttu-id="14f40-153">Microsoft.Extensions.Logging.ILogger&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="14f40-153">Microsoft.Extensions.Logging.ILogger&lt;T&gt;</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.logging.ilogger) | <span data-ttu-id="14f40-154">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-154">Singleton</span></span> |
| [<span data-ttu-id="14f40-155">Microsoft.AspNetCore.Hosting.Builder.IApplicationBuilderFactory</span><span class="sxs-lookup"><span data-stu-id="14f40-155">Microsoft.AspNetCore.Hosting.Builder.IApplicationBuilderFactory</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.builder.iapplicationbuilderfactory) | <span data-ttu-id="14f40-156">Przejściowy</span><span class="sxs-lookup"><span data-stu-id="14f40-156">Transient</span></span> |
| [<span data-ttu-id="14f40-157">Microsoft.AspNetCore.Http.IHttpContextFactory</span><span class="sxs-lookup"><span data-stu-id="14f40-157">Microsoft.AspNetCore.Http.IHttpContextFactory</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.http.ihttpcontextfactory) | <span data-ttu-id="14f40-158">Przejściowy</span><span class="sxs-lookup"><span data-stu-id="14f40-158">Transient</span></span> |
| [<span data-ttu-id="14f40-159">Microsoft.Extensions.Options.IOptions&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="14f40-159">Microsoft.Extensions.Options.IOptions&lt;T&gt;</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.options.ioptions-1) | <span data-ttu-id="14f40-160">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-160">Singleton</span></span> |
| [<span data-ttu-id="14f40-161">System.Diagnostics.DiagnosticSource</span><span class="sxs-lookup"><span data-stu-id="14f40-161">System.Diagnostics.DiagnosticSource</span></span>](https://docs.microsoft.com/dotnet/core/api/system.diagnostics.diagnosticsource) | <span data-ttu-id="14f40-162">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-162">Singleton</span></span> |
| [<span data-ttu-id="14f40-163">System.Diagnostics.DiagnosticListener</span><span class="sxs-lookup"><span data-stu-id="14f40-163">System.Diagnostics.DiagnosticListener</span></span>](https://docs.microsoft.com/dotnet/core/api/system.diagnostics.diagnosticlistener) | <span data-ttu-id="14f40-164">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-164">Singleton</span></span> |
| [<span data-ttu-id="14f40-165">Microsoft.AspNetCore.Hosting.IStartupFilter</span><span class="sxs-lookup"><span data-stu-id="14f40-165">Microsoft.AspNetCore.Hosting.IStartupFilter</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.istartupfilter) | <span data-ttu-id="14f40-166">Przejściowy</span><span class="sxs-lookup"><span data-stu-id="14f40-166">Transient</span></span> |
| [<span data-ttu-id="14f40-167">Microsoft.Extensions.ObjectPool.ObjectPoolProvider</span><span class="sxs-lookup"><span data-stu-id="14f40-167">Microsoft.Extensions.ObjectPool.ObjectPoolProvider</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.objectpool.objectpoolprovider) | <span data-ttu-id="14f40-168">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-168">Singleton</span></span> |
| [<span data-ttu-id="14f40-169">Microsoft.Extensions.Options.IConfigureOptions&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="14f40-169">Microsoft.Extensions.Options.IConfigureOptions&lt;T&gt;</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.options.iconfigureoptions-1) | <span data-ttu-id="14f40-170">Przejściowy</span><span class="sxs-lookup"><span data-stu-id="14f40-170">Transient</span></span> |
| [<span data-ttu-id="14f40-171">Microsoft.AspNetCore.Hosting.Server.IServer</span><span class="sxs-lookup"><span data-stu-id="14f40-171">Microsoft.AspNetCore.Hosting.Server.IServer</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.server.iserver) | <span data-ttu-id="14f40-172">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-172">Singleton</span></span> |
| [<span data-ttu-id="14f40-173">Microsoft.AspNetCore.Hosting.IStartup</span><span class="sxs-lookup"><span data-stu-id="14f40-173">Microsoft.AspNetCore.Hosting.IStartup</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.istartup) | <span data-ttu-id="14f40-174">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-174">Singleton</span></span> |
| [<span data-ttu-id="14f40-175">Microsoft.AspNetCore.Hosting.IApplicationLifetime</span><span class="sxs-lookup"><span data-stu-id="14f40-175">Microsoft.AspNetCore.Hosting.IApplicationLifetime</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.iapplicationlifetime) | <span data-ttu-id="14f40-176">pojedyncze</span><span class="sxs-lookup"><span data-stu-id="14f40-176">Singleton</span></span> |

<span data-ttu-id="14f40-177">Poniżej znajduje się przykład sposobu dodawania dodatkowych usług do kontenera przy użyciu metod rozszerzenia takich jak `AddDbContext`, `AddIdentity`, i `AddMvc`.</span><span class="sxs-lookup"><span data-stu-id="14f40-177">Below is an example of how to add additional services to the container using a number of extension methods like `AddDbContext`, `AddIdentity`, and `AddMvc`.</span></span>

[!code-csharp[Main](../common/samples/WebApplication1/Startup.cs?highlight=5-6,8-10,12&range=39-56)]

<span data-ttu-id="14f40-178">Funkcje i oprogramowanie pośredniczące dostarczane przez platformę ASP.NET, takich jak MVC, wykonaj Konwencji przy użyciu pojedynczego Dodaj*ServiceName* — metoda rozszerzenia zarejestrować wszystkich usług wymaganych przez tej funkcji.</span><span class="sxs-lookup"><span data-stu-id="14f40-178">The features and middleware provided by ASP.NET, such as MVC, follow a convention of using a single Add*ServiceName* extension method to register all of the services required by that feature.</span></span>

>[!TIP]
> <span data-ttu-id="14f40-179">Możesz poprosić o pewnych usług dostarczonych framework w `Startup` Zobacz metody za pomocą ich listy parametrów - [uruchamiania aplikacji](startup.md) więcej szczegółów.</span><span class="sxs-lookup"><span data-stu-id="14f40-179">You can request certain framework-provided services within `Startup` methods through their parameter lists - see [Application Startup](startup.md) for more details.</span></span>

## <a name="registering-your-own-services"></a><span data-ttu-id="14f40-180">Rejestrowanie własnych usług</span><span class="sxs-lookup"><span data-stu-id="14f40-180">Registering Your Own Services</span></span>

<span data-ttu-id="14f40-181">Usługi aplikacji można zarejestrować w następujący sposób.</span><span class="sxs-lookup"><span data-stu-id="14f40-181">You can register your own application services as follows.</span></span> <span data-ttu-id="14f40-182">Pierwszy ogólny typ reprezentuje typ (zazwyczaj interfejs) żądany z kontenera.</span><span class="sxs-lookup"><span data-stu-id="14f40-182">The first generic type represents the type (typically an interface) that will be requested from the container.</span></span> <span data-ttu-id="14f40-183">Drugi typ ogólny reprezentuje typu konkretnego, który zostanie uruchomiony przez kontener i będzie używana do spełnienia takich żądań.</span><span class="sxs-lookup"><span data-stu-id="14f40-183">The second generic type represents the concrete type that will be instantiated by the container and used to fulfill such requests.</span></span>

[!code-csharp[Main](../common/samples/WebApplication1/Startup.cs?range=53-54)]

> [!NOTE]
> <span data-ttu-id="14f40-184">Każdy `services.Add<ServiceName>` — metoda rozszerzenia dodaje (i potencjalnie konfiguruje) usługi.</span><span class="sxs-lookup"><span data-stu-id="14f40-184">Each `services.Add<ServiceName>` extension method adds (and potentially configures) services.</span></span> <span data-ttu-id="14f40-185">Na przykład `services.AddMvc()` dodaje usług wymaga MVC.</span><span class="sxs-lookup"><span data-stu-id="14f40-185">For example, `services.AddMvc()` adds the services MVC requires.</span></span> <span data-ttu-id="14f40-186">Zalecane jest, wykonaj tę Konwencję, umieszczenia metod rozszerzenia w `Microsoft.Extensions.DependencyInjection` przestrzeni nazw w celu hermetyzacji grup rejestracji usługi.</span><span class="sxs-lookup"><span data-stu-id="14f40-186">It's recommended that you follow this convention, placing extension methods in the `Microsoft.Extensions.DependencyInjection` namespace, to encapsulate groups of service registrations.</span></span>

<span data-ttu-id="14f40-187">`AddTransient` Metoda służy do mapowania typów abstrakcyjnych do konkretnych usług, które są tworzone oddzielnie dla każdego obiektu, który wymaga.</span><span class="sxs-lookup"><span data-stu-id="14f40-187">The `AddTransient` method is used to map abstract types to concrete services that are instantiated separately for every object that requires it.</span></span> <span data-ttu-id="14f40-188">Jest to nazywane usługi *okres istnienia*, a okres istnienia dodatkowe opcje zostały opisane poniżej.</span><span class="sxs-lookup"><span data-stu-id="14f40-188">This is known as the service's *lifetime*, and additional lifetime options are described below.</span></span> <span data-ttu-id="14f40-189">Należy wybrać odpowiedni istnienia dla każdej usługi, które należy zarejestrować.</span><span class="sxs-lookup"><span data-stu-id="14f40-189">It's important to choose an appropriate lifetime for each of the services you register.</span></span> <span data-ttu-id="14f40-190">Należy podać nowe wystąpienie usługi do każdej klasy, która zażąda tego?</span><span class="sxs-lookup"><span data-stu-id="14f40-190">Should a new instance of the service be provided to each class that requests it?</span></span> <span data-ttu-id="14f40-191">Należy użyć jednego wystąpienia w całym żądania sieci web danego?</span><span class="sxs-lookup"><span data-stu-id="14f40-191">Should one instance be used throughout a given web request?</span></span> <span data-ttu-id="14f40-192">Czy należy używać pojedynczego wystąpienia dla okresu istnienia aplikacji?</span><span class="sxs-lookup"><span data-stu-id="14f40-192">Or should a single instance be used for the lifetime of the application?</span></span>

<span data-ttu-id="14f40-193">W przykładowym tego artykułu jest proste kontroler, który wyświetla znak nazwy, o nazwie `CharactersController`.</span><span class="sxs-lookup"><span data-stu-id="14f40-193">In the sample for this article, there's a simple controller that displays character names, called `CharactersController`.</span></span> <span data-ttu-id="14f40-194">Jego `Index` metoda Wyświetla bieżącą listę znaków, które były przechowywane w aplikacji i inicjuje połączenie z kilku znaków, jeśli nie ma żadnego.</span><span class="sxs-lookup"><span data-stu-id="14f40-194">Its `Index` method displays the current list of characters that have been stored in the application, and initializes the collection with a handful of characters if none exist.</span></span> <span data-ttu-id="14f40-195">Należy pamiętać, że chociaż Entity Framework Core korzysta z tej aplikacji i `ApplicationDbContext` klasy jego trwałości, żaden z jest widoczna w kontrolerze.</span><span class="sxs-lookup"><span data-stu-id="14f40-195">Note that although this application uses Entity Framework Core and the `ApplicationDbContext` class for its persistence, none of that's apparent in the controller.</span></span> <span data-ttu-id="14f40-196">Zamiast tego mechanizmu dostępu określonych danych ma zostały usunięte za interfejsu `ICharacterRepository`, który następuje [wzorca repozytorium](http://deviq.com/repository-pattern/).</span><span class="sxs-lookup"><span data-stu-id="14f40-196">Instead, the specific data access mechanism has been abstracted behind an interface, `ICharacterRepository`, which follows the [repository pattern](http://deviq.com/repository-pattern/).</span></span> <span data-ttu-id="14f40-197">Wystąpienie `ICharacterRepository` za pośrednictwem konstruktora i ma przypisaną do prywatnego pola, które są następnie używane do dostęp do znaków w razie potrzeby.</span><span class="sxs-lookup"><span data-stu-id="14f40-197">An instance of `ICharacterRepository` is requested via the constructor and assigned to a private field, which is then used to access characters as necessary.</span></span>

[!code-csharp[Main](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Controllers/CharactersController.cs?highlight=3,5,6,7,8,14,21-27&range=8-36)]

<span data-ttu-id="14f40-198">`ICharacterRepository` Definiuje dwie metody kontrolera musi pracować `Character` wystąpień.</span><span class="sxs-lookup"><span data-stu-id="14f40-198">The `ICharacterRepository` defines the two methods the controller needs to work with `Character` instances.</span></span>

[!code-csharp[Main](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Interfaces/ICharacterRepository.cs?highlight=8,9)]

<span data-ttu-id="14f40-199">Ten interfejs z kolei jest implementowany przez typem konkretnym `CharacterRepository`, który jest używany w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="14f40-199">This interface is in turn implemented by a concrete type, `CharacterRepository`, that's used at runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="14f40-200">Sposób Podpisane jest używany z `CharacterRepository` klasy jest ogólny model można wykonać dla wszystkich usług aplikacji, nie tylko w "repozytoria" lub klas dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="14f40-200">The way DI is used with the `CharacterRepository` class is a general model you can follow for all of your application services, not just in "repositories" or data access classes.</span></span>

[!code-csharp[Main](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Models/CharacterRepository.cs?highlight=9,11,12,13,14)]

<span data-ttu-id="14f40-201">Należy pamiętać, że `CharacterRepository` żądań `ApplicationDbContext` w jego konstruktora.</span><span class="sxs-lookup"><span data-stu-id="14f40-201">Note that `CharacterRepository` requests an `ApplicationDbContext` in its constructor.</span></span> <span data-ttu-id="14f40-202">Nie jest rzadko iniekcji zależności do użycia w sposób łańcuchowa podobny do tego, z każdej żądanej zależności z kolei żąda własnych zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-202">It's not unusual for dependency injection to be used in a chained fashion like this, with each requested dependency in turn requesting its own dependencies.</span></span> <span data-ttu-id="14f40-203">Kontener jest odpowiedzialny za rozwiązywanie wszystkich zależności na wykresie i zwracanie całkowicie rozwiązany usługi.</span><span class="sxs-lookup"><span data-stu-id="14f40-203">The container is responsible for resolving all of the dependencies in the graph and returning the fully resolved service.</span></span>

> [!NOTE]
> <span data-ttu-id="14f40-204">Tworzenie żądanego obiektu i wszystkich obiektów wymaga i wszystkie obiekty te wymagają, jest czasami nazywany *wykres obiektu*.</span><span class="sxs-lookup"><span data-stu-id="14f40-204">Creating the requested object, and all of the objects it requires, and all of the objects those require, is sometimes referred to as an *object graph*.</span></span> <span data-ttu-id="14f40-205">Podobnie, zbiorczy zestaw zależności, które muszą zostać rozstrzygnięte jest zwykle nazywany *drzewo zależności* lub *wykresu zależności*.</span><span class="sxs-lookup"><span data-stu-id="14f40-205">Likewise, the collective set of dependencies that must be resolved is typically referred to as a *dependency tree* or *dependency graph*.</span></span>

<span data-ttu-id="14f40-206">W takim przypadku zarówno `ICharacterRepository` i z kolei `ApplicationDbContext` musi być zarejestrowana w kontenerze usług w `ConfigureServices` w `Startup`.</span><span class="sxs-lookup"><span data-stu-id="14f40-206">In this case, both `ICharacterRepository` and in turn `ApplicationDbContext` must be registered with the services container in `ConfigureServices` in `Startup`.</span></span> <span data-ttu-id="14f40-207">`ApplicationDbContext`skonfigurowano wywołanie metody rozszerzenia `AddDbContext<T>`.</span><span class="sxs-lookup"><span data-stu-id="14f40-207">`ApplicationDbContext` is configured with the call to the extension method `AddDbContext<T>`.</span></span> <span data-ttu-id="14f40-208">Poniższy kod przedstawia rejestracji `CharacterRepository` typu.</span><span class="sxs-lookup"><span data-stu-id="14f40-208">The following code shows the registration of the `CharacterRepository` type.</span></span>

[!code-csharp[Main](dependency-injection/sample/DependencyInjectionSample/Startup.cs?highlight=3-5,11&range=16-32)]

<span data-ttu-id="14f40-209">Entity Framework kontekstów należy dodać do kontenera usług przy użyciu `Scoped` okres istnienia.</span><span class="sxs-lookup"><span data-stu-id="14f40-209">Entity Framework contexts should be added to the services container using the `Scoped` lifetime.</span></span> <span data-ttu-id="14f40-210">To jest poświęcony na obsługę automatycznie Jeśli używasz metody pomocnicze, jak pokazano powyżej.</span><span class="sxs-lookup"><span data-stu-id="14f40-210">This is taken care of automatically if you use the helper methods as shown above.</span></span> <span data-ttu-id="14f40-211">Repozytoria, które korzystają z programu Entity Framework należy używać tego samego okresu istnienia.</span><span class="sxs-lookup"><span data-stu-id="14f40-211">Repositories that will make use of Entity Framework should use the same lifetime.</span></span>

>[!WARNING]
> <span data-ttu-id="14f40-212">Rozpoznaje główne zagrożenia dla Uważaj `Scoped` usługi z klasą pojedynczą.</span><span class="sxs-lookup"><span data-stu-id="14f40-212">The main danger to be wary of is resolving a `Scoped` service from a singleton.</span></span> <span data-ttu-id="14f40-213">Prawdopodobnie w takim przypadku usługa ma niepoprawny stan podczas przetwarzania kolejnych żądań.</span><span class="sxs-lookup"><span data-stu-id="14f40-213">It's likely in such a case that the service will have incorrect state when processing subsequent requests.</span></span>

<span data-ttu-id="14f40-214">Usługi z zależnościami, należy zarejestrować je w kontenerze.</span><span class="sxs-lookup"><span data-stu-id="14f40-214">Services that have dependencies should register them in the container.</span></span> <span data-ttu-id="14f40-215">Jeśli usługa Konstruktor wymaga typu pierwotnego, takich jak `string`, to mogą zostać dodane za pomocą [konfiguracji](xref:fundamentals/configuration/index) i [wzorzec opcje](xref:fundamentals/configuration/options).</span><span class="sxs-lookup"><span data-stu-id="14f40-215">If a service's constructor requires a primitive, such as a `string`, this can be injected by using [configuration](xref:fundamentals/configuration/index) and the [options pattern](xref:fundamentals/configuration/options).</span></span>

## <a name="service-lifetimes-and-registration-options"></a><span data-ttu-id="14f40-216">Opcje rejestracji i okresy istnienia usługi</span><span class="sxs-lookup"><span data-stu-id="14f40-216">Service Lifetimes and Registration Options</span></span>

<span data-ttu-id="14f40-217">Usługi ASP.NET można skonfigurować za pomocą następujących okresów:</span><span class="sxs-lookup"><span data-stu-id="14f40-217">ASP.NET services can be configured with the following lifetimes:</span></span>

<span data-ttu-id="14f40-218">**Przejściowy**</span><span class="sxs-lookup"><span data-stu-id="14f40-218">**Transient**</span></span>

<span data-ttu-id="14f40-219">Przejściowa istnienia usług są tworzone zawsze, gdy są one wymagane.</span><span class="sxs-lookup"><span data-stu-id="14f40-219">Transient lifetime services are created each time they're requested.</span></span> <span data-ttu-id="14f40-220">Ten okres istnienia jest najlepsza dla lekkich usług bezstanowych.</span><span class="sxs-lookup"><span data-stu-id="14f40-220">This lifetime works best for lightweight, stateless services.</span></span>

<span data-ttu-id="14f40-221">**Zakres**</span><span class="sxs-lookup"><span data-stu-id="14f40-221">**Scoped**</span></span>

<span data-ttu-id="14f40-222">Okres istnienia w zakresie usług są tworzone raz na każde żądanie.</span><span class="sxs-lookup"><span data-stu-id="14f40-222">Scoped lifetime services are created once per request.</span></span>

<span data-ttu-id="14f40-223">**Pojedyncze**</span><span class="sxs-lookup"><span data-stu-id="14f40-223">**Singleton**</span></span>

<span data-ttu-id="14f40-224">Pojedyncze okres istnienia usług są tworzone po raz pierwszy jest żądanej (lub gdy `ConfigureServices` jest uruchamiany, jeśli określone wystąpienie) i wszystkie kolejne żądania będą następnie używa tego samego wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="14f40-224">Singleton lifetime services are created the first time they're requested (or when `ConfigureServices` is run if you specify an instance there) and then every subsequent request will use the same instance.</span></span> <span data-ttu-id="14f40-225">Jeśli aplikacja wymaga zachowania singleton, umożliwiając kontener usług do zarządzania istnienia usługi jest zalecane zamiast wzorca projektowego singleton wdrażanie i zarządzanie nim okres istnienia z obiektów w klasie samodzielnie.</span><span class="sxs-lookup"><span data-stu-id="14f40-225">If your application requires singleton behavior, allowing the services container to manage the service's lifetime is recommended instead of implementing the singleton design pattern and managing your object's lifetime in the class yourself.</span></span>

<span data-ttu-id="14f40-226">Usługi mogą być rejestrowane w kontenerze na kilka sposobów.</span><span class="sxs-lookup"><span data-stu-id="14f40-226">Services can be registered with the container in several ways.</span></span> <span data-ttu-id="14f40-227">Już widzieliśmy rejestrowania implementacji usługi z danym typem przez określenie konkretnego typu do użycia.</span><span class="sxs-lookup"><span data-stu-id="14f40-227">We have already seen how to register a service implementation with a given type by specifying the concrete type to use.</span></span> <span data-ttu-id="14f40-228">Ponadto fabrykę można określić, który zostanie następnie użyte do utworzenia wystąpienia na żądanie.</span><span class="sxs-lookup"><span data-stu-id="14f40-228">In addition, a factory can be specified, which will then be used to create the instance on demand.</span></span> <span data-ttu-id="14f40-229">Trzeci podejście jest bezpośrednio określić wystąpienie typu do użycia, w którego przypadku kontenera nigdy nie będzie podejmować próby utworzenia wystąpienia (ani będzie dysponować wystąpienia).</span><span class="sxs-lookup"><span data-stu-id="14f40-229">The third approach is to directly specify the instance of the type to use, in which case the container will never attempt to create an instance (nor will it dispose of the instance).</span></span>

<span data-ttu-id="14f40-230">Aby zademonstrować różnica między te opcje okres istnienia i rejestracji, należy wziąć pod uwagę prosty interfejs, który reprezentuje jeden lub więcej zadań jako *operacji* z unikatowym identyfikatorem `OperationId`.</span><span class="sxs-lookup"><span data-stu-id="14f40-230">To demonstrate the difference between these lifetime and registration options, consider a simple interface that represents one or more tasks as an *operation* with a unique identifier, `OperationId`.</span></span> <span data-ttu-id="14f40-231">W zależności od tego, w jaki sposób skonfigurować okres istnienia dla tej usługi kontener zawierają tych samych lub różnych wystąpień usługi do klasy wysyłającego żądanie.</span><span class="sxs-lookup"><span data-stu-id="14f40-231">Depending on how we configure the lifetime for this service, the container will provide either the same or different instances of the service to the requesting class.</span></span> <span data-ttu-id="14f40-232">Aby umożliwić Wyczyść, którego okres istnienia jest wymagany, utworzymy jednego typu na opcja okresu istnienia:</span><span class="sxs-lookup"><span data-stu-id="14f40-232">To make it clear which lifetime is being requested, we will create one type per lifetime option:</span></span>

[!code-csharp[Main](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Interfaces/IOperation.cs?highlight=5-8)]

<span data-ttu-id="14f40-233">Wprowadzania tych interfejsów przy użyciu jednej klasy, `Operation`, która akceptuje `Guid` w konstruktorze lub używa nowego `Guid` Jeśli nie zostanie podana.</span><span class="sxs-lookup"><span data-stu-id="14f40-233">We implement these interfaces using a single class, `Operation`, that accepts a `Guid` in its constructor, or uses a new `Guid` if none is provided.</span></span>

<span data-ttu-id="14f40-234">Następnie w `ConfigureServices`, każdy typ jest dodawany do kontenera zgodnie z jego istnienia o nazwie:</span><span class="sxs-lookup"><span data-stu-id="14f40-234">Next, in `ConfigureServices`, each type is added to the container according to its named lifetime:</span></span>

[!code-csharp[Main](dependency-injection/sample/DependencyInjectionSample/Startup.cs?range=26-32)]

<span data-ttu-id="14f40-235">Należy pamiętać, że `IOperationSingletonInstance` usługa używa określonego wystąpienia o identyfikatorze znane `Guid.Empty` , będzie on wyczyść podczas tego typu jest używana (jego identyfikator Guid będą same zera).</span><span class="sxs-lookup"><span data-stu-id="14f40-235">Note that the `IOperationSingletonInstance` service is using a specific instance with a known ID of `Guid.Empty` so it will be clear when this type is in use (its Guid will be all zeroes).</span></span> <span data-ttu-id="14f40-236">Możemy także zarejestrowane `OperationService` to zależy od wszystkich innych `Operation` typy, dzięki czemu będzie wyczyść w ramach żądania określa, czy ta usługa jest wprowadzenie tego samego wystąpienia co kontroler, lub do nowego, dla każdego typu operacji.</span><span class="sxs-lookup"><span data-stu-id="14f40-236">We have also registered an `OperationService` that depends on each of the other `Operation` types, so that it will be clear within a request whether this service is getting the same instance as the controller, or a new one, for each operation type.</span></span> <span data-ttu-id="14f40-237">Ta usługa nie będzie prezentować zależnościami jako właściwości, co mogą być wyświetlane w widoku.</span><span class="sxs-lookup"><span data-stu-id="14f40-237">All this service does is expose its dependencies as properties, so they can be displayed in the view.</span></span>

[!code-csharp[Main](dependency-injection/sample/DependencyInjectionSample/Services/OperationService.cs)]

<span data-ttu-id="14f40-238">Aby zademonstrować okresy istnienia obiektu, w ramach i między oddzielne poszczególnych żądań do aplikacji, obejmuje próbki `OperationsController` który żąda każdego rodzaju `IOperation` typu, a także `OperationService`.</span><span class="sxs-lookup"><span data-stu-id="14f40-238">To demonstrate the object lifetimes within and between separate individual requests to the application, the sample includes an `OperationsController` that requests each kind of `IOperation` type as well as an `OperationService`.</span></span> <span data-ttu-id="14f40-239">`Index` Akcji następnie wyświetla wszystkie usługi i kontrolera `OperationId` wartości.</span><span class="sxs-lookup"><span data-stu-id="14f40-239">The `Index` action then displays all of the controller's and service's `OperationId` values.</span></span>

[!code-csharp[Main](dependency-injection/sample/DependencyInjectionSample/Controllers/OperationsController.cs)]

<span data-ttu-id="14f40-240">Teraz dwa oddzielne żądania zostały wprowadzone do tej akcji kontrolera:</span><span class="sxs-lookup"><span data-stu-id="14f40-240">Now two separate requests are made to this controller action:</span></span>

![Widok operacji zależności iniekcji przykładowej aplikacji sieci web uruchomiony w programie Microsoft Edge przedstawiający operacji identyfikatory (GUID) dla przejściowy, polu, jako pojedynczej i wystąpienie kontrolera i operacji usługi operacji na pierwsze żądanie.](dependency-injection/_static/lifetimes_request1.png)

![Operacje wyświetlane, zawierające wartości Identyfikatora operacji drugie żądanie.](dependency-injection/_static/lifetimes_request2.png)

<span data-ttu-id="14f40-243">Sprawdź, które z `OperationId` wartości różnią się w obrębie żądanie i między żądaniami.</span><span class="sxs-lookup"><span data-stu-id="14f40-243">Observe which of the `OperationId` values vary within a request, and between requests.</span></span>

* <span data-ttu-id="14f40-244">*Przejściowa* obiektów zawsze są różne; nowe wystąpienie jest dostępne na każdym kontrolerze i każdej usługi.</span><span class="sxs-lookup"><span data-stu-id="14f40-244">*Transient* objects are always different; a new instance is provided to every controller and every service.</span></span>

* <span data-ttu-id="14f40-245">*Zakres* obiekty są takie same, w ramach żądania, ale różne na różnych żądań</span><span class="sxs-lookup"><span data-stu-id="14f40-245">*Scoped* objects are the same within a request, but different across different requests</span></span>

* <span data-ttu-id="14f40-246">*Pojedyncze* obiekty są takie same dla każdego obiektu i każde żądanie (niezależnie od tego, czy wystąpienie znajduje się w `ConfigureServices`)</span><span class="sxs-lookup"><span data-stu-id="14f40-246">*Singleton* objects are the same for every object and every request (regardless of whether an instance is provided in `ConfigureServices`)</span></span>

## <a name="request-services"></a><span data-ttu-id="14f40-247">Żądanie usługi</span><span class="sxs-lookup"><span data-stu-id="14f40-247">Request Services</span></span>

<span data-ttu-id="14f40-248">Dostępne w programie ASP.NET usługi, poproś `HttpContext` dostępnych za pośrednictwem `RequestServices` kolekcji.</span><span class="sxs-lookup"><span data-stu-id="14f40-248">The services available within an ASP.NET request from `HttpContext` are exposed through the `RequestServices` collection.</span></span>

![Element HttpContext żądania usług Intellisense kontekstowe okna dialogowego informujący, że żądanie usługi pobiera lub ustawia element IServiceProvider, który zapewnia dostęp do kontenera usługi żądania.](dependency-injection/_static/request-services.png)

<span data-ttu-id="14f40-250">Żądanie usługi reprezentują usługi, konfigurowanie i żądania jako część aplikacji.</span><span class="sxs-lookup"><span data-stu-id="14f40-250">Request Services represent the services you configure and request as part of your application.</span></span> <span data-ttu-id="14f40-251">Gdy obiektów Określ zależności, te są spełnione przez typy w `RequestServices`, a nie `ApplicationServices`.</span><span class="sxs-lookup"><span data-stu-id="14f40-251">When your objects specify dependencies, these are satisfied by the types found in `RequestServices`, not `ApplicationServices`.</span></span>

<span data-ttu-id="14f40-252">Ogólnie rzecz biorąc nie można używać tych właściwości bezpośrednio, zamiast tego preferowanie do żądania z klas, które wymagają za pośrednictwem swojej klasy Konstruktor typów i pozwolić framework wstrzyknięcia zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-252">Generally, you shouldn't use these properties directly, preferring instead to request the types your classes you require via your class's constructor, and letting the framework inject these dependencies.</span></span> <span data-ttu-id="14f40-253">Daje to klasy, które są łatwiejsze do testowania (zobacz [testowanie](../testing/index.md)) i są bardziej luźno powiązane.</span><span class="sxs-lookup"><span data-stu-id="14f40-253">This yields classes that are easier to test (see [Testing](../testing/index.md)) and are more loosely coupled.</span></span>

> [!NOTE]
> <span data-ttu-id="14f40-254">Preferowane jest żądaniem zależności jako parametry konstruktora do uzyskiwania dostępu do `RequestServices` kolekcji.</span><span class="sxs-lookup"><span data-stu-id="14f40-254">Prefer requesting dependencies as constructor parameters to accessing the `RequestServices` collection.</span></span>

## <a name="designing-your-services-for-dependency-injection"></a><span data-ttu-id="14f40-255">Projektowanie usług iniekcji zależności</span><span class="sxs-lookup"><span data-stu-id="14f40-255">Designing Your Services For Dependency Injection</span></span>

<span data-ttu-id="14f40-256">Zalecane jest zaprojektowanie usług na iniekcji zależności swoich współpracowników.</span><span class="sxs-lookup"><span data-stu-id="14f40-256">You should design your services to use dependency injection to get their collaborators.</span></span> <span data-ttu-id="14f40-257">Oznacza to, unikając stosowania wywołania metody statycznej stanowe (co spowodować zapachu kodu, znany jako [statycznych przylepna](http://deviq.com/static-cling/)) i bezpośrednie tworzenie wystąpień klas zależnych w ramach usługi.</span><span class="sxs-lookup"><span data-stu-id="14f40-257">This means avoiding the use of stateful static method calls (which result in a code smell known as [static cling](http://deviq.com/static-cling/)) and the direct instantiation of dependent classes within your services.</span></span> <span data-ttu-id="14f40-258">Pomocne może zapamiętać hasło, [nowych jest sklejki](https://ardalis.com/new-is-glue), w przypadku wybrania, czy można utworzyć wystąpienia typu lub żądania za pomocą iniekcji zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-258">It may help to remember the phrase, [New is Glue](https://ardalis.com/new-is-glue), when choosing whether to instantiate a type or to request it via dependency injection.</span></span> <span data-ttu-id="14f40-259">Wykonując [stałych zasad z zorientowane na projekt obiektu](http://deviq.com/solid/), klas naturalnie będzie często za mały, dobrze factored i łatwo przetestowane.</span><span class="sxs-lookup"><span data-stu-id="14f40-259">By following the [SOLID Principles of Object Oriented Design](http://deviq.com/solid/), your classes will naturally tend to be small, well-factored, and easily tested.</span></span>

<span data-ttu-id="14f40-260">Co zrobić, jeśli okaże się, że klas zazwyczaj mają sposób zbyt wiele zależności, które są wstrzykiwane?</span><span class="sxs-lookup"><span data-stu-id="14f40-260">What if you find that your classes tend to have way too many dependencies being injected?</span></span> <span data-ttu-id="14f40-261">Zwykle jest to znak klasy próbuje zrobić zbyt dużo i prawdopodobnie narusza zasady ograniczeń oprogramowania - [jednej zasady odpowiedzialności](http://deviq.com/single-responsibility-principle/).</span><span class="sxs-lookup"><span data-stu-id="14f40-261">This is generally a sign that your class is trying to do too much, and is probably violating SRP - the [Single Responsibility Principle](http://deviq.com/single-responsibility-principle/).</span></span> <span data-ttu-id="14f40-262">Zobacz, jeśli użytkownik Refaktoryzuj klasy przez przeniesienie niektórych jego obowiązki do nowej klasy.</span><span class="sxs-lookup"><span data-stu-id="14f40-262">See if you can refactor the class by moving some of its responsibilities into a new class.</span></span> <span data-ttu-id="14f40-263">Należy pamiętać, że Twoje `Controller` klasy powinny koncentrować się na dotyczy interfejsu użytkownika, business reguł i danych access szczegóły implementacji powinna być przechowywana w odpowiednie do tych klas [oddzielnych dotyczy](http://deviq.com/separation-of-concerns/).</span><span class="sxs-lookup"><span data-stu-id="14f40-263">Keep in mind that your `Controller` classes should be focused on UI concerns, so business rules and data access implementation details should be kept in classes appropriate to these [separate concerns](http://deviq.com/separation-of-concerns/).</span></span>

<span data-ttu-id="14f40-264">W szczególności w odniesieniu do dostępu do danych może wstrzyknąć `DbContext` w kontrolerach (przy założeniu EF zostały dodane do kontenera usług w `ConfigureServices`).</span><span class="sxs-lookup"><span data-stu-id="14f40-264">With regards to data access specifically, you can inject the `DbContext` into your controllers (assuming you've added EF to the services container in `ConfigureServices`).</span></span> <span data-ttu-id="14f40-265">Niektórzy deweloperzy wolą używać interfejsu repozytorium, w bazie danych zostanie wstrzyknięta `DbContext` bezpośrednio.</span><span class="sxs-lookup"><span data-stu-id="14f40-265">Some developers prefer to use a repository interface to the database rather than injecting the `DbContext` directly.</span></span> <span data-ttu-id="14f40-266">Przy użyciu interfejsu w celu hermetyzacji danych logika dostępu w jednym miejscu można zminimalizować liczbę miejsc, trzeba będzie zmienić podczas zmiany bazy danych.</span><span class="sxs-lookup"><span data-stu-id="14f40-266">Using an interface to encapsulate the data access logic in one place can minimize how many places you will have to change when your database changes.</span></span>

### <a name="disposing-of-services"></a><span data-ttu-id="14f40-267">Usuwanie usług</span><span class="sxs-lookup"><span data-stu-id="14f40-267">Disposing of services</span></span>

<span data-ttu-id="14f40-268">Kontener wywoła `Dispose` dla `IDisposable` tworzy typy.</span><span class="sxs-lookup"><span data-stu-id="14f40-268">The container will call `Dispose` for `IDisposable` types it creates.</span></span> <span data-ttu-id="14f40-269">Jednak jeśli wystąpienie dodać do kontenera samodzielnie, go nie zostanie usunięte.</span><span class="sxs-lookup"><span data-stu-id="14f40-269">However, if you add an instance to the container yourself, it will not be disposed.</span></span>

<span data-ttu-id="14f40-270">Przykład:</span><span class="sxs-lookup"><span data-stu-id="14f40-270">Example:</span></span>

```csharp
// Services implement IDisposable:
public class Service1 : IDisposable {}
public class Service2 : IDisposable {}
public class Service3 : IDisposable {}

public interface ISomeService {}
public class SomeServiceImplementation : ISomeService, IDisposable {}


public void ConfigureServices(IServiceCollection services)
{
    // container will create the instance(s) of these types and will dispose them
    services.AddScoped<Service1>();
    services.AddSingleton<Service2>();
    services.AddSingleton<ISomeService>(sp => new SomeServiceImplementation());

    // container didn't create instance so it will NOT dispose it
    services.AddSingleton<Service3>(new Service3());
    services.AddSingleton(new Service3());
}
```

> [!NOTE]
> <span data-ttu-id="14f40-271">W wersji 1.0 kontenera wywołano metodę dispose *wszystkie* `IDisposable` obiektów, w tym te nie zostały utworzone.</span><span class="sxs-lookup"><span data-stu-id="14f40-271">In version 1.0, the container called dispose on *all* `IDisposable` objects, including those it didn't create.</span></span>

## <a name="replacing-the-default-services-container"></a><span data-ttu-id="14f40-272">Zastępowanie domyślnego kontenera usług</span><span class="sxs-lookup"><span data-stu-id="14f40-272">Replacing the default services container</span></span>

<span data-ttu-id="14f40-273">Kontener usług wbudowanych jest przeznaczona do potrzebami podstawowe ramach i większość aplikacji klienta oparty na jej.</span><span class="sxs-lookup"><span data-stu-id="14f40-273">The built-in services container is meant to serve the basic needs of the framework and most consumer applications built on it.</span></span> <span data-ttu-id="14f40-274">Jednak deweloperzy można zastąpić wbudowanych kontenera ich preferowanego kontenera.</span><span class="sxs-lookup"><span data-stu-id="14f40-274">However, developers can replace the built-in container with their preferred container.</span></span> <span data-ttu-id="14f40-275">`ConfigureServices` Metoda zwykle zwraca `void`, ale zmiana jego sygnatury do zwrócenia `IServiceProvider`, innego kontenera można konfigurować i zwrócony.</span><span class="sxs-lookup"><span data-stu-id="14f40-275">The `ConfigureServices` method typically returns `void`, but if its signature is changed to return `IServiceProvider`, a different container can be configured and returned.</span></span> <span data-ttu-id="14f40-276">Brak dostępnych wiele kontenerów Inwersja kontroli dla platformy .NET.</span><span class="sxs-lookup"><span data-stu-id="14f40-276">There are many IOC containers available for .NET.</span></span> <span data-ttu-id="14f40-277">W tym przykładzie [Autofac](https://autofac.org/) jest używany pakiet.</span><span class="sxs-lookup"><span data-stu-id="14f40-277">In this example, the [Autofac](https://autofac.org/) package is used.</span></span>

<span data-ttu-id="14f40-278">Najpierw należy zainstalować pakiety odpowiedniego kontenera:</span><span class="sxs-lookup"><span data-stu-id="14f40-278">First, install the appropriate container package(s):</span></span>

* `Autofac`
* `Autofac.Extensions.DependencyInjection`

<span data-ttu-id="14f40-279">Skonfiguruj kontener w `ConfigureServices` i zwracać `IServiceProvider`:</span><span class="sxs-lookup"><span data-stu-id="14f40-279">Next, configure the container in `ConfigureServices` and return an `IServiceProvider`:</span></span>

```csharp
public IServiceProvider ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    // Add other framework services

    // Add Autofac
    var containerBuilder = new ContainerBuilder();
    containerBuilder.RegisterModule<DefaultModule>();
    containerBuilder.Populate(services);
    var container = containerBuilder.Build();
    return new AutofacServiceProvider(container);
}
```

> [!NOTE]
> <span data-ttu-id="14f40-280">Korzystając z kontenera Podpisane innych firm, należy zmienić `ConfigureServices` , tak aby zwracało `IServiceProvider` zamiast `void`.</span><span class="sxs-lookup"><span data-stu-id="14f40-280">When using a third-party DI container, you must change `ConfigureServices` so that it returns `IServiceProvider` instead of `void`.</span></span>

<span data-ttu-id="14f40-281">Na koniec skonfiguruj Autofac normalnie w `DefaultModule`:</span><span class="sxs-lookup"><span data-stu-id="14f40-281">Finally, configure Autofac as normal in `DefaultModule`:</span></span>

```csharp
public class DefaultModule : Module
{
    protected override void Load(ContainerBuilder builder)
    {
        builder.RegisterType<CharacterRepository>().As<ICharacterRepository>();
    }
}
```

<span data-ttu-id="14f40-282">W czasie wykonywania Autofac będzie służyć do rozwiązywania typów i wstrzyknięcia zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-282">At runtime, Autofac will be used to resolve types and inject dependencies.</span></span> <span data-ttu-id="14f40-283">[Dowiedz się więcej o korzystaniu z Autofac i ASP.NET Core](http://docs.autofac.org/en/latest/integration/aspnetcore.html).</span><span class="sxs-lookup"><span data-stu-id="14f40-283">[Learn more about using Autofac and ASP.NET Core](http://docs.autofac.org/en/latest/integration/aspnetcore.html).</span></span>

### <a name="thread-safety"></a><span data-ttu-id="14f40-284">Bezpieczeństwo wątków</span><span class="sxs-lookup"><span data-stu-id="14f40-284">Thread safety</span></span>

<span data-ttu-id="14f40-285">Usługi Singleton należy bezpieczeństwa wątków.</span><span class="sxs-lookup"><span data-stu-id="14f40-285">Singleton services need to be thread safe.</span></span> <span data-ttu-id="14f40-286">Jeśli usługi singleton ma zależność usługi przejściowy, przejściowych usługi może być również konieczne zapewniać bezpieczeństwo wątkowe zależności od sposobu ich wykorzystywania singleton.</span><span class="sxs-lookup"><span data-stu-id="14f40-286">If a singleton service has a dependency on a transient service, the transient service may also need to be thread safe depending how it’s used by the singleton.</span></span>

## <a name="recommendations"></a><span data-ttu-id="14f40-287">Zalecenia</span><span class="sxs-lookup"><span data-stu-id="14f40-287">Recommendations</span></span>

<span data-ttu-id="14f40-288">Podczas pracy z iniekcji zależności należy pamiętać o następujących zaleceń:</span><span class="sxs-lookup"><span data-stu-id="14f40-288">When working with dependency injection, keep the following recommendations in mind:</span></span>

* <span data-ttu-id="14f40-289">Podpisane jest przeznaczony dla obiektów, które mają złożonych zależności.</span><span class="sxs-lookup"><span data-stu-id="14f40-289">DI is for objects that have complex dependencies.</span></span> <span data-ttu-id="14f40-290">Kontrolery, usługi kart i repozytoriów przedstawiono wszystkie obiekty, które mogą zostać dodane do Podpisane.</span><span class="sxs-lookup"><span data-stu-id="14f40-290">Controllers, services, adapters, and repositories are all examples of objects that might be added to DI.</span></span>

* <span data-ttu-id="14f40-291">Unikaj przechowywania danych i konfiguracji bezpośrednio w Podpisane.</span><span class="sxs-lookup"><span data-stu-id="14f40-291">Avoid storing data and configuration directly in DI.</span></span> <span data-ttu-id="14f40-292">Na przykład koszyk użytkownika zwykle nie należy dodać do kontenera usług.</span><span class="sxs-lookup"><span data-stu-id="14f40-292">For example, a user's shopping cart shouldn't typically be added to the services container.</span></span> <span data-ttu-id="14f40-293">Należy używać konfiguracji [wzorzec opcje](xref:fundamentals/configuration/options).</span><span class="sxs-lookup"><span data-stu-id="14f40-293">Configuration should use the [options pattern](xref:fundamentals/configuration/options).</span></span> <span data-ttu-id="14f40-294">Podobnie należy unikać obiektów "symbol zastępczy danych", które istnieją tylko dostęp do innego obiektu.</span><span class="sxs-lookup"><span data-stu-id="14f40-294">Similarly, avoid "data holder" objects that only exist to allow access to some other object.</span></span> <span data-ttu-id="14f40-295">Warto żądania bieżącego elementu potrzebne za pośrednictwem Podpisane, jeśli to możliwe.</span><span class="sxs-lookup"><span data-stu-id="14f40-295">It's better to request the actual item needed via DI, if possible.</span></span>

* <span data-ttu-id="14f40-296">Unikaj statycznych dostęp do usług.</span><span class="sxs-lookup"><span data-stu-id="14f40-296">Avoid static access to services.</span></span>

* <span data-ttu-id="14f40-297">Unikaj lokalizacji usługi w kodzie aplikacji.</span><span class="sxs-lookup"><span data-stu-id="14f40-297">Avoid service location in your application code.</span></span>

* <span data-ttu-id="14f40-298">Unikaj statycznych dostęp do `HttpContext`.</span><span class="sxs-lookup"><span data-stu-id="14f40-298">Avoid static access to `HttpContext`.</span></span>

> [!NOTE]
> <span data-ttu-id="14f40-299">Podobnie jak wszystkie zestawy zaleceń mogą wystąpić sytuacje, w których zostanie zignorowany, co jest wymagane.</span><span class="sxs-lookup"><span data-stu-id="14f40-299">Like all sets of recommendations, you may encounter situations where ignoring one is required.</span></span> <span data-ttu-id="14f40-300">Znaleziono wyjątki, aby się bardzo rzadko — przeważnie bardzo szczególnych przypadkach w ramach samego.</span><span class="sxs-lookup"><span data-stu-id="14f40-300">We have found exceptions to be rare -- mostly very special cases within the framework itself.</span></span>

<span data-ttu-id="14f40-301">Należy pamiętać, że iniekcji zależności *alternatywnych* do wzorce dostępu do obiektu statyczne/globalne.</span><span class="sxs-lookup"><span data-stu-id="14f40-301">Remember, dependency injection is an *alternative* to static/global object access patterns.</span></span> <span data-ttu-id="14f40-302">Nie można wykorzystać zalety Podpisane, jeśli można mieszać z dostępem do obiektu statycznego.</span><span class="sxs-lookup"><span data-stu-id="14f40-302">You won't be able to realize the benefits of DI if you mix it with static object access.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="14f40-303">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="14f40-303">Additional Resources</span></span>

* [<span data-ttu-id="14f40-304">Uruchamianie aplikacji</span><span class="sxs-lookup"><span data-stu-id="14f40-304">Application Startup</span></span>](startup.md)

* [<span data-ttu-id="14f40-305">Testowanie</span><span class="sxs-lookup"><span data-stu-id="14f40-305">Testing</span></span>](../testing/index.md)

* [<span data-ttu-id="14f40-306">Czysty kod platformy ASP.NET Core z iniekcji zależności (MSDN)</span><span class="sxs-lookup"><span data-stu-id="14f40-306">Writing Clean Code in ASP.NET Core with Dependency Injection (MSDN)</span></span>](https://msdn.microsoft.com/magazine/mt703433.aspx)

* [<span data-ttu-id="14f40-307">Projekt aplikacji zarządzanych przez kontener, Prelude: Gdzie jest kontener należeć?</span><span class="sxs-lookup"><span data-stu-id="14f40-307">Container-Managed Application Design, Prelude: Where does the Container Belong?</span></span>](https://blogs.msdn.microsoft.com/nblumhardt/2008/12/26/container-managed-application-design-prelude-where-does-the-container-belong/)

* [<span data-ttu-id="14f40-308">Zasada jawne zależności</span><span class="sxs-lookup"><span data-stu-id="14f40-308">Explicit Dependencies Principle</span></span>](http://deviq.com/explicit-dependencies-principle/)

* <span data-ttu-id="14f40-309">[Inwersja kontroli kontenerów i wzorzec iniekcji zależności](https://www.martinfowler.com/articles/injection.html) (Fowler)</span><span class="sxs-lookup"><span data-stu-id="14f40-309">[Inversion of Control Containers and the Dependency Injection Pattern](https://www.martinfowler.com/articles/injection.html) (Fowler)</span></span>
