---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
title: Buforowanie danych w architekturze (C#) | Dokumentacja firmy Microsoft
author: rick-anderson
description: W poprzednim samouczku opisano sposób stosowania buforowanie w warstwie prezentacji. W tym samouczku będziemy Dowiedz się, jak skorzystać z naszych warstwowego architectu...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/30/2007
ms.topic: article
ms.assetid: d29a7c41-0628-4a23-9dfc-bfea9c6c1054
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
msc.type: authoredcontent
ms.openlocfilehash: 9ca91ecdaed536fe69196e0f726138590d7a9b77
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2018
ms.locfileid: "30879221"
---
<a name="caching-data-in-the-architecture-c"></a><span data-ttu-id="c4cfc-104">Buforowanie danych w architekturze (C#)</span><span class="sxs-lookup"><span data-stu-id="c4cfc-104">Caching Data in the Architecture (C#)</span></span>
====================
<span data-ttu-id="c4cfc-105">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c4cfc-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c4cfc-106">[Pobierz przykładową aplikację](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) lub [pobierania plików PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c4cfc-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) or [Download PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span></span>

> <span data-ttu-id="c4cfc-107">W poprzednim samouczku opisano sposób stosowania buforowanie w warstwie prezentacji.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="c4cfc-108">W tym samouczku będziemy Dowiedz się, jak skorzystać z naszych warstwowa architektura do pamięci podręcznej danych w warstwie logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="c4cfc-109">Firma Microsoft to zrobić przez rozszerzanie architektury do dołączenia do buforowania warstwy.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-109">We do this by extending the architecture to include a Caching Layer.</span></span>


## <a name="introduction"></a><span data-ttu-id="c4cfc-110">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="c4cfc-110">Introduction</span></span>

<span data-ttu-id="c4cfc-111">Jak widzieliśmy w poprzednim samouczek buforowanie danych s ObjectDataSource jest tak proste, jak ustawienie kilka właściwości.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="c4cfc-112">Niestety ObjectDataSource stosuje buforowanie w warstwie prezentacji, ściśle składającą zasad buforowania z strony ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="c4cfc-113">Jednym z powodów tworzenia warstwowa architektura jest umożliwienie takie sprzężenia uszkodzenie.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="c4cfc-114">Warstwy logiki biznesowej, na przykład oddziela logiki biznesowej ze stron ASP.NET podczas Warstwa dostępu do danych oddziela szczegółów dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="c4cfc-115">To oddzielenie szczegóły dostępu logikę i dane biznesowe jest preferowana, w części, ponieważ sprawia, że system był bardziej czytelny, więcej utrzymaniu i bardziej elastyczne, aby zmienić.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="c4cfc-116">Umożliwia także dla domeny wiedzy i podziału pracy Deweloper pracujący nad warstwę prezentacji t muszą być zapoznać się ze szczegółami s bazy danych, aby wykonać swoje zadania.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="c4cfc-117">Rozdzielenie zasad buforowania z warstwy prezentacji oferuje podobne korzyści.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="c4cfc-118">W tym samouczku będziemy rozszerzać Nasza architektura, aby uwzględnić *buforowanie warstwy* (lub CL skrócie) która jest stosowana w naszym zasad buforowania.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="c4cfc-119">Buforowanie warstwa będzie zawierać `ProductsCL` klasy, która zapewnia dostęp do informacji o produkcie z metody, takie jak `GetProducts()`, `GetProductsByCategoryID(categoryID)`, itd., gdy została wywołana, będzie pierwsza próba pobrania danych z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="c4cfc-120">Jeśli pamięć podręczna jest pusta, te metody wywoła odpowiednie `ProductsBLL` metoda logiki warstwy Biznesowej, które z kolei może pobrać danych z warstwy DAL.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="c4cfc-121">`ProductsCL` Metody buforować dane pobrane z logiki warstwy Biznesowej przed zwróceniem.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="c4cfc-122">Jak pokazano na rysunku 1, CL znajduje się między prezentacji i warstwy logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>


![Warstwa buforowania (CL) jest kolejną warstwę nasze architektury](caching-data-in-the-architecture-cs/_static/image1.png)

<span data-ttu-id="c4cfc-124">**Rysunek 1**: buforowania warstwy (CL) jest kolejną warstwę nasze architektury</span><span class="sxs-lookup"><span data-stu-id="c4cfc-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>


## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="c4cfc-125">Krok 1: Tworzenie buforowania klas warstwy</span><span class="sxs-lookup"><span data-stu-id="c4cfc-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="c4cfc-126">W tym samouczku utworzymy bardzo proste CL z jednej klasy `ProductsCL` mający tylko kilku metod.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="c4cfc-127">Tworzenie pełną warstwy buforowanie dla całej aplikacji wymaga utworzenia `CategoriesCL`, `EmployeesCL`, i `SuppliersCL` klasy i udostępnieniu metod w tych klas warstwy buforowania dla każdego dostępu lub zmiana metody danych w logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="c4cfc-128">Podobnie jak w przypadku logiki warstwy Biznesowej i warstwy DAL, buforowanie warstwy powinny być implementowane w idealnym przypadku jako osobne projektu biblioteki klas; jednak wprowadzimy go jako klasa w `App_Code` folderu.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="c4cfc-129">Więcej bezpośrednio oddzielne CL klas z klas DAL i logiki warstwy Biznesowej, umożliwiają s Utwórz nowy podfolder w `App_Code` folderu.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="c4cfc-130">Kliknij prawym przyciskiem myszy `App_Code` folder w Eksploratorze rozwiązań wybierz nowy Folder i nadaj nazwę nowego folderu `CL`.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="c4cfc-131">Po utworzeniu tego folderu, Dodaj do niej nową klasę o nazwie `ProductsCL.cs`.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-131">After creating this folder, add to it a new class named `ProductsCL.cs`.</span></span>


![Dodaj nowy Folder o nazwie CL i klasę o nazwie ProductsCL.cs](caching-data-in-the-architecture-cs/_static/image2.png)

<span data-ttu-id="c4cfc-133">**Rysunek 2**: Dodaj nowy Folder o nazwie `CL` i klasę o nazwie `ProductsCL.cs`</span><span class="sxs-lookup"><span data-stu-id="c4cfc-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.cs`</span></span>


<span data-ttu-id="c4cfc-134">`ProductsCL` Klasy powinny zawierać ten sam zestaw metod dostępu i modyfikacji danych tak jak w odpowiedniej klasie warstwy logiki biznesowej (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="c4cfc-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="c4cfc-135">Zamiast tworzenia wszystkie te metody umożliwiają s tylko kompilacji kilka tutaj, aby uzyskać pewne pojęcie o wzorce używane przez CL.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="c4cfc-136">W szczególności dodamy `GetProducts()` i `GetProductsByCategoryID(categoryID)` metod w kroku 3 i `UpdateProduct` przeciążenia w kroku 4.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="c4cfc-137">Możesz dodać pozostałe `ProductsCL` metod i `CategoriesCL`, `EmployeesCL`, i `SuppliersCL` klas w wolnym czasie.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="c4cfc-138">Krok 2: Odczytywanie i zapisywanie do pamięci podręcznej danych</span><span class="sxs-lookup"><span data-stu-id="c4cfc-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="c4cfc-139">ObjectDataSource przedstawione w powyższej samouczek wewnętrznie funkcji buforowania używa pamięci podręcznej programu ASP.NET danych do przechowywania danych pobranych z logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="c4cfc-140">Pamięć podręczna danych również można uzyskać programistycznie z klasy związane z kodem stron ASP.NET lub z klas w architekturze s aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="c4cfc-141">Do odczytu i zapisu w pamięci podręcznej danych z klasy związane z kodem s strony ASP.NET, użyj następującego wzorca:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample1.cs)]

<span data-ttu-id="c4cfc-142">[ `Cache` Klasy](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [ `Insert` metody](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) ma kilka przeciążeń.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="c4cfc-143">`Cache["key"] = value` i `Cache.Insert(key, value)` to samo i zarówno dodania elementu do pamięci podręcznej przy użyciu określonego klucza bez zdefiniowanego wygaśnięcia.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-143">`Cache["key"] = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="c4cfc-144">Zazwyczaj chcemy Określ wygaśnięcia podczas dodawania elementu do pamięci podręcznej, zarówno jako zależność i/lub na podstawie czasu wygaśnięcia.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="c4cfc-145">Użyj jednego z innych `Insert` przeciążenia metody s, aby podać informacje na podstawie zależności lub czasu wygaśnięcia.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="c4cfc-146">Buforowanie warstwy s metody, należy najpierw sprawdź, czy żądane dane są w pamięci podręcznej, a jeśli tak, przywrócić go stamtąd.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="c4cfc-147">Jeśli żądanych danych nie jest w pamięci podręcznej, musi być wywoływane odpowiedniej metody logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="c4cfc-148">Jego wartość zwrotna, należy w pamięci podręcznej i zwracany, jak pokazano na poniższym diagramie sekwencji.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>


![Metody s buforowanie warstwy zwracać dane z pamięci podręcznej, jeśli jego s dostępne](caching-data-in-the-architecture-cs/_static/image3.png)

<span data-ttu-id="c4cfc-150">**Rysunek 3**: warstwa buforowanie s metody zwracają dane z pamięci podręcznej, jeśli jego s dostępne</span><span class="sxs-lookup"><span data-stu-id="c4cfc-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>


<span data-ttu-id="c4cfc-151">Sekwencja przedstawione na rysunku 3 odbywa się w klasach CL przy użyciu następującego wzorca:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample2.cs)]

<span data-ttu-id="c4cfc-152">W tym miejscu *typu* jest typu danych są przechowywane w pamięci podręcznej `Northwind.ProductsDataTable`, na przykład *klucza* jest klucz, który unikatowo identyfikuje element pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="c4cfc-153">Jeśli element z określonym *klucza* nie znajduje się w pamięci podręcznej, następnie *wystąpienia* będzie `null` i dane zostaną pobrane z odpowiedniej metody logiki warstwy Biznesowej i dodane do pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-153">If the item with the specified *key* is not in the cache, then *instance* will be `null` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="c4cfc-154">W czasie `return instance` osiągnięciu *wystąpienia* zawiera odwołanie do danych z pamięci podręcznej lub pobierane z logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-154">By the time `return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="c4cfc-155">Należy użyć powyżej wzorzec podczas uzyskiwania dostępu do danych z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="c4cfc-156">Następującego wzorca, który na pierwszy rzut oka wygląda równoważnej zawiera niewielka różnica wprowadzającej wyścigu.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="c4cfc-157">Warunki wyścigu są trudne do debugowania, ponieważ ujawnić się sporadycznie i trudnych do odtworzenia.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample3.cs)]

<span data-ttu-id="c4cfc-158">Różnica w drugą fragment niepoprawny kod jest to, że zamiast odwołania do elementu pamięci podręcznej są przechowywane w zmiennej lokalnej, pamięć podręczna danych jest dostępny bezpośrednio w instrukcji warunkowej *i* w `return`.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `return`.</span></span> <span data-ttu-id="c4cfc-159">Załóżmy, że po osiągnięciu tego kodu `Cache["key"]` ma wartość inną niż`null`, ale przed wysłaniem `return` osiągnięciu instrukcji, system wyklucza mogą *klucza* z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-159">Imagine that when this code is reached, `Cache["key"]` is non-`null`, but before the `return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="c4cfc-160">W tym przypadku rzadkich zwróci kod `null` wartość zamiast oczekiwanego typu obiektu.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-160">In this rare case, the code will return a `null` value rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="c4cfc-161">Pamięć podręczna danych jest bezpieczne wątkowo, tak zrobisz potrzebę t synchronizujący dostęp wątku dla prostego odczytów i zapisów.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-161">The data cache is thread-safe, so you don t need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="c4cfc-162">Jednak jeśli zachodzi potrzeba wykonania wielu operacji na danych w pamięci podręcznej, które muszą być atomic, jest odpowiedzialny za wdrażanie blokady lub innych mechanizmu w celu zapewnienia bezpieczeństwa wątków.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="c4cfc-163">Zobacz [synchronizowanie dostęp do pamięci podręcznej programu ASP.NET](http://www.ddj.com/184406369) Aby uzyskać więcej informacji.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>


<span data-ttu-id="c4cfc-164">Element może zostać wykluczony programowo z pamięci podręcznej danych przy użyciu [ `Remove` metody](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample4.cs)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="c4cfc-165">Krok 3: Zwracanie informacji o produkcie z`ProductsCL`— klasa</span><span class="sxs-lookup"><span data-stu-id="c4cfc-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="c4cfc-166">Dla tego samouczka let s implementuje dwie metody w celu zwrócenia informacji o produkcie z `ProductsCL` klasy: `GetProducts()` i `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="c4cfc-167">Jak `ProductsBL` klasy warstwy logiki biznesowej, `GetProducts()` metody w CL zwraca informacje o wszystkich produktów jako `Northwind.ProductsDataTable` obiektu, podczas `GetProductsByCategoryID(categoryID)` zwraca wszystkie produkty z określonej kategorii.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="c4cfc-168">Poniższy kod przedstawia część metod w `ProductsCL` klasy:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-cs/samples/sample5.vb)]

<span data-ttu-id="c4cfc-169">Najpierw należy zanotować `DataObject` i `DataObjectMethodAttribute` atrybuty stosowane do klasy i metody.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="c4cfc-170">Te atrybuty zawierają informacje do kreatora s ObjectDataSource wskazującą, jakie klasy i metody powinny być wyświetlane w s kroki kreatora.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="c4cfc-171">Ponieważ CL klasy i metody będą mieli dostęp z ObjectDataSource w warstwie prezentacji, po dodaniu tych atrybutów, aby ulepszyć środowisko czasu projektowania.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="c4cfc-172">Odwołaj się do [Tworzenie warstwy logiki biznesowej](../introduction/creating-a-business-logic-layer-cs.md) samouczka bardziej szczegółowego opis tych atrybutów i ich wpływu.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="c4cfc-173">W `GetProducts()` i `GetProductsByCategoryID(categoryID)` metody, dane zwrócone w wyniku `GetCacheItem(key)` metody jest przypisany do zmiennej lokalnej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="c4cfc-174">`GetCacheItem(key)` Metodę, która zajmiemy się wkrótce, zwraca konkretny element z pamięci podręcznej oparte na określony *klucza*.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="c4cfc-175">Jeśli nie z tych danych zostanie znaleziony w pamięci podręcznej, są pobierane z odpowiadającego `ProductsBLL` metoda klasy, a następnie dodany do pamięci podręcznej przy użyciu `AddCacheItem(key, value)` metody.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="c4cfc-176">`GetCacheItem(key)` i `AddCacheItem(key, value)` metody interfejsu odpowiednio z pamięci podręcznej danych, odczytywanie i zapisywanie wartości.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="c4cfc-177">`GetCacheItem(key)` Metoda jest prostsza dwóch.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="c4cfc-178">Po prostu zwraca wartość z klasy pamięci podręcznej, za pomocą przekazany do *klucza*:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample6.cs)]

<span data-ttu-id="c4cfc-179">`GetCacheItem(key)` nie używa *klucza* wartość jak podany, ale zamiast tego wywołania `GetCacheKey(key)` metody, która zwraca *klucza* poprzedzony przez ProductsCache —.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="c4cfc-180">`MasterCacheKeyArray`, Które zawiera ciąg ProductsCache, jest już używana przez `AddCacheItem(key, value)` metody, ponieważ zajmiemy się na chwilę.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="c4cfc-181">Z kodem klasę strony ASP.NET pamięci podręcznej danych jest możliwy za pomocą `Page` klasy s [ `Cache` właściwości](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)i umożliwia składnię `Cache["key"] = value`, zgodnie z opisem w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache["key"] = value`, as discussed in Step 2.</span></span> <span data-ttu-id="c4cfc-182">Po klasie w architekturze pamięci podręcznej danych jest możliwy za pomocą `HttpRuntime.Cache` lub `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="c4cfc-183">[Peterowi Johnson](https://weblogs.asp.net/pjohnson/default.aspx)jego wpis w blogu [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) uwagi dotyczące wydajności nieznaczne zaletą używania `HttpRuntime` zamiast `HttpContext.Current`; w rezultacie `ProductsCL` używa `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="c4cfc-184">Jeśli architektury jest implementowane za pomocą projektów biblioteki klas, musisz dodać odwołanie do `System.Web` zestawu, aby można było używać [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) i [element HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) klasy.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>


<span data-ttu-id="c4cfc-185">Jeśli element nie zostanie znaleziony w pamięci podręcznej, `ProductsCL` metod klasy s pobrać danych z logiki warstwy Biznesowej i dodaj go do pamięci podręcznej przy użyciu `AddCacheItem(key, value)` metody.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="c4cfc-186">Aby dodać *wartość* do pamięci podręcznej możemy użyć następujący kod, który używa upływie 60 sekund:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample7.cs)]

<span data-ttu-id="c4cfc-187">`DateTime.Now.AddSeconds(CacheDuration)` Określa okres ważności na podstawie czasu 60 sekund w przyszłości podczas [ `System.Web.Caching.Cache.NoSlidingExpiration` ](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) wskazuje s, ponieważ nie wygasanie przewijania.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="c4cfc-188">Podczas to `Insert` przeciążenie metody ma wejściowych parametry dla obu bezwzględnym i przedłużanie ważności, możesz udostępniać jedno z nich.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="c4cfc-189">Jeśli spróbujesz określić bezwzględny czas i przedział czasu, `Insert` metoda zgłosi `ArgumentException` wyjątku.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="c4cfc-190">Ta implementacja `AddCacheItem(key, value)` metoda ma obecnie niektóre nieprawidłowości.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="c4cfc-191">Firma Microsoft będzie adresu i rozwiązać te problemy w kroku 4.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-191">We'll address and overcome these issues in Step 4.</span></span>


## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="c4cfc-192">Krok 4: Unieważniania pamięci podręcznej podczas danych jest zmodyfikowany za pomocą architektury</span><span class="sxs-lookup"><span data-stu-id="c4cfc-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="c4cfc-193">Wraz z metod pobierania danych buforowanie warstwy należy podać te same metody jako logiki warstwy Biznesowej, wstawianie, aktualizowanie i usuwanie danych.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="c4cfc-194">Metody modyfikacji danych s CL nie należy modyfikować buforowane dane, ale zamiast wywoływać metodę logiki warstwy Biznesowej s do modyfikacji odpowiednich danych i następnie unieważnić pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="c4cfc-195">Jak widzieliśmy w poprzednim samouczek jest takie samo zachowanie stosowanym przez element ObjectDataSource po włączeniu buforowania funkcji i jej `Insert`, `Update`, lub `Delete` metody są wywoływane.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="c4cfc-196">Następujące `UpdateProduct` przeciążenia ilustruje sposób implementowania metod modyfikacji danych w CL:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample8.cs)]

<span data-ttu-id="c4cfc-197">Modyfikacja odpowiednie dane warstwy logiki biznesowej — metoda jest wywoływana, ale przed zwróceniem odpowiedzi musimy unieważnienie pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="c4cfc-198">Niestety, unieważniania pamięci podręcznej nie jest utrudnione ponieważ `ProductsCL` klasy s `GetProducts()` i `GetProductsByCategoryID(categoryID)` metody należy dodać elementy do pamięci podręcznej z różnymi kluczami i `GetProductsByCategoryID(categoryID)` metoda dodaje element różnych pamięci podręcznej dla każdego unikatowy *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="c4cfc-199">Gdy unieważniania pamięci podręcznej, należy usunąć *wszystkie* elementów, które mogły zostać dodane przez `ProductsCL` klasy.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="c4cfc-200">Można to zrobić przez skojarzenie *pamięci podręcznej zależności* z każdym elementem dodanych do pamięci podręcznej w `AddCacheItem(key, value)` metody.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="c4cfc-201">Ogólnie rzecz biorąc zależności pamięci podręcznej może być innego elementu w pamięci podręcznej, pliku w systemie plików lub dane z bazy danych programu Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="c4cfc-202">Gdy zależności zmiany lub jest usunięty z pamięci podręcznej, elementy pamięci podręcznej skojarzonej z nim automatycznie są usunięty z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="c4cfc-203">W tym samouczku, chcemy, aby utworzyć dodatkowe elementu w pamięci podręcznej, która służy jako zależność pamięci podręcznej dla wszystkich elementów dodane za pośrednictwem `ProductsCL` klasy.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="c4cfc-204">W ten sposób wszystkie te elementy można usunąć z pamięci podręcznej przez usunięcie zależności pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="c4cfc-205">Aktualizacja Let s `AddCacheItem(key, value)` — metoda poszczególnych elementów dodanych do pamięci podręcznej za pomocą tej metody, dzięki którym jest skojarzony z zależnością jednej pamięci podręcznej:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample9.cs)]

<span data-ttu-id="c4cfc-206">`MasterCacheKeyArray` jest tablicą ciągów, który zawiera pojedynczą wartość ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="c4cfc-207">Po pierwsze element pamięci podręcznej zostanie dodany do pamięci podręcznej i przypisane do bieżącej daty i godziny.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="c4cfc-208">Jeśli istnieje już element pamięci podręcznej, jest aktualizowana.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="c4cfc-209">Następnie jest tworzony zależności pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="c4cfc-210">[ `CacheDependency` Klasy](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s Konstruktor ma kilka przeciążeń, ale używaną w tym miejscu oczekuje dwóch `string` tablicy danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `string` array inputs.</span></span> <span data-ttu-id="c4cfc-211">Pierwsza z nich określa zestaw plików, które mają być używane jako zależności.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="c4cfc-212">Ponieważ firma Microsoft ADAM Chcę używać zależności opartych na plikach, wartość `null` służy do pierwszego parametru wejściowego.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-212">Since we don t want to use any file-based dependencies, a value of `null` is used for the first input parameter.</span></span> <span data-ttu-id="c4cfc-213">Drugi parametr wejściowy określa zestaw kluczy pamięci podręcznej do użycia jako zależności.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="c4cfc-214">W tym miejscu możemy określić naszego jednego zależności `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="c4cfc-215">`CacheDependency` Są następnie przekazywane do `Insert` metody.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="c4cfc-216">Z tym modyfikację `AddCacheItem(key, value)`, invaliding pamięci podręcznej jest tak proste, jak usunięcie zależności.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample10.cs)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="c4cfc-217">Krok 5: Wywoływanie buforowania warstwy z warstwy prezentacji</span><span class="sxs-lookup"><span data-stu-id="c4cfc-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="c4cfc-218">Buforowanie warstwy s klasy i metody może służyć do pracy z danymi przy użyciu technik możemy stawienia zbadać w całym te samouczki.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="c4cfc-219">Aby zilustrować pracę z danymi w pamięci podręcznej, Zapisz zmiany, aby `ProductsCL` klasy, a następnie otwórz `FromTheArchitecture.aspx` strony `Caching` folderu i Dodaj element GridView.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="c4cfc-220">Z widoku GridView s tagu Utwórz nowy element ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="c4cfc-221">W pierwszym kroku kreatora s powinna zostać wyświetlona `ProductsCL` klasy jako jedną z opcji z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>


<span data-ttu-id="c4cfc-222">[![Klasa ProductsCL znajduje się na liście rozwijanej obiektu biznesowa](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c4cfc-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span></span>

<span data-ttu-id="c4cfc-223">**Rysunek 4**: `ProductsCL` klasa znajduje się na liście rozwijanej obiektu Business ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](caching-data-in-the-architecture-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c4cfc-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image6.png))</span></span>


<span data-ttu-id="c4cfc-224">Po wybraniu `ProductsCL`, kliknij przycisk Dalej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="c4cfc-225">Listy rozwijanej wybierz karcie zawiera dwa elementy - `GetProducts()` i `GetProductsByCategoryID(categoryID)` i na karcie Aktualizacja ma jedyny `UpdateProduct` przeciążenia.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="c4cfc-226">Wybierz `GetProducts()` metody z wybierz kartę i `UpdateProducts` metody na karcie AKTUALIZACJĘ i kliknij przycisk Zakończ.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>


<span data-ttu-id="c4cfc-227">[![Metody klasy ProductsCL s są wymienione w listy rozwijanej](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c4cfc-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span></span>

<span data-ttu-id="c4cfc-228">**Rysunek 5**: `ProductsCL` metod klasy s są wymienione w listy rozwijanej ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](caching-data-in-the-architecture-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c4cfc-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image9.png))</span></span>


<span data-ttu-id="c4cfc-229">Po zakończeniu działania kreatora programu Visual Studio ustawi ObjectDataSource s `OldValuesParameterFormatString` właściwości `original_{0}` i dodaj odpowiednie pola do widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="c4cfc-230">Zmień `OldValuesParameterFormatString` jego wartość domyślna właściwości `{0}`i skonfigurować do obsługi stronicowania, sortowanie i edytowanie widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="c4cfc-231">Ponieważ `UploadProducts` używane przez CL przeciążenie akceptuje tylko nazwa produktu edytowanych s i cen, ograniczyć widoku GridView, tak aby tylko te pola są edytowalne.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="c4cfc-232">W poprzednim samouczek zdefiniowanego GridView zawierać pól dla `ProductName`, `CategoryName`, i `UnitPrice` pól.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="c4cfc-233">Możesz replikować to formatowanie i struktury, w tym przypadku z widoku GridView i ObjectDataSource s deklaratywne znaczników powinien wyglądać podobnie do następującego:</span><span class="sxs-lookup"><span data-stu-id="c4cfc-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](caching-data-in-the-architecture-cs/samples/sample11.aspx)]

<span data-ttu-id="c4cfc-234">W tym momencie mamy strona używa warstwy buforowania.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="c4cfc-235">Aby wyświetlić pamięci podręcznej w akcji, ustaw punkty przerwania w `ProductsCL` klasy s `GetProducts()` i `UpdateProduct` metody.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="c4cfc-236">Odwiedź stronę w przeglądarce i kroków kodu podczas sortowania i stronicowania, aby wyświetlić dane pobierane z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="c4cfc-237">Następnie zaktualizuj rekord i należy pamiętać, że unieważnienia pamięci podręcznej, a w rezultacie jest pobierana z logiki warstwy Biznesowej w przypadku danych jest odbitych do widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="c4cfc-238">Warstwa buforowanie w pobierania towarzyszące w tym artykule nie zostało zakończone.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="c4cfc-239">Zawiera tylko jedną klasę `ProductsCL`, który sportowy tylko kilku metod.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="c4cfc-240">Ponadto tylko jednej strony ASP.NET używa CL (`~/Caching/FromTheArchitecture.aspx`) wszystkich innych nadal logiki warstwy Biznesowej bezpośrednie odwołanie.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="c4cfc-241">Jeśli planujesz używanie CL w aplikacji, wszystkie wywołania z warstwy prezentacji należy przejdź do CL, które wymagałyby, który klasy s CL, i metody pasuje do tych klasy i metody w logiki warstwy Biznesowej aktualnie używane przez warstwę prezentacji.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>


## <a name="summary"></a><span data-ttu-id="c4cfc-242">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="c4cfc-242">Summary</span></span>

<span data-ttu-id="c4cfc-243">Podczas buforowania, mogą być stosowane na warstwę prezentacji z programu ASP.NET 2.0 s SqlDataSource i kontrolki ObjectDataSource, najlepiej buforowanie obowiązki będzie delegowane do oddzielnych warstwy architektury.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="c4cfc-244">W tym samouczku utworzyliśmy buforowanie warstwy, która znajduje się między warstwą prezentacji a warstwy logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="c4cfc-245">Buforowanie warstwy musi podać ten sam zestaw klasy i metody, które istnieją w logiki warstwy Biznesowej i są nazywane z warstwy prezentacji.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="c4cfc-246">Przykłady buforowanie warstwy możemy przedstawione w tym i samouczki poprzedniego wystawiane *reaktywne ładowania*.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="c4cfc-247">Z reaktywne ładowania danych została załadowana do pamięci podręcznej tylko po wysłaniu żądania danych i brakuje danych z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="c4cfc-248">Dane mogą być również *aktywnego załadować* do pamięci podręcznej, technika który ładuje dane w pamięci podręcznej przed będzie to wymagane.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="c4cfc-249">W następnym samouczku przedstawiono będzie przykładem aktywnego ładowania, jeśli przyjrzymy się jak przechowywać wartości statyczne do pamięci podręcznej podczas uruchamiania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="c4cfc-250">Programowanie przyjemność!</span><span class="sxs-lookup"><span data-stu-id="c4cfc-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c4cfc-251">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="c4cfc-251">About the Author</span></span>

<span data-ttu-id="c4cfc-252">[Scott Bento](http://www.4guysfromrolla.com/ScottMitchell.shtml), autora siedmiu książek ASP/ASP.NET i twórcę z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje z technologii Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c4cfc-253">Scott działa jako niezależnego konsultanta trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c4cfc-254">Jest jego najnowszej książki [ *Sams nauczyć się ASP.NET 2.0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="c4cfc-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c4cfc-255">Piotr można uzyskać pod adresem [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) lub za pośrednictwem jego blog, który znajduje się w temacie [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="c4cfc-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c4cfc-256">Specjalne podziękowania dla</span><span class="sxs-lookup"><span data-stu-id="c4cfc-256">Special Thanks To</span></span>

<span data-ttu-id="c4cfc-257">Ten samouczek serii zostało sprawdzone przez wiele recenzentów przydatne.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-257">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c4cfc-258">Recenzenta realizacji w tym samouczku został Teresa Murph.</span><span class="sxs-lookup"><span data-stu-id="c4cfc-258">Lead reviewer for this tutorial was Teresa Murph.</span></span> <span data-ttu-id="c4cfc-259">Zainteresowani recenzowania Moje nadchodzących artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="c4cfc-259">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c4cfc-260">Jeśli tak, Porzuć mnie linii w [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c4cfc-260">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c4cfc-261">[Poprzednie](caching-data-with-the-objectdatasource-cs.md)
> [dalej](caching-data-at-application-startup-cs.md)</span><span class="sxs-lookup"><span data-stu-id="c4cfc-261">[Previous](caching-data-with-the-objectdatasource-cs.md)
[Next](caching-data-at-application-startup-cs.md)</span></span>
