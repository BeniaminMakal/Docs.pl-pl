---
uid: web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
title: "Używanie metod asynchronicznych w języku ASP.NET 4.5 | Dokumentacja firmy Microsoft"
author: Rick-Anderson
description: "W tym samouczku uczy podstaw konstruowania asynchroniczne aplikacji formularzy sieci Web ASP.NET przy użyciu programu Visual Studio Express 2012 for Web, który jest bezpłatny..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/06/2012
ms.topic: article
ms.assetid: a585c9a2-7c8e-478b-9706-90f3739c50d1
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
msc.type: authoredcontent
ms.openlocfilehash: 73e46134cfafb9edc4c1888211eab44b8f2bf828
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/24/2018
---
<a name="using-asynchronous-methods-in-aspnet-45"></a><span data-ttu-id="26f3b-103">Używanie metod asynchronicznych w języku ASP.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="26f3b-103">Using Asynchronous Methods in ASP.NET 4.5</span></span>
====================
<span data-ttu-id="26f3b-104">Przez [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="26f3b-104">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="26f3b-105">W tym samouczku udzieli Ci podstawy asynchroniczne formularzy sieci Web ASP.NET aplikacji za pomocą [programu Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), który jest bezpłatną wersję programu Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="26f3b-105">This tutorial will teach you the basics of building an asynchronous ASP.NET Web Forms application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="26f3b-106">Można również użyć [programu Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="26f3b-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span> <span data-ttu-id="26f3b-107">Następujące sekcje są uwzględnione w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="26f3b-107">The following sections are included in this tutorial.</span></span>
> 
> - [<span data-ttu-id="26f3b-108">Jak żądania są przetwarzane przez puli wątków</span><span class="sxs-lookup"><span data-stu-id="26f3b-108">How Requests Are Processed by the Thread Pool</span></span>](#HowRequestsProcessedByTP)
> - [<span data-ttu-id="26f3b-109">Wybieranie metody synchronicznego lub asynchronicznego</span><span class="sxs-lookup"><span data-stu-id="26f3b-109">Choosing Synchronous or Asynchronous Methods</span></span>](#ChoosingSyncVasync)
> - [<span data-ttu-id="26f3b-110">Przykładowa aplikacja</span><span class="sxs-lookup"><span data-stu-id="26f3b-110">The Sample Application</span></span>](#SampleApp)
> - [<span data-ttu-id="26f3b-111">Na stronie synchroniczne Gizmos</span><span class="sxs-lookup"><span data-stu-id="26f3b-111">The Gizmos Synchronous Page</span></span>](#GizmosSynch)
> - [<span data-ttu-id="26f3b-112">Tworzenie stron Gizmos asynchroniczne</span><span class="sxs-lookup"><span data-stu-id="26f3b-112">Creating an Asynchronous Gizmos Page</span></span>](#CreatingAsynchGizmos)
> - [<span data-ttu-id="26f3b-113">Wykonywanie operacji na wielu równolegle</span><span class="sxs-lookup"><span data-stu-id="26f3b-113">Performing Multiple Operations in Parallel</span></span>](#Parallel)
> - [<span data-ttu-id="26f3b-114">Przy użyciu Token anulowania</span><span class="sxs-lookup"><span data-stu-id="26f3b-114">Using a Cancellation Token</span></span>](#CancelToken)
> - [<span data-ttu-id="26f3b-115">Konfiguracja serwera dla wywołania usługi sieci Web opóźnienia wysokiej współbieżności/wysoki</span><span class="sxs-lookup"><span data-stu-id="26f3b-115">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>](#ServerConfig)
> 
> <span data-ttu-id="26f3b-116">Kompletnego przykładu znajduje się w tym samouczku w</span><span class="sxs-lookup"><span data-stu-id="26f3b-116">A complete sample is provided for this tutorial at</span></span>  
>  <span data-ttu-id="26f3b-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) na [GitHub](https://github.com/) lokacji.</span><span class="sxs-lookup"><span data-stu-id="26f3b-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) on the [GitHub](https://github.com/) site.</span></span>


<span data-ttu-id="26f3b-118">Strony sieci Web platformy ASP.NET 4.5 w połączeniu [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) umożliwia rejestrowanie metod asynchronicznych, które zwracają obiekt typu [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="26f3b-118">ASP.NET 4.5 Web Pages in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to register asynchronous methods that return an object of type [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="26f3b-119">.NET Framework 4 wprowadzono asynchroniczne koncepcji programowania nazywane [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) i obsługuje funkcję ASP.NET 4.5 [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="26f3b-119">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET 4.5 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="26f3b-120">Zadania są reprezentowane przez **zadań** typu i powiązanych typów z [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="26f3b-120">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="26f3b-121">.NET Framework 4.5 opiera się na tym obsługa komunikacji asynchronicznej z [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych, które sprawiają, że praca z [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) znacznie mniej złożona niż poprzednie obiektów metody asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="26f3b-121">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="26f3b-122">[Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) — słowo kluczowe jest syntaktycznych skrócona forma wskazujący, który fragment kodu asynchronicznie ma oczekiwać na innych części kodu.</span><span class="sxs-lookup"><span data-stu-id="26f3b-122">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="26f3b-123">[Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) — słowo kluczowe reprezentuje wskazówkę, która służy do oznaczania metod jako opartego na zadaniach asynchronicznej metody.</span><span class="sxs-lookup"><span data-stu-id="26f3b-123">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="26f3b-124">Kombinacja **await**, **async**i **zadań** obiektu ułatwia do pisania kodu asynchronicznego w programie .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="26f3b-124">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="26f3b-125">Nowy model do metod asynchronicznych jest nazywany *wzorca asynchronicznego opartego na zadaniach* (**wybierz**).</span><span class="sxs-lookup"><span data-stu-id="26f3b-125">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="26f3b-126">Ten samouczek zakłada, masz pewną znajomość asynchronicznych za pomocą programing [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych i [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="26f3b-126">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="26f3b-127">Aby uzyskać więcej informacji na temat używania [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych i [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) przestrzeni nazw, zobacz następujące odwołania.</span><span class="sxs-lookup"><span data-stu-id="26f3b-127">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="26f3b-128">Oficjalny dokument: Asynchrony w .NET</span><span class="sxs-lookup"><span data-stu-id="26f3b-128">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="26f3b-129">Async/Await — często zadawane pytania</span><span class="sxs-lookup"><span data-stu-id="26f3b-129">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="26f3b-130">Programowanie asynchroniczne programu Visual Studio</span><span class="sxs-lookup"><span data-stu-id="26f3b-130">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a><span data-ttu-id="26f3b-131">Jak żądania są przetwarzane przez puli wątków</span><span class="sxs-lookup"><span data-stu-id="26f3b-131">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="26f3b-132">Na serwerze sieci web programu .NET Framework przechowuje pulę wątków, które są używane do obsługi żądań ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="26f3b-132">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="26f3b-133">Gdy żądanie dociera, wątków z puli jest wysyłane do przetwarzania tego żądania.</span><span class="sxs-lookup"><span data-stu-id="26f3b-133">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="26f3b-134">Jeśli żądanie jest przetwarzane synchronicznie, wątku, który przetwarza żądania jest zajęty podczas żądanie jest przetwarzane i że wątek nie może zrealizować innego żądania.</span><span class="sxs-lookup"><span data-stu-id="26f3b-134">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="26f3b-135">To może nie być problem, ponieważ pula wątków może się wystarczająco duże, aby pomieścić wiele wątków zajęty.</span><span class="sxs-lookup"><span data-stu-id="26f3b-135">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="26f3b-136">Jednak jest ograniczona liczba wątków w puli wątków (domyślna wartość maksymalna .NET 4.5 jest 5000).</span><span class="sxs-lookup"><span data-stu-id="26f3b-136">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="26f3b-137">W dużych aplikacji o wysokiej współbieżności długotrwałe żądania może być zajęta wszystkich dostępnych wątków.</span><span class="sxs-lookup"><span data-stu-id="26f3b-137">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="26f3b-138">Ten stan jest nazywany zablokowania wątku.</span><span class="sxs-lookup"><span data-stu-id="26f3b-138">This condition is known as thread starvation.</span></span> <span data-ttu-id="26f3b-139">Po osiągnięciu tego warunku, serwer sieci web kolejki żądań.</span><span class="sxs-lookup"><span data-stu-id="26f3b-139">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="26f3b-140">Jeśli zapełnienia kolejki żądań serwera sieci web odrzuca żądania z stan HTTP 503 (serwer jest zbyt zajęty).</span><span class="sxs-lookup"><span data-stu-id="26f3b-140">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="26f3b-141">Pula wątków CLR ma ograniczenia na nowe iniekcji wątku.</span><span class="sxs-lookup"><span data-stu-id="26f3b-141">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="26f3b-142">Jeśli seryjnym współbieżności (to znaczy witryny sieci web może nagle get dużą liczbę żądań) i wszystkie wątki żądanie dostępne są zajęte ze względu na wywołania zaplecza duże opóźnienie, szybkość iniekcji ograniczone wątku można zwiększyć bezpieczeństwo aplikacji odpowiadać bardzo źle.</span><span class="sxs-lookup"><span data-stu-id="26f3b-142">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="26f3b-143">Ponadto w każdym nowym wątku dodane do puli wątków ma obciążenie (na przykład 1 MB pamięci stosu).</span><span class="sxs-lookup"><span data-stu-id="26f3b-143">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="26f3b-144">Aplikacji sieci web przy użyciu metod synchronicznych wywołań duże opóźnienie usługi, którym puli wątków rozwoju domyślne .NET 4.5 maksymalnie 5 000 wątków będzie używać około 5 GB więcej pamięci niż aplikacja stanie takie same żądania obsługi przy użyciu metody asynchroniczne i wątków tylko 50.</span><span class="sxs-lookup"><span data-stu-id="26f3b-144">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="26f3b-145">Gdy podczas wykonywania zadanie asynchroniczne, nie zawsze korzystasz wątku.</span><span class="sxs-lookup"><span data-stu-id="26f3b-145">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="26f3b-146">Na przykład po wprowadzeniu żądanie usługi sieci web asynchroniczne, program ASP.NET nie będzie korzystać wszystkie wątki między **async** wywołanie metody i **await**.</span><span class="sxs-lookup"><span data-stu-id="26f3b-146">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="26f3b-147">Duże opóźnienie przy użyciu puli wątków do obsługi żądań może prowadzić do dużych pamięci i niską wykorzystanie sprzętu serwera.</span><span class="sxs-lookup"><span data-stu-id="26f3b-147">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="26f3b-148">Przetwarzanie żądań asynchronicznych</span><span class="sxs-lookup"><span data-stu-id="26f3b-148">Processing Asynchronous Requests</span></span>

<span data-ttu-id="26f3b-149">W aplikacji sieci web, które Zobacz dużej liczby równoczesnych żądań przy rozruchu lub ma seryjnym obciążenia (gdzie współbieżności zwiększa nagle) wywołania usługi sieci web jest asynchroniczne wydłużają czas odpowiedzi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="26f3b-149">In web applications that see a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous will increase the responsiveness of your application.</span></span> <span data-ttu-id="26f3b-150">Asynchroniczne żądanie trwa tyle samo czasu na przetwarzanie jako żądań synchronicznych.</span><span class="sxs-lookup"><span data-stu-id="26f3b-150">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="26f3b-151">Na przykład jeśli żądanie sprawia, że usługi sieci web wywołaniu, które wymaga dwóch sekund, przyjmuje żądania dwie sekundy czy jest wykonywane synchronicznie lub asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="26f3b-151">For example, if a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it is performed synchronously or asynchronously.</span></span> <span data-ttu-id="26f3b-152">Jednak podczas wywołania asynchronicznego wątku nie blokuje odpowiedzi na inne żądania podczas oczekiwania na pierwsze żądanie do wykonania.</span><span class="sxs-lookup"><span data-stu-id="26f3b-152">However, during an asynchronous call, a thread is not blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="26f3b-153">W związku z tym żądań asynchronicznych uniknięcia wzrostu puli usługi kolejkowania wiadomości i wątku żądania, gdy istnieją dużą liczbą jednoczesnych żądań, które wywołują długotrwałej operacji.</span><span class="sxs-lookup"><span data-stu-id="26f3b-153">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a><span data-ttu-id="26f3b-154">Wybieranie metody synchronicznego lub asynchronicznego</span><span class="sxs-lookup"><span data-stu-id="26f3b-154">Choosing Synchronous or Asynchronous Methods</span></span>

<span data-ttu-id="26f3b-155">Ta sekcja zawiera wskazówki dotyczące użycie metody synchroniczna lub asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="26f3b-155">This section lists guidelines for when to use synchronous or asynchronous Methods.</span></span> <span data-ttu-id="26f3b-156">Są to po prostu wytycznych; zbadać każdą aplikację osobno w celu ustalenia, czy metod asynchronicznych pomocy z wydajnością.</span><span class="sxs-lookup"><span data-stu-id="26f3b-156">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="26f3b-157">Ogólnie rzecz biorąc Użyj metod synchronicznych następujące warunki:</span><span class="sxs-lookup"><span data-stu-id="26f3b-157">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="26f3b-158">Operacje są proste lub wykonywania short.</span><span class="sxs-lookup"><span data-stu-id="26f3b-158">The operations are simple or short-running.</span></span>
- <span data-ttu-id="26f3b-159">Prostota ma większe znaczenie niż wydajność.</span><span class="sxs-lookup"><span data-stu-id="26f3b-159">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="26f3b-160">Operacje są głównie operacje Procesora zamiast operacje, które wymagają szeroką gamę dysku lub obciążenie sieci.</span><span class="sxs-lookup"><span data-stu-id="26f3b-160">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="26f3b-161">Używanie metod asynchronicznych operacji procesora zapewnia nie korzyści i narzut powoduje więcej.</span><span class="sxs-lookup"><span data-stu-id="26f3b-161">Using asynchronous methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

 <span data-ttu-id="26f3b-162">Ogólnie rzecz biorąc można używać metod asynchronicznych następujące warunki:</span><span class="sxs-lookup"><span data-stu-id="26f3b-162">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="26f3b-163">W przypadku wywoływania usługi, które mogą być używane za pośrednictwem metod asynchronicznych i używasz .NET 4.5 lub wyższej.</span><span class="sxs-lookup"><span data-stu-id="26f3b-163">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="26f3b-164">Operacje są powiązane z siecią lub I/E-granicę zamiast procesora.</span><span class="sxs-lookup"><span data-stu-id="26f3b-164">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="26f3b-165">Równoległość ma większe znaczenie niż prostota kodu.</span><span class="sxs-lookup"><span data-stu-id="26f3b-165">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="26f3b-166">Chcesz udostępniają mechanizm umożliwiający użytkownikom anulować żądanie długotrwałe.</span><span class="sxs-lookup"><span data-stu-id="26f3b-166">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="26f3b-167">Gdy korzyści przełączania wątków limit przeprowadzi koszt przełączania kontekstu.</span><span class="sxs-lookup"><span data-stu-id="26f3b-167">When the benefit of switching threads out weights the cost of the context switch.</span></span> <span data-ttu-id="26f3b-168">Ogólnie rzecz biorąc należy ustawić metody asynchroniczne Jeśli metoda synchroniczna blokuje wątku żądania ASP.NET podczas wykonywania żadne czynności.</span><span class="sxs-lookup"><span data-stu-id="26f3b-168">In general, you should make a method asynchronous if the synchronous method blocks the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="26f3b-169">Za pomocą wywołania asynchronicznego, wątku żądania programu ASP.NET nie jest blokowane podczas żadne czynności podczas oczekiwania na żądanie usługi sieci web zakończyć.</span><span class="sxs-lookup"><span data-stu-id="26f3b-169">By making the call asynchronous, the ASP.NET request thread is not blocked doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="26f3b-170">Testowanie pokazuje, czy operacji blokowania wąskich gardeł wydajności lokacji i usług IIS może obsłużyć więcej żądań przy użyciu metod asynchronicznych tymi połączeniami blokowania.</span><span class="sxs-lookup"><span data-stu-id="26f3b-170">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

 <span data-ttu-id="26f3b-171">Do pobrania przykładowych pokazano, jak skutecznie używać metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="26f3b-171">The downloadable sample shows how to use asynchronous methods effectively.</span></span> <span data-ttu-id="26f3b-172">Przykładu dostępnego zaprojektowano tak, aby zapewnić prosty pokaz programowania asynchronicznego w programie ASP.NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="26f3b-172">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET 4.5.</span></span> <span data-ttu-id="26f3b-173">Przykład nie jest przeznaczona do architektury odwołania do programowania asynchronicznego w programie ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="26f3b-173">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET.</span></span> <span data-ttu-id="26f3b-174">Wywołuje program przykładowy [ASP.NET Web API](../../../web-api/index.md) metod, które z kolei wymagają [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) do symulowania wywołania usługi sieci web długotrwałe.</span><span class="sxs-lookup"><span data-stu-id="26f3b-174">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="26f3b-175">Większość aplikacji produkcyjnych, nie będą widoczne takie oczywiste korzyści wynikające z używania metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="26f3b-175">Most production applications will not show such obvious benefits to using asynchronous Methods.</span></span>   
  
<span data-ttu-id="26f3b-176">Kilka aplikacji wymaga wszystkich metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="26f3b-176">Few applications require all methods to be asynchronous.</span></span> <span data-ttu-id="26f3b-177">Często konwertowanie kilka metod synchronicznych do metod asynchronicznych zapewnia najlepsze zwiększenia efektywności ilości pracy wymagane.</span><span class="sxs-lookup"><span data-stu-id="26f3b-177">Often, converting a few synchronous methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a><span data-ttu-id="26f3b-178">Przykładowa aplikacja</span><span class="sxs-lookup"><span data-stu-id="26f3b-178">The Sample Application</span></span>

<span data-ttu-id="26f3b-179">Możesz pobrać przykładową aplikację z [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) na [GitHub](https://github.com/) lokacji.</span><span class="sxs-lookup"><span data-stu-id="26f3b-179">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="26f3b-180">Repozytorium zawiera trzy projekty:</span><span class="sxs-lookup"><span data-stu-id="26f3b-180">The repository consists of three projects:</span></span>

- <span data-ttu-id="26f3b-181">*WebAppAsync*: projekt formularzy sieci Web ASP.NET, który wykorzystuje interfejs API sieci Web **WebAPIpwg** usługi.</span><span class="sxs-lookup"><span data-stu-id="26f3b-181">*WebAppAsync*: The ASP.NET Web Forms project that consumes the Web API **WebAPIpwg** service.</span></span> <span data-ttu-id="26f3b-182">Większość kodu dla tego samouczka jest w tym projekcie.</span><span class="sxs-lookup"><span data-stu-id="26f3b-182">Most of the code for this tutorial is from the this project.</span></span>
- <span data-ttu-id="26f3b-183">*WebAPIpgw*: projekt programu ASP.NET MVC 4 interfejsu API sieci Web, który implementuje `Products, Gizmos and Widgets` kontrolerów.</span><span class="sxs-lookup"><span data-stu-id="26f3b-183">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="26f3b-184">Zapewnia dane dla *WebAppAsync* projektu i *Mvc4Async* projektu.</span><span class="sxs-lookup"><span data-stu-id="26f3b-184">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="26f3b-185">*Mvc4Async*: projekt programu ASP.NET MVC 4, który zawiera kod używany w innym samouczka.</span><span class="sxs-lookup"><span data-stu-id="26f3b-185">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in another tutorial.</span></span> <span data-ttu-id="26f3b-186">Wykonywania wywołań interfejsu API sieci Web do **WebAPIpwg** usługi.</span><span class="sxs-lookup"><span data-stu-id="26f3b-186">It makes Web API calls to the **WebAPIpwg** service.</span></span>

## <a id="GizmosSynch"></a><span data-ttu-id="26f3b-187">Na stronie synchroniczne Gizmos</span><span class="sxs-lookup"><span data-stu-id="26f3b-187">The Gizmos Synchronous Page</span></span>

 <span data-ttu-id="26f3b-188">Poniższy kod przedstawia `Page_Load` metoda synchroniczna, który służy do wyświetlania listy gizmos.</span><span class="sxs-lookup"><span data-stu-id="26f3b-188">The following code shows the `Page_Load` synchronous method that is used to display a list of gizmos.</span></span> <span data-ttu-id="26f3b-189">(W tym artykule gizmo jest urządzenie mechaniczne fikcyjne).</span><span class="sxs-lookup"><span data-stu-id="26f3b-189">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample1.cs)]

<span data-ttu-id="26f3b-190">Poniższy kod przedstawia `GetGizmos` metody gizmo usługi.</span><span class="sxs-lookup"><span data-stu-id="26f3b-190">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample2.cs)]

<span data-ttu-id="26f3b-191">`GizmoService GetGizmos` Metoda przekazuje identyfikatora URI z usługą HTTP interfejsu API sieci Web programu ASP.NET, która zwraca listę gizmos danych.</span><span class="sxs-lookup"><span data-stu-id="26f3b-191">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="26f3b-192">*WebAPIpgw* projektu zawiera implementację interfejsu API sieci Web `gizmos, widget` i `product` kontrolerów.</span><span class="sxs-lookup"><span data-stu-id="26f3b-192">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="26f3b-193">Na poniższej ilustracji przedstawiono stronę gizmos z przykładowy projekt.</span><span class="sxs-lookup"><span data-stu-id="26f3b-193">The following image shows the gizmos page from the sample project.</span></span>

![Gizmos](using-asynchronous-methods-in-aspnet-45/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a><span data-ttu-id="26f3b-195">Tworzenie stron Gizmos asynchroniczne</span><span class="sxs-lookup"><span data-stu-id="26f3b-195">Creating an Asynchronous Gizmos Page</span></span>

<span data-ttu-id="26f3b-196">Przykład używa nowego [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) i [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) słowa kluczowe (dostępne w .NET 4.5 i programu Visual Studio 2012) pozwala kompilatora odpowiada za utrzymywanie złożone przekształcenia niezbędne do Programowanie asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="26f3b-196">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="26f3b-197">Kompilator umożliwia pisanie kodu za pomocą, który tworzy przepływ sterowania synchroniczne C# w i kompilator automatycznie stosuje przekształcenia trzeba użyć wywołania zwrotne w celu unikania blokowania wątków.</span><span class="sxs-lookup"><span data-stu-id="26f3b-197">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="26f3b-198">Asynchroniczne strony ASP.NET należy uwzględnić [strony](https://msdn.microsoft.com/library/ydy4x04a.aspx) dyrektywy z `Async` atrybut na wartość "true".</span><span class="sxs-lookup"><span data-stu-id="26f3b-198">ASP.NET asynchronous pages must include the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true".</span></span> <span data-ttu-id="26f3b-199">Poniższy kod przedstawia [strony](https://msdn.microsoft.com/library/ydy4x04a.aspx) dyrektywy z `Async` atrybut na wartość "true" dla *GizmosAsync.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="26f3b-199">The following code shows the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true" for the *GizmosAsync.aspx* page.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample3.aspx?highlight=1)]

<span data-ttu-id="26f3b-200">Poniższy kod przedstawia `Gizmos` synchroniczne `Page_Load` — metoda i `GizmosAsync` asynchroniczne strony.</span><span class="sxs-lookup"><span data-stu-id="26f3b-200">The following code shows the `Gizmos` synchronous `Page_Load` method and the `GizmosAsync` asynchronous page.</span></span> <span data-ttu-id="26f3b-201">Jeśli przeglądarka obsługuje [HTML 5 &lt;oznaczyć&gt; elementu](http://www.w3.org/wiki/HTML/Elements/mark), zmiany w `GizmosAsync` w Wyróżnij żółty.</span><span class="sxs-lookup"><span data-stu-id="26f3b-201">If your browser supports the [HTML 5 &lt;mark&gt; element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample4.cs)]

<span data-ttu-id="26f3b-202">Wersja asynchroniczna:</span><span class="sxs-lookup"><span data-stu-id="26f3b-202">The asynchronous version:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample5.cs?highlight=3,6-7,9,11)]

 <span data-ttu-id="26f3b-203">Następujące zmiany zostały zastosowane, aby umożliwić `GizmosAsync` strona była asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="26f3b-203">The following changes were applied to allow the `GizmosAsync` page be asynchronous.</span></span>

- <span data-ttu-id="26f3b-204">[Strony](https://msdn.microsoft.com/library/ydy4x04a.aspx) dyrektywa musi mieć `Async` atrybut na wartość "true".</span><span class="sxs-lookup"><span data-stu-id="26f3b-204">The [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive must have the `Async` attribute set to "true".</span></span>
- <span data-ttu-id="26f3b-205">`RegisterAsyncTask` Metoda służy do rejestrowania zadania asynchronicznego zawierającego kod, który uruchamia asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="26f3b-205">The `RegisterAsyncTask` method is used to register an asynchronous task containing the code which runs asynchronously.</span></span>
- <span data-ttu-id="26f3b-206">Nowy `GetGizmosSvcAsync` metoda jest oznaczona atrybutem [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) — słowo kluczowe, które informuje kompilator, aby wygenerować wywołań zwrotnych dla części treści i automatycznie utworzyć `Task` który jest zwracany.</span><span class="sxs-lookup"><span data-stu-id="26f3b-206">The new `GetGizmosSvcAsync` method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task` that is returned.</span></span>
- <span data-ttu-id="26f3b-207">&quot;Asynchroniczne&quot; został dołączony do nazwy metody asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="26f3b-207">&quot;Async&quot; was appended to the asynchronous method name.</span></span> <span data-ttu-id="26f3b-208">Dołączanie "Async" nie jest wymagana, ale jest Konwencji podczas zapisywania metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="26f3b-208">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="26f3b-209">Zwracany typ nowej nowe `GetGizmosSvcAsync` jest metoda `Task`.</span><span class="sxs-lookup"><span data-stu-id="26f3b-209">The return type of the new new `GetGizmosSvcAsync` method is `Task`.</span></span> <span data-ttu-id="26f3b-210">Zwracany typ `Task` reprezentuje pracy w toku i dostarcza wywołań metody z dojściem za pośrednictwem której czekać na zakończenie operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="26f3b-210">The return type of `Task` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span>
- <span data-ttu-id="26f3b-211">[Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) — słowo kluczowe została zastosowana do wywołania usługi sieci web.</span><span class="sxs-lookup"><span data-stu-id="26f3b-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="26f3b-212">Interfejs API usługi sieci web asynchroniczne została wywołana (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="26f3b-212">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="26f3b-213">Wewnątrz `GetGizmosSvcAsync` innej metody asynchroniczne, treści metody `GetGizmosAsync` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="26f3b-213">Inside of the `GetGizmosSvcAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="26f3b-214">`GetGizmosAsync`natychmiast zwraca `Task<List<Gizmo>>` który ostatecznie zostanie zakończony, gdy dane są dostępne.</span><span class="sxs-lookup"><span data-stu-id="26f3b-214">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="26f3b-215">Ponieważ nie chcesz wykonywanie dodatkowych czynności, aż do uzyskania danych gizmo kod oczekujące na zadanie (przy użyciu **await** — słowo kluczowe).</span><span class="sxs-lookup"><span data-stu-id="26f3b-215">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="26f3b-216">Można użyć **await** — słowo kluczowe tylko w metodach opatrzoną **async** — słowo kluczowe.</span><span class="sxs-lookup"><span data-stu-id="26f3b-216">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="26f3b-217">**Await** — słowo kluczowe nie blokuje wątek, do czasu ukończenia zadania.</span><span class="sxs-lookup"><span data-stu-id="26f3b-217">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="26f3b-218">Rejestruje się pozostałe metody jako wywołania zwrotnego dla zadania i natychmiast zwraca.</span><span class="sxs-lookup"><span data-stu-id="26f3b-218">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="26f3b-219">Po ukończeniu ostatecznie oczekiwano zadania, spowoduje wywołanie wywołanie zwrotne i w związku z tym wznowić wykonywanie prawa metody, w którym przerwał.</span><span class="sxs-lookup"><span data-stu-id="26f3b-219">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="26f3b-220">Aby uzyskać więcej informacji na temat używania [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) i [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) słów kluczowych i [zadań](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) przestrzeni nazw, zobacz [odwołania async](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="26f3b-220">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="26f3b-221">Poniższy kod przedstawia `GetGizmos` i `GetGizmosAsync` metody.</span><span class="sxs-lookup"><span data-stu-id="26f3b-221">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample6.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample7.cs?highlight=1,4-8)]

 <span data-ttu-id="26f3b-222">Asynchroniczne zmiany są podobne do tych wprowadzone **GizmosAsync** powyżej.</span><span class="sxs-lookup"><span data-stu-id="26f3b-222">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="26f3b-223">Podpis metody został oznaczony za pomocą [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) — słowo kluczowe, zwracany typ został zmieniony na `Task<List<Gizmo>>`, i *Async* został dołączony do nazwy metody.</span><span class="sxs-lookup"><span data-stu-id="26f3b-223">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="26f3b-224">Asynchroniczną [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) klasa jest używana zamiast synchroniczne [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) klasy.</span><span class="sxs-lookup"><span data-stu-id="26f3b-224">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the synchronous [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="26f3b-225">[Await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) — słowo kluczowe została zastosowana do [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) metody asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="26f3b-225">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) asynchronous method.</span></span>

<span data-ttu-id="26f3b-226">Na poniższej ilustracji przedstawiono widok gizmo asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="26f3b-226">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-45/_static/image2.png)

<span data-ttu-id="26f3b-228">Przeglądarki prezentację danych gizmos jest identyczny z widoku utworzonego przez wywołanie synchroniczne.</span><span class="sxs-lookup"><span data-stu-id="26f3b-228">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="26f3b-229">Jedyną różnicą jest to wersja asynchroniczna może być więcej wydajności pod dużym obciążeniem.</span><span class="sxs-lookup"><span data-stu-id="26f3b-229">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a name="registerasynctask-notes"></a><span data-ttu-id="26f3b-230">Informacje o RegisterAsyncTask</span><span class="sxs-lookup"><span data-stu-id="26f3b-230">RegisterAsyncTask Notes</span></span>

<span data-ttu-id="26f3b-231">Metody podłączonymi z `RegisterAsyncTask` zostanie uruchomiona natychmiast po [PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span><span class="sxs-lookup"><span data-stu-id="26f3b-231">Methods hooked up with `RegisterAsyncTask` will run immediately after [PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span></span> <span data-ttu-id="26f3b-232">Umożliwia także async void strony zdarzenia bezpośrednio, jak pokazano w poniższym kodzie:</span><span class="sxs-lookup"><span data-stu-id="26f3b-232">You can also use async void page events directly, as shown in the following code:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample8.cs)]

<span data-ttu-id="26f3b-233">Wadą interfejsu async void zdarzeń jest, że deweloperzy już ma pełną kontrolę nad podczas wykonywania zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="26f3b-233">The downside to async void events is that developers no longer has full control over when events execute.</span></span> <span data-ttu-id="26f3b-234">Na przykład jeśli obie aspx oraz. Zdefiniuj wzorzec `Page_Load` zdarzeń i co najmniej jeden z nich są asynchroniczne, kolejność wykonywania nie może zagwarantować.</span><span class="sxs-lookup"><span data-stu-id="26f3b-234">For example, if both an .aspx and a .Master define `Page_Load` events and one or both of them are asynchronous, the order of execution can't be guaranteed.</span></span> <span data-ttu-id="26f3b-235">Tej samej kolejności indeterminiate dla programów obsługi zdarzeń z systemem innym niż (takie jak `async void Button_Click` ) ma zastosowanie.</span><span class="sxs-lookup"><span data-stu-id="26f3b-235">The same indeterminiate order for non event handlers (such as `async void Button_Click` ) applies.</span></span> <span data-ttu-id="26f3b-236">Dla większości deweloperów powinna być akceptowane, ale tych, którzy wymagają pełną kontrolę nad kolejność wykonywania należy używać tylko interfejsów API, takich jak `RegisterAsyncTask` który korzystać z metod, które zwraca obiekt zadania.</span><span class="sxs-lookup"><span data-stu-id="26f3b-236">For most developers this should be acceptable, but those who require full control over the order of execution should only use APIs like `RegisterAsyncTask` that consume methods which return a Task object.</span></span>

## <a id="Parallel"></a><span data-ttu-id="26f3b-237">Wykonywanie operacji na wielu równolegle</span><span class="sxs-lookup"><span data-stu-id="26f3b-237">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="26f3b-238">Metod asynchronicznych ma znaczących korzyści za pośrednictwem metod synchronicznych, gdy akcję, należy wykonać kilka operacji niezależnych.</span><span class="sxs-lookup"><span data-stu-id="26f3b-238">Asynchronous Methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="26f3b-239">W przykładowym podany synchroniczne strony *PWG.aspx*(dla produktów, elementów widget i Gizmos) są wyświetlane wyniki trzy wywołania usługi sieci web w celu uzyskania listy produktów, elementów widget i gizmos.</span><span class="sxs-lookup"><span data-stu-id="26f3b-239">In the sample provided, the synchronous page *PWG.aspx*(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="26f3b-240">[ASP.NET Web API](../../../web-api/index.md) projektu, który zawiera te usługi używa [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) wywołuje w celu symulowania opóźnienia lub powolnej sieci.</span><span class="sxs-lookup"><span data-stu-id="26f3b-240">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="26f3b-241">Jeśli opóźnienie jest równa 500 milisekund asynchroniczną *PWGasync.aspx* strona zajmuje trochę ponad 500 MS, aby ukończyć podczas synchronicznego `PWG` wersji przejmuje 1500 MS.</span><span class="sxs-lookup"><span data-stu-id="26f3b-241">When the delay is set to 500 milliseconds, the asynchronous *PWGasync.aspx* page takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="26f3b-242">Synchroniczne *PWG.aspx* strony przedstawiono w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="26f3b-242">The synchronous *PWG.aspx* page is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample9.cs)]

<span data-ttu-id="26f3b-243">Asynchroniczną `PWGasync` kodzie przedstawiono poniżej.</span><span class="sxs-lookup"><span data-stu-id="26f3b-243">The asynchronous `PWGasync` code behind is shown below.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample10.cs?highlight=5,11,21)]

<span data-ttu-id="26f3b-244">Na poniższej ilustracji przedstawiono widok zwrócona z asynchronicznej *PWGasync.aspx* strony.</span><span class="sxs-lookup"><span data-stu-id="26f3b-244">The following image shows the view returned from the asynchronous *PWGasync.aspx* page.</span></span>

![](using-asynchronous-methods-in-aspnet-45/_static/image3.png)

## <a id="CancelToken"></a><span data-ttu-id="26f3b-245">Przy użyciu Token anulowania</span><span class="sxs-lookup"><span data-stu-id="26f3b-245">Using a Cancellation Token</span></span>

<span data-ttu-id="26f3b-246">Zwracanie metod asynchronicznych `Task`czy można anulować, będącą podejmują [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parametru, gdy zostało ono określone z `AsyncTimeout` atrybutu [strony](https://msdn.microsoft.com/library/ydy4x04a.aspx) dyrektywy.</span><span class="sxs-lookup"><span data-stu-id="26f3b-246">Asynchronous Methods returning `Task`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the `AsyncTimeout` attribute of the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive.</span></span> <span data-ttu-id="26f3b-247">Poniższy kod przedstawia *GizmosCancelAsync.aspx* strony z limitem czasu równym na sekundę.</span><span class="sxs-lookup"><span data-stu-id="26f3b-247">The following code shows the *GizmosCancelAsync.aspx* page with a timeout of on second.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample11.aspx?highlight=1)]

<span data-ttu-id="26f3b-248">Poniższy kod przedstawia *GizmosCancelAsync.aspx.cs* pliku.</span><span class="sxs-lookup"><span data-stu-id="26f3b-248">The following code shows the *GizmosCancelAsync.aspx.cs* file.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample12.cs?highlight=6,9)]

<span data-ttu-id="26f3b-249">W przykładowej aplikacji pod warunkiem, wybierając *GizmosCancelAsync* link wywołania *GizmosCancelAsync.aspx* strony i prezentuje anulowanie wywołania asynchronicznego (za pomocą limitu czasu).</span><span class="sxs-lookup"><span data-stu-id="26f3b-249">In the sample application provided, selecting the *GizmosCancelAsync* link calls the *GizmosCancelAsync.aspx* page and demonstrates the cancelation (by timing out) of the asynchronous call.</span></span> <span data-ttu-id="26f3b-250">Ponieważ czas opóźnienia losowego zakresu, może być konieczne odświeżenie strony kilka razy na komunikat o błędzie limitu czasu.</span><span class="sxs-lookup"><span data-stu-id="26f3b-250">Because the delay time is within a random range, you might need to refresh the page a couple times to get the time out error message.</span></span>

## <a id="ServerConfig"></a><span data-ttu-id="26f3b-251">Konfiguracja serwera dla wywołania usługi sieci Web opóźnienia wysokiej współbieżności/wysoki</span><span class="sxs-lookup"><span data-stu-id="26f3b-251">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="26f3b-252">Aby wykorzystać zalety aplikacji sieci web asynchroniczne, może być konieczne dokonanie pewnych zmian w domyślnej konfiguracji serwera.</span><span class="sxs-lookup"><span data-stu-id="26f3b-252">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="26f3b-253">Należy pamiętać o następujących w uwadze podczas konfigurowania i obciążeniowe testowania aplikacji sieci web asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="26f3b-253">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="26f3b-254">Windows 7, Windows Vista, Windows 8 i wszystkie klienckie systemy operacyjne Windows mieć maksymalnie 10 równoczesnych żądań.</span><span class="sxs-lookup"><span data-stu-id="26f3b-254">Windows 7, Windows Vista, Window 8, and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="26f3b-255">Będziesz potrzebować systemu operacyjnego Windows Server, aby można było wykorzystać zalety metod asynchronicznych mocno obciążony.</span><span class="sxs-lookup"><span data-stu-id="26f3b-255">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="26f3b-256">Zarejestruj .NET 4.5 z usługami IIS w wierszu polecenia z podwyższonym poziomem uprawnień, za pomocą następującego polecenia:</span><span class="sxs-lookup"><span data-stu-id="26f3b-256">Register .NET 4.5 with IIS from an elevated command prompt using the following command:</span></span>  
 <span data-ttu-id="26f3b-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis -i</span><span class="sxs-lookup"><span data-stu-id="26f3b-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis -i</span></span>  
 <span data-ttu-id="26f3b-258">Zobacz [narzędzie rejestracji programu ASP.NET usług IIS (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="26f3b-258">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="26f3b-259">Może być konieczne w celu zwiększenia [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) limitu kolejki z domyślnej wartości 1000 do 5000.</span><span class="sxs-lookup"><span data-stu-id="26f3b-259">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="26f3b-260">Jeśli ustawienie jest zbyt niska, mogą pojawić się [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) odrzucanie żądań o stan HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="26f3b-260">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="26f3b-261">Aby zmienić limit kolejki sterownik HTTP.sys:</span><span class="sxs-lookup"><span data-stu-id="26f3b-261">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="26f3b-262">Otwórz Menedżera usług IIS i przejdź do okienka pul aplikacji.</span><span class="sxs-lookup"><span data-stu-id="26f3b-262">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="26f3b-263">Kliknij prawym przyciskiem myszy docelową pulę aplikacji, a następnie wybierz **Zaawansowane ustawienia**.</span><span class="sxs-lookup"><span data-stu-id="26f3b-263">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="26f3b-264">![Zaawansowane](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="26f3b-264">![advanced](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span></span>
    - <span data-ttu-id="26f3b-265">W **Zaawansowane ustawienia** okno dialogowe, zmień *długość kolejki* z 1000 do 5000.</span><span class="sxs-lookup"><span data-stu-id="26f3b-265">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="26f3b-266">![Długość kolejki](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="26f3b-266">![Queue length](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span></span>  
  
 <span data-ttu-id="26f3b-267">Należy pamiętać, obrazy powyżej, .NET framework znajduje się w wersji 4.0, mimo że pula aplikacji jest przy użyciu platformy .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="26f3b-267">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="26f3b-268">Aby poznać tę rozbieżność, zobacz następujące tematy:</span><span class="sxs-lookup"><span data-stu-id="26f3b-268">To understand this discrepancy, see the following:</span></span>

        - [.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
        - [How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
        - [.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)
- <span data-ttu-id="26f3b-269">Jeśli aplikacja korzysta z usług sieci web lub może być konieczne System.NET do komunikowania się z wewnętrznej bazy danych za pośrednictwem protokołu HTTP należy zwiększyć [connectionmanagement — / maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) elementu.</span><span class="sxs-lookup"><span data-stu-id="26f3b-269">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="26f3b-270">Dla aplikacji ASP.NET to jest ograniczona przez funkcję automatycznej konfiguracji do 12 razy liczba procesorów.</span><span class="sxs-lookup"><span data-stu-id="26f3b-270">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="26f3b-271">Oznacza to, że na quad-proc, użytkownik może mieć co najwyżej 12 \* 4 = 48 równoczesnych połączeń punkt końcowy IP.</span><span class="sxs-lookup"><span data-stu-id="26f3b-271">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="26f3b-272">Ponieważ to jest związany z [autokonfiguracji](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), najprostszym sposobem, aby zwiększyć `maxconnection` w programie ASP.NET jest skonfigurowanie aplikacji [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programowo w z `Application_Start` metody w *global.asax* pliku.</span><span class="sxs-lookup"><span data-stu-id="26f3b-272">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="26f3b-273">Zobacz przykład Pobierz przykład.</span><span class="sxs-lookup"><span data-stu-id="26f3b-273">See the sample download for an example.</span></span>
- <span data-ttu-id="26f3b-274">W programie .NET 4.5, domyślnie 5000 dla [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) powinna być poprawnie.</span><span class="sxs-lookup"><span data-stu-id="26f3b-274">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>

## <a name="contributors"></a><span data-ttu-id="26f3b-275">Współautorzy</span><span class="sxs-lookup"><span data-stu-id="26f3b-275">Contributors</span></span>

- [<span data-ttu-id="26f3b-276">Levi Broderick</span><span class="sxs-lookup"><span data-stu-id="26f3b-276">Levi Broderick</span></span>](http://stackoverflow.com/users/59641/levi)
- [<span data-ttu-id="26f3b-277">Tomasz Dykstra</span><span class="sxs-lookup"><span data-stu-id="26f3b-277">Tom Dykstra</span></span>](http://www.bing.com/search?q=site%3Aasp.net+%22Tom+Dykstra%22+-forums.asp.net&amp;qs=n&amp;form=QBRE&amp;pq=site%3Aasp.net+%22tom+dykstra%22+-forums.asp.net&amp;sc=8-42&amp;sp=-1&amp;sk=)
- [<span data-ttu-id="26f3b-278">Brad Wilson</span><span class="sxs-lookup"><span data-stu-id="26f3b-278">Brad Wilson</span></span>](http://bradwilson.typepad.com/)
- [<span data-ttu-id="26f3b-279">HongMei Ge</span><span class="sxs-lookup"><span data-stu-id="26f3b-279">HongMei Ge</span></span>](https://blogs.msdn.com/b/hongmeig/)
