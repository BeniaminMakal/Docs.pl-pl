---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
title: Tworzenie dostawcy mapy witryny opartej na bazie danych niestandardowych (C#) | Dokumentacja firmy Microsoft
author: rick-anderson
description: Domyślny dostawca mapy witryny w programie ASP.NET 2.0 pobiera dane ze statycznego pliku XML. Gdy dostawca opartych na języku XML nadaje się do wielu w małych i średnich rozmiar...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: 04b7591d-106f-4f05-87e9-d416cb65a8a6
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
msc.type: authoredcontent
ms.openlocfilehash: cab1b02dff27e9bacec2f4d4f7facc9f99d76b0a
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2018
ms.locfileid: "30878012"
---
<a name="building-a-custom-database-driven-site-map-provider-c"></a><span data-ttu-id="5bb85-104">Tworzenie dostawcy mapy witryny opartej na bazie danych niestandardowych (C#)</span><span class="sxs-lookup"><span data-stu-id="5bb85-104">Building a Custom Database-Driven Site Map Provider (C#)</span></span>
====================
<span data-ttu-id="5bb85-105">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5bb85-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5bb85-106">[Pobierz kod](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) lub [pobierania plików PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5bb85-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span></span>

> <span data-ttu-id="5bb85-107">Domyślny dostawca mapy witryny w programie ASP.NET 2.0 pobiera dane ze statycznego pliku XML.</span><span class="sxs-lookup"><span data-stu-id="5bb85-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="5bb85-108">Gdy dostawca opartych na języku XML nadaje się do wielu witryn sieci Web małych i średnich, dużych aplikacji sieci Web wymagają bardziej dynamiczne mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="5bb85-109">W tym samouczku, który będzie budujemy dostawcy mapy niestandardowej witryny, która pobiera dane z warstwy logiki biznesowej, które z kolei pobiera dane z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="5bb85-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="5bb85-110">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="5bb85-110">Introduction</span></span>

<span data-ttu-id="5bb85-111">Platforma ASP.NET 2.0 funkcja mapy witryny s umożliwia deweloperom strony zdefiniowania mapy witryny sieci web i aplikacji s niektóre stałe nośnika, na przykład w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="5bb85-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="5bb85-112">Po zdefiniowaniu, dane mapy witryny można uzyskać dostęp programowo za pomocą [ `SiteMap` klasy](https://msdn.microsoft.com/library/system.web.sitemap.aspx) w [ `System.Web` przestrzeni nazw](https://msdn.microsoft.com/library/system.web.aspx) lub za pomocą różnych nawigacji formanty sieci Web, takich jak Kontrolki ścieżki mapy witryny, Menu i TreeView.</span><span class="sxs-lookup"><span data-stu-id="5bb85-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="5bb85-113">System mapy witryny używa [modelu dostawcy](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) tak, aby implementacje serializacji mapy innej lokacji można tworzyć i podłączony do aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="5bb85-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="5bb85-114">Domyślny dostawca mapy witryny dostarczaną z programem ASP.NET 2.0 utrzymuje struktury mapy witryny w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="5bb85-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="5bb85-115">W [stron wzorcowych i nawigacji w witrynie](../introduction/master-pages-and-site-navigation-cs.md) samouczek utworzyliśmy plik o nazwie `Web.sitemap` czy zawarte tej struktury i mieć aktualizuje jego XML z każdej nowej sekcji samouczka.</span><span class="sxs-lookup"><span data-stu-id="5bb85-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="5bb85-116">Domyślnego dostawcy mapy witryny opartych na języku XML działa dobrze w przypadku, gdy struktura s mapy witryny jest dość statycznych, takich jak te samouczki.</span><span class="sxs-lookup"><span data-stu-id="5bb85-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="5bb85-117">W wielu scenariuszach jednak bardziej dynamiczne mapy witryny jest wymagany.</span><span class="sxs-lookup"><span data-stu-id="5bb85-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="5bb85-118">Należy wziąć pod uwagę przedstawione na rysunku 1, w którym każdej kategorii i produktu są wyświetlane jako części strukturę s witryny sieci Web mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="5bb85-119">Z tym mapy witryny odwiedzania strony sieci web odpowiadający węzła głównego mogą zawierać wszystkie kategorie, odwiedzając stronę sieci web określonej kategorii s listę produktów s tej kategorii i wyświetlanie strony sieci web określonego produktu s czy Pokaż tego produktu s szczegóły.</span><span class="sxs-lookup"><span data-stu-id="5bb85-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>


<span data-ttu-id="5bb85-120">[![Kategorie i produktów w skład struktury s mapy witryny](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span></span>

<span data-ttu-id="5bb85-121">**Rysunek 1**: kategorie i produktów w skład s mapy witryny struktury ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span></span>


<span data-ttu-id="5bb85-122">Ta struktura według kategorii i produktu może być ustalony w `Web.sitemap` pliku, plik musi zostać zaktualizowany w każdym razem, kiedy kategorii lub dodane, usunięte lub zmieniono jego nazwę produktu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="5bb85-123">W rezultacie konserwacji mapy witryny może znacznie uprościć jeśli jego struktury został pobrany z bazy danych lub, najlepiej z warstwy logiki biznesowej architektura s.</span><span class="sxs-lookup"><span data-stu-id="5bb85-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="5bb85-124">W ten sposób, jak produktów i kategorie zostały dodane, zmieniono nazwę lub usunięto, aby uwzględnić te zmiany automatycznie zaktualizuje mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="5bb85-125">Ponieważ serializacji mapy witryny s ASP.NET 2.0 została stworzona z modelu dostawcy, można utworzyć dostawcy mapy własnej niestandardowej witryny, który grabs dane z magazynu danych, takich jak bazy danych lub architektury.</span><span class="sxs-lookup"><span data-stu-id="5bb85-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="5bb85-126">W tym samouczku będziesz mamy utworzyć niestandardowego dostawcę, który pobiera dane z logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="5bb85-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="5bb85-127">Rozpoczynanie pracy dzięki s!</span><span class="sxs-lookup"><span data-stu-id="5bb85-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="5bb85-128">Dostawcy mapy niestandardowej witryny utworzonej w tym samouczku jest ściśle powiązane do aplikacji s architektury i danych modelu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="5bb85-129">S Jeff Prosise [przechowywania map witryn w programie SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) i [dostawcy mapy witryny SQL był czas oczekiwania](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) artykuły zbadać uogólniony podejście do przechowywania danych mapy witryny w programie SQL Server.</span><span class="sxs-lookup"><span data-stu-id="5bb85-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>


## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="5bb85-130">Krok 1: Tworzenie stron sieci Web uzyskiwania informacji na temat dostawcy mapy niestandardowej witryny</span><span class="sxs-lookup"><span data-stu-id="5bb85-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="5bb85-131">Zanim możemy rozpocząć tworzenie dostawcy mapy witryny niestandardowej, chętnie s najpierw dodać stron ASP.NET, które będą potrzebne w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="5bb85-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="5bb85-132">Rozpocznij od dodania nowy folder o nazwie `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="5bb85-133">Następnie dodaj do tego folderu, upewniając się skojarzyć każdą stronę z następujących stron ASP.NET `Site.master` strony głównej:</span><span class="sxs-lookup"><span data-stu-id="5bb85-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="5bb85-134">Dodaj również `CustomProviders` podfolderu, aby `App_Code` folderu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>


![Dodawanie stron ASP.NET samouczki dotyczące dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-cs/_static/image2.gif)

<span data-ttu-id="5bb85-136">**Rysunek 2**: Dodawanie stron ASP.NET dla witryny mapy samouczki związane z dostawcą</span><span class="sxs-lookup"><span data-stu-id="5bb85-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>


<span data-ttu-id="5bb85-137">Ponieważ istnieje tylko jeden samouczek dla tej sekcji, możemy ADAM potrzeby t `Default.aspx` do listy samouczki sekcji s.</span><span class="sxs-lookup"><span data-stu-id="5bb85-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="5bb85-138">Zamiast tego `Default.aspx` wyświetli kategorii w kontrolce GridView.</span><span class="sxs-lookup"><span data-stu-id="5bb85-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="5bb85-139">Firma Microsoft będzie rozwiązano ten problem w kroku 2.</span><span class="sxs-lookup"><span data-stu-id="5bb85-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="5bb85-140">Następnie zaktualizuj `Web.sitemap` załączanie odwołań do `Default.aspx` strony.</span><span class="sxs-lookup"><span data-stu-id="5bb85-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="5bb85-141">W szczególności, Dodaj następujący kod po buforowanie `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="5bb85-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample1.xml)]

<span data-ttu-id="5bb85-142">Po zaktualizowaniu `Web.sitemap`, Poświęć chwilę, aby wyświetlić witrynę sieci Web samouczki, za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="5bb85-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="5bb85-143">Menu po lewej stronie zawiera teraz elementu samouczek dostawcy mapy witryny wyłącznie.</span><span class="sxs-lookup"><span data-stu-id="5bb85-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>


![Mapy witryny zawiera teraz wpis samouczek dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-cs/_static/image3.gif)

<span data-ttu-id="5bb85-145">**Rysunek 3**: mapy witryny zawiera teraz wpis samouczek dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="5bb85-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>


<span data-ttu-id="5bb85-146">Głównym celem tego samouczka s jest aby zilustrować Tworzenie dostawcy mapy witryny niestandardowej i konfigurowanie aplikacji sieci web do korzystania z tego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="5bb85-147">W szczególności firma Microsoft będzie kompilacji dostawcy, która zwraca mapy witryny, która zawiera węzeł główny wraz z węzłem dla każdej kategorii i produktu, jak pokazano na rysunku 1.</span><span class="sxs-lookup"><span data-stu-id="5bb85-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="5bb85-148">Ogólnie rzecz biorąc każdy węzeł mapy witryny może określić adres URL.</span><span class="sxs-lookup"><span data-stu-id="5bb85-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="5bb85-149">Dla naszych mapy witryny będą głównego adresu URL węzła s `~/SiteMapProvider/Default.aspx`, który znajduje się lista wszystkich kategorii w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="5bb85-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="5bb85-150">Każdy węzeł kategorii mapy witryny będą mieć adres URL, który wskazuje `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, która będzie zawierała listę wszystkich produktów w określonej *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="5bb85-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="5bb85-151">Ponadto każdy węzeł mapy witryny produktu wskaże `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, które będą wyświetlane szczegóły określonego produktu s.</span><span class="sxs-lookup"><span data-stu-id="5bb85-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="5bb85-152">Aby uruchomić należy utworzyć `Default.aspx`, `ProductsByCategory.aspx`, i `ProductDetails.aspx` stron.</span><span class="sxs-lookup"><span data-stu-id="5bb85-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="5bb85-153">Te strony są wykonywane w kroku 2, 3 i 4, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="5bb85-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="5bb85-154">Ponieważ impuls w tym samouczku znajduje się w dostawcy mapy witryny i samouczki ostatnich ma pasuje do tworzenia raportów tego rodzaju wielostronicowych wzorzec/szczegół, firma Microsoft będzie Pospiesz się za pośrednictwem kroki 2 do 4.</span><span class="sxs-lookup"><span data-stu-id="5bb85-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="5bb85-155">Jeśli potrzebujesz odświeżacz o tworzeniu raportów wzorzec/szczegół, obejmującej wiele stron, odwołaj się do [wzorzec/szczegół filtrowania między dwoma stronami](../masterdetail/master-detail-filtering-across-two-pages-cs.md) samouczka.</span><span class="sxs-lookup"><span data-stu-id="5bb85-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="5bb85-156">Krok 2: Wyświetlanie listy kategorii</span><span class="sxs-lookup"><span data-stu-id="5bb85-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="5bb85-157">Otwórz `Default.aspx` strony `SiteMapProvider` folder i przeciągnij element GridView z przybornika do projektanta, ustawienie jej `ID` do `Categories`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="5bb85-158">Z tagów inteligentnych s GridView powiązać go z nowego elementu ObjectDataSource o nazwie `CategoriesDataSource` i skonfiguruj ją tak, aby pobiera, jego danych przy użyciu `CategoriesBLL` klasy s `GetCategories` metody.</span><span class="sxs-lookup"><span data-stu-id="5bb85-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="5bb85-159">Ponieważ właśnie tego widoku GridView przedstawia kategorie i nie ma możliwości zmiany danych, ustaw list rozwijanych w UPDATE, INSERT i usuwanie kart na (Brak).</span><span class="sxs-lookup"><span data-stu-id="5bb85-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="5bb85-160">[![Skonfiguruj ObjectDataSource do zwrócenia kategorii przy użyciu metody GetCategories](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span></span>

<span data-ttu-id="5bb85-161">**Rysunek 4**: Konfigurowanie ObjectDataSource powrócić przy użyciu kategorii `GetCategories` — metoda ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span></span>


<span data-ttu-id="5bb85-162">[![Ustawianie list rozwijanych w UPDATE, INSERT i usuwanie kart na (Brak)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span></span>

<span data-ttu-id="5bb85-163">**Rysunek 5**: wartość listy rozwijane w AKTUALIZOWANIA, WSTAWIANIA i usuwanie kart (None) ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span></span>


<span data-ttu-id="5bb85-164">Po zakończeniu pracy Kreatora konfigurowania źródła danych programu Visual Studio spowoduje dodanie elementu BoundField dla `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, i `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="5bb85-165">Edytowanie widoku GridView, tak aby zawierała tylko `CategoryName` i `Description` BoundFields i zaktualizuj `CategoryName` s elementu BoundField `HeaderText` właściwości do kategorii.</span><span class="sxs-lookup"><span data-stu-id="5bb85-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="5bb85-166">Następnie dodaj pole hiperłącza HyperLinkField i umieść go tak że s pole lewej.</span><span class="sxs-lookup"><span data-stu-id="5bb85-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="5bb85-167">Ustaw `DataNavigateUrlFields` właściwości `CategoryID` i `DataNavigateUrlFormatString` właściwości `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="5bb85-168">Ustaw `Text` właściwości do widoku produktów.</span><span class="sxs-lookup"><span data-stu-id="5bb85-168">Set the `Text` property to View Products .</span></span>


![Dodaj pole hiperłącza HyperLinkField do widoku GridView kategorii](building-a-custom-database-driven-site-map-provider-cs/_static/image6.gif)

<span data-ttu-id="5bb85-170">**Rysunek 6**: Dodaj pole hiperłącza HyperLinkField do `Categories` widoku GridView</span><span class="sxs-lookup"><span data-stu-id="5bb85-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>


<span data-ttu-id="5bb85-171">Po utworzeniu elementu ObjectDataSource i dostosowywanie pól s GridView, znaczników deklaratywne dwóch formantów będzie wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="5bb85-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample2.aspx)]

<span data-ttu-id="5bb85-172">Rysunek nr 7 przedstawia `Default.aspx` podczas wyświetlania za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="5bb85-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="5bb85-173">Kliknięcie kategorii s Wyświetl produkty łącze prowadzi do `ProductsByCategory.aspx?CategoryID=categoryID`, które firma Microsoft będzie kompilowana w kroku 3.</span><span class="sxs-lookup"><span data-stu-id="5bb85-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>


<span data-ttu-id="5bb85-174">[![Każda kategoria to wymienione wraz z łączem produktów widoku](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span></span>

<span data-ttu-id="5bb85-175">**Rysunek 7**: każdej kategorii jest wymienione wraz z łączem produktów widoku ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span></span>


## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="5bb85-176">Krok 3: Wyświetlanie wybranej kategorii produktów s</span><span class="sxs-lookup"><span data-stu-id="5bb85-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="5bb85-177">Otwórz `ProductsByCategory.aspx` i dodać element GridView nazw `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="5bb85-178">W tagu inteligentnego powiązać widoku GridView nowy element ObjectDataSource o nazwie `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="5bb85-179">Element ObjectDataSource umożliwia konfigurowanie `ProductsBLL` klasy s `GetProductsByCategoryID(categoryID)` — metoda i zestaw listy rozwijanej listy (Brak), na kartach UPDATE, INSERT i DELETE.</span><span class="sxs-lookup"><span data-stu-id="5bb85-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>


<span data-ttu-id="5bb85-180">[![Użyj metody GetProductsByCategoryID(categoryID) s ProductsBLL — klasa](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span></span>

<span data-ttu-id="5bb85-181">**Rysunek 8**: Użyj `ProductsBLL` klasy s `GetProductsByCategoryID(categoryID)` — metoda ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span></span>


<span data-ttu-id="5bb85-182">Ostatnim krokiem w Kreatorze skonfiguruj źródło danych wyświetla monit o źródło parametru *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="5bb85-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="5bb85-183">Ponieważ te informacje są przesyłane za pomocą pola querystring `CategoryID`, wybierz ciąg zapytania z listy rozwijanej i wprowadź w polu tekstowym pole QueryStringField CategoryID, jak pokazano na rysunku 9.</span><span class="sxs-lookup"><span data-stu-id="5bb85-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="5bb85-184">Kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="5bb85-184">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="5bb85-185">[![Użyj pola Querystring CategoryID dla categoryID parametru](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span></span>

<span data-ttu-id="5bb85-186">**Rysunek 9**: Użyj `CategoryID` pola Querystring *categoryID* parametr ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span></span>


<span data-ttu-id="5bb85-187">Po zakończeniu działania kreatora programu Visual Studio zostaną dodane do widoku GridView dla pól danych produktu odpowiednie BoundFields i CheckBoxField.</span><span class="sxs-lookup"><span data-stu-id="5bb85-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="5bb85-188">Usuń wszystkie elementy oprócz `ProductName`, `UnitPrice`, i `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="5bb85-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="5bb85-189">Dostosuj te trzy BoundFields `HeaderText` właściwości do odczytu produktu, ceny i dostawcy, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="5bb85-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="5bb85-190">Format `UnitPrice` elementu BoundField jako walutę.</span><span class="sxs-lookup"><span data-stu-id="5bb85-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="5bb85-191">Następnie dodaj pole hiperłącza HyperLinkField i przenieś ją do lewej położenia.</span><span class="sxs-lookup"><span data-stu-id="5bb85-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="5bb85-192">Ustaw jego `Text` właściwości, aby wyświetlić szczegóły jego `DataNavigateUrlFields` właściwości `ProductID`i jego `DataNavigateUrlFormatString` właściwości `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>


![Dodaj widok szczegółów pole hiperłącza HyperLinkField wskazujące ProductDetails.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image10.gif)

<span data-ttu-id="5bb85-194">**Na rysunku nr 10**: Dodawanie widoku szczegółów pole hiperłącza HyperLinkField, który wskazuje `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="5bb85-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>


<span data-ttu-id="5bb85-195">Po wykonaniu tych dostosowań, znaczników deklaratywne s GridView i ObjectDataSource powinna wyglądać w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="5bb85-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample3.aspx)]

<span data-ttu-id="5bb85-196">Wróć do wyświetlania `Default.aspx` za pośrednictwem przeglądarki i kliknij pozycję Wyświetl produkty łączy dla napoje.</span><span class="sxs-lookup"><span data-stu-id="5bb85-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="5bb85-197">Spowoduje to przejście do `ProductsByCategory.aspx?CategoryID=1`, wyświetlanie nazw, ceny i dostawców produktów w bazie danych Northwind, który należy do należące do tej kategorii (patrz rysunek 11).</span><span class="sxs-lookup"><span data-stu-id="5bb85-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="5bb85-198">Możesz zwiększyć tę stronę, aby uwzględnić łącze do zwrócenia użytkowników na stronę listy kategorii (`Default.aspx`) i wyświetla wybraną kategorię s nazwę i opis formantu widoku DetailsView lub FormView.</span><span class="sxs-lookup"><span data-stu-id="5bb85-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>


<span data-ttu-id="5bb85-199">[![Są wyświetlane nazwy napoje, ceny i dostawcami](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span></span>

<span data-ttu-id="5bb85-200">**Rysunek 11**: są wyświetlane nazwy napoje, ceny i dostawców ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span></span>


## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="5bb85-201">Krok 4: Pokazywanie szczegółów s produktu</span><span class="sxs-lookup"><span data-stu-id="5bb85-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="5bb85-202">Ostatnia strona `ProductDetails.aspx`, wyświetlane są szczegóły zaznaczonych produktów.</span><span class="sxs-lookup"><span data-stu-id="5bb85-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="5bb85-203">Otwórz `ProductDetails.aspx` i przeciągnij element DetailsView z przybornika do projektanta.</span><span class="sxs-lookup"><span data-stu-id="5bb85-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="5bb85-204">Ustaw s widoku DetailsView `ID` właściwości `ProductInfo` i wyczyszczenie jego `Height` i `Width` wartości właściwości.</span><span class="sxs-lookup"><span data-stu-id="5bb85-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="5bb85-205">W tagu inteligentnego powiązać widoku DetailsView nowy element ObjectDataSource o nazwie `ProductDataSource`, konfigurowanie ObjectDataSource jego dane z `ProductsBLL` klasy s `GetProductByProductID(productID)` metody.</span><span class="sxs-lookup"><span data-stu-id="5bb85-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="5bb85-206">Podobnie jak w przypadku poprzednich stron sieci web utworzony w kroki 2 i 3 zestawu list rozwijanych w UPDATE, INSERT i usuwanie kart na (Brak).</span><span class="sxs-lookup"><span data-stu-id="5bb85-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="5bb85-207">[![Skonfiguruj element ObjectDataSource przy użyciu metody GetProductByProductID(productID)](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span></span>

<span data-ttu-id="5bb85-208">**Rysunek 12**: Konfigurowanie ObjectDataSource użyć `GetProductByProductID(productID)` — metoda ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span></span>


<span data-ttu-id="5bb85-209">Ostatni krok kreatora konfigurowania źródła danych monit o podanie źródła *productID* parametru.</span><span class="sxs-lookup"><span data-stu-id="5bb85-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="5bb85-210">Ponieważ te dane jest dostarczany za pomocą pola querystring `ProductID`, ustaw listy rozwijanej QueryString i pole tekstowe pole QueryStringField do ProductID.</span><span class="sxs-lookup"><span data-stu-id="5bb85-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="5bb85-211">Na koniec kliknij przycisk Zakończ, aby zakończyć pracę kreatora.</span><span class="sxs-lookup"><span data-stu-id="5bb85-211">Finally, click the Finish button to complete the wizard.</span></span>


<span data-ttu-id="5bb85-212">[![Skonfiguruj productID parametru ściągania jego wartość z pola ProductID ciąg zapytania](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span></span>

<span data-ttu-id="5bb85-213">**Rysunek 13**: Konfigurowanie *productID* parametru ściągania jego wartość z `ProductID` pole Querystring ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span></span>


<span data-ttu-id="5bb85-214">Po zakończeniu pracy Kreatora konfigurowania źródła danych, Visual Studio utworzy odpowiedni BoundFields i CheckBoxField w widoku DetailsView dla pól danych produktu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="5bb85-215">Usuń `ProductID`, `SupplierID`, i `CategoryID` BoundFields i skonfiguruj pozostałe pola zgodnie z własnymi potrzebami.</span><span class="sxs-lookup"><span data-stu-id="5bb85-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="5bb85-216">Po kilku estetycznych konfiguracje Moje widoku DetailsView i ObjectDataSource s deklaratywne znaczników wyszukiwanego podobne do poniższych:</span><span class="sxs-lookup"><span data-stu-id="5bb85-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample4.aspx)]

<span data-ttu-id="5bb85-217">Aby przetestować tę stronę, wróć do `Default.aspx` i kliknij polecenie Wyświetl produkty dla należące do tej kategorii.</span><span class="sxs-lookup"><span data-stu-id="5bb85-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="5bb85-218">Z listą produktów napoju, kliknij Link Wyświetl szczegóły, aby Zepołowy Chai.</span><span class="sxs-lookup"><span data-stu-id="5bb85-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="5bb85-219">Spowoduje to przejście do `ProductDetails.aspx?ProductID=1`, który wskazuje s Zepołowy Chai szczegóły (patrz rysunek 14).</span><span class="sxs-lookup"><span data-stu-id="5bb85-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>


<span data-ttu-id="5bb85-220">[![Zostanie wyświetlony Chai Zepołowy s dostawca, kategoria, ceny i inne informacje](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span></span>

<span data-ttu-id="5bb85-221">**Rysunek 14**: Zepołowy Chai s dostawca, kategoria, ceny i inne informacje są wyświetlane ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span></span>


## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="5bb85-222">Krok 5: Opis przebiega dostawcy mapy witryny</span><span class="sxs-lookup"><span data-stu-id="5bb85-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="5bb85-223">Mapy witryny jest reprezentowana w pamięci s serwera sieci web jako kolekcja `SiteMapNode` wystąpień, które tworzą hierarchię.</span><span class="sxs-lookup"><span data-stu-id="5bb85-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="5bb85-224">Musi istnieć dokładnie jeden katalog główny, wszystkie węzły z systemem innym niż główny musi mieć dokładnie jeden węzeł nadrzędny i wszystkich węzłów może mieć dowolną liczbę elementów podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="5bb85-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="5bb85-225">Każdy `SiteMapNode` obiekt reprezentuje sekcję w strukturze witryny sieci Web s; te sekcje często mają odpowiednie strony sieci web.</span><span class="sxs-lookup"><span data-stu-id="5bb85-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="5bb85-226">W rezultacie [ `SiteMapNode` klasy](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) ma właściwości, takie jak `Title`, `Url`, i `Description`, które zapewniają informacje o sekcji `SiteMapNode` reprezentuje.</span><span class="sxs-lookup"><span data-stu-id="5bb85-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="5bb85-227">Istnieje również `Key` właściwości, który unikatowo identyfikuje każdego `SiteMapNode` w hierarchii, jak również właściwości używany do ustanawiania tej hierarchii `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, itd.</span><span class="sxs-lookup"><span data-stu-id="5bb85-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="5bb85-228">Rysunek 15 zawiera struktura mapy witryny ogólne z rysunku 1, ale określiła szczegółowo bardziej precyzyjną szczegóły implementacji.</span><span class="sxs-lookup"><span data-stu-id="5bb85-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>


<span data-ttu-id="5bb85-229">[![Każdy SiteMapNode ma właściwości, takie jak tytuł, adres Url, klucz itd.](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="5bb85-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span></span>

<span data-ttu-id="5bb85-230">**Rysunek 15**: każdego `SiteMapNode` ma właściwości jak `Title`, `Url`, `Key`i tak dalej ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="5bb85-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span></span>


<span data-ttu-id="5bb85-231">Mapy witryny jest dostępna za pośrednictwem [ `SiteMap` klasy](https://msdn.microsoft.com/library/system.web.sitemap.aspx) w [ `System.Web` przestrzeni nazw](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="5bb85-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="5bb85-232">Ta klasa s `RootNode` właściwość zwraca lokacji głównej mapy s `SiteMapNode` wystąpienia; `CurrentNode` zwraca `SiteMapNode` których `Url` właściwości odpowiada adresowi URL obecnie żądanej strony.</span><span class="sxs-lookup"><span data-stu-id="5bb85-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="5bb85-233">Ta klasa jest używana wewnętrznie przez formanty sieci Web programu ASP.NET 2.0 s nawigacji.</span><span class="sxs-lookup"><span data-stu-id="5bb85-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="5bb85-234">Gdy `SiteMap` właściwości klasy s są dostępne, musi on serializować struktury mapy witryny niektóre stałe nośnik do pamięci.</span><span class="sxs-lookup"><span data-stu-id="5bb85-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="5bb85-235">Jednak logiki serializacji mapy witryny nie jest trudne w `SiteMap` klasy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="5bb85-236">Zamiast tego w czasie wykonywania `SiteMap` klasy określa, które mapy witryny *dostawcy* do użycia na potrzeby serializacji.</span><span class="sxs-lookup"><span data-stu-id="5bb85-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="5bb85-237">Domyślnie [ `XmlSiteMapProvider` klasy](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) jest używana, która odczytuje struktura s mapy witryny z pliku XML niepoprawnie sformatowany.</span><span class="sxs-lookup"><span data-stu-id="5bb85-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="5bb85-238">Jednak z niewielki pracy można utworzyć własną niestandardową witrynę dostawcy mapy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="5bb85-239">Wszystkich dostawców mapy witryny musi pochodzić od [ `SiteMapProvider` klasy](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), w tym podstawowych metod i właściwości wymagane dla lokacji mapy dostawców, ale pominięto wiele szczegóły implementacji.</span><span class="sxs-lookup"><span data-stu-id="5bb85-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="5bb85-240">W drugiej klasy [ `StaticSiteMapProvider` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), rozszerza `SiteMapProvider` klasy i zawiera bardziej niezawodne implementacja funkcje.</span><span class="sxs-lookup"><span data-stu-id="5bb85-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="5bb85-241">Wewnętrznie `StaticSiteMapProvider` przechowuje `SiteMapNode` wystąpień witryny mapy w `Hashtable` i udostępnia metody, takich jak `AddNode(child, parent)`, `RemoveNode(siteMapNode),` i `Clear()` który Dodawanie i usuwanie `SiteMapNode` s do wewnętrznej `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="5bb85-242">`XmlSiteMapProvider` jest pochodną `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="5bb85-243">Jeśli tworzenie dostawcy mapy niestandardowej witryny, która rozszerza `StaticSiteMapProvider`, istnieją dwie metody abstrakcyjnej, które musi zostać zastąpiona: [ `BuildSiteMap` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) i [ `GetRootNodeCore` ](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="5bb85-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="5bb85-244">`BuildSiteMap`, jak jego nazwa wskazuje, jest odpowiedzialny za ładowanie struktury mapy witryny z magazynu trwałego i tworzenia go w pamięci.</span><span class="sxs-lookup"><span data-stu-id="5bb85-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="5bb85-245">`GetRootNodeCore` Zwraca główny węzeł mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="5bb85-246">Przed sieci web aplikacji można użyć dostawcy mapy witryny, który musi być zarejestrowany w konfiguracji aplikacji s.</span><span class="sxs-lookup"><span data-stu-id="5bb85-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="5bb85-247">Domyślnie `XmlSiteMapProvider` klasa jest zarejestrowana przy użyciu nazwy `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="5bb85-248">Aby zarejestrować lokacji dodatkowych dostawców mapy, Dodaj następujący kod do `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="5bb85-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample5.xml)]

<span data-ttu-id="5bb85-249">*Nazwa* wartość przypisuje nazwę zrozumiałą dla dostawcy podczas *typu* pełni kwalifikowanego typu nazwa dostawcy mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="5bb85-250">Firma Microsoft będzie Poznaj konkretne wartości *nazwa* i *typu* wartości w kroku 7 po możemy kolejnych utworzone naszych dostawcy mapy niestandardowej witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="5bb85-251">Klasa dostawcy mapy witryny zostanie uruchomiony po raz pierwszy jest dostępny z `SiteMap` klasy i pozostaje w pamięci przez czas ich istnienia aplikacji sieci web.</span><span class="sxs-lookup"><span data-stu-id="5bb85-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="5bb85-252">Ponieważ istnieje tylko jedno wystąpienie dostawcy mapy witryny, który może wywołać z wielu równoczesnych osoby odwiedzające, konieczne jest konieczności metod dostawcy s *wątkowo*.</span><span class="sxs-lookup"><span data-stu-id="5bb85-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="5bb85-253">Wydajność i skalowalność powodów jego s ważne, możemy pamięci podręcznej w pamięci lokacji mapowania struktury i zwracać buforowane to struktura zamiast konieczności jej ponownego tworzenia zawsze `BuildSiteMap` wywołania metody.</span><span class="sxs-lookup"><span data-stu-id="5bb85-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="5bb85-254">`BuildSiteMap` może zostać wywołana kilka razy na żądanie dostępu do strony dla poszczególnych użytkowników, w zależności od formantów nawigacji używany na stronie i głębokość struktury mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="5bb85-255">W każdym przypadku, jeśli firma Microsoft nie buforują struktury mapy witryny w `BuildSiteMap` , a następnie zawsze jest wywoływana, czy należy ponownie pobrać produktu oraz informacje o kategorii z architektury (co spowoduje powstanie zapytania do bazy danych).</span><span class="sxs-lookup"><span data-stu-id="5bb85-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="5bb85-256">Jak wspomniano w poprzedniej samouczki buforowania danych z pamięci podręcznej może stać się przestarzałe.</span><span class="sxs-lookup"><span data-stu-id="5bb85-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="5bb85-257">To zwalczania, firma Microsoft może używać czas - lub expiries na podstawie zależności buforu SQL.</span><span class="sxs-lookup"><span data-stu-id="5bb85-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="5bb85-258">Dostawcy mapy witryny może opcjonalnie zastąpić [ `Initialize` metody](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="5bb85-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="5bb85-259">`Initialize` wywoływane, gdy dostawcy mapy witryny jest najpierw wystąpienie zostało utworzone i jest przekazywany dowolne atrybuty niestandardowe przypisane do dostawcy w `Web.config` w `<add>` elementów, takich jak: `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="5bb85-260">Jest przydatne, jeśli chcesz zezwolić dewelopera strony określić różne ustawienia mapy witryny związane z dostawcą bez konieczności modyfikowania kodu s dostawcy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="5bb85-261">Na przykład, jeśli firma Microsoft zostały odczytu kategorii i produktów danych bezpośrednio z bazy danych, w przeciwieństwie do za pomocą architektury, możemy d prawdopodobnie chcesz zezwolić developer strony, określ odpowiedni ciąg połączenia bazy danych za pośrednictwem `Web.config` zamiast przy użyciu zakodowanego wartość w kodzie dostawcy s.</span><span class="sxs-lookup"><span data-stu-id="5bb85-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="5bb85-262">Firma Microsoft będzie kompilacji w kroku 6 dostawcy mapy niestandardowej witryny nie zastępuje to `Initialize` metody.</span><span class="sxs-lookup"><span data-stu-id="5bb85-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="5bb85-263">Przykład za pomocą `Initialize` metody, zapoznaj się [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [przechowywania map witryn w programie SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) artykułu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>


## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="5bb85-264">Krok 6: Tworzenie dostawcy mapy witryny niestandardowej</span><span class="sxs-lookup"><span data-stu-id="5bb85-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="5bb85-265">Aby utworzyć niestandardową witrynę dostawcy mapy, który kompiluje mapy witryny z kategorii i produktów w bazie danych Northwind, należy utworzyć klasę, która rozszerza `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="5bb85-266">W kroku 1 pojawia się pytanie, można dodać `CustomProviders` folderu w `App_Code` folderu - Dodaj nową klasę do tego folderu o nazwie `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="5bb85-267">Dodaj następujący kod do `NorthwindSiteMapProvider` klasy:</span><span class="sxs-lookup"><span data-stu-id="5bb85-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample6.cs)]

<span data-ttu-id="5bb85-268">Let s rozpoczynać się od tej klasy s eksploracji `BuildSiteMap` metodę, która rozpoczyna się od [ `lock` instrukcji](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="5bb85-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="5bb85-269">`lock` Instrukcji zezwala tylko jeden wątek w momencie wprowadzenia, tym samym dostęp do jej kodu serializacji i uniemożliwia wykonywanie krok po kroku na siebie s roku dwa współbieżnych wątków.</span><span class="sxs-lookup"><span data-stu-id="5bb85-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="5bb85-270">Klasa poziomie `SiteMapNode` zmiennej `root` służy do buforowania struktury mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="5bb85-271">Gdy mapy witryny jest tworzony po raz pierwszy lub po raz pierwszy po zmodyfikowaniu danych `root` będzie `null` i będzie można utworzyć struktury mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `null` and the site map structure will be constructed.</span></span> <span data-ttu-id="5bb85-272">Węzeł główny mapy s witryny jest przypisany do `root` podczas konstruowania procesu, aby następnym razem ta metoda jest wywoływana, `root` nie będzie `null`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `null`.</span></span> <span data-ttu-id="5bb85-273">W związku z tym tak długo, jak `root` nie jest `null` struktury mapy witryny zostanie zwrócony do obiektu wywołującego bez konieczności ponownego tworzenia.</span><span class="sxs-lookup"><span data-stu-id="5bb85-273">Consequently, so long as `root` is not `null` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="5bb85-274">Jeśli główny jest `null`, struktura mapy witryny jest tworzona na podstawie informacji dotyczących produktu i kategorii.</span><span class="sxs-lookup"><span data-stu-id="5bb85-274">If root is `null`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="5bb85-275">Mapy witryny jest konstruowany przez tworzenie `SiteMapNode` wystąpień i następnie tworząca hierarchii za pomocą wywołania `StaticSiteMapProvider` klasy s `AddNode` metody.</span><span class="sxs-lookup"><span data-stu-id="5bb85-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="5bb85-276">`AddNode` wykonuje wewnętrznej księgowości, przechowywanie różne `SiteMapNode` wystąpień w `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="5bb85-277">Przed rozpoczęciem możemy tworzenia hierarchii, Rozpoczniemy przez wywołanie metody `Clear` metodę, która powoduje elementów wewnętrznych `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="5bb85-278">Następnie `ProductsBLL` klasy s `GetProducts` — metoda i powstałe w ten sposób `ProductsDataTable` są przechowywane w zmiennych lokalnych.</span><span class="sxs-lookup"><span data-stu-id="5bb85-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="5bb85-279">Konstrukcja mapy s lokacji rozpoczyna się od tworzenia węzła głównego i przypisywania go do `root`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="5bb85-280">Przeciążenia [ `SiteMapNode` Konstruktor s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) używane w tym miejscu i przez to `BuildSiteMap` jest przekazywany następujące informacje:</span><span class="sxs-lookup"><span data-stu-id="5bb85-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="5bb85-281">Odwołanie do dostawcy mapy witryny (`this`).</span><span class="sxs-lookup"><span data-stu-id="5bb85-281">A reference to the site map provider (`this`).</span></span>
- <span data-ttu-id="5bb85-282">`SiteMapNode` s `Key`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="5bb85-283">To wymagane, wartość musi być unikatowa dla każdej `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="5bb85-284">`SiteMapNode` s `Url`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="5bb85-285">`Url` jest opcjonalna, ale w przypadku każdego `SiteMapNode` s `Url` wartość musi być unikatowa.</span><span class="sxs-lookup"><span data-stu-id="5bb85-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="5bb85-286">`SiteMapNode` s `Title`, co jest wymagane.</span><span class="sxs-lookup"><span data-stu-id="5bb85-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="5bb85-287">`AddNode(root)` Dodaje wywołania metody `SiteMapNode` `root` do mapy witryny jako katalogu głównego.</span><span class="sxs-lookup"><span data-stu-id="5bb85-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="5bb85-288">Następnie każdego `ProductRow` w `ProductsDataTable` wyliczeniu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="5bb85-289">Jeśli istnieje już `SiteMapNode` dla bieżącej kategorii produktów s odwołuje się do.</span><span class="sxs-lookup"><span data-stu-id="5bb85-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="5bb85-290">W przeciwnym razie nowy `SiteMapNode` dla kategorii jest tworzony i dodawany jako element podrzędny `SiteMapNode``root` za pośrednictwem `AddNode(categoryNode, root)` wywołania metody.</span><span class="sxs-lookup"><span data-stu-id="5bb85-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="5bb85-291">Po odpowiedniej kategorii `SiteMapNode` węzeł został znalezione lub utworzone, `SiteMapNode` jest tworzony dla bieżącego produktu i dodawany jako element podrzędny kategorii `SiteMapNode` za pośrednictwem `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="5bb85-292">Należy pamiętać, że kategoria `SiteMapNode` s `Url` wartość właściwości jest `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` podczas produktu `SiteMapNode` s `Url` przypisano właściwości `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="5bb85-293">Te produkty, które mają bazy danych `NULL` wartość ich `CategoryID` są pogrupowane w kategorii `SiteMapNode` których `Title` właściwość ma wartość None i których `Url` właściwość jest ustawiona na pusty ciąg.</span><span class="sxs-lookup"><span data-stu-id="5bb85-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="5bb85-294">I decyzję ustawić `Url` na pusty ciąg od `ProductBLL` klasy s `GetProductsByCategory(categoryID)` metody obecnie nie ma możliwości, aby przywrócić tylko te produkty z `NULL` `CategoryID` wartości.</span><span class="sxs-lookup"><span data-stu-id="5bb85-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="5bb85-295">Ponadto miała być pokazują, jak renderowania formantów nawigacji `SiteMapNode` bez wartości dla jego `Url` właściwości.</span><span class="sxs-lookup"><span data-stu-id="5bb85-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="5bb85-296">I zachęca do rozszerzać ten samouczek, aby Brak `SiteMapNode` s `Url` wskazuje `ProductsByCategory.aspx`, tylko zawiera produkty z `NULL` `CategoryID` wartości.</span><span class="sxs-lookup"><span data-stu-id="5bb85-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>


<span data-ttu-id="5bb85-297">Po tworzenia mapy witryny, dowolny obiekt jest dodawany do pamięci podręcznej danych przy użyciu zależności bufora SQL na `Categories` i `Products` tabel za pomocą `AggregateCacheDependency` obiektu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="5bb85-298">Firma Microsoft zbadane, przy użyciu zależności buforu SQL w poprzednim samouczka *przy użyciu zależności buforu SQL*.</span><span class="sxs-lookup"><span data-stu-id="5bb85-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="5bb85-299">Niestandardowa witryna dostawcy mapy, jednak używane jest przeciążenie pamięci podręcznej danych s `Insert` — metoda tego możemy kolejnych jeszcze, aby zapoznać się z.</span><span class="sxs-lookup"><span data-stu-id="5bb85-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="5bb85-300">To przeciążenie akceptuje jako jego ostatni parametr wejściowy delegata, który jest wywoływany, gdy obiekt jest usunięty z pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="5bb85-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="5bb85-301">W szczególności jest przekazywana w nowym [ `CacheItemRemovedCallback` delegować](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) wskazującego `OnSiteMapChanged` metoda zdefiniowana dalszych szczegółów w `NorthwindSiteMapProvider` klasy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="5bb85-302">Reprezentacja w pamięci mapy witryny jest buforowana za pośrednictwem zmiennej poziomie klasy `root`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="5bb85-303">Ponieważ istnieje tylko jedno wystąpienie klasy dostawcy mapy witryny niestandardowej i ponieważ to wystąpienie jest współdzielona przez wszystkie wątki w aplikacji sieci web, ta zmienna klasy służy jako pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="5bb85-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="5bb85-304">`BuildSiteMap` Metoda również używa pamięci podręcznej danych, jednak tylko w sposób, aby otrzymać powiadomienie, gdy podstawowa z bazy danych w `Categories` lub `Products` tabel zmian.</span><span class="sxs-lookup"><span data-stu-id="5bb85-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="5bb85-305">Należy pamiętać, że wartość umieszczane w pamięci podręcznej danych tylko bieżącą datę i godzinę.</span><span class="sxs-lookup"><span data-stu-id="5bb85-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="5bb85-306">Dane mapy lokacji jest *nie* umieścić w pamięci podręcznej danych.</span><span class="sxs-lookup"><span data-stu-id="5bb85-306">The actual site map data is *not* put in the data cache.</span></span>


<span data-ttu-id="5bb85-307">`BuildSiteMap` Ukończeniu metody zwracając główny węzeł mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="5bb85-308">Pozostałe metody są bardzo prosta.</span><span class="sxs-lookup"><span data-stu-id="5bb85-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="5bb85-309">`GetRootNodeCore` jest odpowiedzialny za zwrócenie węzła głównego.</span><span class="sxs-lookup"><span data-stu-id="5bb85-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="5bb85-310">Ponieważ `BuildSiteMap` zwraca główny `GetRootNodeCore` po prostu zwraca `BuildSiteMap` s zwracają wartość.</span><span class="sxs-lookup"><span data-stu-id="5bb85-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="5bb85-311">`OnSiteMapChanged` Zestawy metody `root` do `null` po usunięciu elementu pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="5bb85-311">The `OnSiteMapChanged` method sets `root` back to `null` when the cache item is removed.</span></span> <span data-ttu-id="5bb85-312">Z certyfikatem głównym ustawiana dla `null`, przy następnym `BuildSiteMap` jest wywołane, struktura mapy witryny zostanie odbudowany.</span><span class="sxs-lookup"><span data-stu-id="5bb85-312">With root set back to `null`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="5bb85-313">Ponadto `CachedDate` właściwość zwraca wartość daty i godziny przechowywane w pamięci podręcznej danych, jeśli istnieje takich wartości.</span><span class="sxs-lookup"><span data-stu-id="5bb85-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="5bb85-314">Ta właściwość umożliwia przez dewelopera strony podczas ostatniego został buforowane dane mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="5bb85-315">Krok 7: Rejestrowanie`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="5bb85-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="5bb85-316">Aby naszej aplikacji sieci web do używania `NorthwindSiteMapProvider` utworzony w kroku 6 dostawcy mapy witryny, należy zarejestrować je w `<siteMap>` części `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="5bb85-317">W szczególności, Dodaj następujący kod w `<system.web>` element `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="5bb85-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample7.xml)]

<span data-ttu-id="5bb85-318">Ten kod znaczników wykonuje dwie czynności: najpierw, oznacza to, że wbudowane `AspNetXmlSiteMapProvider` domyślny dostawca mapy witryny; drugie, rejestruje dostawcy mapy niestandardowej witryny utworzony w kroku 6 o nazwie przyjaznych dla człowieka Northwind.</span><span class="sxs-lookup"><span data-stu-id="5bb85-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="5bb85-319">Dla dostawcy map witryn znajdujących się w aplikacji s `App_Code` folderu, wartość `type` atrybut jest po prostu nazwę klasy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="5bb85-320">Alternatywnie dostawcy mapy witryny niestandardowych można zostały utworzone w oddzielnych projektu biblioteki klas z skompilowanego zestawu umieszczone w s aplikacji sieci web `/Bin` katalogu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="5bb85-321">W takim przypadku `type` wartość atrybutu będzie *Namespace*. *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="5bb85-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>


<span data-ttu-id="5bb85-322">Po zaktualizowaniu `Web.config`, Poświęć chwilę, aby wyświetlić dowolną stronę z samouczków w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="5bb85-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="5bb85-323">Zauważ, że interfejs nawigacji po lewej stronie nadal zawiera sekcje i samouczki zdefiniowane w `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="5bb85-324">Jest to spowodowane możemy pozostałych `AspNetXmlSiteMapProvider` jako domyślny dostawca.</span><span class="sxs-lookup"><span data-stu-id="5bb85-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="5bb85-325">Aby można było utworzyć nawigacji elementu interfejsu użytkownika, który używa `NorthwindSiteMapProvider`, musisz jawnie określić, że dostawca mapy witryny Northwind powinny być używane.</span><span class="sxs-lookup"><span data-stu-id="5bb85-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="5bb85-326">Będzie przedstawiono, jak to zrobić w kroku 8.</span><span class="sxs-lookup"><span data-stu-id="5bb85-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="5bb85-327">Krok 8: Wyświetlanie informacji mapy witryny przy użyciu dostawcy mapy witryny niestandardowej</span><span class="sxs-lookup"><span data-stu-id="5bb85-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="5bb85-328">Z niestandardowej witryny dostawcy mapy utworzona i zarejestrowana w `Web.config`, możemy re gotowe do dodawania formantów nawigacji do `Default.aspx`, `ProductsByCategory.aspx`, i `ProductDetails.aspx` stron w `SiteMapProvider` folderu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="5bb85-329">Uruchamianie przez otwarcie `Default.aspx` strony i przeciągnij `SiteMapPath` z przybornika do projektanta.</span><span class="sxs-lookup"><span data-stu-id="5bb85-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="5bb85-330">Kontrolki ścieżki mapy witryny znajduje się w sekcji nawigacji przybornika.</span><span class="sxs-lookup"><span data-stu-id="5bb85-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>


<span data-ttu-id="5bb85-331">[![Dodawanie ścieżki mapy witryny do Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="5bb85-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span></span>

<span data-ttu-id="5bb85-332">**Rysunek 16**: ścieżki mapy witryny, aby dodać `Default.aspx` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="5bb85-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span></span>


<span data-ttu-id="5bb85-333">Kontrolki ścieżki mapy witryny Wyświetla ślad, wskazujący bieżącą lokalizację s strony w ramach mapy witryny.</span><span class="sxs-lookup"><span data-stu-id="5bb85-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="5bb85-334">Dodaliśmy ścieżki mapy witryny na początku strony wzorcowej w *stron wzorcowych i nawigacji w witrynie* samouczka.</span><span class="sxs-lookup"><span data-stu-id="5bb85-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="5bb85-335">Poświęć chwilę, aby wyświetlić tą stronę za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="5bb85-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="5bb85-336">Ścieżki mapy witryny dodane na rysunku 16 używa dostawcy mapy witryny domyślnej, ściąganie danych z `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="5bb85-337">W związku z tym łączach pokazuje Home &gt; Dostosowywanie mapy witryny, podobnie jak w łączach w prawym górnym rogu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>


<span data-ttu-id="5bb85-338">[![Łączach korzysta z domyślnego dostawcy mapy witryny](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="5bb85-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span></span>

<span data-ttu-id="5bb85-339">**Rysunek 17**: łączach używa dostawcy mapy witryny domyślnej ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="5bb85-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span></span>


<span data-ttu-id="5bb85-340">Aby ścieżki mapy witryny dodane na rysunku 16 korzystają z dostawcy mapy witryny niestandardowej utworzyliśmy w kroku 6, ustaw jej [ `SiteMapProvider` właściwości](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) do Northwind, nazwa możemy przypisana do `NorthwindSiteMapProvider` w `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="5bb85-341">Niestety Projektant w dalszym ciągu używa domyślnego dostawcy mapy witryny, ale w przypadku odwiedzenia strony za pośrednictwem przeglądarki po wprowadzeniu tej zmiany właściwości zobaczysz, że łączach teraz używa dostawcy mapy witryny niestandardowej.</span><span class="sxs-lookup"><span data-stu-id="5bb85-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>


<span data-ttu-id="5bb85-342">[![Łączach korzysta z NorthwindSiteMapProvider dostawcy mapy witryny niestandardowej](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="5bb85-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span></span>

<span data-ttu-id="5bb85-343">**Rysunek 18**: łączach korzysta z dostawcy mapy witryny niestandardowe `NorthwindSiteMapProvider` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="5bb85-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span></span>


<span data-ttu-id="5bb85-344">Kontrolki ścieżki mapy witryny Wyświetla więcej funkcjonalności interfejsu użytkownika w `ProductsByCategory.aspx` i `ProductDetails.aspx` stron.</span><span class="sxs-lookup"><span data-stu-id="5bb85-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="5bb85-345">Dodawanie ścieżki mapy witryny na tych stronach ustawienie `SiteMapProvider` właściwości zarówno do Northwind.</span><span class="sxs-lookup"><span data-stu-id="5bb85-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="5bb85-346">Z `Default.aspx` kliknij łącze Wyświetl produkty napojami, a następnie Link Wyświetl szczegóły, aby Zepołowy Chai.</span><span class="sxs-lookup"><span data-stu-id="5bb85-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="5bb85-347">Jak pokazano na rysunku 19, łączach obejmuje sekcji mapy bieżącej lokacji (Chai Zepołowy) i jego elementy nadrzędne: napoje i wszystkich kategorii.</span><span class="sxs-lookup"><span data-stu-id="5bb85-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>


<span data-ttu-id="5bb85-348">[![Łączach korzysta z NorthwindSiteMapProvider dostawcy mapy witryny niestandardowej](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="5bb85-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span></span>

<span data-ttu-id="5bb85-349">**Rysunek 19**: łączach korzysta z dostawcy mapy witryny niestandardowe `NorthwindSiteMapProvider` ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="5bb85-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span></span>


<span data-ttu-id="5bb85-350">Elementy interfejsu użytkownika innych nawigacji służy oprócz ścieżki mapy witryny, takie jak kontrolki TreeView i Menu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="5bb85-351">`Default.aspx`, `ProductsByCategory.aspx`, I `ProductDetails.aspx` strony pobierania w tym samouczku, na przykład obejmują kontrolek Menu (patrz rysunek 20).</span><span class="sxs-lookup"><span data-stu-id="5bb85-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="5bb85-352">Zobacz [s badanie ASP.NET 2.0 funkcji nawigacji witryny](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) i [za pomocą kontrolki witryny](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) sekcji [skrócone podręczniki platformy ASP.NET 2.0](https://quickstarts.asp.net/QuickStartv20/aspnet/) na pełniejsze przyjrzeć się formanty nawigacji i system mapy witryny w programie ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="5bb85-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>


<span data-ttu-id="5bb85-353">[![Formant Menu zawiera listę kategorii i produkty](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="5bb85-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span></span>

<span data-ttu-id="5bb85-354">**Rysunek 20**: Menu sterowania wyświetla każdy kategorie i produktów ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="5bb85-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span></span>


<span data-ttu-id="5bb85-355">Jak wspomniano wcześniej w tym samouczku, struktura mapy witryny można uzyskać dostęp programowo za pomocą `SiteMap` klasy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="5bb85-356">Poniższy kod Zwraca pierwiastek `SiteMapNode` domyślnego dostawcy:</span><span class="sxs-lookup"><span data-stu-id="5bb85-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample8.cs)]

<span data-ttu-id="5bb85-357">Ponieważ `AspNetXmlSiteMapProvider` jest dostawcą domyślnym dla aplikacji, kodu powyżej zwróci węzeł główny zdefiniowany w `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="5bb85-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="5bb85-358">Aby odwołać dostawcy mapy witryny innej niż domyślna, należy użyć `SiteMap` klasy s [ `Providers` właściwości](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="5bb85-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample9.cs)]

<span data-ttu-id="5bb85-359">Gdzie *nazwa* jest nazwa dostawcy mapy niestandardowej witryny (Northwind dla aplikacji sieci web).</span><span class="sxs-lookup"><span data-stu-id="5bb85-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="5bb85-360">Aby uzyskiwanie dostępu do członka, które są specyficzne dla dostawcy mapy witryny, należy użyć `SiteMap.Providers["name"]` można pobrać wystąpienia dostawcy i rzutować go do odpowiedniego typu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="5bb85-361">Na przykład, aby wyświetlić `NorthwindSiteMapProvider` s `CachedDate` właściwości strony ASP.NET, użyj następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="5bb85-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample10.cs)]

> [!NOTE]
> <span data-ttu-id="5bb85-362">Należy przetestować funkcji zależności buforu SQL.</span><span class="sxs-lookup"><span data-stu-id="5bb85-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="5bb85-363">Po przejściu na stronę `Default.aspx`, `ProductsByCategory.aspx`, i `ProductDetails.aspx` stron, przejdź do jednej z samouczków w edytowanie, wstawianie i usuwanie sekcji i Zmień nazwę kategorii lub produktu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="5bb85-364">Następnie wróć do jednej ze stron w `SiteMapProvider` folderu.</span><span class="sxs-lookup"><span data-stu-id="5bb85-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="5bb85-365">Zakładając, że dla mechanizmu sondowania zmian do podstawowej bazy danych należy pamiętać, upłynęło dostatecznie dużo czasu, mapy witryny powinny zostać uaktualnione do wyświetlenia nowego produktu lub nazwa kategorii.</span><span class="sxs-lookup"><span data-stu-id="5bb85-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>


## <a name="summary"></a><span data-ttu-id="5bb85-366">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="5bb85-366">Summary</span></span>

<span data-ttu-id="5bb85-367">Platforma ASP.NET 2.0 obejmuje funkcje mapy witryny s `SiteMap` klasy, określa liczbę wbudowanych nawigacji sieci Web i domyślnego dostawcy mapy witryny oczekuje mapy witryny utrwalone w pliku XML.</span><span class="sxs-lookup"><span data-stu-id="5bb85-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="5bb85-368">Aby można było użyć mapy witryny z z innego źródła takich jak z bazy danych, aplikacja — architektura s lub zdalnej usługi sieci Web, należy utworzyć niestandardową witrynę mapy dostawcy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="5bb85-369">Obejmuje to tworzenie klasy pochodnej, bezpośrednio lub pośrednio, z `SiteMapProvider` klasy.</span><span class="sxs-lookup"><span data-stu-id="5bb85-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="5bb85-370">W tym samouczku widzieliśmy jak utworzyć niestandardową witrynę mapy dostawcy mapy witryny na podstawie produktów i kategorii informacji ubitych z architektury aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5bb85-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="5bb85-371">Nasze Dostawca rozszerzony `StaticSiteMapProvider` klasy i wiązało się tworzenie `BuildSiteMap` metodę, która pobrać dane, skonstruowany hierarchii mapy witryny i strukturze wynikowe w zmiennej poziomie klasy w pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="5bb85-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="5bb85-372">Użyliśmy zależności bufora SQL przy użyciu funkcji wywołania zwrotnego w celu unieważnienia zapisane w pamięci podręcznej struktury, kiedy podstawowa `Categories` lub `Products` dane są modyfikowane.</span><span class="sxs-lookup"><span data-stu-id="5bb85-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="5bb85-373">Programowanie przyjemność!</span><span class="sxs-lookup"><span data-stu-id="5bb85-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="5bb85-374">Dalsze informacje</span><span class="sxs-lookup"><span data-stu-id="5bb85-374">Further Reading</span></span>

<span data-ttu-id="5bb85-375">Więcej informacji dotyczących tematów omówionych w tym samouczku można znaleźć w następujących zasobach:</span><span class="sxs-lookup"><span data-stu-id="5bb85-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="5bb85-376">[Zapisywanie map witryn w programie SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) i [dostawcy mapy witryny SQL był czas oczekiwania](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="5bb85-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="5bb85-377">Wzór dostawcy s przyjrzeć się ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="5bb85-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="5bb85-378">Zestaw narzędzi do dostawcy</span><span class="sxs-lookup"><span data-stu-id="5bb85-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="5bb85-379">Badanie ASP.NET 2.0 funkcji nawigacji witryny s</span><span class="sxs-lookup"><span data-stu-id="5bb85-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="5bb85-380">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="5bb85-380">About the Author</span></span>

<span data-ttu-id="5bb85-381">[Scott Bento](http://www.4guysfromrolla.com/ScottMitchell.shtml), autora siedmiu książek ASP/ASP.NET i twórcę z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje z technologii Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="5bb85-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5bb85-382">Scott działa jako niezależnego konsultanta trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="5bb85-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5bb85-383">Jest jego najnowszej książki [ *Sams nauczyć się ASP.NET 2.0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5bb85-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5bb85-384">Piotr można uzyskać pod adresem [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) lub za pośrednictwem jego blog, który znajduje się w temacie [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5bb85-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5bb85-385">Specjalne podziękowania dla</span><span class="sxs-lookup"><span data-stu-id="5bb85-385">Special Thanks To</span></span>

<span data-ttu-id="5bb85-386">Ten samouczek serii zostało sprawdzone przez wiele recenzentów przydatne.</span><span class="sxs-lookup"><span data-stu-id="5bb85-386">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5bb85-387">Prowadzić osób dokonujących przeglądu, w tym samouczku zostały Dave Gardner, Nowak Zack Teresa Murphy i Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="5bb85-387">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="5bb85-388">Zainteresowani recenzowania Moje nadchodzących artykuły MSDN?</span><span class="sxs-lookup"><span data-stu-id="5bb85-388">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5bb85-389">Jeśli tak, Porzuć mnie linii w [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5bb85-389">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="5bb85-390">Next</span><span class="sxs-lookup"><span data-stu-id="5bb85-390">Next</span></span>](building-a-custom-database-driven-site-map-provider-vb.md)
