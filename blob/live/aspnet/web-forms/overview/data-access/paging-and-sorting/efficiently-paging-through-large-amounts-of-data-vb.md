---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb
title: "Efektywne stronicowania za pośrednictwem dużych ilości danych (VB) | Dokumentacja firmy Microsoft"
author: rick-anderson
description: "Podczas pracy z dużą ilością danych, jako jego podstawowy pobierania kontroli źródła danych nie nadaje się domyślną opcją stronicowania formantu prezentacji danych..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/15/2006
ms.topic: article
ms.assetid: 3e20e64a-8808-4b49-88d6-014e2629d56f
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb
msc.type: authoredcontent
ms.openlocfilehash: 00a5358361fa3f37d13ea74d61c437088b388ece
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/10/2017
---
<a name="efficiently-paging-through-large-amounts-of-data-vb"></a><span data-ttu-id="c0d8d-103">Efektywne stronicowania za pośrednictwem dużych ilości danych (VB)</span><span class="sxs-lookup"><span data-stu-id="c0d8d-103">Efficiently Paging Through Large Amounts of Data (VB)</span></span>
====================
<span data-ttu-id="c0d8d-104">przez [Bento Scott](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c0d8d-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c0d8d-105">[Pobierz przykładową aplikację](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_VB.exe) lub [pobierania plików PDF](efficiently-paging-through-large-amounts-of-data-vb/_static/datatutorial25vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c0d8d-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_VB.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-vb/_static/datatutorial25vb1.pdf)</span></span>

> <span data-ttu-id="c0d8d-106">Domyślna opcja stronicowania danych formantu prezentacji nie nadaje się podczas pracy z dużą ilością danych, jako jego podstawowy kontroli źródła danych pobiera wszystkie rekordy, nawet jeśli jest wyświetlany tylko podzestaw danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="c0d8d-107">W takiej sytuacji, możemy wyłączyć do niestandardowych stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-107">In such circumstances, we must turn to custom paging.</span></span>


## <a name="introduction"></a><span data-ttu-id="c0d8d-108">Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="c0d8d-108">Introduction</span></span>

<span data-ttu-id="c0d8d-109">Jak wspomniano w poprzednim samouczek stronicowania można zaimplementować w jeden z dwóch sposobów:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="c0d8d-110">**Domyślne stronicowania** może być zaimplementowany przez po prostu zaznaczenie opcji Włącz stronicowanie w danych formantu sieci Web s tagów inteligentnych; jednak zawsze, gdy wyświetlania strony danych, pobiera ObjectDataSource *wszystkie* rekordów, nawet jednak tylko ich podzbiór są wyświetlane na stronie</span><span class="sxs-lookup"><span data-stu-id="c0d8d-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="c0d8d-111">**Stronicowania niestandardowego** poprawia wydajność domyślna stronicowania przez pobranie tylko te rekordy z bazy danych, konieczne będzie wyświetlany dla określonej strony danych żądanej przez użytkownika; jednak stronicowania niestandardowego wymaga nieco więcej wysiłku do zaimplementowania niż domyślne stronicowania</span><span class="sxs-lookup"><span data-stu-id="c0d8d-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="c0d8d-112">Ze względu na łatwość implementacji tylko sprawdzanie pole wyboru i której gotowe!</span><span class="sxs-lookup"><span data-stu-id="c0d8d-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="c0d8d-113">domyślne stronicowania jest atrakcyjną opcję.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-113">default paging is an attractive option.</span></span> <span data-ttu-id="c0d8d-114">Jego podejścia kolejnych na pobranie wszystkich rekordów, jednak ułatwia wybór nieprawdopodobny podczas stronicowania za pośrednictwem wystarczająco duże ilości danych lub dla witryn o wielu użytkowników równocześnie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="c0d8d-115">W takiej sytuacji możemy wyłączyć do niestandardowych stronicowania w celu zapewnienia elastyczny system.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="c0d8d-116">Wyzwanie stronicowania niestandardowego jest możliwość Napisz zapytanie, które zwraca dokładny zestaw rekordów niezbędnych dla określonej strony danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="c0d8d-117">Na szczęście usługa Microsoft SQL Server 2005 zawiera new — słowo kluczowe wyników klasyfikacji, co umożliwia firmie Microsoft w celu Napisz zapytanie, które skutecznie można pobrać prawidłowego podzestaw rekordów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="c0d8d-118">W tym samouczku będziesz przedstawiono sposób użycia to słowo kluczowe new programu SQL Server 2005 do implementowania stronicowania niestandardowego w kontrolce GridView.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="c0d8d-119">Gdy interfejs użytkownika stronicowania niestandardowego jest identyczna jak domyślne stronicowanie, wykonywanie krok po kroku z jednej strony do następnego przy użyciu stronicowania niestandardowego może mieć wiele rzędów szybciej niż domyślne stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="c0d8d-120">Bardziej wydajne dokładne, wystawiane przez stronicowania niestandardowego zależy od całkowita liczba rekordów jest stronicowana za pośrednictwem i obciążenia są umieszczone na serwerze bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="c0d8d-121">Na końcu tego samouczka przyjrzymy niektórych nierównej metryki pokazują zalet wydajności uzyskiwaną stronicowania niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>


## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="c0d8d-122">Krok 1: Zrozumienie niestandardowy proces stronicowania</span><span class="sxs-lookup"><span data-stu-id="c0d8d-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="c0d8d-123">Gdy stronicowanie za pośrednictwem danych, dokładne rekordów wyświetlanych na stronie zależą strony danych żądanej i liczba rekordów wyświetlanych na stronie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="c0d8d-124">Na przykład załóżmy, że możemy przeglądania 81 produktów, wyświetlanie 10 produktów na stronie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="c0d8d-125">Podczas wyświetlania pierwszej strony, d chcemy produktów od 1 do 10; Podczas wyświetlania na drugiej stronie możemy d zainteresować produktów 11 do 20 i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="c0d8d-126">Istnieją trzy zmienne, które wymuszają rekordy muszą zostać pobrane i jak mają być renderowane interfejsu stronicowania:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="c0d8d-127">**Indeks wiersza początkowy** indeks pierwszego wiersza na stronie danych do wyświetlenia; może to indeks jest obliczana przez pomnożenie indeksu strony przez rekordów wyświetlanych na każdej stronie i dodawania co.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="c0d8d-128">Na przykład jeśli stronicowanie za pośrednictwem rekordów 10 jednocześnie, na pierwszej stronie (której indeks strony wynosi 0), indeks wiersza Start wynosi 0 \* 10 + 1 lub 1; dla drugiej strony (indeks strony, którego wartość wynosi 1) jest indeks wiersza Start 1 \* 10 + 1 , lub 11.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="c0d8d-129">**Maksymalna liczba wierszy** maksymalną liczbę rekordów wyświetlanych na każdej stronie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="c0d8d-130">Ta zmienna jest określana jako maksymalna liczba wierszy, ponieważ dla ostatniej strony może być mniejszą liczbę rekordów zwróconych niż rozmiar strony.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="c0d8d-131">Na przykład stronicowanie rekordy 81 produktów 10 na każdej stronie, dziewiąty i ostatnia strona ma tylko jeden rekord.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="c0d8d-132">Jednak Brak strony zostaną wyświetlone więcej rekordów niż wartość maksymalna liczba wierszy.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="c0d8d-133">**Całkowita liczba rekordów** całkowita liczba rekordów jest stronicowana za pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="c0d8d-134">Gdy t ta zmienna nie jest potrzebne do ustalenia, które rekordy do pobrania dla danej strony, wymagane przez interfejs stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="c0d8d-135">Na przykład w przypadku produktów 81 trwa stronicowanej za pośrednictwem interfejsu stronicowania wie do wyświetlenia dziewięć cyfr strony w interfejsie użytkownika stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="c0d8d-136">Z stronicowania domyślny indeks wiersza Start jest obliczana jako iloczyn indeksu strony i rozmiar strony plus, maksymalna liczba wierszy jest po prostu rozmiar strony.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="c0d8d-137">Ponieważ domyślne stronicowania pobiera wszystkie rekordy z bazy danych podczas renderowania dowolnej strony indeksu dla każdego wiersza danych jest znany, dzięki czemu przenoszenie do wiersza Start indeks wiersza trivial zadań.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="c0d8d-138">Ponadto jest dostępny, ponieważ łączna liczba rekordów s po prostu liczbę rekordów w elemencie DataTable (lub obiekt jest używany do przechowywania wyników bazy danych).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="c0d8d-139">Podana zmienne Start indeks wiersza i maksymalna liczba wierszy, implementacja niestandardowa stronicowania tylko musi zwracać dokładne podzestaw uruchamianie w indeksie wiersza Start i maksymalnie wierszy maksymalną liczbę rekordów po tym.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="c0d8d-140">Stronicowania niestandardowego zapewnia wyzwanie z dwóch powodów:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="c0d8d-141">Firma Microsoft musi mieć możliwość wydajnie skojarzyć indeks wiersza z każdego wiersza w całej danych jest stronicowanej za pośrednictwem, dzięki czemu możemy rozpocząć zwracanie rekordów w określonym indeksie wiersza Start</span><span class="sxs-lookup"><span data-stu-id="c0d8d-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="c0d8d-142">Należy podać całkowita liczba rekordów jest stronicowana za pośrednictwem</span><span class="sxs-lookup"><span data-stu-id="c0d8d-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="c0d8d-143">W poniższych dwóch krokach zajmiemy skrypt SQL niezbędne do odpowiadania na te dwa problemy.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="c0d8d-144">Oprócz skryptu SQL potrzebujemy również implementować metody DAL i logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="c0d8d-145">Krok 2: Całkowita liczba rekordów jest stronicowana za pośrednictwem zwracanie</span><span class="sxs-lookup"><span data-stu-id="c0d8d-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="c0d8d-146">Przed omówione jak uzyskać dokładne podzestaw rekordów dla strony wyświetlany umożliwiają Pierwsze spojrzenie na sposób zwracania całkowita liczba rekordów jest stronicowana za pośrednictwem s.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="c0d8d-147">Te informacje są potrzebne, aby poprawnie skonfigurować interfejs użytkownika stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="c0d8d-148">Całkowita liczba rekordów zwróconych przez zapytanie SQL w szczególności można uzyskać za pomocą [ `COUNT` funkcję agregacji](https://msdn.microsoft.com/en-US/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/en-US/library/ms175997.aspx).</span></span> <span data-ttu-id="c0d8d-149">Na przykład, aby określić całkowita liczba rekordów w `Products` tabeli, możemy użyć następujące zapytanie:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample1.sql)]

<span data-ttu-id="c0d8d-150">Umożliwiają dodawanie metody do naszych DAL, która zwraca informację s.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="c0d8d-151">W szczególności, utworzymy warstwę DAL metodę o nazwie `TotalNumberOfProducts()` , który jest wykonywany `SELECT` instrukcji przedstawionych powyżej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="c0d8d-152">Uruchamianie przez otwarcie `Northwind.xsd` wpisane pliku zestawu danych w `App_Code/DAL` folderu.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="c0d8d-153">Następnie kliknij prawym przyciskiem myszy `ProductsTableAdapter` w Projektancie i wybierz polecenie Dodaj zapytanie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="c0d8d-154">Jako firma Microsoft kolejnych w poprzedniej samouczki, pozwoli to firmie Microsoft w celu dodania nowej metody z warstwą dal, gdy została wywołana, będą wykonywane określonego instrukcję SQL lub procedurę składowaną.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="c0d8d-155">Podobnie jak w przypadku naszego metod TableAdapter w poprzednim samouczki, dla tego zdecydować się na użycie instrukcji SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>


![Używanie instrukcji SQL Ad Hoc](efficiently-paging-through-large-amounts-of-data-vb/_static/image1.png)

<span data-ttu-id="c0d8d-157">**Rysunek 1**: Użyj instrukcji SQL Ad Hoc</span><span class="sxs-lookup"><span data-stu-id="c0d8d-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>


<span data-ttu-id="c0d8d-158">Na następnym ekranie możemy określić jakiego rodzaju zapytanie w celu utworzenia.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="c0d8d-159">Ponieważ to zapytanie spowoduje zwrócenie pojedynczego, skalarne wartość całkowita liczba rekordów w `Products` wybierz tabelę `SELECT` zwraca opcji wartość wystąpieniu.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>


![Skonfiguruj zapytanie do użycia w instrukcji SELECT, która zwraca pojedynczą wartość](efficiently-paging-through-large-amounts-of-data-vb/_static/image2.png)

<span data-ttu-id="c0d8d-161">**Rysunek 2**: Skonfiguruj zapytanie do użycia w instrukcji SELECT, która zwraca pojedynczą wartość</span><span class="sxs-lookup"><span data-stu-id="c0d8d-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>


<span data-ttu-id="c0d8d-162">Po wskazujący typ zapytanie do użycia, możemy obok określ kwerendę.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-162">After indicating the type of query to use, we must next specify the query.</span></span>


![Użyj wybierz COUNT(*) z kwerendy produktów](efficiently-paging-through-large-amounts-of-data-vb/_static/image3.png)

<span data-ttu-id="c0d8d-164">**Rysunek 3**: Użyj wybierz liczby (\*) FROM zapytania produktów</span><span class="sxs-lookup"><span data-stu-id="c0d8d-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>


<span data-ttu-id="c0d8d-165">Na koniec należy określić nazwę metody.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="c0d8d-166">S wyżej wymienione, pozwalają używać `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>


![Nazwa TotalNumberOfProducts DAL — metoda](efficiently-paging-through-large-amounts-of-data-vb/_static/image4.png)

<span data-ttu-id="c0d8d-168">**Rysunek 4**: Nazwa TotalNumberOfProducts DAL — metoda</span><span class="sxs-lookup"><span data-stu-id="c0d8d-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>


<span data-ttu-id="c0d8d-169">Po kliknięciu przycisku Zakończ, Kreator doda `TotalNumberOfProducts` metody z warstwą dal.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="c0d8d-170">Skalarne metody przekazujących w warstwy DAL zwracają typy dopuszczające wartości null, w przypadku, gdy wynik zapytania SQL `NULL`.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="c0d8d-171">Nasze `COUNT` zapytania, jednak zawsze zwróci niż`NULL` wartości; niezależnie od tego, metoda DAL zwraca całkowitą wartość null.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="c0d8d-172">Oprócz metody DAL potrzebujemy są również metody w logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="c0d8d-173">Otwórz `ProductsBLL` klasy plik i dodać `TotalNumberOfProducts` metodę, która po prostu wywołuje w dół do DAL s `TotalNumberOfProducts` metody:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>


[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample2.vb)]

<span data-ttu-id="c0d8d-174">DAL s `TotalNumberOfProducts` metoda zwraca całkowitą wartość null, ale firma Microsoft kolejnych utworzone `ProductsBLL` klasy s `TotalNumberOfProducts` metodę, tak aby zwraca standardowy liczbę całkowitą.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="c0d8d-175">W związku z tym musimy mieć `ProductsBLL` klasy s `TotalNumberOfProducts` metoda zwraca wartość części całkowitej wartości null zwracane przez warstwę DAL s `TotalNumberOfProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="c0d8d-176">Wywołanie `GetValueOrDefault()` zwraca wartość liczby całkowitej wartości null, jeśli istnieje; w przypadku wartości null całkowitą `null`, jednak zwraca wartość liczby całkowitej domyślna to 0.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="c0d8d-177">Krok 3: Zwracanie dokładne podzestaw rekordów</span><span class="sxs-lookup"><span data-stu-id="c0d8d-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="c0d8d-178">Nasze następne zadanie to można utworzyć metody w DAL i logiki warstwy Biznesowej, które akceptują indeks wiersza Start i maksymalna liczba wierszy zmiennych wymienione powyżej i zwraca odpowiednie rekordy.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="c0d8d-179">Zanim przejdziemy, umożliwiają s Pierwsze spojrzenie na uruchomienie skryptu SQL.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="c0d8d-180">Żądania skierowane do nas jest, że firma musi mieć możliwość przydzielić indeksu dla każdego wiersza w całej wyniki są stronicowanej za pośrednictwem tak, aby firma Microsoft może zwracać tylko te rekordy, uruchamianie w indeksie wiersza Start (i do rekordów maksymalnej liczby rekordów).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="c0d8d-181">To nie jest trudne, jeśli istnieje już kolumna w tabeli bazy danych, która służy jako indeks wiersza.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="c0d8d-182">Na pierwszy rzut oka może podejrzewamy, że `Products` tabeli s `ProductID` pola będą wystarczające jako pierwszy produkt ma `ProductID` 1, 2, drugi i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="c0d8d-183">Jednak usunięcie produktu pozostawia przerwy w sekwencji, rozpoczynającą tej metody.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="c0d8d-184">Istnieją dwie metody Ogólne umożliwia wydajne skojarzyć indeks wiersza z danymi do przeglądania, umożliwiając w ten sposób dokładne podzestaw rekordów do pobrania:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="c0d8d-185">**Za pomocą programu SQL Server 2005 s `ROW_NUMBER()` — słowo kluczowe** jesteś nowym użytkownikiem programu SQL Server 2005, `ROW_NUMBER()` — słowo kluczowe kojarzy klasyfikacji z każdego zwróconego rekordu według kolejności.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="c0d8d-186">Ta klasyfikacja może służyć jako indeks wiersza dla każdego wiersza.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="c0d8d-187">**Za pomocą zmiennej tabeli i `SET ROWCOUNT`**  s programu SQL Server [ `SET ROWCOUNT` instrukcji](https://msdn.microsoft.com/en-us/library/ms188774.aspx) można określić liczbę rekordów całkowita zapytania ma być przetwarzana przed zakończeniem; [tabeli zmienne](http://www.sqlteam.com/item.asp?ItemID=9454) są zmienne lokalne T-SQL, które mogą zawierać dane tabelaryczne akin do [tabel tymczasowych](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/en-us/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="c0d8d-188">Ta metoda działa równie dobrze z Microsoft SQL Server 2005 i SQL Server 2000 (natomiast `ROW_NUMBER()` podejście działa tylko w przypadku programu SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
 <span data-ttu-id="c0d8d-189">W tym miejscu będzie utworzyć zmienną tabeli, która ma `IDENTITY` kolumny i kolumny kluczy podstawowych w tabeli jest trwa stronicowanej którego dane za pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="c0d8d-190">Następnie utworzyć zrzutu zawartość tabeli, którego dane jest trwa stronicowanej za pośrednictwem do zmiennej tabeli, w tym samym kojarzenie indeks wiersza sekwencyjnych (za pośrednictwem `IDENTITY` kolumny) dla każdego rekordu w tabeli.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="c0d8d-191">Gdy zmienna tabeli zostały wypełnione, `SELECT` instrukcji w zmiennej tabeli połączony z tabeli podstawowej, aby można było wykonać Aby wysunąć określonych rekordów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="c0d8d-192">`SET ROWCOUNT` Używana jest instrukcja inteligentnie ograniczyć liczbę rekordów, które należy można utworzyć zrzutu w zmiennej tabeli.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
 <span data-ttu-id="c0d8d-193">Takie zwiększenie efektywności podejście s jest oparta na numer strony żądanej, jako `SET ROWCOUNT` wartość jest przypisywana wartość Start indeks wiersza oraz maksymalna liczba wierszy.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="c0d8d-194">Jeśli stronicowanie za pośrednictwem strony o numerach niski, takich jak pierwszy kilka stron danych ta metoda jest bardzo wydajny.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="c0d8d-195">Jednak wskazuje domyślną stronicowania przypominającej wydajności podczas pobierania strony blisko końca.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="c0d8d-196">W tym samouczku implementuje niestandardowych za pomocą stronicowania `ROW_NUMBER()` — słowo kluczowe.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="c0d8d-197">Aby uzyskać więcej informacji na temat używania zmiennej tabeli i `SET ROWCOUNT` technika, zobacz [A więcej efektywną metodą stronicowania za pośrednictwem dużych zestawów wyników](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="c0d8d-198">`ROW_NUMBER()` — Słowo kluczowe skojarzone klasyfikacji z każdego rekordu zwróconego w kolejności określonej przy użyciu następującej składni:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample3.sql)]

<span data-ttu-id="c0d8d-199">`ROW_NUMBER()`Zwraca wartość liczbową określa rangę dla każdego rekordu w odniesieniu do wskazanej kolejności.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="c0d8d-200">Na przykład aby wyświetlić pozycję dla każdego produktu, uporządkowanych od najbardziej kosztowne o najmniejszej można Stosujemy następujące zapytanie:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample4.sql)]

<span data-ttu-id="c0d8d-201">Rysunek 5. Pokazuje to zapytanie wyniki s uruchamianych w oknie zapytania w programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="c0d8d-202">Należy pamiętać, że te produkty są uporządkowane według cen wraz z pozycji ceny dla każdego wiersza.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>


![Ranga cen jest dołączane do każdego rekordu zwrócone](efficiently-paging-through-large-amounts-of-data-vb/_static/image5.png)

<span data-ttu-id="c0d8d-204">**Rysunek 5**: rangę cen jest dołączane do każdego rekordu zwrócone</span><span class="sxs-lookup"><span data-stu-id="c0d8d-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>


> [!NOTE]
> <span data-ttu-id="c0d8d-205">`ROW_NUMBER()`jest tylko jeden z wielu nowych funkcji klasyfikacji dostępnych w programie SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="c0d8d-206">Bardziej szczegółowe omówienie `ROW_NUMBER()`, oraz inne funkcje klasyfikacji, przeczytaj [zwracanie wyniki związane z programu Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>


<span data-ttu-id="c0d8d-207">Gdy klasyfikacja wyniki według określonego `ORDER BY` kolumny w `OVER` klauzuli (`UnitPrice`, w powyższym przykładzie), programu SQL Server musi sortowania wyników.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="c0d8d-208">To jest szybkie działanie, jeśli istnieje indeks klastrowany kolumn na liście wyników jest porządkowana, lub jeśli istnieje pokryciem indeksu, ale może być bardziej kosztowne inaczej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="c0d8d-209">Aby zwiększyć wydajność kwerend wystarczająco duże, należy rozważyć dodanie indeks nieklastrowany za pomocą której wyniki są uporządkowane według kolumny.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="c0d8d-210">Zobacz [funkcji klasyfikacji i wydajności w programie SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) dla bardziej szczegółowy widok zagadnienia dotyczące wydajności.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="c0d8d-211">Informacje dotyczące klasyfikacji zwracane przez `ROW_NUMBER()` nie można użyć bezpośrednio w `WHERE` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="c0d8d-212">Jednak tabeli pochodnej może służyć do zwrócenia `ROW_NUMBER()` wynik, który następnie może występować w `WHERE` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="c0d8d-213">Na przykład poniższe zapytanie używa tabeli pochodnej mają być zwracane ProductName i UnitPrice kolumny, wraz z `ROW_NUMBER()` wyników, a następnie używa `WHERE` klauzuli, która zwraca tylko te produkty której pozycję cen to od 11 do 20:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample5.sql)]

<span data-ttu-id="c0d8d-214">Rozszerzanie nieco więcej koncepcji, firma Microsoft może korzystać z tej metody można pobrać określonej strony danych podanych odpowiednie wartości Start indeks wiersza i maksymalna liczba wierszy:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>


[!code-html[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="c0d8d-215">Jak zostanie wyświetlone później w tym samouczku  *`StartRowIndex`*  dostarczonych przez element ObjectDataSource jest indeksowana zaczynając od zera, podczas gdy `ROW_NUMBER()` wartość zwrócona przez program SQL Server 2005 jest indeksowana, zaczynając od 1.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="c0d8d-216">W związku z tym `WHERE` klauzula zwraca te rekordy, gdzie `PriceRank` jest większa niż  *`StartRowIndex`*  i mniejsza niż lub równa  *`StartRowIndex`*   +  *`MaximumRows`*.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>


<span data-ttu-id="c0d8d-217">Teraz tego możemy kolejnych omówiony sposób `ROW_NUMBER()` mogą być używane do pobierania określonej strony danych podanych wartości Start indeks wiersza i maksymalna liczba wierszy, teraz należy wdrożyć logikę tej metody w DAL i logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="c0d8d-218">Podczas tworzenia to zapytanie, należy zdecydować, kolejność za pomocą którego wyników zostanie wyznaczona ranga; Let s posortować produkty według nazwy w kolejności alfabetycznej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="c0d8d-219">Oznacza to, że z implementacją stronicowania niestandardowego, w tym samouczku firma Microsoft nie będzie można utworzyć niestandardowy raport stronicowanych niż również można sortować.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="c0d8d-220">W następnym samouczku, firma Microsoft będzie widoczny jak takie funkcje można podać.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="c0d8d-221">W poprzedniej sekcji utworzyliśmy metody DAL jako instrukcję SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="c0d8d-222">Niestety, analizator T-SQL w programie Visual Studio używane przez t kreatora TableAdapter, takich jak `OVER` składnia wykorzystywana przez `ROW_NUMBER()` funkcji.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="c0d8d-223">W związku z tym musi utworzymy tej metody DAL jako procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="c0d8d-224">Wybierz z menu Widok (lub trafień Ctrl + Alt + S) w Eksploratorze serwera i rozwiń `NORTHWND.MDF` węzła.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="c0d8d-225">Aby dodać nową procedurę składowaną, kliknij prawym przyciskiem myszy w węźle procedur składowanych i wybierz polecenie Dodaj nowe procedury składowanej (patrz rysunek 6).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>


![Dodaj nową procedurę składowaną stronicowanie za pośrednictwem produktów](efficiently-paging-through-large-amounts-of-data-vb/_static/image6.png)

<span data-ttu-id="c0d8d-227">**Rysunek 6**: Dodaj nową procedurę składowaną stronicowanie za pośrednictwem produktów</span><span class="sxs-lookup"><span data-stu-id="c0d8d-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>


<span data-ttu-id="c0d8d-228">Tę procedurę składowaną powinna obsługiwać dwóch parametrów wejściowych całkowitą — `@startRowIndex` i `@maximumRows` i użyj `ROW_NUMBER()` funkcja uporządkowanych według `ProductName` pola zwracanie tylko tych wierszy, większy niż określony `@startRowIndex` i mniejsza niż lub równa `@startRowIndex`  +  `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="c0d8d-229">Wprowadź następujący skrypt do nowej procedury składowanej, a następnie kliknij ikonę Zapisz, aby dodać procedury składowanej do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample7.sql)]

<span data-ttu-id="c0d8d-230">Po utworzeniu procedury składowanej, Poświęć chwilę, aby przetestować go. Kliknij prawym przyciskiem myszy `GetProductsPaged` procedury składowanej nazwy w Eksploratorze serwera i wybierz opcję Execute.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="c0d8d-231">Visual Studio wyświetlany jest monit dla parametrów wejściowych `@startRowIndex` i `@maximumRow` s (patrz rysunek 7).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="c0d8d-232">Spróbuj różne wartości, a następnie przejrzyj wyniki.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-232">Try different values and examine the results.</span></span>


![Wprowadź wartość dla @startRowIndex i @maximumRows parametrów](efficiently-paging-through-large-amounts-of-data-vb/_static/image7.png)

<span data-ttu-id="c0d8d-234">**Rysunek 7**: wprowadź wartość dla @startRowIndex i @maximumRows parametrów</span><span class="sxs-lookup"><span data-stu-id="c0d8d-234">**Figure 7**: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>


<span data-ttu-id="c0d8d-235">Po wybranie tych wprowadzanie wartości parametrów, okno dane wyjściowe będą pokazywały wyniki.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="c0d8d-236">Rysunek nr 8 przedstawia wyniki podczas przekazywania na 10 dla obu `@startRowIndex` i `@maximumRows` parametrów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>


<span data-ttu-id="c0d8d-237">[![Rejestruje że pojawią się w drugiej strony danych są zwracane.](efficiently-paging-through-large-amounts-of-data-vb/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="c0d8d-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-vb/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image8.png)</span></span>

<span data-ttu-id="c0d8d-238">**Rysunek 8**: rekordy że pojawią się w drugiej strony dane są zwracane ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="c0d8d-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image10.png))</span></span>


<span data-ttu-id="c0d8d-239">Z tym przechowywane procedury tworzenia, możemy re gotowy do utworzenia `ProductsTableAdapter` metody.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="c0d8d-240">Otwórz `Northwind.xsd` wpisane zestawu danych, kliknij prawym przyciskiem myszy w `ProductsTableAdapter`, a następnie wybierz opcję Dodaj zapytanie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="c0d8d-241">Zamiast tworzenia zapytania przy użyciu instrukcji SQL ad-hoc, należy utworzyć za pomocą istniejącą procedurę składowaną.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>


![Create — metoda DAL przy użyciu istniejącą procedurę składowaną](efficiently-paging-through-large-amounts-of-data-vb/_static/image11.png)

<span data-ttu-id="c0d8d-243">**Rysunek 9**: Utwórz metody DAL przy użyciu istniejącą procedurę składowaną</span><span class="sxs-lookup"><span data-stu-id="c0d8d-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>


<span data-ttu-id="c0d8d-244">Następnie możemy wyświetlony monit o wybranie procedury składowanej do wywołania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="c0d8d-245">Wybierz `GetProductsPaged` przechowywane procedury z listy rozwijanej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>


![Wybierz GetProductsPaged przechowywane procedury z listy rozwijanej](efficiently-paging-through-large-amounts-of-data-vb/_static/image12.png)

<span data-ttu-id="c0d8d-247">**Na rysunku nr 10**: Wybierz GetProductsPaged przechowywane procedury z listy rozwijanej</span><span class="sxs-lookup"><span data-stu-id="c0d8d-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>


<span data-ttu-id="c0d8d-248">Następnym ekranie następnie prosi jakiego rodzaju dane zwracane przez procedurę składowaną: dane tabelaryczne, pojedynczą wartością lub brak wartości.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="c0d8d-249">Ponieważ `GetProductsPaged` procedurę składowaną można przywrócić wiele rekordów, wskazują, że zwraca dane tabelaryczne.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>


![Wskazuje, że procedura składowana ma zwracać dane tabelaryczne](efficiently-paging-through-large-amounts-of-data-vb/_static/image13.png)

<span data-ttu-id="c0d8d-251">**Rysunek 11**: wskazuje, że procedura składowana ma zwracać dane tabelaryczne</span><span class="sxs-lookup"><span data-stu-id="c0d8d-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>


<span data-ttu-id="c0d8d-252">Wskazuje koniec nazwy metody, które ma zostać utworzona.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="c0d8d-253">Zgodnie z naszymi samouczkami, poprzednie, przejdź dalej i Utwórz metody za pomocą obu wypełnienia DataTable i zwracają DataTable.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="c0d8d-254">Pierwsza metoda nazwa `FillPaged` , a drugi `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>


![Nazwa metody FillPaged i GetProductsPaged](efficiently-paging-through-large-amounts-of-data-vb/_static/image14.png)

<span data-ttu-id="c0d8d-256">**Rysunek 12**: Nazwa FillPaged metod i GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="c0d8d-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>


<span data-ttu-id="c0d8d-257">Ponadto można utworzyć metody warstwy DAL do zwracania określonej strony produktów, również potrzebujemy umożliwiają korzystanie z tych funkcji w logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="c0d8d-258">Jak metoda DAL s logiki warstwy Biznesowej metody GetProductsPaged dwóch wejść całkowitą Start indeks wiersza i maksymalna liczba wierszy, musisz zaakceptować i musi zwracać tylko te rekordy, które należą do zakresu.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="c0d8d-259">Utwórz metodę logiki warstwy Biznesowej w klasie ProductsBLL, że tylko wywołania w dół do s DAL metody GetProductsPaged w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>


[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample8.vb)]

<span data-ttu-id="c0d8d-260">Można użyć dowolnej nazwy parametrów wejściowych metody s logiki warstwy Biznesowej, ale, jak firma Microsoft będzie wkrótce, wybrania `startRowIndex` i `maximumRows` oszczędza nam dodatkowy bit pracy podczas konfigurowania ObjectDataSource przy użyciu tej metody.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="c0d8d-261">Krok 4: Konfigurowanie ObjectDataSource do użycia stronicowania niestandardowego</span><span class="sxs-lookup"><span data-stu-id="c0d8d-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="c0d8d-262">Za pomocą metod logiki warstwy Biznesowej i warstwy DAL do uzyskiwania dostępu do konkretnego podzestawu rekordów pełną re gotowe, aby utworzyć element GridView sterować tej strony za pomocą jego rekordy przy użyciu stronicowania niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="c0d8d-263">Uruchamianie przez otwarcie `EfficientPaging.aspx` strony `PagingAndSorting` folderu, na stronie Dodaj element GridView i skonfigurować go do używania nowej kontrolki ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="c0d8d-264">W naszym ostatnich samouczki, często było ObjectDataSource skonfigurowana do używania `ProductsBLL` klasy s `GetProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="c0d8d-265">Teraz, jednak chcemy użyć `GetProductsPaged` — metoda, ponieważ `GetProducts` metoda zwraca *wszystkie* produktów w bazie danych należy `GetProductsPaged` zwraca konkretnego podzestawu rekordów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>


![Skonfiguruj element ObjectDataSource przy użyciu metody GetProductsPaged klasy ProductsBLL s](efficiently-paging-through-large-amounts-of-data-vb/_static/image15.png)

<span data-ttu-id="c0d8d-267">**Rysunek 13**: Konfigurowanie ObjectDataSource przy użyciu metody GetProductsPaged klasy ProductsBLL s</span><span class="sxs-lookup"><span data-stu-id="c0d8d-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>


<span data-ttu-id="c0d8d-268">Od możemy re tworzenie tylko do odczytu widoku GridView Poświęć chwilę, aby ustawić metodę listy rozwijanej w INSERT, UPDATE i usuwanie kart na (Brak).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="c0d8d-269">Następnie Kreator ObjectDataSource nam monituje o podanie źródła `GetProductsPaged` metody s `startRowIndex` i `maximumRows` wprowadzanie wartości parametrów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="c0d8d-270">Te parametry wejściowe faktycznie zostanie ustawiona w widoku GridView automatycznie, więc po prostu pozostaw zestaw źródła None i kliknij przycisk Zakończ.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>


![Pozostaw źródeł parametru wejściowego None](efficiently-paging-through-large-amounts-of-data-vb/_static/image16.png)

<span data-ttu-id="c0d8d-272">**Rysunek 14**: pozostaw źródeł parametru wejściowego None</span><span class="sxs-lookup"><span data-stu-id="c0d8d-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>


<span data-ttu-id="c0d8d-273">Po zakończeniu pracy Kreatora ObjectDataSource widoku GridView będzie zawierać elementu BoundField lub CheckBoxField dla każdego pola danych produktu.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="c0d8d-274">Możesz dostosować wygląd widoku GridView s zgodnie z własnymi potrzebami.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="c0d8d-275">I Zapisz zgłoszono mają być wyświetlane tylko `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, i `UnitPrice` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="c0d8d-276">Ponadto należy skonfigurować do obsługi stronicowania, zaznaczając pole wyboru Włącz stronicowanie w jego tagów inteligentnych widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="c0d8d-277">Po wprowadzeniu tych zmian znaczników deklaratywne GridView i ObjectDataSource powinien wyglądać podobny do następującego:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample9.aspx)]

<span data-ttu-id="c0d8d-278">W przypadku odwiedzenia strony za pośrednictwem przeglądarki, jednak widoku GridView jest którego ma zostać odnaleziona.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>


![Widoku GridView jest niewidoczne](efficiently-paging-through-large-amounts-of-data-vb/_static/image17.png)

<span data-ttu-id="c0d8d-280">**Rysunek 15**: widoku GridView jest niewidoczne</span><span class="sxs-lookup"><span data-stu-id="c0d8d-280">**Figure 15**: The GridView is Not Displayed</span></span>


<span data-ttu-id="c0d8d-281">Widoku GridView jest Brak, ponieważ element ObjectDataSource aktualnie używa 0 jako wartości dla obu `GetProductsPaged` `startRowIndex` i `maximumRows` parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="c0d8d-282">W związku z tym żadne rekordy nie zwraca wynikowy zapytania SQL i w związku z tym nie jest wyświetlany widoku GridView.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="c0d8d-283">Aby rozwiązać ten problem, należy skonfigurować element ObjectDataSource do użycia stronicowania niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="c0d8d-284">Można to zrobić w poniższych krokach:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="c0d8d-285">**Ustaw element ObjectDataSource s `EnablePaging` właściwości `true`**  wskazuje element ObjectDataSource, który musi upłynąć do `SelectMethod` dwóch dodatkowych parametrów: jedna, aby określić indeks wiersza Start ([ `StartRowIndexParameterName` ](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)) i określ maksymalna liczba wierszy ([`MaximumRowsParameterName`](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="c0d8d-286">**Ustaw ObjectDataSource s `StartRowIndexParameterName` i `MaximumRowsParameterName` odpowiednio do właściwości** `StartRowIndexParameterName` i `MaximumRowsParameterName` właściwości wskazują nazwy parametrów wejściowych przekazany `SelectMethod` celach stronicowania niestandardowego .</span><span class="sxs-lookup"><span data-stu-id="c0d8d-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="c0d8d-287">Domyślnie te nazwy parametru są `startIndexRow` i `maximumRows`, czyli Dlaczego, podczas tworzenia `GetProductsPaged` metody w logiki warstwy Biznesowej, można użyć tych wartości parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="c0d8d-288">Jeśli zostanie wybrany różne nazwy parametrów dla s logiki warstwy Biznesowej `GetProductsPaged` metody, takie jak `startIndex` i `maxRows`dla przykładzie trzeba ustawić ObjectDataSource s `StartRowIndexParameterName` i `MaximumRowsParameterName` właściwości odpowiednio (na przykład startIndex dla `StartRowIndexParameterName` i maksymalna liczba wierszy do `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="c0d8d-289">**Ustaw element ObjectDataSource s [ `SelectCountMethod` właściwości](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) na nazwę metody, która zwraca łączna liczba z rekordów jest stronicowanej za pośrednictwem (`TotalNumberOfProducts`)** odwołania, który `ProductsBLL` klasy s `TotalNumberOfProducts`metoda zwraca wartość całkowita liczba rekordów jest stronicowana przy użyciu metody DAL, która wykonuje `SELECT COUNT(*) FROM Products` zapytania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="c0d8d-290">Te informacje są potrzebne przez element ObjectDataSource, aby można było poprawnie renderowania interfejsu stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="c0d8d-291">**Usuń `startRowIndex` i `maximumRows` `<asp:Parameter>` elementy z s ObjectDataSource deklaratywne znaczników** podczas konfigurowania ObjectDataSource za pomocą kreatora, Visual Studio automatycznie dodane dwa `<asp:Parameter>` elementy dla `GetProductsPaged` metody s parametrów wejściowych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="c0d8d-292">Przez ustawienie `EnablePaging` do `true`, parametry te będą przekazywane automatycznie; jeśli znajdują się również w składni deklaratywnej, ObjectDataSource spróbuje przekazać *cztery* parametry `GetProductsPaged` — metoda i dwa parametry `TotalNumberOfProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="c0d8d-293">Jeśli użytkownik zapomni usunąć te `<asp:Parameter>` elementów, podczas odwiedzania strony za pośrednictwem przeglądarki, zostanie wyświetlony komunikat o błędzie, takich jak: *element ObjectDataSource "ObjectDataSource1" nie można znaleźć nieuniwersalnej metody TotalNumberOfProducts, która ma Parametry: startRowIndex, maximumRows*.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="c0d8d-294">Po wprowadzeniu tych zmian, składni deklaratywnej s ObjectDataSource powinna wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample10.aspx)]

<span data-ttu-id="c0d8d-295">Należy pamiętać, że `EnablePaging` i `SelectCountMethod` zostały ustawione właściwości i `<asp:Parameter>` elementy zostały usunięte.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="c0d8d-296">16 rysunku przedstawiono zrzut ekranu: okno właściwości po dokonaniu zmiany.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>


![Aby użyć niestandardowej stronicowania, skonfiguruj kontrolki ObjectDataSource](efficiently-paging-through-large-amounts-of-data-vb/_static/image18.png)

<span data-ttu-id="c0d8d-298">**Rysunek 16**: Aby użyć niestandardowej stronicowania, skonfiguruj kontrolki ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="c0d8d-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>


<span data-ttu-id="c0d8d-299">Po wprowadzeniu tych zmian, odwiedź stronę tej strony za pośrednictwem przeglądarki.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="c0d8d-300">Powinny pojawić się 10 produktów na liście, w kolejności alfabetycznej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="c0d8d-301">Poświęć chwilę, aby przetwarzać dane o jedną stronę w czasie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="c0d8d-302">Gdy nie ma różnic visual z perspektywy użytkownika końcowego s między stronicowania domyślne i niestandardowe stronicowania, niestandardowe stronicowania wydajniej strony z dużą ilością danych zgodnie z jego pobiera tylko te rekordy, które muszą być wyświetlany dla danej strony.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>


<span data-ttu-id="c0d8d-303">[![Dane, zamówione przez produkt s nazwa jest stronicowania niestandardowego stronicowanej przy użyciu](efficiently-paging-through-large-amounts-of-data-vb/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c0d8d-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-vb/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image19.png)</span></span>

<span data-ttu-id="c0d8d-304">**Rysunek 17**: dane, zamówione przez produkt s nazwa jest stronicowania niestandardowego stronicowanej przy użyciu ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c0d8d-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image21.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c0d8d-305">Z stronicowania niestandardowego strony liczba wartość zwrócona przez element ObjectDataSource s `SelectCountMethod` znajduje się w stanie widoku GridView s.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="c0d8d-306">Inne zmienne GridView `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` kolekcji i tak dalej są przechowywane w *kontrolować stan*, który jest trwały, niezależnie od wartości GridView s `EnableViewState` Właściwość.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="c0d8d-307">Ponieważ `PageCount` wartość jest trwale przechowywana w ogłaszania zwrotnego przy użyciu stan widoku, korzystając z interfejsu stronicowania, który zawiera łącze umożliwiające przejście do ostatniej strony, konieczne jest włączenie stan widoku GridView s.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="c0d8d-308">(Jeśli interfejs użytkownika stronicowania ostatni nie ma bezpośredniego łącza strony, następnie należy wyłączyć stan widoku).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>


<span data-ttu-id="c0d8d-309">Kliknij link do ostatniej strony powoduje odświeżenie strony i powoduje, że można zaktualizować widoku GridView jego `PageIndex` właściwości.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="c0d8d-310">Po kliknięciu link do ostatniej strony widoku GridView przypisuje jej `PageIndex` właściwości na wartość jeden mniejsza od jego `PageCount` właściwości.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="c0d8d-311">Widok stanu wyłączone `PageCount` wartości zostaną utracone na ogłaszania zwrotnego i `PageIndex` zamiast tego przypisuje się wartość maksymalna liczba całkowita.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="c0d8d-312">Następnie widoku GridView spróbuje określić początkowy indeks wiersza przez pomnożenie `PageSize` i `PageCount` właściwości.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="c0d8d-313">Powoduje to `OverflowException` ponieważ produktu przekracza rozmiar maksymalny dozwolony liczby całkowitej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="c0d8d-314">Implementowanie niestandardowych stronicowania i sortowania</span><span class="sxs-lookup"><span data-stu-id="c0d8d-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="c0d8d-315">Nasze bieżąca implementacja stronicowania niestandardowego wymaga kolejności, za pomocą którego dane są stronicowanej za pośrednictwem statycznie podczas tworzenia `GetProductsPaged` procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="c0d8d-316">Jednak może mieć zanotowaną czy tagów inteligentnych s GridView zawiera wyboru Włącz sortowanie oprócz opcji Włącz stronicowanie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="c0d8d-317">Niestety Dodawanie obsługi sortowania do widoku GridView z naszych bieżąca implementacja stronicowania niestandardowego tylko będzie sortowanie rekordów na stronie aktualnie wyświetlanych danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="c0d8d-318">Na przykład jeśli skonfigurujesz GridView również obsługiwać stronicowania i następnie podczas przeglądania danych, na pierwszej stronie sortowania według nazwy produktu w kolejności malejącej, go będzie odwrócić kolejność produktów na stronie 1.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="c0d8d-319">Jak pokazano na rysunku 18, takie tygrysy Carnarvon po wyświetlany jako pierwszy produktu w odwrotnej kolejności alfabetycznej, co powoduje ignorowanie 71 inne produkty, które pochodzą od tygrysy Carnarvon alfabetycznie; tylko te rekordy na pierwszej stronie są wliczane sortowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>


<span data-ttu-id="c0d8d-320">[![Jest sortowany tylko dane wyświetlane na bieżącej stronie](efficiently-paging-through-large-amounts-of-data-vb/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c0d8d-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-vb/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image22.png)</span></span>

<span data-ttu-id="c0d8d-321">**Rysunek 18**: tylko dane wyświetlane na bieżącej stronie jest sortowana ([kliknij, aby wyświetlić obraz w pełnym rozmiarze](efficiently-paging-through-large-amounts-of-data-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c0d8d-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image24.png))</span></span>


<span data-ttu-id="c0d8d-322">Sortowanie dotyczy tylko do bieżącej strony danych, ponieważ sortowanie jest wykonywana po pobraniu danych z s logiki warstwy Biznesowej `GetProductsPaged` — metoda i metoda ta zwraca tylko tych rekordów dla określonej strony.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="c0d8d-323">Aby zaimplementować sortowanie prawidłowo, należy przekazać wyrażenie sortowania `GetProductsPaged` metody, dzięki czemu dane można odpowiednio uszeregowane przed zwróceniem określonej strony danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="c0d8d-324">Będzie przedstawiono, jak to zrobić w naszym samouczku dalej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="c0d8d-325">Implementowanie niestandardowego stronicowania i usuwanie</span><span class="sxs-lookup"><span data-stu-id="c0d8d-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="c0d8d-326">Jeśli użytkownik włączenie funkcji usuwania w widoku GridView, którego dane są stronicowanej przy użyciu niestandardowych technik stronicowania, można zauważyć, które podczas usuwania ostatniego rekordu z ostatniej strony, widoku GridView zniknie zamiast odpowiednio zmniejszanie GridView s `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="c0d8d-327">Aby odtworzyć ten błąd, Włącz usuwanie samouczek, które właśnie właśnie utworzyliśmy.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="c0d8d-328">Przejdź do ostatniej strony (strona 9), gdzie powinien zostać wyświetlony jeden produkt od nas są stronicowania za pośrednictwem 81 produktów, 10 produktów w czasie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="c0d8d-329">Usuń ten produkt.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-329">Delete this product.</span></span>

<span data-ttu-id="c0d8d-330">Podczas usuwania ostatniego produktu widoku GridView *powinien* automatyczne przejście do strony ósmego i takich funkcji wystawiony jest z domyślną stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="c0d8d-331">Z stronicowania niestandardowego, jednak po usunięciu ostatniego produktu na ostatniej stronie widoku GridView po prostu zniknie z ekranu całkowicie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="c0d8d-332">Dokładne Przyczyna *Dlaczego* dzieje się to nieco wykracza poza zakres tego samouczka; zobacz [usunięcie ostatniego rekordu na ostatniej stronie z Element GridView z właściwością stronicowania niestandardowego](http://scottonwriting.net/sowblog/posts/7326.aspx) dla niskiego poziomu szczegóły dotyczące źródła Ten problem.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="c0d8d-333">W podsumowaniu go s z powodu następująca sekwencja kroków, które są wykonywane w widoku GridView po kliknięciu przycisku Usuń:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="c0d8d-334">Usuń rekord</span><span class="sxs-lookup"><span data-stu-id="c0d8d-334">Delete the record</span></span>
2. <span data-ttu-id="c0d8d-335">Pobierz odpowiednie rekordy do wyświetlenia dla określonego `PageIndex` i`PageSize`</span><span class="sxs-lookup"><span data-stu-id="c0d8d-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="c0d8d-336">Sprawdź, upewnij się, że `PageIndex` nie przekracza liczbę stron danych w źródle danych; jeśli ją automatycznie zmniejszyć GridView s `PageIndex` właściwości</span><span class="sxs-lookup"><span data-stu-id="c0d8d-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="c0d8d-337">Powiązać odpowiedniej strony danych widoku GridView przy użyciu rekordów uzyskanym w kroku 2</span><span class="sxs-lookup"><span data-stu-id="c0d8d-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="c0d8d-338">Problem wynika z faktu, że w kroku 2 `PageIndex` używany, gdy przechwytywanie rekordów do wyświetlenia jest nadal `PageIndex` ostatniej strony, którego jedynym rekord właśnie został usunięty.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="c0d8d-339">W związku z tym w kroku 2 *nie* rekordy są zwracane, ponieważ w tej ostatniej strony danych nie zawiera żadnych rekordów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="c0d8d-340">Następnie, w kroku 3 widoku GridView realizuje który jego `PageIndex` właściwości jest większa niż całkowita liczba stron w źródle danych (od nas kolejnych usunąć ostatni rekord na ostatniej stronie) i w związku z tym zmniejsza jego `PageIndex` właściwości.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="c0d8d-341">W kroku 4 próbuje się powiązać dane pobrane w kroku 2; widoku GridView Jednak w kroku 2 żadne rekordy nie zostały zwrócone, w związku z tym powodujące pusty element GridView.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="c0d8d-342">Z domyślnego stronicowania, ten problem t surface, ponieważ w kroku 2 *wszystkie* rekordy są pobierane ze źródła danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="c0d8d-343">Aby rozwiązać ten problem, firma Microsoft są dostępne dwie opcje.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-343">To fix this we have two options.</span></span> <span data-ttu-id="c0d8d-344">Pierwsza to można utworzyć programu obsługi zdarzeń dla widoku GridView s `RowDeleted` obsługi zdarzeń, który określa liczbę rekordów były wyświetlane na stronie, który właśnie został usunięty.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="c0d8d-345">Jeśli było tylko jeden rekord, rekord tylko usunięte musi być ostatnią i musimy dekrementacji s widoku GridView `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="c0d8d-346">Oczywiście chcemy tylko zaktualizować `PageIndex` Jeśli operacja usuwania rzeczywiście powiodła się, które można określić za zapewnienie, że `e.Exception` jest właściwość `null`.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="c0d8d-347">Ta metoda działa, ponieważ aktualizuje `PageIndex` po kroku 1, ale przed krok 2.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="c0d8d-348">W związku z tym w kroku 2, zwracana jest odpowiedni zestaw rekordów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="c0d8d-349">W tym celu należy użyć kodu podobne do poniższych:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-349">To accomplish this, use code like the following:</span></span>


[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample11.vb)]

<span data-ttu-id="c0d8d-350">Inne obejście polega na utworzeniu program obsługi zdarzeń dla elementu ObjectDataSource s `RowDeleted` zdarzenia i ustawić `AffectedRows` właściwości na wartość 1.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="c0d8d-351">Po usunięciu rekordu w kroku 1 (ale przed jego ponowne pobranie danych w kroku 2), aktualizacje widoku GridView jego `PageIndex` właściwości, jeśli co najmniej jeden wiersz został dotknięty wykonać operację.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="c0d8d-352">Jednak `AffectedRows` właściwość nie została ustawiona przez element ObjectDataSource i dlatego ten krok zostanie pominięty.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="c0d8d-353">Jest jednym ze sposobów zawierają to krok wykonywany ręcznie ustawić `AffectedRows` właściwości, jeśli operacja usuwania zakończy się pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="c0d8d-354">Można to zrobić przy użyciu kodu podobne do poniższych:</span><span class="sxs-lookup"><span data-stu-id="c0d8d-354">This can be accomplished using code like the following:</span></span>


[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample12.vb)]

<span data-ttu-id="c0d8d-355">Kod dla obu tych programów obsługi zdarzeń można znaleźć klasy związane z kodem `EfficientPaging.aspx` przykład.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="c0d8d-356">Porównanie wydajności domyślne i niestandardowe stronicowania</span><span class="sxs-lookup"><span data-stu-id="c0d8d-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="c0d8d-357">Ponieważ stronicowania niestandardowego pobiera tylko wymagane rekordy, natomiast zwraca domyślną stronicowania *wszystkie* rekordów dla każdej strony wyświetlany, jego s wyczyść czy stronicowania niestandardowego jest bardziej efektywne niż domyślne stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="c0d8d-358">Jednak samo jak bardziej efektywnego jest stronicowania niestandardowego?</span><span class="sxs-lookup"><span data-stu-id="c0d8d-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="c0d8d-359">Jakiego rodzaju wzrost wydajności, można wyświetlić, przenosząc z domyślnego stronicowania do stronicowania niestandardowego?</span><span class="sxs-lookup"><span data-stu-id="c0d8d-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="c0d8d-360">Niestety, s nie dostosowane do wszystkich odpowiedzi w tym miejscu.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="c0d8d-361">Bardziej wydajne zależy od wielu czynników, najbardziej widocznym dwa liczba rekordów jest stronicowana za pośrednictwem i obciążenia są umieszczane na kanały bazy danych serwera i komunikacji między serwerem sieci web a serwerem bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="c0d8d-362">Dla małych tabel z kilku dozen rekordów różnicy wydajności może być nieznaczny.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="c0d8d-363">Dla dużych tabel z tysiącami setki tysięcy wierszy, jednak wydajność różnica polega na tym ostrych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="c0d8d-364">Artykuł min, [stronicowania niestandardowego w programie ASP.NET 2.0 z programu SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), zawiera niektóre testy wydajności został uruchomiony wykazują różnic w wydajności między te dwie metody stronicowania podczas stronicowania za pośrednictwem tabeli bazy danych z 50 000 rekordów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="c0d8d-365">W tych testach zbadana I czas do wykonania zapytania na poziomie serwera SQL (przy użyciu [SQL Profiler](https://msdn.microsoft.com/en-us/library/ms173757.aspx)) i na stronie ASP.NET przy użyciu [s śledzenia programu ASP.NET](https://msdn.microsoft.com/en-US/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/en-us/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/en-US/library/y13fw6we.aspx).</span></span> <span data-ttu-id="c0d8d-366">Należy pamiętać, że te testy były uruchamiane na Moje pole programowanie z jednego aktywnego użytkownika i w związku z tym są unscientific i nie imitują wzorców obciążenia typowe witryny sieci Web.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="c0d8d-367">Niezależnie od tego wyniki ilustrują względną różnice w czasie wykonywania w domyślnej i niestandardowej stronicowania podczas pracy z wystarczająco duże ilości danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>


|  | <span data-ttu-id="c0d8d-368">**Średni Czas trwania (s)**</span><span class="sxs-lookup"><span data-stu-id="c0d8d-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="c0d8d-369">**Odczytuje**</span><span class="sxs-lookup"><span data-stu-id="c0d8d-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c0d8d-370">**Domyślne stronicowania SQL profilera**</span><span class="sxs-lookup"><span data-stu-id="c0d8d-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="c0d8d-371">1.411</span><span class="sxs-lookup"><span data-stu-id="c0d8d-371">1.411</span></span> | <span data-ttu-id="c0d8d-372">383</span><span class="sxs-lookup"><span data-stu-id="c0d8d-372">383</span></span> |
| <span data-ttu-id="c0d8d-373">**Niestandardowe stronicowania SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="c0d8d-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="c0d8d-374">0.002</span><span class="sxs-lookup"><span data-stu-id="c0d8d-374">0.002</span></span> | <span data-ttu-id="c0d8d-375">29</span><span class="sxs-lookup"><span data-stu-id="c0d8d-375">29</span></span> |
| <span data-ttu-id="c0d8d-376">**Domyślne stronicowania ASP.NET śledzenia**</span><span class="sxs-lookup"><span data-stu-id="c0d8d-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="c0d8d-377">2.379</span><span class="sxs-lookup"><span data-stu-id="c0d8d-377">2.379</span></span> | <span data-ttu-id="c0d8d-378">*N/D*</span><span class="sxs-lookup"><span data-stu-id="c0d8d-378">*N/A*</span></span> |
| <span data-ttu-id="c0d8d-379">**Niestandardowe śledzenia ASP.NET stronicowania**</span><span class="sxs-lookup"><span data-stu-id="c0d8d-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="c0d8d-380">0.029</span><span class="sxs-lookup"><span data-stu-id="c0d8d-380">0.029</span></span> | <span data-ttu-id="c0d8d-381">*N/D*</span><span class="sxs-lookup"><span data-stu-id="c0d8d-381">*N/A*</span></span> |


<span data-ttu-id="c0d8d-382">Jak widać, pobierania określonej strony danych średnio wymagane 354 mniej odczyty i zostało ukończone w ułamku czasu.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="c0d8d-383">Na stronie ASP.NET niestandardowe strony był w stanie mają być renderowane w pobliżu 1-100<sup>th</sup> czasu zajęło, używając domyślnego stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="c0d8d-384">Zobacz [Moje artykułu](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) Aby uzyskać więcej informacji na temat tych wyników, wraz z kodem i bazy danych można pobrać do odtworzenia tych testów we własnym środowisku.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="c0d8d-385">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="c0d8d-385">Summary</span></span>

<span data-ttu-id="c0d8d-386">Domyślne stronicowania jest proste wdrożenie wyboru tylko pole wyboru Włącz stronicowanie w danych sieci Web kontroli s tagu, ale takie prostota odbywa się kosztem wydajności.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="c0d8d-387">Z domyślnego stronicowania, gdy użytkownik zażąda dowolnej strony danych *wszystkie* rekordy są zwracane, nawet jeśli mogą być wyświetlane tylko niewielka część je.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="c0d8d-388">Element ObjectDataSource zwalczania to zmniejszenie wydajności, oferuje alternatywne stronicowania niestandardowego opcji stronicowania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="c0d8d-389">Podczas stronicowania niestandardowego poprawia domyślnego stronicowania problemy z wydajnością s pobierając tylko te rekordy, które muszą zostać wyświetlone, jego s więcej wysiłku do implementowania stronicowania niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="c0d8d-390">Po pierwsze zapytania musi być napisana, który prawidłowo (i efektywnie) uzyskuje dostęp do konkretnego podzestawu żądanych rekordów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="c0d8d-391">Można to zrobić na kilka różnych sposobów; co mamy zbadane, w tym samouczku jest użycie programu SQL Server 2005 s nowego `ROW_NUMBER()` funkcji do poziomu powoduje, a następnie aby zwracać tylko te wyniki, których klasyfikacji mieści się w określonym zakresie.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="c0d8d-392">Ponadto należy dodać środki do określenia całkowita liczba rekordów jest stronicowana za pośrednictwem.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="c0d8d-393">Po utworzeniu tych metod DAL i logiki warstwy Biznesowej, również należy skonfigurować element ObjectDataSource, dzięki czemu może ustalić, ile całkowita liczba rekordów są trwa stronicowanej za pośrednictwem i poprawnie można przekazać wartości Start indeks wiersza i maksymalna liczba wierszy do logiki warstwy Biznesowej.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="c0d8d-394">Podczas implementowania stronicowania niestandardowego wymagają wielu kroków i nie niemal najprostszą domyślne stronicowania, stronicowania niestandardowego jest to konieczne, gdy stronicowania za pośrednictwem wystarczająco duże ilości danych.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="c0d8d-395">Jak zbadać wyników stronicowania pokazane, niestandardowe można pozostawia sekund poza czas renderowania stron ASP.NET i rozjaśnić obciążenia na serwerze bazy danych przez jedną lub więcej rzędów.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="c0d8d-396">Programowanie przyjemność!</span><span class="sxs-lookup"><span data-stu-id="c0d8d-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c0d8d-397">Informacje o autorze</span><span class="sxs-lookup"><span data-stu-id="c0d8d-397">About the Author</span></span>

<span data-ttu-id="c0d8d-398">[Scott Bento](http://www.4guysfromrolla.com/ScottMitchell.shtml), autora siedmiu książek ASP/ASP.NET i twórcę z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje z technologii Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c0d8d-399">Scott działa jako niezależnego konsultanta trainer i składnika zapisywania.</span><span class="sxs-lookup"><span data-stu-id="c0d8d-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c0d8d-400">Jest jego najnowszej książki [ *Sams nauczyć się ASP.NET 2.0 w ciągu 24 godzin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c0d8d-401">Piotr można uzyskać pod adresem [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) lub za pośrednictwem jego blog, który znajduje się w temacie [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="c0d8d-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="c0d8d-402">[Poprzednie](paging-and-sorting-report-data-vb.md)
[dalej](sorting-custom-paged-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c0d8d-402">[Previous](paging-and-sorting-report-data-vb.md)
[Next](sorting-custom-paged-data-vb.md)</span></span>
