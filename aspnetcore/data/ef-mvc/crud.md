---
title: Platformy ASP.NET Core MVC podstawowych EF - CRUD - 2 10
author: rick-anderson
description: ''
manager: wpickett
ms.author: tdykstra
ms.date: 03/15/2017
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: get-started-article
uid: data/ef-mvc/crud
ms.openlocfilehash: ec3f048c97d4e950fa76250382e4e18ccbea29e1
ms.sourcegitcommit: a19261eb82b948af6e4a1664fcfb8dabb16150e3
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/14/2018
ms.locfileid: "34153589"
---
# <a name="aspnet-core-mvc-with-ef-core---crud---2-of-10"></a><span data-ttu-id="f2e5a-102">Platformy ASP.NET Core MVC podstawowych EF - CRUD - 2 10</span><span class="sxs-lookup"><span data-stu-id="f2e5a-102">ASP.NET Core MVC with EF Core - CRUD - 2 of 10</span></span>

<span data-ttu-id="f2e5a-103">Przez [Dykstra Tomasz](https://github.com/tdykstra) i [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="f2e5a-103">By [Tom Dykstra](https://github.com/tdykstra) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="f2e5a-104">Przykładową aplikację sieci web firmy Contoso University przedstawia sposób tworzenia aplikacji sieci web platformy ASP.NET Core MVC przy użyciu programu Entity Framework Core i Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-104">The Contoso University sample web application demonstrates how to create ASP.NET Core MVC web applications using Entity Framework Core and Visual Studio.</span></span> <span data-ttu-id="f2e5a-105">Informacje o samouczek serii, zobacz [pierwszy samouczek z tej serii](intro.md).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-105">For information about the tutorial series, see [the first tutorial in the series](intro.md).</span></span>

<span data-ttu-id="f2e5a-106">W poprzednich samouczek utworzono aplikację MVC, która przechowuje i wyświetla danych przy użyciu programu Entity Framework i bazy danych LocalDB programu SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-106">In the previous tutorial, you created an MVC application that stores and displays data using the Entity Framework and SQL Server LocalDB.</span></span> <span data-ttu-id="f2e5a-107">W tym samouczku, należy przejrzeć i dostosować CRUD (tworzenia, odczytu, aktualizowanie i usuwanie) kodu, który będzie szkieletów MVC automatycznie tworzy w kontrolery i widoki.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-107">In this tutorial, you'll review and customize the CRUD (create, read, update, delete) code that the MVC scaffolding automatically creates for you in controllers and views.</span></span>

> [!NOTE] 
> <span data-ttu-id="f2e5a-108">Jest typowym rozwiązaniem implementacji klienta wzorca repozytorium, aby można było utworzyć warstwę abstrakcji między kontrolerem a warstwa dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-108">It's a common practice to implement the repository pattern in order to create an abstraction layer between your controller and the data access layer.</span></span> <span data-ttu-id="f2e5a-109">Aby zachować te samouczki proste i skupiają się na nauczania sposobu korzystania z programu Entity Framework samej siebie, nie używają repozytoriów.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-109">To keep these tutorials simple and focused on teaching how to use the Entity Framework itself, they don't use repositories.</span></span> <span data-ttu-id="f2e5a-110">Informacje o repozytoria z EF, zobacz [ostatniego samouczku tej serii](advanced.md).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-110">For information about repositories with EF, see [the last tutorial in this series](advanced.md).</span></span>

<span data-ttu-id="f2e5a-111">W tym samouczku będziesz pracować z następujących stron sieci web:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-111">In this tutorial, you'll work with the following web pages:</span></span>

![Strona szczegółów dla użytkowników domowych](crud/_static/student-details.png)

![Strona tworzenia dla użytkowników domowych](crud/_static/student-create.png)

![Uczniów edycji strony](crud/_static/student-edit.png)

![Strona usuwania studentów](crud/_static/student-delete.png)

## <a name="customize-the-details-page"></a><span data-ttu-id="f2e5a-116">Dostosowywanie strony szczegółów</span><span class="sxs-lookup"><span data-stu-id="f2e5a-116">Customize the Details page</span></span>

<span data-ttu-id="f2e5a-117">Szkieletu kodu strony indeksu studentów pozostać poza `Enrollments` właściwości, ponieważ kolekcja zawiera tej właściwości.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-117">The scaffolded code for the Students Index page left out the `Enrollments` property, because that property holds a collection.</span></span> <span data-ttu-id="f2e5a-118">W **szczegóły** strony, będzie wyświetlać zawartość kolekcji, w tabeli HTML.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-118">In the **Details** page, you'll display the contents of the collection in an HTML table.</span></span>

<span data-ttu-id="f2e5a-119">W *Controllers/StudentsController.cs*, metody akcji, aby uzyskać więcej informacji, Wyświetl używa `SingleOrDefaultAsync` metoda pobierania pojedynczy `Student` jednostki.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-119">In *Controllers/StudentsController.cs*, the action method for the Details view uses the `SingleOrDefaultAsync` method to retrieve a single `Student` entity.</span></span> <span data-ttu-id="f2e5a-120">Dodaj kod, który wywołuje `Include`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-120">Add code that calls `Include`.</span></span> <span data-ttu-id="f2e5a-121">`ThenInclude`, a `AsNoTracking` metod, jak pokazano w poniższym kodzie zaznaczony.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-121">`ThenInclude`,  and `AsNoTracking` methods, as shown in the following highlighted code.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Details&highlight=8-12)]

<span data-ttu-id="f2e5a-122">`Include` i `ThenInclude` metody powodują kontekstu ładowania `Student.Enrollments` właściwość nawigacji i w obrębie każdej rejestracji `Enrollment.Course` właściwości nawigacji.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-122">The `Include` and `ThenInclude` methods cause the context to load the `Student.Enrollments` navigation property, and within each enrollment the `Enrollment.Course` navigation property.</span></span>  <span data-ttu-id="f2e5a-123">Dowiesz się więcej na temat tych metod w [odczytać dane dotyczące](read-related-data.md) samouczka.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-123">You'll learn more about these methods in the [read related data](read-related-data.md) tutorial.</span></span>

<span data-ttu-id="f2e5a-124">`AsNoTracking` Metody umożliwia zwiększenie wydajności w scenariuszach, w którym zwróconych nie zostaną zaktualizowane w okresie istnienia w bieżącym kontekście.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-124">The `AsNoTracking` method improves performance in scenarios where the entities returned won't be updated in the current context's lifetime.</span></span> <span data-ttu-id="f2e5a-125">Dowiesz się więcej na temat `AsNoTracking` na końcu tego samouczka.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-125">You'll learn more about `AsNoTracking` at the end of this tutorial.</span></span>

### <a name="route-data"></a><span data-ttu-id="f2e5a-126">Dane trasy</span><span class="sxs-lookup"><span data-stu-id="f2e5a-126">Route data</span></span>

<span data-ttu-id="f2e5a-127">Wartość klucza, który jest przekazywany do `Details` metody pochodzi z *przekazywanie danych*.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-127">The key value that's passed to the `Details` method comes from *route data*.</span></span> <span data-ttu-id="f2e5a-128">Dane trasy to dane integratora modelu znaleziono w segmencie adresu URL.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-128">Route data is data that the model binder found in a segment of the URL.</span></span> <span data-ttu-id="f2e5a-129">Na przykład trasy domyślnej określa kontroler, akcję i identyfikator segmentów:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-129">For example, the default route specifies controller, action, and id segments:</span></span>

[!code-csharp[](intro/samples/cu/Startup.cs?name=snippet_Route&highlight=5)]

<span data-ttu-id="f2e5a-130">Następujący adres URL trasy domyślnej mapuje instruktora co kontroler, indeks jako akcja i 1 jako identyfikatora; są to wartości danych trasy.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-130">In the following URL, the default route maps Instructor as the controller, Index as the action, and 1 as the id; these are route data values.</span></span>

```
http://localhost:1230/Instructor/Index/1?courseID=2021
```

<span data-ttu-id="f2e5a-131">Ostatnia część adresu URL ("? courseID = 2021") jest wartość ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-131">The last part of the URL ("?courseID=2021") is a query string value.</span></span> <span data-ttu-id="f2e5a-132">Integrator modelu zostaną również przekazać wartość Identyfikatora do `Details` metody `id` parametru, jeśli przekaż go jako wartość ciągu kwerendy:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-132">The model binder will also pass the ID value to the `Details` method `id` parameter if you pass it as a query string value:</span></span>

```
http://localhost:1230/Instructor/Index?id=1&CourseID=2021
```

<span data-ttu-id="f2e5a-133">Na stronie indeksu Odnośnik URL są tworzone przez instrukcje elementu pomocniczego znacznika w widoku Razor.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-133">In the Index page, hyperlink URLs are created by tag helper statements in the Razor view.</span></span> <span data-ttu-id="f2e5a-134">W poniższym kodzie Razor `id` parametru odpowiada trasy domyślnej tak `id` jest dodawany do danych trasy.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-134">In the following Razor code, the `id` parameter matches the default route, so `id` is added to the route data.</span></span>

```html
<a asp-action="Edit" asp-route-id="@item.ID">Edit</a>
```

<span data-ttu-id="f2e5a-135">Spowoduje to wygenerowanie poniższy kod HTML po `item.ID` to 6:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-135">This generates the following HTML when `item.ID` is 6:</span></span>

```html
<a href="/Students/Edit/6">Edit</a>
```

<span data-ttu-id="f2e5a-136">W poniższym kodzie Razor `studentID` nie jest zgodny z parametrem w trasy domyślnej, jest dodawany jako ciąg zapytania.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-136">In the following Razor code, `studentID` doesn't match a parameter in the default route, so it's added as a query string.</span></span>

```html
<a asp-action="Edit" asp-route-studentID="@item.ID">Edit</a>
```

<span data-ttu-id="f2e5a-137">Spowoduje to wygenerowanie poniższy kod HTML po `item.ID` to 6:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-137">This generates the following HTML when `item.ID` is 6:</span></span>

```html
<a href="/Students/Edit?studentID=6">Edit</a>
```

<span data-ttu-id="f2e5a-138">Aby uzyskać więcej informacji na temat pomocników tagów, zobacz [pomocników tagów w ASP.NET Core](xref:mvc/views/tag-helpers/intro).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-138">For more information about tag helpers, see [Tag helpers in ASP.NET Core](xref:mvc/views/tag-helpers/intro).</span></span>

### <a name="add-enrollments-to-the-details-view"></a><span data-ttu-id="f2e5a-139">Dodać rejestracji do widoku szczegółów</span><span class="sxs-lookup"><span data-stu-id="f2e5a-139">Add enrollments to the Details view</span></span>

<span data-ttu-id="f2e5a-140">Otwórz *Views/Students/Details.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-140">Open *Views/Students/Details.cshtml*.</span></span> <span data-ttu-id="f2e5a-141">Każde pole jest wyświetlane przy użyciu `DisplayNameFor` i `DisplayFor` pomocników, jak pokazano w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-141">Each field is displayed using `DisplayNameFor` and `DisplayFor` helpers, as shown in the following example:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=13-18&highlight=2,5)]

<span data-ttu-id="f2e5a-142">Po ostatnim polu i bezpośrednio przed tagiem zamykającym `</dl>` tagów, Dodaj następujący kod, aby wyświetlić listę rejestracji:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-142">After the last field and immediately before the closing `</dl>` tag, add the following code to display a list of enrollments:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=31-52)]

<span data-ttu-id="f2e5a-143">Jeśli po wklejeniu kod wcięcia kodu o nieprawidłowej naciśnij kombinację klawiszy CTRL-K-D, aby naprawić błąd.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-143">If code indentation is wrong after you paste the code, press CTRL-K-D to correct it.</span></span>

<span data-ttu-id="f2e5a-144">Ten kod w pętli jednostek w `Enrollments` właściwości nawigacji.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-144">This code loops through the entities in the `Enrollments` navigation property.</span></span> <span data-ttu-id="f2e5a-145">Dla każdego rejestracji Wyświetla tytuł kursu i kategorii.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-145">For each enrollment, it displays the course title and the grade.</span></span> <span data-ttu-id="f2e5a-146">Tytuł kursu są pobierane z jednostki kursu, która jest przechowywana w `Course` właściwości nawigacji jednostki rejestracji.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-146">The course title is retrieved from the Course entity that's stored in the `Course` navigation property of the Enrollments entity.</span></span>

<span data-ttu-id="f2e5a-147">Uruchom aplikację, wybierz **studentów** , a następnie kliknij pozycję **szczegóły** łącze studenta.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-147">Run the app, select the **Students** tab, and click the **Details** link for a student.</span></span> <span data-ttu-id="f2e5a-148">Zostanie wyświetlona lista kursów i klasy dla wybranego uczniów:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-148">You see the list of courses and grades for the selected student:</span></span>

![Strona szczegółów dla użytkowników domowych](crud/_static/student-details.png)

## <a name="update-the-create-page"></a><span data-ttu-id="f2e5a-150">Utwórz stronę aktualizacji</span><span class="sxs-lookup"><span data-stu-id="f2e5a-150">Update the Create page</span></span>

<span data-ttu-id="f2e5a-151">W *StudentsController.cs*, zmodyfikuj HttpPost `Create` metody bloku try-catch Dodawanie i usuwanie identyfikator z `Bind` atrybutu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-151">In *StudentsController.cs*, modify the HttpPost `Create` method by adding a try-catch block and removing ID from the `Bind` attribute.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=4,6-7,14-21)]

<span data-ttu-id="f2e5a-152">Ten kod dodaje jednostki uczniów utworzony przez obiekt wiążący modelu platformy ASP.NET MVC do jednostki studentów ustawić, a następnie zapisuje zmiany w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-152">This code adds the Student entity created by the ASP.NET MVC model binder to the Students entity set and then saves the changes to the database.</span></span> <span data-ttu-id="f2e5a-153">Integrator modelu odwołuje się do funkcji ASP.NET MVC, który ułatwi pracę z danych przesyłanych przez formularz, (integratora modelu konwertuje wartości przesłanego formularza na typy CLR i przekazuje je do metody akcji w parametrach.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-153">(Model binder refers to the ASP.NET MVC functionality that makes it easier for you to work with data submitted by a form; a model binder converts posted form values to CLR types and passes them to the action method in parameters.</span></span> <span data-ttu-id="f2e5a-154">W tym przypadku integratora modelu tworzy wystąpienie jednostki uczniów przy użyciu wartości właściwości z kolekcji formularza.)</span><span class="sxs-lookup"><span data-stu-id="f2e5a-154">In this case, the model binder instantiates a Student entity for you using property values from the Form collection.)</span></span>

<span data-ttu-id="f2e5a-155">Możesz usunąć `ID` z `Bind` atrybutu, ponieważ identyfikator ma wartość klucza podstawowego, której program SQL Server ustawi automatycznie, gdy zostanie wstawiona.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-155">You removed `ID` from the `Bind` attribute because ID is the primary key value which SQL Server will set automatically when the row is inserted.</span></span> <span data-ttu-id="f2e5a-156">Dane wejściowe użytkownika nie zmienia wartości Identyfikatora.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-156">Input from the user doesn't set the ID value.</span></span>

<span data-ttu-id="f2e5a-157">Inne niż `Bind` atrybutu, blok try-catch jest tylko zmiany wprowadzone do szkieletu kodu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-157">Other than the `Bind` attribute, the try-catch block is the only change you've made to the scaffolded code.</span></span> <span data-ttu-id="f2e5a-158">Jeśli wyjątek, która jest pochodną `DbUpdateException` jest zgłoszony, gdy trwa zapisywanie zmian, zostanie wyświetlony komunikat ogólny błąd.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-158">If an exception that derives from `DbUpdateException` is caught while the changes are being saved, a generic error message is displayed.</span></span> <span data-ttu-id="f2e5a-159">`DbUpdateException` wyjątki są czasami spowodowane coś zewnętrzne do aplikacji, a nie błąd programistyczny, dlatego zalecane jest użytkownik, aby spróbować ponownie.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-159">`DbUpdateException` exceptions are sometimes caused by something external to the application rather than a programming error, so the user is advised to try again.</span></span> <span data-ttu-id="f2e5a-160">Chociaż nie jest zaimplementowana w tym przykładzie, jakości aplikacji produkcyjnej może zarejestruje wyjątek.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-160">Although not implemented in this sample, a production quality application would log the exception.</span></span> <span data-ttu-id="f2e5a-161">Aby uzyskać więcej informacji, zobacz **dziennik, aby uzyskać szczegółowe informacje o** sekcji [monitorowanie i dane telemetryczne (tworzenia rzeczywistych aplikacji w chmurze platformy Azure)](https://docs.microsoft.com/aspnet/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-161">For more information, see the **Log for insight** section in [Monitoring and Telemetry (Building Real-World Cloud Apps with Azure)](https://docs.microsoft.com/aspnet/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).</span></span>

<span data-ttu-id="f2e5a-162">`ValidateAntiForgeryToken` Atrybut zapobiega fałszerstwie żądania międzywitrynowego (CSRF).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-162">The `ValidateAntiForgeryToken` attribute helps prevent cross-site request forgery (CSRF) attacks.</span></span> <span data-ttu-id="f2e5a-163">Token jest automatycznie wprowadzić do widoku przez [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) i jest dostępne po przesłaniu formularza przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-163">The token is automatically injected into the view by the [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) and is included when the form is submitted by the user.</span></span> <span data-ttu-id="f2e5a-164">Token jest zweryfikowany przez `ValidateAntiForgeryToken` atrybutu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-164">The token is validated by the `ValidateAntiForgeryToken` attribute.</span></span> <span data-ttu-id="f2e5a-165">Aby uzyskać więcej informacji o CSRF, zobacz [żądania przed sfałszowaniem](../../security/anti-request-forgery.md).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-165">For more information about CSRF, see [Anti-Request Forgery](../../security/anti-request-forgery.md).</span></span>

<a id="overpost"></a>
### <a name="security-note-about-overposting"></a><span data-ttu-id="f2e5a-166">Uwaga dotycząca zabezpieczeń o overposting</span><span class="sxs-lookup"><span data-stu-id="f2e5a-166">Security note about overposting</span></span>

<span data-ttu-id="f2e5a-167">`Bind` Atrybut, który zawiera utworzony szkielet kodu na `Create` metoda jest jednym ze sposobów ochrony przed overposting w tworzenie scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-167">The `Bind` attribute that the scaffolded code includes on the `Create` method is one way to protect against overposting in create scenarios.</span></span> <span data-ttu-id="f2e5a-168">Na przykład, załóżmy, że zawiera jednostki uczniów `Secret` właściwości, których nie chcesz, aby ta strona sieci web, aby ustawić.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-168">For example, suppose the Student entity includes a `Secret` property that you don't want this web page to set.</span></span>

```csharp
public class Student
{
    public int ID { get; set; }
    public string LastName { get; set; }
    public string FirstMidName { get; set; }
    public DateTime EnrollmentDate { get; set; }
    public string Secret { get; set; }
}
```

<span data-ttu-id="f2e5a-169">Nawet jeśli nie masz `Secret` pola na stronie sieci web, haker można za pomocą narzędzia, takie jak Fiddler lub zapisać fragmentów kodu JavaScript można opublikować `Secret` tworzą wartość.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-169">Even if you don't have a `Secret` field on the web page, a hacker could use a tool such as Fiddler, or write some JavaScript, to post a `Secret` form value.</span></span> <span data-ttu-id="f2e5a-170">Bez `Bind` atrybutu ograniczanie pól używanych przez integrator modelu podczas tworzenia wystąpienia dla użytkowników domowych, integratora modelu czy odebrania który `Secret` stanowią wartość i go użyć do utworzenia wystąpienia jednostki studenta.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-170">Without the `Bind` attribute limiting the fields that the model binder uses when it creates a Student instance, the model binder would pick up that `Secret` form value and use it to create the Student entity instance.</span></span> <span data-ttu-id="f2e5a-171">Następnie niezależnie od wartości haker określony dla `Secret` pola formularza, czy zaktualizowane w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-171">Then whatever value the hacker specified for the `Secret` form field would be updated in your database.</span></span> <span data-ttu-id="f2e5a-172">Na poniższej ilustracji przedstawiono dodawanie narzędzie Fiddler `Secret` pola (o wartości "OverPost") do wartości przesłanego formularza.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-172">The following image shows the Fiddler tool adding the `Secret` field (with the value "OverPost") to the posted form values.</span></span>

![Dodawanie pola tajny fiddler](crud/_static/fiddler.png)

<span data-ttu-id="f2e5a-174">Wartość "OverPost" może następnie pomyślnie dodane do `Secret` właściwości wstawionego wiersza, chociaż nie powinny strony sieci web i można ustawić tej właściwości.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-174">The value "OverPost" would then be successfully added to the `Secret` property of the inserted row, although you never intended that the web page be able to set that property.</span></span>

<span data-ttu-id="f2e5a-175">Overposting w scenariuszach edycji można zapobiec przez najpierw odczytu jednostki bazy danych, a następnie wywołując `TryUpdateModel`, przekazując Jawne dozwolonych właściwości listy.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-175">You can prevent overposting in edit scenarios by reading the entity from the database first and then calling `TryUpdateModel`, passing in an explicit allowed properties list.</span></span> <span data-ttu-id="f2e5a-176">To metodę użytą w tych samouczkach.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-176">That's the method used in these tutorials.</span></span>

<span data-ttu-id="f2e5a-177">Alternatywny sposób, aby zapobiec overposting, który jest wybierany przez wielu deweloperów jest użycie modeli widoku zamiast klas jednostek dla wiązania modelu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-177">An alternative way to prevent overposting that's preferred by many developers is to use view models rather than entity classes with model binding.</span></span> <span data-ttu-id="f2e5a-178">Zawierać tylko właściwości, które chcesz zaktualizować w modelu widoku.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-178">Include only the properties you want to update in the view model.</span></span> <span data-ttu-id="f2e5a-179">Po zakończeniu integratora modelu MVC, skopiuj Wyświetl właściwości modelu do tego wystąpienia jednostki, opcjonalnie przy użyciu narzędzia, takiego jak AutoMapper.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-179">Once the MVC model binder has finished, copy the view model properties to the entity instance, optionally using a tool such as AutoMapper.</span></span> <span data-ttu-id="f2e5a-180">Użyj `_context.Entry` na wystąpienie jednostki, aby ustawić stanu `Unchanged`, a następnie ustaw `Property("PropertyName").IsModified` na wartość true dla każdej właściwości jednostki, który znajduje się w modelu widoku.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-180">Use `_context.Entry` on the entity instance to set its state to `Unchanged`, and then set `Property("PropertyName").IsModified` to true on each entity property that's included in the view model.</span></span> <span data-ttu-id="f2e5a-181">Ta metoda działa zarówno w edytować i tworzyć scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-181">This method works in both edit and create scenarios.</span></span>

### <a name="test-the-create-page"></a><span data-ttu-id="f2e5a-182">Utwórz strona testowa</span><span class="sxs-lookup"><span data-stu-id="f2e5a-182">Test the Create page</span></span>

<span data-ttu-id="f2e5a-183">Kod w *Views/Students/Create.cshtml* używa `label`, `input`, i `span` (dla komunikatów dotyczących sprawdzania poprawności) pomocników dla każdego pola tagów.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-183">The code in *Views/Students/Create.cshtml* uses `label`, `input`, and `span` (for validation messages) tag helpers for each field.</span></span>

<span data-ttu-id="f2e5a-184">Uruchom aplikację, wybierz **studentów** , a następnie kliknij pozycję **Utwórz nowy**.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-184">Run the app, select the **Students** tab, and click **Create New**.</span></span>

<span data-ttu-id="f2e5a-185">Wprowadź nazwy i daty.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-185">Enter names and a date.</span></span> <span data-ttu-id="f2e5a-186">Spróbuj wprowadzić nieprawidłową datę, jeśli przeglądarki umożliwia to zrobić.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-186">Try entering an invalid date if your browser lets you do that.</span></span> <span data-ttu-id="f2e5a-187">(W niektórych przeglądarkach wymusza użyj selektora daty.) Następnie kliknij przycisk **Utwórz** Aby wyświetlić komunikat o błędzie.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-187">(Some browsers force you to use a date picker.) Then click **Create** to see the error message.</span></span>

![Błąd sprawdzania poprawności daty](crud/_static/date-error.png)

<span data-ttu-id="f2e5a-189">Jest to weryfikacji po stronie serwera, który można pobrać domyślnie; w samouczku nowsze zobaczysz jak dodać atrybuty, które również wygeneruje kod weryfikacji po stronie klienta.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-189">This is server-side validation that you get by default; in a later tutorial you'll see how to add attributes that will generate code for client-side validation also.</span></span> <span data-ttu-id="f2e5a-190">Następujący wyróżniony kod pokazuje sprawdzenie poprawności modelu w `Create` metody.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-190">The following highlighted code shows the model validation check in the `Create` method.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=8)]

<span data-ttu-id="f2e5a-191">Zmień wartość na prawidłową datę, a następnie kliknij przycisk **Utwórz** aby zobaczyć nowe student są wyświetlane w **indeksu** strony.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-191">Change the date to a valid value and click **Create** to see the new student appear in the **Index** page.</span></span>

## <a name="update-the-edit-page"></a><span data-ttu-id="f2e5a-192">Aktualizacja edycji strony</span><span class="sxs-lookup"><span data-stu-id="f2e5a-192">Update the Edit page</span></span>

<span data-ttu-id="f2e5a-193">W *StudentController.cs*, HttpGet `Edit` — metoda (jeden bez `HttpPost` atrybut) używa `SingleOrDefaultAsync` metoda pobierania wybranej jednostki dla użytkowników domowych, jak przedstawiono w `Details` metody.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-193">In *StudentController.cs*, the HttpGet `Edit` method (the one without the `HttpPost` attribute) uses the `SingleOrDefaultAsync` method to retrieve the selected Student entity, as you saw in the `Details` method.</span></span> <span data-ttu-id="f2e5a-194">Nie trzeba będzie zmienić tę metodę.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-194">You don't need to change this method.</span></span>

### <a name="recommended-httppost-edit-code-read-and-update"></a><span data-ttu-id="f2e5a-195">Zalecane HttpPost edycji kodu: Odczyt i aktualizacja</span><span class="sxs-lookup"><span data-stu-id="f2e5a-195">Recommended HttpPost Edit code: Read and update</span></span>

<span data-ttu-id="f2e5a-196">Zastąp następujący kod metody HttpPost edycji akcji.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-196">Replace the HttpPost Edit action method with the following code.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_ReadFirst)]

<span data-ttu-id="f2e5a-197">Te zmiany implementuje zaleceniami dotyczącymi zabezpieczeń, aby zapobiec overposting.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-197">These changes implement a security best practice to prevent overposting.</span></span> <span data-ttu-id="f2e5a-198">Tworzenia szkieletu, generowane `Bind` atrybutu i dodać obiekt utworzony przez obiekt wiążący modelu do zestawu z jednostek `Modified` flagi.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-198">The scaffolder generated a `Bind` attribute and added the entity created by the model binder to the entity set with a `Modified` flag.</span></span> <span data-ttu-id="f2e5a-199">Czy kod nie jest zalecane w różnych scenariuszach, ponieważ `Bind` atrybutu usuwa wszystkie istniejące dane w polach niewymienionych w `Include` parametru.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-199">That code isn't recommended for many scenarios because the `Bind` attribute clears out any pre-existing data in fields not listed in the `Include` parameter.</span></span>

<span data-ttu-id="f2e5a-200">Nowy kod odczytuje istniejącej jednostki i wywołania `TryUpdateModel` można zaktualizować pola w pobraną jednostkę [oparte na dane wejściowe użytkownika w danych przesłanego formularza](xref:mvc/models/model-binding#how-model-binding-works).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-200">The new code reads the existing entity and calls `TryUpdateModel` to update fields in the retrieved entity [based on user input in the posted form data](xref:mvc/models/model-binding#how-model-binding-works).</span></span> <span data-ttu-id="f2e5a-201">Automatyczna zmiana Entity Framework śledzenia zestawy `Modified` flagi w polach, które są zmieniane przez dane wejściowe formularza.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-201">The Entity Framework's automatic change tracking sets the `Modified` flag on the fields that are changed by form input.</span></span> <span data-ttu-id="f2e5a-202">Gdy `SaveChanges` metoda jest wywoływana, Entity Framework utworzy instrukcje SQL w celu zaktualizowania wiersza w tabeli bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-202">When the `SaveChanges` method is called, the Entity Framework creates SQL statements to update the database row.</span></span> <span data-ttu-id="f2e5a-203">Konfliktom współbieżności są ignorowane, a kolumn tabeli, które zostały zaktualizowane przez użytkownika są aktualizowane w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-203">Concurrency conflicts are ignored, and only the table columns that were updated by the user are updated in the database.</span></span> <span data-ttu-id="f2e5a-204">(Nowsze samouczek przedstawia sposób obsługi konfliktom współbieżności.)</span><span class="sxs-lookup"><span data-stu-id="f2e5a-204">(A later tutorial shows how to handle concurrency conflicts.)</span></span>

<span data-ttu-id="f2e5a-205">Najlepszym rozwiązaniem, aby zapobiec overposting pola, które mają być aktualizuje **Edytuj** strony są białej w `TryUpdateModel` parametrów.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-205">As a best practice to prevent overposting, the fields that you want to be updateable by the **Edit** page are whitelisted in the `TryUpdateModel` parameters.</span></span> <span data-ttu-id="f2e5a-206">(Pusty ciąg powyższej listy pól na liście parametrów jest dla prefiksu nazwy pola formularza za pomocą). Obecnie nie ma żadnych dodatkowych pól, które chronisz, ale lista pól, które mają integratora modelu do powiązania gwarantuje, że jeśli dodajesz pola do modelu danych w przyszłości, są one automatycznie chronione aż dodasz je tutaj.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-206">(The empty string preceding the list of fields in the parameter list is for a prefix to use with the form fields names.) Currently there are no extra fields that you're protecting, but listing the fields that you want the model binder to bind ensures that if you add fields to the data model in the future, they're automatically protected until you explicitly add them here.</span></span>

<span data-ttu-id="f2e5a-207">W wyniku tych zmian podpis metody HttpPost `Edit` metody jest taka sama jak HttpGet `Edit` metody; w związku z tym została zmieniona metoda `EditPost`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-207">As a result of these changes, the method signature of the HttpPost `Edit` method is the same as the HttpGet `Edit` method; therefore you've renamed the method `EditPost`.</span></span>

### <a name="alternative-httppost-edit-code-create-and-attach"></a><span data-ttu-id="f2e5a-208">Kod HttpPost Edytuj alternatywnych: Utwórz i Dołącz</span><span class="sxs-lookup"><span data-stu-id="f2e5a-208">Alternative HttpPost Edit code: Create and attach</span></span>

<span data-ttu-id="f2e5a-209">Zalecane kodu edycji HttpPost gwarantuje, że tylko zmienione kolumny pobierania aktualizacji i zachowuje dane w właściwości, które nie mają być dołączane do wiązania modelu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-209">The recommended HttpPost edit code ensures that only changed columns get updated and preserves data in properties that you don't want included for model binding.</span></span> <span data-ttu-id="f2e5a-210">Jednak odczytu pierwszego podejścia wymaga dodatkowych bazy danych do odczytu i może spowodować bardziej złożonego kodu do obsługi konfliktom współbieżności.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-210">However, the read-first approach requires an extra database read, and can result in more complex code for handling concurrency conflicts.</span></span> <span data-ttu-id="f2e5a-211">Alternatywą jest dołączyć jednostki utworzone przez integratora modelu dla kontekstu EF i oznacz ją jako zmodyfikowane.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-211">An alternative is to attach an entity created by the model binder to the EF context and mark it as modified.</span></span> <span data-ttu-id="f2e5a-212">(Nie Aktualizuj projektu o tym kodzie tylko wykazał ilustrujący opcjonalne podejście.)</span><span class="sxs-lookup"><span data-stu-id="f2e5a-212">(Don't update your project with this code, it's only shown to illustrate an optional approach.)</span></span> 

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_CreateAndAttach)]

<span data-ttu-id="f2e5a-213">Tej metody można użyć po stronie interfejsu użytkownika sieci web obejmuje wszystkie pola w jednostce i można ich zaktualizować.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-213">You can use this approach when the web page UI includes all of the fields in the entity and can update any of them.</span></span>

<span data-ttu-id="f2e5a-214">Kod z utworzonym szkieletem używa metody tworzenia i dołączyć, ale tylko przechwytuje `DbUpdateConcurrencyException` wyjątki i zwraca 404 kody błędów.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-214">The scaffolded code uses the create-and-attach approach but only catches `DbUpdateConcurrencyException` exceptions and returns 404 error codes.</span></span>  <span data-ttu-id="f2e5a-215">Przykład pokazany przechwytuje żadnych wyjątków aktualizacji bazy danych i wyświetla komunikat o błędzie.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-215">The example shown catches any database update exception and displays an error message.</span></span>

### <a name="entity-states"></a><span data-ttu-id="f2e5a-216">Stany jednostki</span><span class="sxs-lookup"><span data-stu-id="f2e5a-216">Entity States</span></span>

<span data-ttu-id="f2e5a-217">Przechowuje informacje o kontekście bazy danych, czy jednostki w pamięci są zsynchronizowane z ich odpowiednich wierszy w bazie danych, a te informacje określa, co się stanie w przypadku wywołania `SaveChanges` metody.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-217">The database context keeps track of whether entities in memory are in sync with their corresponding rows in the database, and this information determines what happens when you call the `SaveChanges` method.</span></span> <span data-ttu-id="f2e5a-218">Na przykład podczas przekazywania nową jednostkę do `Add` — metoda, która stanu jednostki jest ustawiona na `Added`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-218">For example, when you pass a new entity to the `Add` method, that entity's state is set to `Added`.</span></span> <span data-ttu-id="f2e5a-219">Następnie podczas wywoływania `SaveChanges` metody kontekst bazy danych wydaje polecenia SQL INSERT.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-219">Then when you call the `SaveChanges` method, the database context issues a SQL INSERT command.</span></span>

<span data-ttu-id="f2e5a-220">Jednostka może być w jednym z następujących stanów:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-220">An entity may be in one of the following states:</span></span>

* <span data-ttu-id="f2e5a-221">`Added`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-221">`Added`.</span></span> <span data-ttu-id="f2e5a-222">Jednostka nie istnieje jeszcze w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-222">The entity doesn't yet exist in the database.</span></span> <span data-ttu-id="f2e5a-223">`SaveChanges` Metody wystawia instrukcji INSERT.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-223">The `SaveChanges` method issues an INSERT statement.</span></span>

* <span data-ttu-id="f2e5a-224">`Unchanged`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-224">`Unchanged`.</span></span> <span data-ttu-id="f2e5a-225">Nie trzeba żadnego ustawienia można zrobić za pomocą tej jednostki przez `SaveChanges` metody.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-225">Nothing needs to be done with this entity by the `SaveChanges` method.</span></span> <span data-ttu-id="f2e5a-226">Podczas odczytu jednostki bazy danych, jednostka rozpoczyna się od tego stanu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-226">When you read an entity from the database, the entity starts out with this status.</span></span>

* <span data-ttu-id="f2e5a-227">`Modified`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-227">`Modified`.</span></span> <span data-ttu-id="f2e5a-228">Zmodyfikowano niektóre lub wszystkie wartości właściwości jednostki.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-228">Some or all of the entity's property values have been modified.</span></span> <span data-ttu-id="f2e5a-229">`SaveChanges` Metody wystawia instrukcji UPDATE.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-229">The `SaveChanges` method issues an UPDATE statement.</span></span>

* <span data-ttu-id="f2e5a-230">`Deleted`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-230">`Deleted`.</span></span> <span data-ttu-id="f2e5a-231">Jednostka została oznaczona do usunięcia.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-231">The entity has been marked for deletion.</span></span> <span data-ttu-id="f2e5a-232">`SaveChanges` Metody wystawia instrukcji DELETE.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-232">The `SaveChanges` method issues a DELETE statement.</span></span>

* <span data-ttu-id="f2e5a-233">`Detached`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-233">`Detached`.</span></span> <span data-ttu-id="f2e5a-234">Jednostka nie jest śledzony przez kontekst bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-234">The entity isn't being tracked by the database context.</span></span>

<span data-ttu-id="f2e5a-235">W aplikacji pulpitu zmian stanu zwykle są ustawiane automatycznie.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-235">In a desktop application, state changes are typically set automatically.</span></span> <span data-ttu-id="f2e5a-236">Przeczytaj jednostki i wprowadzić zmiany w niektóre z jej wartości właściwości.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-236">You read an entity and make changes to some of its property values.</span></span> <span data-ttu-id="f2e5a-237">Powoduje to, że jego stan jednostki automatycznie zmieniona na `Modified`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-237">This causes its entity state to automatically be changed to `Modified`.</span></span> <span data-ttu-id="f2e5a-238">Następnie podczas wywoływania `SaveChanges`, Entity Framework generuje instrukcję aktualizacji programu SQL, która aktualizuje tylko rzeczywiste właściwości, które zostało zmienione.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-238">Then when you call `SaveChanges`, the Entity Framework generates a SQL UPDATE statement that updates only the actual properties that you changed.</span></span>

<span data-ttu-id="f2e5a-239">W aplikacji sieci web `DbContext` który początkowo odczytuje jednostki i wyświetla jego dane można edytowane zostanie usunięty po renderowania strony.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-239">In a web app, the `DbContext` that initially reads an entity and displays its data to be edited is disposed after a page is rendered.</span></span> <span data-ttu-id="f2e5a-240">Gdy HttpPost `Edit` metoda akcji jest wywoływana, nowych żądań sieci web i masz nowe wystąpienie klasy `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-240">When the HttpPost `Edit` action method is called,  a new web request is made and you have a new instance of the `DbContext`.</span></span> <span data-ttu-id="f2e5a-241">Jeśli ponownie odczytać jednostki, w tym kontekście nowe, można symulować przetwarzania pulpitu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-241">If you re-read the entity in that new context, you simulate desktop processing.</span></span>

<span data-ttu-id="f2e5a-242">Ale jeśli nie chcesz zrobić nadmiarowe operacja odczytu, należy użyć obiektu jednostki, utworzonego przez integratora modelu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-242">But if you don't want to do the extra read operation, you have to use the entity object created by the model binder.</span></span>  <span data-ttu-id="f2e5a-243">Najprostszym sposobem, aby to zrobić, jest do ustawienia stanu jednostki zmodyfikowane, co jest wykonywane w kodzie HttpPost Edytuj alternatywnych przedstawiona wcześniej.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-243">The simplest way to do this is to set the entity state to Modified as is done in the alternative HttpPost Edit code shown earlier.</span></span> <span data-ttu-id="f2e5a-244">Następnie podczas wywoływania `SaveChanges`, Entity Framework aktualizacji wszystkie kolumny wiersza bazy danych, ponieważ kontekst nie ma możliwości wiedzieć, właściwości, które zostało zmienione.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-244">Then when you call `SaveChanges`, the Entity Framework updates all columns of the database row, because the context has no way to know which properties you changed.</span></span>

<span data-ttu-id="f2e5a-245">Jeśli chce się uniknąć odczytu pierwszego podejścia, ale ma także instrukcji SQL UPDATE można zaktualizować tylko pola, które użytkownik faktycznie zmienił, kod jest bardziej złożony.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-245">If you want to avoid the read-first approach, but you also want the SQL UPDATE statement to update only the fields that the user actually changed, the code is more complex.</span></span> <span data-ttu-id="f2e5a-246">Masz próbę zapisania oryginalnych wartości w jakiś sposób (takich jak przy użyciu pola ukryte), dzięki czemu są one dostępne podczas HttpPost `Edit` metoda jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-246">You have to save the original values in some way (such as by using hidden fields) so that they're available when the HttpPost `Edit` method is called.</span></span> <span data-ttu-id="f2e5a-247">Następnie można utworzyć jednostki dla użytkowników domowych, przy użyciu oryginalnych wartości, wywołanie `Attach` metody z tej wersji oryginalnej jednostki, zaktualizuj wartości jednostki do nowych wartości, a następnie wywołać `SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-247">Then you can create a Student entity using the original values, call the `Attach` method with that original version of the entity, update the entity's values to the new values, and then call `SaveChanges`.</span></span>

### <a name="test-the-edit-page"></a><span data-ttu-id="f2e5a-248">Testowanie edycji strony</span><span class="sxs-lookup"><span data-stu-id="f2e5a-248">Test the Edit page</span></span>

<span data-ttu-id="f2e5a-249">Uruchom aplikację, wybierz **studentów** , a następnie kliknij **Edytuj** hiperłącza.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-249">Run the app, select the **Students** tab, then click an **Edit** hyperlink.</span></span>

![Strona Edytuj uczniów lub studentów](crud/_static/student-edit.png)

<span data-ttu-id="f2e5a-251">Niektóre dane i kliknij przycisk Zmień **zapisać**.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-251">Change some of the data and click **Save**.</span></span> <span data-ttu-id="f2e5a-252">**Indeksu** spowoduje otwarcie strony, aby zobaczyć zmienione dane.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-252">The **Index** page opens and you see the changed data.</span></span>

## <a name="update-the-delete-page"></a><span data-ttu-id="f2e5a-253">Zaktualizuj strony usuwania</span><span class="sxs-lookup"><span data-stu-id="f2e5a-253">Update the Delete page</span></span>

<span data-ttu-id="f2e5a-254">W *StudentController.cs*, kod szablonu HttpGet `Delete` używa metody `SingleOrDefaultAsync` metoda pobierania wybranej jednostki dla użytkowników domowych, jak przedstawiono w szczegóły i Edytuj metody.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-254">In *StudentController.cs*, the template code for the HttpGet `Delete` method uses the `SingleOrDefaultAsync` method to retrieve the selected Student entity, as you saw in the Details and Edit methods.</span></span> <span data-ttu-id="f2e5a-255">Jednak do zaimplementowania niestandardowy komunikat o błędzie podczas wywołania `SaveChanges` nie powiedzie się, niektóre funkcje zostanie dodana do tej metody i jego odpowiedni widok.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-255">However, to implement a custom error message when the call to `SaveChanges` fails, you'll add some functionality to this method and its corresponding view.</span></span>

<span data-ttu-id="f2e5a-256">Instrukcji dotyczących aktualizacji i tworzenia operacji operacji usuwania wymaga dwóch metod akcji.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-256">As you saw for update and create operations, delete operations require two action methods.</span></span> <span data-ttu-id="f2e5a-257">Metoda jest wywoływana w odpowiedzi na żądanie GET Wyświetla widok, który daje użytkownikowi możliwość zatwierdzenia lub anulować operację usuwania.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-257">The method that's called in response to a GET request displays a view that gives the user a chance to approve or cancel the delete operation.</span></span> <span data-ttu-id="f2e5a-258">Jeśli użytkownik zaakceptuje go, tworzona jest wysłanie żądania POST.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-258">If the user approves it, a POST request is created.</span></span> <span data-ttu-id="f2e5a-259">Jeśli tak się stanie, HttpPost `Delete` metoda jest wywoływana, a następnie metoda faktycznie wykonuje operację usuwania.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-259">When that happens, the HttpPost `Delete` method is called and then that method actually performs the delete operation.</span></span>

<span data-ttu-id="f2e5a-260">Blok try-catch zostanie dodana do HttpPost `Delete` można obsłużyć wszystkie błędy, które mogą wystąpić, gdy baza danych jest aktualizowana.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-260">You'll add a try-catch block to the HttpPost `Delete` method to handle any errors that might occur when the database is updated.</span></span> <span data-ttu-id="f2e5a-261">Jeśli wystąpi błąd, metoda HttpPost Delete wywołuje metodę HttpGet Delete przekazanie jej przez parametr, który wskazuje, że wystąpił błąd.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-261">If an error occurs, the HttpPost Delete method calls the HttpGet Delete method, passing it a parameter that indicates that an error has occurred.</span></span> <span data-ttu-id="f2e5a-262">Metody HttpGet Delete zostanie następnie ponownie stronę potwierdzenia oraz komunikat o błędzie, która umożliwia użytkownikowi możliwość anulowania lub spróbuj ponownie.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-262">The HttpGet Delete method then redisplays the confirmation page along with the error message, giving the user an opportunity to cancel or try again.</span></span>

<span data-ttu-id="f2e5a-263">Zastąp HttpGet `Delete` metodę akcji za pomocą następujący kod, który zarządza raportowanie błędów.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-263">Replace the HttpGet `Delete` action method with the following code, which manages error reporting.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteGet&highlight=1,9,16-21)]

<span data-ttu-id="f2e5a-264">Ten kod przyjmuje opcjonalny parametr, który wskazuje, czy metoda została wywołana po awarii, aby zapisać zmiany.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-264">This code accepts an optional parameter that indicates whether the method was called after a failure to save changes.</span></span> <span data-ttu-id="f2e5a-265">Ten parametr ma wartość false, gdy HttpGet `Delete` metoda jest wywoływana bez poprzednim błędzie.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-265">This parameter is false when the HttpGet `Delete` method is called without a previous failure.</span></span> <span data-ttu-id="f2e5a-266">Gdy jest wywoływana przez HttpPost `Delete` metody w odpowiedzi na błąd aktualizacji bazy danych, parametr ma wartość true, komunikat o błędzie jest przekazywane do widoku.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-266">When it's called by the HttpPost `Delete` method in response to a database update error, the parameter is true and an error message is passed to the view.</span></span>

### <a name="the-read-first-approach-to-httppost-delete"></a><span data-ttu-id="f2e5a-267">Podejście pierwszy odczytu do usunięcia HttpPost</span><span class="sxs-lookup"><span data-stu-id="f2e5a-267">The read-first approach to HttpPost Delete</span></span>

<span data-ttu-id="f2e5a-268">Zastąp HttpPost `Delete` metody akcji (o nazwie `DeleteConfirmed`) z następującym kodem, wykonuje operację usuwania rzeczywistego oraz przechwytującą wszystkie błędy aktualizacji bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-268">Replace the HttpPost `Delete` action method (named `DeleteConfirmed`) with the following code, which performs the actual delete operation and catches any database update errors.</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithReadFirst&highlight=6,8-11,13-14,18-23)]

<span data-ttu-id="f2e5a-269">Ten kod pobiera wybranej jednostki, następnie wywołuje `Remove` metody w celu ustawienia stanu jednostki `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-269">This code retrieves the selected entity, then calls the `Remove` method to set the entity's status to `Deleted`.</span></span> <span data-ttu-id="f2e5a-270">Gdy `SaveChanges` jest nazywany SQL DELETE wygenerowaniu polecenia.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-270">When `SaveChanges` is called, a SQL DELETE command is generated.</span></span>

### <a name="the-create-and-attach-approach-to-httppost-delete"></a><span data-ttu-id="f2e5a-271">Utwórz i dołączyć podejście do usunięcia HttpPost</span><span class="sxs-lookup"><span data-stu-id="f2e5a-271">The create-and-attach approach to HttpPost Delete</span></span>

<span data-ttu-id="f2e5a-272">W przypadku zwiększania wydajności aplikacji dużych priorytet, można uniknąć niepotrzebnych kwerend SQL przez utworzenie wystąpienia jednostki dla użytkowników domowych, przy użyciu tylko podstawowy klucz wartość, a następnie ustawienie stanu jednostki `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-272">If improving performance in a high-volume application is a priority, you could avoid an unnecessary SQL query by instantiating a Student entity using only the primary key value and then setting the entity state to `Deleted`.</span></span> <span data-ttu-id="f2e5a-273">To wszystko, który programu Entity Framework wymaga, aby usunąć jednostkę.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-273">That's all that the Entity Framework needs in order to delete the entity.</span></span> <span data-ttu-id="f2e5a-274">(Nie należy umieszczać tego kodu w projekcie; tutaj jest tylko w celu zilustrowania zamiast).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-274">(Don't put this code in your project; it's here just to illustrate an alternative.)</span></span>

[!code-csharp[](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithoutReadFirst&highlight=7-8)]

<span data-ttu-id="f2e5a-275">Jeśli jednostka ma powiązane dane, które również zostaną usunięte, upewnij się, że usuwanie kaskadowe jest skonfigurowany w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-275">If the entity has related data that should also be deleted, make sure that cascade delete is configured in the database.</span></span> <span data-ttu-id="f2e5a-276">Takie podejście do usuwania jednostki EF może mieli się, że istnieją powiązanych jednostek do usunięcia.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-276">With this approach to entity deletion, EF might not realize there are related entities to be deleted.</span></span>

### <a name="update-the-delete-view"></a><span data-ttu-id="f2e5a-277">Aktualizowanie widoku Delete</span><span class="sxs-lookup"><span data-stu-id="f2e5a-277">Update the Delete view</span></span>

<span data-ttu-id="f2e5a-278">W *Views/Student/Delete.cshtml*, Dodaj komunikat o błędzie między nagłówków h2 i nagłówek h3, jak pokazano w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-278">In *Views/Student/Delete.cshtml*, add an error message between the h2 heading and the h3 heading, as shown in the following example:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Delete.cshtml?range=7-9&highlight=2)]

<span data-ttu-id="f2e5a-279">Uruchom aplikację, wybierz **studentów** , a następnie kliknij pozycję **usunąć** hiperłącze:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-279">Run the app, select the **Students** tab, and click a **Delete** hyperlink:</span></span>

![Usuń stronę potwierdzenia](crud/_static/student-delete.png)

<span data-ttu-id="f2e5a-281">Kliknij przycisk **usunąć**.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-281">Click **Delete**.</span></span> <span data-ttu-id="f2e5a-282">Bez uczniów usuniętych zostanie wyświetlona strona indeksu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-282">The Index page is displayed without the deleted student.</span></span> <span data-ttu-id="f2e5a-283">(Będzie Zobacz przykład obsługi kodu w akcji w samouczku współbieżności błędów).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-283">(You'll see an example of the error handling code in action in the concurrency tutorial.)</span></span>

## <a name="closing-database-connections"></a><span data-ttu-id="f2e5a-284">Zamykanie połączenia bazy danych</span><span class="sxs-lookup"><span data-stu-id="f2e5a-284">Closing database connections</span></span>

<span data-ttu-id="f2e5a-285">Aby zwolnić zasoby, które przechowuje połączenia z bazą danych, wystąpienia kontekstu musi zostać usunięty tak szybko, jak to możliwe po zakończeniu z nim.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-285">To free up the resources that a database connection holds, the context instance must be disposed as soon as possible when you are done with it.</span></span> <span data-ttu-id="f2e5a-286">Wbudowane platformy ASP.NET Core [iniekcji zależności](../../fundamentals/dependency-injection.md) zajmuje to zadanie za użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-286">The ASP.NET Core built-in [dependency injection](../../fundamentals/dependency-injection.md) takes care of that task for you.</span></span>

<span data-ttu-id="f2e5a-287">W *Startup.cs*, należy wywołać [— metoda rozszerzenia AddDbContext](https://github.com/aspnet/EntityFrameworkCore/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) umożliwia kontrolerowi wyznaczenie `DbContext` klasy w kontenerze Podpisane ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-287">In *Startup.cs*, you call the [AddDbContext extension method](https://github.com/aspnet/EntityFrameworkCore/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) to provision the `DbContext` class in the ASP.NET DI container.</span></span> <span data-ttu-id="f2e5a-288">Czy metoda Ustawia okres istnienia usługi `Scoped` domyślnie.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-288">That method sets the service lifetime to `Scoped` by default.</span></span> <span data-ttu-id="f2e5a-289">`Scoped` oznacza, że okres istnienia obiektu kontekstu pokrywa się z czasem życia żądania sieci web, i `Dispose` metoda zostanie wywołana automatycznie na końcu żądania sieci web.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-289">`Scoped` means the context object lifetime coincides with the web request life time, and the `Dispose` method will be called automatically at the end of the web request.</span></span>

## <a name="handling-transactions"></a><span data-ttu-id="f2e5a-290">Obsługa transakcji</span><span class="sxs-lookup"><span data-stu-id="f2e5a-290">Handling Transactions</span></span>

<span data-ttu-id="f2e5a-291">Domyślnie programu Entity Framework niejawnie implementuje transakcji.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-291">By default the Entity Framework implicitly implements transactions.</span></span> <span data-ttu-id="f2e5a-292">W scenariuszach, gdzie zmianę wielu wierszy lub tabel, a następnie wywołać `SaveChanges`, Entity Framework automatycznie upewnia się, że wszystkie zmiany powiedzie się lub nie ich wszystkich.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-292">In scenarios where you make changes to multiple rows or tables and then call `SaveChanges`, the Entity Framework automatically makes sure that either all of your changes succeed or they all fail.</span></span> <span data-ttu-id="f2e5a-293">Jeśli niektóre zmiany są najpierw wykonywane, a następnie błąd wystąpi, zmiany te są automatycznie wycofana.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-293">If some changes are done first and then an error happens, those changes are automatically rolled back.</span></span> <span data-ttu-id="f2e5a-294">Scenariusze, w którym należy więcej kontrolujesz — na przykład, jeśli chcesz dołączyć operacje wykonywane poza Entity Framework w transakcji — można znaleźć [transakcji](https://docs.microsoft.com/ef/core/saving/transactions).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-294">For scenarios where you need more control -- for example, if you want to include operations done outside of Entity Framework in a transaction -- see [Transactions](https://docs.microsoft.com/ef/core/saving/transactions).</span></span>

## <a name="no-tracking-queries"></a><span data-ttu-id="f2e5a-295">Zapytania dotyczące śledzenia nie</span><span class="sxs-lookup"><span data-stu-id="f2e5a-295">No-tracking queries</span></span>

<span data-ttu-id="f2e5a-296">Jeśli kontekst bazy danych pobiera wiersze tabeli i tworzy obiekty jednostki, które reprezentują je, domyślnie go przechowuje informacje o czy jednostek w pamięci są zsynchronizowane z nowości w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-296">When a database context retrieves table rows and creates entity objects that represent them, by default it keeps track of whether the entities in memory are in sync with what's in the database.</span></span> <span data-ttu-id="f2e5a-297">Dane w pamięci działa jako pamięci podręcznej i jest używany podczas aktualizacji jednostki.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-297">The data in memory acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="f2e5a-298">Często jest wykorzystywana w aplikacji sieci web to buforowanie, ponieważ kontekst wystąpienia są zwykle krótkotrwałą (nowy jest utworzony i usunięty dla każdego żądania) oraz kontekst które odczytuje jednostki zazwyczaj zostanie usunięty, zanim będzie można ponownie użyć tej jednostki.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-298">This caching is often unnecessary in a web application because context instances are typically short-lived (a new one is created and disposed for each request) and the context that reads an entity is typically disposed before that entity is used again.</span></span>

<span data-ttu-id="f2e5a-299">Możesz wyłączyć śledzenie obiektów jednostek w pamięci przez wywołanie metody `AsNoTracking` metody.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-299">You can disable tracking of entity objects in memory by calling the `AsNoTracking` method.</span></span> <span data-ttu-id="f2e5a-300">Następujące typowe scenariusze, w których można to zrobić:</span><span class="sxs-lookup"><span data-stu-id="f2e5a-300">Typical scenarios in which you might want to do that include the following:</span></span>

* <span data-ttu-id="f2e5a-301">Okres istnienia kontekstu nie trzeba zaktualizować żadnych jednostek i nie trzeba EF do [automatycznie załadować właściwości nawigacji z jednostkami pobierane przez oddzielne zapytania](read-related-data.md).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-301">During the context lifetime you don't need to update any entities, and you don't need EF to [automatically load navigation properties with  entities retrieved by separate queries](read-related-data.md).</span></span> <span data-ttu-id="f2e5a-302">Często te warunki są spełnione w metod akcji kontrolera HttpGet.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-302">Frequently these conditions are met in a controller's HttpGet action methods.</span></span>

* <span data-ttu-id="f2e5a-303">Używasz kwerendę, która pobiera dużej ilości danych, a tylko niewielką część zwrócone dane zostaną zaktualizowane.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-303">You are running a query that retrieves a large volume of data, and only a small portion of the returned data will be updated.</span></span> <span data-ttu-id="f2e5a-304">Może być bardziej efektywne Wyłącz śledzenie dla dużych zapytanie i uruchom zapytanie później dla kilku jednostek, które muszą zostać zaktualizowane.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-304">It may be more efficient to turn off tracking for the large query, and run a query later for the few entities that need to be updated.</span></span>

* <span data-ttu-id="f2e5a-305">Aby dołączyć jednostki, aby można było zaktualizować go, ale wcześniej pobrać tej samej jednostki w innym celu.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-305">You want to attach an entity in order to update it, but earlier you retrieved the same entity for a different purpose.</span></span> <span data-ttu-id="f2e5a-306">Ponieważ jednostka jest już śledzony przez kontekst bazy danych, nie można dołączyć jednostki, która ma zostać zmieniony.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-306">Because the entity is already being tracked by the database context, you can't attach the entity that you want to change.</span></span> <span data-ttu-id="f2e5a-307">Jednym ze sposobów obsłużyć taką sytuację jest wywołać `AsNoTracking` na wcześniejsze zapytanie.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-307">One way to handle this situation is to call `AsNoTracking` on the earlier query.</span></span>

<span data-ttu-id="f2e5a-308">Aby uzyskać więcej informacji, zobacz [śledzenia wersji programu vs. Śledzenie nr](https://docs.microsoft.com/ef/core/querying/tracking).</span><span class="sxs-lookup"><span data-stu-id="f2e5a-308">For more information, see [Tracking vs. No-Tracking](https://docs.microsoft.com/ef/core/querying/tracking).</span></span>

## <a name="summary"></a><span data-ttu-id="f2e5a-309">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="f2e5a-309">Summary</span></span>

<span data-ttu-id="f2e5a-310">Masz teraz kompletny zestaw stron, które wykonywać proste operacje CRUD dla uczniów jednostek.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-310">You now have a complete set of pages that perform simple CRUD operations for Student entities.</span></span> <span data-ttu-id="f2e5a-311">W następnym samouczku będzie rozszerzyć funkcjonalność **indeksu** dodając sortowanie, filtrowanie i stronicowania.</span><span class="sxs-lookup"><span data-stu-id="f2e5a-311">In the next tutorial you'll expand the functionality of the **Index** page by adding sorting, filtering, and paging.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f2e5a-312">[Poprzednie](intro.md)
> [dalej](sort-filter-page.md)</span><span class="sxs-lookup"><span data-stu-id="f2e5a-312">[Previous](intro.md)
[Next](sort-filter-page.md)</span></span>  
