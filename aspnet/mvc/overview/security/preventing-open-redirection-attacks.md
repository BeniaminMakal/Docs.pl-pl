---
uid: mvc/overview/security/preventing-open-redirection-attacks
title: Zapobieganie atakom Otwórz przekierowania (C#) | Dokumentacja firmy Microsoft
author: jongalloway
description: W tym samouczku wyjaśniono, jak można zapobiec ataków Otwórz przekierowania w aplikacjach ASP.NET MVC. W tym samouczku opisano zmiany, które zostały wprowadzone...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/27/2014
ms.topic: article
ms.assetid: 69fb02e0-f5b7-4c35-878c-fa87164fc785
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/security/preventing-open-redirection-attacks
msc.type: authoredcontent
ms.openlocfilehash: ec1cd1791eb6d32e7c1ea50bc6626929cad2960e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/06/2018
---
<a name="preventing-open-redirection-attacks-c"></a><span data-ttu-id="a0445-104">Zapobieganie atakom Otwórz przekierowania (C#)</span><span class="sxs-lookup"><span data-stu-id="a0445-104">Preventing Open Redirection Attacks (C#)</span></span>
====================
<span data-ttu-id="a0445-105">przez [Galloway Jan](https://github.com/jongalloway)</span><span class="sxs-lookup"><span data-stu-id="a0445-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="a0445-106">W tym samouczku wyjaśniono, jak można zapobiec ataków Otwórz przekierowania w aplikacjach ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="a0445-106">This tutorial explains how you can prevent open redirection attacks in your ASP.NET MVC applications.</span></span> <span data-ttu-id="a0445-107">W tym samouczku opisano zmiany wprowadzone w elementu AccountController w ASP.NET MVC 3 i pokazuje, jak zastosować te zmiany w Twoje istniejące 1.0 MVC ASP.NET i aplikacji 2.</span><span class="sxs-lookup"><span data-stu-id="a0445-107">This tutorial discusses the changes that have been made in the AccountController in ASP.NET MVC 3 and demonstrates how you can apply these changes in your existing ASP.NET MVC 1.0 and 2 applications.</span></span>


## <a name="what-is-an-open-redirection-attack"></a><span data-ttu-id="a0445-108">Co to jest atak przekierowania Otwórz?</span><span class="sxs-lookup"><span data-stu-id="a0445-108">What is an Open Redirection Attack?</span></span>

<span data-ttu-id="a0445-109">Dowolnej aplikacji sieci web, która przekierowuje do adresu URL, który został określony przy użyciu żądania, takich jak dane querystring lub formularza może potencjalnie niepowołane przekierowuje użytkowników zewnętrznych, złośliwy adresu URL.</span><span class="sxs-lookup"><span data-stu-id="a0445-109">Any web application that redirects to a URL that is specified via the request such as the querystring or form data can potentially be tampered with to redirect users to an external, malicious URL.</span></span> <span data-ttu-id="a0445-110">Naruszeniu ten nosi nazwę atak przekierowania otwarte.</span><span class="sxs-lookup"><span data-stu-id="a0445-110">This tampering is called an open redirection attack.</span></span>

<span data-ttu-id="a0445-111">Zawsze, gdy logiki aplikacji przekierowuje pod określony adres URL, należy sprawdzić, czy adres URL przekierowania nie została zmieniona.</span><span class="sxs-lookup"><span data-stu-id="a0445-111">Whenever your application logic redirects to a specified URL, you must verify that the redirection URL hasn't been tampered with.</span></span> <span data-ttu-id="a0445-112">Nazwa logowania używana w domyślnym elementu AccountController dla platformy ASP.NET MVC 1.0 i ASP.NET MVC 2 jest narażony na Otwórz ataków przekierowania.</span><span class="sxs-lookup"><span data-stu-id="a0445-112">The login used in the default AccountController for both ASP.NET MVC 1.0 and ASP.NET MVC 2 is vulnerable to open redirection attacks.</span></span> <span data-ttu-id="a0445-113">Na szczęście są łatwe do aktualizowania istniejących aplikacji ma używać poprawek w wersji zapoznawczej programu ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="a0445-113">Fortunately, it is easy to update your existing applications to use the corrections from the ASP.NET MVC 3 Preview.</span></span>

<span data-ttu-id="a0445-114">Aby poznać lukę w zabezpieczeniach, Przyjrzyjmy się jak działa przekierowanie logowania w domyślny projekt aplikacji sieci Web programu ASP.NET MVC 2.</span><span class="sxs-lookup"><span data-stu-id="a0445-114">To understand the vulnerability, let's look at how the login redirection works in a default ASP.NET MVC 2 Web Application project.</span></span> <span data-ttu-id="a0445-115">W tej aplikacji próby odwiedź akcji kontrolera, który ma atrybut [Authorize] nastąpi przekierowanie nieautoryzowanych użytkowników do widoku /Account/LogOn.</span><span class="sxs-lookup"><span data-stu-id="a0445-115">In this application, attempting to visit a controller action that has the [Authorize] attribute will redirect unauthorized users to the /Account/LogOn view.</span></span> <span data-ttu-id="a0445-116">Przekierowanie do /Account/LogOn będzie zawierać parametr querystring returnUrl, dzięki czemu użytkownik może być zwracany do pierwotnie żądanego adresu URL po ich pomyślnym zalogowaniu.</span><span class="sxs-lookup"><span data-stu-id="a0445-116">This redirect to /Account/LogOn will include a returnUrl querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in.</span></span>

<span data-ttu-id="a0445-117">Na poniższym zrzucie ekranu widać, że próba dostępu do widoku /Account/ChangePassword, gdy nie jest zalogowany powoduje przekierowanie do /Account/LogOn? ReturnUrl = % 2fAccount % 2fChangePassword % 2f.</span><span class="sxs-lookup"><span data-stu-id="a0445-117">In the screenshot below, we can see that an attempt to access the /Account/ChangePassword view when not logged in results in a redirect to /Account/LogOn?ReturnUrl=%2fAccount%2fChangePassword%2f.</span></span>

[![](preventing-open-redirection-attacks/_static/image2.png)](preventing-open-redirection-attacks/_static/image1.png)

<span data-ttu-id="a0445-118">**Rysunek 01**: strony logowania z otwartych przekierowania</span><span class="sxs-lookup"><span data-stu-id="a0445-118">**Figure 01**: Login page with an open redirection</span></span>

<span data-ttu-id="a0445-119">Ponieważ parametr querystring ReturnUrl nie została zweryfikowana, osoba atakująca ją zmodyfikować, aby wprowadzić dowolny adres URL do parametru do przeprowadzenia ataku Otwórz przekierowania.</span><span class="sxs-lookup"><span data-stu-id="a0445-119">Since the ReturnUrl querystring parameter is not validated, an attacker can modify it to inject any URL address into the parameter to conduct an open redirection attack.</span></span> <span data-ttu-id="a0445-120">Aby to wykazać, firma Microsoft Zmodyfikuj parametr ReturnUrl [ http://bing.com ](http://bing.com), więc będzie wynikowy adresu URL logowania/Account/logowania? ReturnUrl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="a0445-120">To demonstrate this, we can modify the ReturnUrl parameter to [http://bing.com](http://bing.com), so the resulting login URL will be /Account/LogOn?ReturnUrl=<http://www.bing.com/>.</span></span> <span data-ttu-id="a0445-121">Po pomyślnym zalogowaniu do lokacji, możemy są przekierowywane do [ http://bing.com ](http://bing.com). Ponieważ przekierowanie nie została zweryfikowana, zamiast tego można wskazać niebezpiecznej witryny podejmowanych w celu nakłonienia użytkownika.</span><span class="sxs-lookup"><span data-stu-id="a0445-121">Upon successfully logging in to the site, we are redirected to [http://bing.com](http://bing.com). Since this redirection is not validated, it could instead point to a malicious site that attempts to trick the user.</span></span>

### <a name="a-more-complex-open-redirection-attack"></a><span data-ttu-id="a0445-122">Bardziej złożone Otwórz atak przekierowania</span><span class="sxs-lookup"><span data-stu-id="a0445-122">A more complex Open Redirection Attack</span></span>

<span data-ttu-id="a0445-123">Otwórz przekierowania ataki są szczególnie niebezpieczne, ponieważ atakujący zna próbujemy do zalogowania się do określonej witryny sieci Web, dzięki czemu nam narażony na ataki [ataku phishing](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span><span class="sxs-lookup"><span data-stu-id="a0445-123">Open redirection attacks are especially dangerous because an attacker knows that we're trying to log into a specific website, which makes us vulnerable to a [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span></span> <span data-ttu-id="a0445-124">Na przykład osoba atakująca może wysłać złośliwy wiadomości e-mail do użytkowników witryny sieci Web w celu przechwycenia haseł.</span><span class="sxs-lookup"><span data-stu-id="a0445-124">For example, an attacker could send malicious emails to website users in an attempt to capture their passwords.</span></span> <span data-ttu-id="a0445-125">Oto jak to będzie działać w witrynie NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="a0445-125">Let's look at how this would work on the NerdDinner site.</span></span> <span data-ttu-id="a0445-126">(Należy pamiętać, że działającą witrynę NerdDinner została zaktualizowana w celu ochrony przed atakami Otwórz przekierowania).</span><span class="sxs-lookup"><span data-stu-id="a0445-126">(Note that the live NerdDinner site has been updated to protect against open redirection attacks.)</span></span>

<span data-ttu-id="a0445-127">Po pierwsze osoba atakująca wysyła nam łącze do strony logowania na NerdDinner, która obejmuje przekierowanie do ich sfałszowanego strony:</span><span class="sxs-lookup"><span data-stu-id="a0445-127">First, an attacker sends us a link to the login page on NerdDinner that includes a redirect to their forged page:</span></span>

[http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn](http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn)

<span data-ttu-id="a0445-128">Należy pamiętać, że zwrotny adres URL wskazuje nerddiner.com, której brakuje "n" z obiad programu word.</span><span class="sxs-lookup"><span data-stu-id="a0445-128">Note that the return URL points to nerddiner.com, which is missing an "n" from the word dinner.</span></span> <span data-ttu-id="a0445-129">W tym przykładzie jest domena, która kontroluje, osoba atakująca.</span><span class="sxs-lookup"><span data-stu-id="a0445-129">In this example, this is a domain that the attacker controls.</span></span> <span data-ttu-id="a0445-130">Gdy firma Microsoft dostęp do tego łącza, firma Microsoft jest podjęcie uzasadnionych NerdDinner.com strony logowania.</span><span class="sxs-lookup"><span data-stu-id="a0445-130">When we access the above link, we're taken to the legitimate NerdDinner.com login page.</span></span>

[![](preventing-open-redirection-attacks/_static/image4.png)](preventing-open-redirection-attacks/_static/image3.png)

<span data-ttu-id="a0445-131">**Rysunek 02**: NerdDinner strony logowania z otwartych przekierowania</span><span class="sxs-lookup"><span data-stu-id="a0445-131">**Figure 02**: NerdDinner login page with an open redirection</span></span>

<span data-ttu-id="a0445-132">Gdy poprawnie rejestrowane, elementu ASP.NET MVC AccountController logowania akcji przekierowuje nam na adres URL określony w parametrze returnUrl querystring.</span><span class="sxs-lookup"><span data-stu-id="a0445-132">When we correctly log in, the ASP.NET MVC AccountController's LogOn action redirects us to the URL specified in the returnUrl querystring parameter.</span></span> <span data-ttu-id="a0445-133">W takim przypadku jest adres URL wprowadzony osoba atakująca, która jest [ http://nerddiner.com/Account/LogOn ](http://nerddiner.com/Account/LogOn).</span><span class="sxs-lookup"><span data-stu-id="a0445-133">In this case, it's the URL that the attacker has entered, which is [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span></span> <span data-ttu-id="a0445-134">O ile nie jest bardzo watchful, jest bardzo prawdopodobne, nie będzie zauważymy, szczególnie w przypadku, ponieważ atakujący został uważać, aby upewnić się, że ich sfałszowanego strona wygląda dokładnie strony logowania autoryzowanych.</span><span class="sxs-lookup"><span data-stu-id="a0445-134">Unless we're extremely watchful, it's very likely we won't notice this, especially because the attacker has been careful to make sure that their forged page looks exactly like the legitimate login page.</span></span> <span data-ttu-id="a0445-135">Ta strona logowania zawiera komunikat błędu żądania, że możemy zalogować się ponownie.</span><span class="sxs-lookup"><span data-stu-id="a0445-135">This login page includes an error message requesting that we login again.</span></span> <span data-ttu-id="a0445-136">Clumsy USA, firma Microsoft musi zostać błędnie nasze hasło.</span><span class="sxs-lookup"><span data-stu-id="a0445-136">Clumsy us, we must have mistyped our password.</span></span>

[![](preventing-open-redirection-attacks/_static/image6.png)](preventing-open-redirection-attacks/_static/image5.png)

<span data-ttu-id="a0445-137">**Rysunek 03**: ekran logowania sfałszowane NerdDinner</span><span class="sxs-lookup"><span data-stu-id="a0445-137">**Figure 03**: Forged NerdDinner Login screen</span></span>

<span data-ttu-id="a0445-138">Gdy firma Microsoft ponownie naszych nazwy użytkownika i hasła, strony logowania sfałszowanego zapisuje informacje i wysyła nam do witrynę NerdDinner.com.</span><span class="sxs-lookup"><span data-stu-id="a0445-138">When we retype our user name and password, the forged login page saves the information and sends us back to the legitimate NerdDinner.com site.</span></span> <span data-ttu-id="a0445-139">W tym momencie lokacji NerdDinner.com ma już uwierzytelniony us, więc strony logowania sfałszowanego można przekierowywać bezpośrednio do tej strony.</span><span class="sxs-lookup"><span data-stu-id="a0445-139">At this point, the NerdDinner.com site has already authenticated us, so the forged login page can redirect directly to that page.</span></span> <span data-ttu-id="a0445-140">W rezultacie jest ma naszych nazwę użytkownika i hasło, czy możemy wie, że udostępniliśmy ją dla nich.</span><span class="sxs-lookup"><span data-stu-id="a0445-140">The end result is that the attacker has our user name and password, and we are unaware that we've provided it to them.</span></span>

## <a name="looking-at-the-vulnerable-code-in-the-accountcontroller-logon-action"></a><span data-ttu-id="a0445-141">Spojrzenie na niebezpieczny kod w akcji elementu AccountController logowania</span><span class="sxs-lookup"><span data-stu-id="a0445-141">Looking at the vulnerable code in the AccountController LogOn Action</span></span>

<span data-ttu-id="a0445-142">Poniżej przedstawiono kod dla działań logowania w aplikacji ASP.NET MVC 2.</span><span class="sxs-lookup"><span data-stu-id="a0445-142">The code for the LogOn action in an ASP.NET MVC 2 application is shown below.</span></span> <span data-ttu-id="a0445-143">Należy pamiętać, że po pomyślnym logowaniu, kontrolera zwraca przekierowanie do returnUrl.</span><span class="sxs-lookup"><span data-stu-id="a0445-143">Note that upon a successful login, the controller returns a redirect to the returnUrl.</span></span> <span data-ttu-id="a0445-144">Widać, że weryfikacja nie jest wykonywana przed parametru returnUrl.</span><span class="sxs-lookup"><span data-stu-id="a0445-144">You can see that no validation is being performed against the returnUrl parameter.</span></span>

<span data-ttu-id="a0445-145">**Wyświetlanie listy 1 – logowania programu ASP.NET MVC 2 akcji w `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="a0445-145">**Listing 1 – ASP.NET MVC 2 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample1.cs)]

<span data-ttu-id="a0445-146">Teraz Przyjrzyjmy się zmiany do akcji logowania programu ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="a0445-146">Now let's look at the changes to the ASP.NET MVC 3 LogOn action.</span></span> <span data-ttu-id="a0445-147">Ten kod został zmieniony na sprawdzanie poprawności parametru returnUrl przez wywołanie nowej metody w klasie System.Web.Mvc.Url o nazwie `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="a0445-147">This code has been changed to validate the returnUrl parameter by calling a new method in the System.Web.Mvc.Url helper class named `IsLocalUrl()`.</span></span>

<span data-ttu-id="a0445-148">**Wyświetlanie listy 2 — akcji logowania programu ASP.NET MVC 3 `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="a0445-148">**Listing 2 – ASP.NET MVC 3 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample2.cs)]

<span data-ttu-id="a0445-149">Zostało to zmienione aby zweryfikować parametr zwrotnego adresu URL, wywołując nowej metody w klasie System.Web.Mvc.Url, `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="a0445-149">This has been changed to validate the return URL parameter by calling a new method in the System.Web.Mvc.Url helper class, `IsLocalUrl()`.</span></span>

## <a name="protecting-your-aspnet-mvc-10-and-mvc-2-applications"></a><span data-ttu-id="a0445-150">Ochrona ASP.NET MVC 1.0 i MVC 2 aplikacji</span><span class="sxs-lookup"><span data-stu-id="a0445-150">Protecting Your ASP.NET MVC 1.0 and MVC 2 Applications</span></span>

<span data-ttu-id="a0445-151">Firma Microsoft może korzystać z zmiany ASP.NET MVC 3 w naszym istniejących 1.0 MVC ASP.NET i aplikacji 2 przez dodanie metody pomocnika IsLocalUrl() i aktualizowanie akcji logowania w celu zweryfikowania parametru returnUrl.</span><span class="sxs-lookup"><span data-stu-id="a0445-151">We can take advantage of the ASP.NET MVC 3 changes in our existing ASP.NET MVC 1.0 and 2 applications by adding the IsLocalUrl() helper method and updating the LogOn action to validate the returnUrl parameter.</span></span>

<span data-ttu-id="a0445-152">Metoda UrlHelper IsLocalUrl() faktycznie tylko wywoływanie metody w System.Web.WebPages jako tej weryfikacji jest również używane przez aplikacje ASP.NET Web Pages.</span><span class="sxs-lookup"><span data-stu-id="a0445-152">The UrlHelper IsLocalUrl() method actually just calling into a method in System.Web.WebPages, as this validation is also used by ASP.NET Web Pages applications.</span></span>

<span data-ttu-id="a0445-153">**Wyświetlanie listy 3 — metody IsLocalUrl() z UrlHelper ASP.NET MVC 3 `class`**</span><span class="sxs-lookup"><span data-stu-id="a0445-153">**Listing 3 – The IsLocalUrl() method from the ASP.NET MVC 3 UrlHelper `class`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample3.cs)]

<span data-ttu-id="a0445-154">Metoda IsUrlLocalToHost zawiera logikę rzeczywista weryfikacja pokazane na listę 4.</span><span class="sxs-lookup"><span data-stu-id="a0445-154">The IsUrlLocalToHost method contains the actual validation logic, as shown in Listing 4.</span></span>

<span data-ttu-id="a0445-155">**Wyświetlanie listy 4 — metody IsUrlLocalToHost() z klasy System.Web.WebPages RequestExtensions**</span><span class="sxs-lookup"><span data-stu-id="a0445-155">**Listing 4 – IsUrlLocalToHost() method from the System.Web.WebPages RequestExtensions class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample4.cs)]

<span data-ttu-id="a0445-156">W naszym ASP.NET MVC w wersji 1.0 lub 2 aplikacji metoda IsLocalUrl() zostanie dodany do elementu AccountController, ale użytkownik ma zaleca, aby dodać go do klasę pomocy oddzielnych Jeśli to możliwe.</span><span class="sxs-lookup"><span data-stu-id="a0445-156">In our ASP.NET MVC 1.0 or 2 application, we'll add a IsLocalUrl() method to the AccountController, but you're encouraged to add it to a separate helper class if possible.</span></span> <span data-ttu-id="a0445-157">Firma Microsoft wprowadzi dwóch niewielkich zmian do wersji platformy ASP.NET MVC 3 IsLocalUrl(), dzięki czemu będzie ona działać wewnątrz elementu AccountController.</span><span class="sxs-lookup"><span data-stu-id="a0445-157">We will make two small changes to the ASP.NET MVC 3 version of IsLocalUrl() so that it will work inside the AccountController.</span></span> <span data-ttu-id="a0445-158">Najpierw zmienimy go z publiczną metodę do metody prywatnej, ponieważ są dostępne metody publiczne kontrolery akcji kontrolera.</span><span class="sxs-lookup"><span data-stu-id="a0445-158">First, we'll change it from a public method to a private method, since public methods in controllers can be accessed as controller actions.</span></span> <span data-ttu-id="a0445-159">Po drugie firma Microsoft będzie modyfikować połączenia, który sprawdza hostem adresu URL dla hosta aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a0445-159">Second, we'll modify the call that checks the URL host against the application host.</span></span> <span data-ttu-id="a0445-160">Czy połączenie korzysta z lokalnej RequestContext pole w klasie UrlHelper.</span><span class="sxs-lookup"><span data-stu-id="a0445-160">That call makes use of a local RequestContext field in the UrlHelper class.</span></span> <span data-ttu-id="a0445-161">Zamiast tego. RequestContext.HttpContext.Request.Url.Host, użyjemy go. Request.Url.Host.</span><span class="sxs-lookup"><span data-stu-id="a0445-161">Instead of using this.RequestContext.HttpContext.Request.Url.Host, we will use this.Request.Url.Host.</span></span> <span data-ttu-id="a0445-162">Poniższy kod przedstawia zmodyfikowane metody IsLocalUrl() do użytku z klasy controller w aplikacjach 2 i ASP.NET MVC w wersji 1.0.</span><span class="sxs-lookup"><span data-stu-id="a0445-162">The following code shows the modified IsLocalUrl() method for use with a controller class in ASP.NET MVC 1.0 and 2 applications.</span></span>

<span data-ttu-id="a0445-163">**Listę 5 — metoda IsLocalUrl(), który jest zmodyfikowany służących do klasy kontrolera MVC**</span><span class="sxs-lookup"><span data-stu-id="a0445-163">**Listing 5 – IsLocalUrl() method, which is modified for use with an MVC Controller class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample5.cs)]

<span data-ttu-id="a0445-164">Teraz, metoda IsLocalUrl() znajduje się w miejscu, można nazywamy go od naszych działań logowania do zweryfikowania parametru returnUrl, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="a0445-164">Now that the IsLocalUrl() method is in place, we can call it from our LogOn action to validate the returnUrl parameter, as shown in the following code.</span></span>

<span data-ttu-id="a0445-165">**Wyświetlanie listy 6 — metodę logowania zaktualizowane, która weryfikuje parametru returnUrl**</span><span class="sxs-lookup"><span data-stu-id="a0445-165">**Listing 6 – Updated LogOn method which validates the returnUrl parameter**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample6.cs)]

<span data-ttu-id="a0445-166">Teraz można było przetestować atak przekierowania otwarte przez próby Zaloguj się za pomocą zewnętrznego adresu URL zwracany.</span><span class="sxs-lookup"><span data-stu-id="a0445-166">Now we can test an open redirection attack by attempting to log in using an external return URL.</span></span> <span data-ttu-id="a0445-167">Użyjmy /Account/LogOn? ReturnUrl =<http://www.bing.com/> ponownie.</span><span class="sxs-lookup"><span data-stu-id="a0445-167">Let's use /Account/LogOn?ReturnUrl=<http://www.bing.com/> again.</span></span>

[![](preventing-open-redirection-attacks/_static/image8.png)](preventing-open-redirection-attacks/_static/image7.png)

<span data-ttu-id="a0445-168">**Rysunek 04**: testowanie zaktualizowane akcji logowania</span><span class="sxs-lookup"><span data-stu-id="a0445-168">**Figure 04**: Testing the updated LogOn Action</span></span>

<span data-ttu-id="a0445-169">Po pomyślnym zalogowaniu możemy są przekierowywane do akcji kontrolera głównej/indeksu, a nie jako zewnętrzny adres URL.</span><span class="sxs-lookup"><span data-stu-id="a0445-169">After successfully logging in, we are redirected to the Home/Index Controller action rather than the external URL.</span></span>

[![](preventing-open-redirection-attacks/_static/image10.png)](preventing-open-redirection-attacks/_static/image9.png)

<span data-ttu-id="a0445-170">**Rysunek 05**: atak przekierowania Otwórz udaremnione</span><span class="sxs-lookup"><span data-stu-id="a0445-170">**Figure 05**: Open Redirection attack defeated</span></span>

## <a name="summary"></a><span data-ttu-id="a0445-171">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="a0445-171">Summary</span></span>

<span data-ttu-id="a0445-172">Otwórz przekierowania ataków może wystąpić, gdy przekierowania adresów URL są przekazywane jako parametry w adresie URL dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a0445-172">Open redirection attacks can occur when redirection URLs are passed as parameters in the URL for an application.</span></span> <span data-ttu-id="a0445-173">ASP.NET MVC 3 szablon zawiera kod, aby zapewnić ochronę przed Otwórz ataków przekierowania.</span><span class="sxs-lookup"><span data-stu-id="a0445-173">The ASP.NET MVC 3 template includes code to protect against open redirection attacks.</span></span> <span data-ttu-id="a0445-174">Możesz dodać ten kod z niektórych modyfikację ASP.NET MVC w wersji 1.0 oraz 2 aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a0445-174">You can add this code with some modification to ASP.NET MVC 1.0 and 2 applications.</span></span> <span data-ttu-id="a0445-175">Ochronę przed atakami Otwórz przekierowania, podczas logowania się do platformy ASP.NET w wersji 1.0 oraz 2 aplikacji, Dodaj metodę IsLocalUrl() i sprawdzanie poprawności parametru returnUrl w operacji logowania.</span><span class="sxs-lookup"><span data-stu-id="a0445-175">To protect against open redirection attacks when logging into ASP.NET 1.0 and 2 applications, add a IsLocalUrl() method and validate the returnUrl parameter in the LogOn action.</span></span>
